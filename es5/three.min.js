"use strict";function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map():undefined;_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!_isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function");}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper);}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor);}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _setPrototypeOf(Wrapper,Class);};return _wrapNativeSuper(Class);}function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct.bind();}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor();if(Class)_setPrototypeOf(instance,Class.prototype);return instance;};}return _construct.apply(null,arguments);}function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1;}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{Promise.resolve(value).then(_next,_throw);}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value);}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err);}_next(undefined);});};}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e338){throw _e338;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e339){didErr=true;err=_e339;},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]();}finally{if(didErr)throw err;}}};}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_x,_r,_arr=[],_n=!0,_d=!1;try{if(_x=(_i=_i.call(arr)).next,0===i){if(Object(_i)!==_i)return;_n=!1;}else for(;!(_n=(_s=_x.call(_i)).done)&&(_arr.push(_s.value),_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err;}finally{try{if(!_n&&null!=_i["return"]&&(_r=_i["return"](),Object(_r)!==_r))return;}finally{if(_d)throw _e;}}return _arr;}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}function _get(){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get.bind();}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(arguments.length<3?target:receiver);}return desc.value;};}return _get.apply(this,arguments);}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break;}return object;}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});Object.defineProperty(subClass,"prototype",{writable:false});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined");}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _regeneratorRuntime(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function _regeneratorRuntime(){return exports;};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,defineProperty=Object.defineProperty||function(obj,key,desc){obj[key]=desc.value;},$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key];}try{define({},"");}catch(err){define=function define(obj,key,value){return obj[key]=value;};}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return defineProperty(generator,"_invoke",{value:makeInvokeMethod(innerFn,self,context)}),generator;}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)};}catch(err){return{type:"throw",arg:err};}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,function(){return this;});var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){define(prototype,method,function(arg){return this._invoke(method,arg);});});}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==_typeof(value)&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject);},function(err){invoke("throw",err,resolve,reject);}):PromiseImpl.resolve(value).then(function(unwrapped){result.value=unwrapped,resolve(result);},function(error){return invoke("throw",error,resolve,reject);});}reject(record.arg);}var previousPromise;defineProperty(this,"_invoke",{value:function value(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl(function(resolve,reject){invoke(method,arg,resolve,reject);});}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg();}});}function makeInvokeMethod(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult();}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult;}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg);}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done};}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg);}};}function maybeInvokeDelegate(delegate,context){var methodName=context.method,method=delegate.iterator[methodName];if(undefined===method)return context.delegate=null,"throw"===methodName&&delegate.iterator["return"]&&(context.method="return",context.arg=undefined,maybeInvokeDelegate(delegate,context),"throw"===context.method)||"return"!==methodName&&(context.method="throw",context.arg=new TypeError("The iterator does not provide a '"+methodName+"' method")),ContinueSentinel;var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=undefined),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel);}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry);}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record;}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0);}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=undefined,next.done=!0,next;};return next.next=next;}}return{next:doneResult};}function doneResult(){return{value:undefined,done:!0};}return GeneratorFunction.prototype=GeneratorFunctionPrototype,defineProperty(Gp,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),defineProperty(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name));},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun;},exports.awrap=function(arg){return{__await:arg};},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,function(){return this;}),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next();});},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,function(){return this;}),define(Gp,"toString",function(){return"[object Generator]";}),exports.keys=function(val){var object=Object(val),keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next;}return next.done=!0,next;};},exports.values=values,Context.prototype={constructor:Context,reset:function reset(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=undefined);},stop:function stop(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval;},dispatchException:function dispatchException(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=undefined),!!caught;}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc);}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc);}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break;}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record);},complete:function complete(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel;},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel;}},"catch":function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry);}return thrown;}}throw new Error("illegal catch attempt");},delegateYield:function delegateYield(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=undefined),ContinueSentinel;}},exports;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key);}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return(hint==="string"?String:Number)(input);}function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;},_typeof(obj);}console.warn('Scripts "build/three.js" and "build/three.min.js" are deprecated with r150+, and will be removed with r160. Please use ES Modules or alternatives: https://threejs.org/docs/index.html#manual/en/introduction/Installation'),/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function(t,e){"object"==(typeof exports==="undefined"?"undefined":_typeof(exports))&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).THREE={});}(void 0,function(t){"use strict";var _we;var e="160",n=1,i=2,r=3,s=0,a=1,o=100,l=204,c=205,h=0,u=1,d=2,p=0,m=1,f=2,g=3,_=4,v=5,x=6,y="attached",M="detached",S=300,b=301,T=302,E=303,w=304,A=306,R=1e3,C=1001,L=1002,P=1003,I=1004,U=1005,D=1006,N=1007,O=1008,F=1009,B=1012,z=1013,G=1014,H=1015,V=1016,k=1017,W=1018,X=1020,j=1023,q=1026,Y=1027,Z=1029,J=1031,K=1033,$=33776,Q=33777,tt=33778,et=33779,nt=35840,it=35841,rt=35842,st=35843,at=36196,ot=37492,lt=37496,ct=37808,ht=37809,ut=37810,dt=37811,pt=37812,mt=37813,ft=37814,gt=37815,_t=37816,vt=37817,xt=37818,yt=37819,Mt=37820,St=37821,bt=36492,Tt=36494,Et=36495,wt=36284,At=36285,Rt=36286,Ct=2300,Lt=2301,Pt=2302,It=2400,Ut=2401,Dt=2402,Nt=2500,Ot=2501,Ft=3e3,Bt=3001,zt="",Gt="srgb",Ht="srgb-linear",Vt="display-p3",kt="display-p3-linear",Wt="linear",Xt="srgb",jt="rec709",qt="p3",Yt=7680,Zt=35044,Jt="300 es",Kt=1035,$t=2e3,Qt=2001;var te=/*#__PURE__*/function(){function te(){_classCallCheck(this,te);}_createClass(te,[{key:"addEventListener",value:function addEventListener(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e);}},{key:"hasEventListener",value:function hasEventListener(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e);}},{key:"removeEventListener",value:function removeEventListener(t,e){if(void 0===this._listeners)return;var n=this._listeners[t];if(void 0!==n){var _t2=n.indexOf(e);-1!==_t2&&n.splice(_t2,1);}}},{key:"dispatchEvent",value:function dispatchEvent(t){if(void 0===this._listeners)return;var e=this._listeners[t.type];if(void 0!==e){t.target=this;var _n2=e.slice(0);for(var _e2=0,_i2=_n2.length;_e2<_i2;_e2++)_n2[_e2].call(this,t);t.target=null;}}}]);return te;}();var ee=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];var ne=1234567;var ie=Math.PI/180,re=180/Math.PI;function se(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(ee[255&t]+ee[t>>8&255]+ee[t>>16&255]+ee[t>>24&255]+"-"+ee[255&e]+ee[e>>8&255]+"-"+ee[e>>16&15|64]+ee[e>>24&255]+"-"+ee[63&n|128]+ee[n>>8&255]+"-"+ee[n>>16&255]+ee[n>>24&255]+ee[255&i]+ee[i>>8&255]+ee[i>>16&255]+ee[i>>24&255]).toLowerCase();}function ae(t,e,n){return Math.max(e,Math.min(n,t));}function oe(t,e){return(t%e+e)%e;}function le(t,e,n){return(1-n)*t+n*e;}function ce(t){return 0==(t&t-1)&&0!==t;}function he(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2));}function ue(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.");}}function de(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.");}}var pe={DEG2RAD:ie,RAD2DEG:re,generateUUID:se,clamp:ae,euclideanModulo:oe,mapLinear:function mapLinear(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e);},inverseLerp:function inverseLerp(t,e,n){return t!==e?(n-t)/(e-t):0;},lerp:le,damp:function damp(t,e,n,i){return le(t,e,1-Math.exp(-n*i));},pingpong:function pingpong(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return e-Math.abs(oe(t,2*e)-e);},smoothstep:function smoothstep(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t);},smootherstep:function smootherstep(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10);},randInt:function randInt(t,e){return t+Math.floor(Math.random()*(e-t+1));},randFloat:function randFloat(t,e){return t+Math.random()*(e-t);},randFloatSpread:function randFloatSpread(t){return t*(.5-Math.random());},seededRandom:function seededRandom(t){void 0!==t&&(ne=t);var e=ne+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296;},degToRad:function degToRad(t){return t*ie;},radToDeg:function radToDeg(t){return t*re;},isPowerOfTwo:ce,ceilPowerOfTwo:function ceilPowerOfTwo(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2));},floorPowerOfTwo:he,setQuaternionFromProperEuler:function setQuaternionFromProperEuler(t,e,n,i,r){var s=Math.cos,a=Math.sin,o=s(n/2),l=a(n/2),c=s((e+i)/2),h=a((e+i)/2),u=s((e-i)/2),d=a((e-i)/2),p=s((i-e)/2),m=a((i-e)/2);switch(r){case"XYX":t.set(o*h,l*u,l*d,o*c);break;case"YZY":t.set(l*d,o*h,l*u,o*c);break;case"ZXZ":t.set(l*u,l*d,o*h,o*c);break;case"XZX":t.set(o*h,l*m,l*p,o*c);break;case"YXY":t.set(l*p,o*h,l*m,o*c);break;case"ZYZ":t.set(l*m,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r);}},normalize:de,denormalize:ue};var me=/*#__PURE__*/function(_Symbol$iterator){function me(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,me);me.prototype.isVector2=!0,this.x=t,this.y=e;}_createClass(me,[{key:"width",get:function get(){return this.x;},set:function set(t){this.x=t;}},{key:"height",get:function get(){return this.y;},set:function set(t){this.y=t;}},{key:"set",value:function set(t,e){return this.x=t,this.y=e,this;}},{key:"setScalar",value:function setScalar(t){return this.x=t,this.y=t,this;}},{key:"setX",value:function setX(t){return this.x=t,this;}},{key:"setY",value:function setY(t){return this.y=t,this;}},{key:"setComponent",value:function setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t);}return this;}},{key:"getComponent",value:function getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t);}}},{key:"clone",value:function clone(){return new this.constructor(this.x,this.y);}},{key:"copy",value:function copy(t){return this.x=t.x,this.y=t.y,this;}},{key:"add",value:function add(t){return this.x+=t.x,this.y+=t.y,this;}},{key:"addScalar",value:function addScalar(t){return this.x+=t,this.y+=t,this;}},{key:"addVectors",value:function addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this;}},{key:"addScaledVector",value:function addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this;}},{key:"sub",value:function sub(t){return this.x-=t.x,this.y-=t.y,this;}},{key:"subScalar",value:function subScalar(t){return this.x-=t,this.y-=t,this;}},{key:"subVectors",value:function subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this;}},{key:"multiply",value:function multiply(t){return this.x*=t.x,this.y*=t.y,this;}},{key:"multiplyScalar",value:function multiplyScalar(t){return this.x*=t,this.y*=t,this;}},{key:"divide",value:function divide(t){return this.x/=t.x,this.y/=t.y,this;}},{key:"divideScalar",value:function divideScalar(t){return this.multiplyScalar(1/t);}},{key:"applyMatrix3",value:function applyMatrix3(t){var e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this;}},{key:"min",value:function min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this;}},{key:"max",value:function max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this;}},{key:"clamp",value:function clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this;}},{key:"clampScalar",value:function clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this;}},{key:"clampLength",value:function clampLength(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)));}},{key:"floor",value:function floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this;}},{key:"ceil",value:function ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this;}},{key:"round",value:function round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this;}},{key:"roundToZero",value:function roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this;}},{key:"negate",value:function negate(){return this.x=-this.x,this.y=-this.y,this;}},{key:"dot",value:function dot(t){return this.x*t.x+this.y*t.y;}},{key:"cross",value:function cross(t){return this.x*t.y-this.y*t.x;}},{key:"lengthSq",value:function lengthSq(){return this.x*this.x+this.y*this.y;}},{key:"length",value:function length(){return Math.sqrt(this.x*this.x+this.y*this.y);}},{key:"manhattanLength",value:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y);}},{key:"normalize",value:function normalize(){return this.divideScalar(this.length()||1);}},{key:"angle",value:function angle(){return Math.atan2(-this.y,-this.x)+Math.PI;}},{key:"angleTo",value:function angleTo(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;var n=this.dot(t)/e;return Math.acos(ae(n,-1,1));}},{key:"distanceTo",value:function distanceTo(t){return Math.sqrt(this.distanceToSquared(t));}},{key:"distanceToSquared",value:function distanceToSquared(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n;}},{key:"manhattanDistanceTo",value:function manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y);}},{key:"setLength",value:function setLength(t){return this.normalize().multiplyScalar(t);}},{key:"lerp",value:function lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this;}},{key:"lerpVectors",value:function lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this;}},{key:"equals",value:function equals(t){return t.x===this.x&&t.y===this.y;}},{key:"fromArray",value:function fromArray(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this;}},{key:"toArray",value:function toArray(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t;}},{key:"fromBufferAttribute",value:function fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this;}},{key:"rotateAround",value:function rotateAround(t,e){var n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*i+t.x,this.y=r*i+s*n+t.y,this;}},{key:"random",value:function random(){return this.x=Math.random(),this.y=Math.random(),this;}},{key:_Symbol$iterator,value:/*#__PURE__*/_regeneratorRuntime().mark(function value(){return _regeneratorRuntime().wrap(function value$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return this.x;case 2:_context.next=4;return this.y;case 4:case"end":return _context.stop();}},value,this);})}]);return me;}(Symbol.iterator);var fe=/*#__PURE__*/function(){function fe(t,e,n,i,r,s,a,o,l){_classCallCheck(this,fe);fe.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,s,a,o,l);}_createClass(fe,[{key:"set",value:function set(t,e,n,i,r,s,a,o,l){var c=this.elements;return c[0]=t,c[1]=i,c[2]=a,c[3]=e,c[4]=r,c[5]=o,c[6]=n,c[7]=s,c[8]=l,this;}},{key:"identity",value:function identity(){return this.set(1,0,0,0,1,0,0,0,1),this;}},{key:"copy",value:function copy(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this;}},{key:"extractBasis",value:function extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this;}},{key:"setFromMatrix4",value:function setFromMatrix4(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this;}},{key:"multiply",value:function multiply(t){return this.multiplyMatrices(this,t);}},{key:"premultiply",value:function premultiply(t){return this.multiplyMatrices(t,this);}},{key:"multiplyMatrices",value:function multiplyMatrices(t,e){var n=t.elements,i=e.elements,r=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],c=n[4],h=n[7],u=n[2],d=n[5],p=n[8],m=i[0],f=i[3],g=i[6],_=i[1],v=i[4],x=i[7],y=i[2],M=i[5],S=i[8];return r[0]=s*m+a*_+o*y,r[3]=s*f+a*v+o*M,r[6]=s*g+a*x+o*S,r[1]=l*m+c*_+h*y,r[4]=l*f+c*v+h*M,r[7]=l*g+c*x+h*S,r[2]=u*m+d*_+p*y,r[5]=u*f+d*v+p*M,r[8]=u*g+d*x+p*S,this;}},{key:"multiplyScalar",value:function multiplyScalar(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this;}},{key:"determinant",value:function determinant(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8];return e*s*c-e*a*l-n*r*c+n*a*o+i*r*l-i*s*o;}},{key:"invert",value:function invert(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=c*s-a*l,u=a*o-c*r,d=l*r-s*o,p=e*h+n*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);var m=1/p;return t[0]=h*m,t[1]=(i*l-c*n)*m,t[2]=(a*n-i*s)*m,t[3]=u*m,t[4]=(c*e-i*o)*m,t[5]=(i*r-a*e)*m,t[6]=d*m,t[7]=(n*o-l*e)*m,t[8]=(s*e-n*r)*m,this;}},{key:"transpose",value:function transpose(){var t;var e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this;}},{key:"getNormalMatrix",value:function getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose();}},{key:"transposeIntoArray",value:function transposeIntoArray(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this;}},{key:"setUvTransform",value:function setUvTransform(t,e,n,i,r,s,a){var o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*s+l*a)+s+t,-i*l,i*o,-i*(-l*s+o*a)+a+e,0,0,1),this;}},{key:"scale",value:function scale(t,e){return this.premultiply(ge.makeScale(t,e)),this;}},{key:"rotate",value:function rotate(t){return this.premultiply(ge.makeRotation(-t)),this;}},{key:"translate",value:function translate(t,e){return this.premultiply(ge.makeTranslation(t,e)),this;}},{key:"makeTranslation",value:function makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this;}},{key:"makeRotation",value:function makeRotation(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this;}},{key:"makeScale",value:function makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this;}},{key:"equals",value:function equals(t){var e=this.elements,n=t.elements;for(var _t3=0;_t3<9;_t3++)if(e[_t3]!==n[_t3])return!1;return!0;}},{key:"fromArray",value:function fromArray(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;for(var _n3=0;_n3<9;_n3++)this.elements[_n3]=t[_n3+e];return this;}},{key:"toArray",value:function toArray(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t;}},{key:"clone",value:function clone(){return new this.constructor().fromArray(this.elements);}}]);return fe;}();var ge=new fe();function _e(t){for(var _e3=t.length-1;_e3>=0;--_e3)if(t[_e3]>=65535)return!0;return!1;}var ve={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function xe(t,e){return new ve[t](e);}function ye(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t);}function Me(){var t=ye("canvas");return t.style.display="block",t;}var Se={};function be(t){t in Se||(Se[t]=!0,console.warn(t));}var Te=new fe().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Ee=new fe().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),we=(_we={},_defineProperty(_we,Ht,{transfer:Wt,primaries:jt,toReference:function toReference(t){return t;},fromReference:function fromReference(t){return t;}}),_defineProperty(_we,Gt,{transfer:Xt,primaries:jt,toReference:function toReference(t){return t.convertSRGBToLinear();},fromReference:function fromReference(t){return t.convertLinearToSRGB();}}),_defineProperty(_we,kt,{transfer:Wt,primaries:qt,toReference:function toReference(t){return t.applyMatrix3(Ee);},fromReference:function fromReference(t){return t.applyMatrix3(Te);}}),_defineProperty(_we,Vt,{transfer:Xt,primaries:qt,toReference:function toReference(t){return t.convertSRGBToLinear().applyMatrix3(Ee);},fromReference:function fromReference(t){return t.applyMatrix3(Te).convertLinearToSRGB();}}),_we),Ae=new Set([Ht,kt]),Re={enabled:!0,_workingColorSpace:Ht,get workingColorSpace(){return this._workingColorSpace;},set workingColorSpace(t){if(!Ae.has(t))throw new Error("Unsupported working color space, \"".concat(t,"\"."));this._workingColorSpace=t;},convert:function convert(t,e,n){if(!1===this.enabled||e===n||!e||!n)return t;var i=we[e].toReference;return(0,we[n].fromReference)(i(t));},fromWorkingColorSpace:function fromWorkingColorSpace(t,e){return this.convert(t,this._workingColorSpace,e);},toWorkingColorSpace:function toWorkingColorSpace(t,e){return this.convert(t,e,this._workingColorSpace);},getPrimaries:function getPrimaries(t){return we[t].primaries;},getTransfer:function getTransfer(t){return t===zt?Wt:we[t].transfer;}};function Ce(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4);}function Le(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055;}var Pe;var Ie=/*#__PURE__*/function(){function Ie(){_classCallCheck(this,Ie);}_createClass(Ie,null,[{key:"getDataURL",value:function getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;var e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Pe&&(Pe=ye("canvas")),Pe.width=t.width,Pe.height=t.height;var _n4=Pe.getContext("2d");t instanceof ImageData?_n4.putImageData(t,0,0):_n4.drawImage(t,0,0,t.width,t.height),e=Pe;}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png");}},{key:"sRGBToLinear",value:function sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){var _e4=ye("canvas");_e4.width=t.width,_e4.height=t.height;var _n5=_e4.getContext("2d");_n5.drawImage(t,0,0,t.width,t.height);var _i3=_n5.getImageData(0,0,t.width,t.height),_r2=_i3.data;for(var _t4=0;_t4<_r2.length;_t4++)_r2[_t4]=255*Ce(_r2[_t4]/255);return _n5.putImageData(_i3,0,0),_e4;}if(t.data){var _e5=t.data.slice(0);for(var _t5=0;_t5<_e5.length;_t5++)_e5 instanceof Uint8Array||_e5 instanceof Uint8ClampedArray?_e5[_t5]=Math.floor(255*Ce(_e5[_t5]/255)):_e5[_t5]=Ce(_e5[_t5]);return{data:_e5,width:t.width,height:t.height};}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t;}}]);return Ie;}();var Ue=0;var De=/*#__PURE__*/function(){function De(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,De);this.isSource=!0,Object.defineProperty(this,"id",{value:Ue++}),this.uuid=se(),this.data=t,this.version=0;}_createClass(De,[{key:"needsUpdate",set:function set(t){!0===t&&this.version++;}},{key:"toJSON",value:function toJSON(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];var n={uuid:this.uuid,url:""},i=this.data;if(null!==i){var _t6;if(Array.isArray(i)){_t6=[];for(var _e6=0,_n6=i.length;_e6<_n6;_e6++)i[_e6].isDataTexture?_t6.push(Ne(i[_e6].image)):_t6.push(Ne(i[_e6]));}else _t6=Ne(i);n.url=_t6;}return e||(t.images[this.uuid]=n),n;}}]);return De;}();function Ne(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Ie.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{});}var Oe=0;var Fe=/*#__PURE__*/function(_te){_inherits(Fe,_te);var _super=_createSuper(Fe);function Fe(){var _this;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Fe.DEFAULT_IMAGE;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Fe.DEFAULT_MAPPING;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1001;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1001;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1006;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1008;var a=arguments.length>6&&arguments[6]!==undefined?arguments[6]:1023;var o=arguments.length>7&&arguments[7]!==undefined?arguments[7]:1009;var l=arguments.length>8&&arguments[8]!==undefined?arguments[8]:Fe.DEFAULT_ANISOTROPY;var c=arguments.length>9&&arguments[9]!==undefined?arguments[9]:"";_classCallCheck(this,Fe);_this=_super.call(this),_this.isTexture=!0,Object.defineProperty(_assertThisInitialized(_this),"id",{value:Oe++}),_this.uuid=se(),_this.name="",_this.source=new De(t),_this.mipmaps=[],_this.mapping=e,_this.channel=0,_this.wrapS=n,_this.wrapT=i,_this.magFilter=r,_this.minFilter=s,_this.anisotropy=l,_this.format=a,_this.internalFormat=null,_this.type=o,_this.offset=new me(0,0),_this.repeat=new me(1,1),_this.center=new me(0,0),_this.rotation=0,_this.matrixAutoUpdate=!0,_this.matrix=new fe(),_this.generateMipmaps=!0,_this.premultiplyAlpha=!1,_this.flipY=!0,_this.unpackAlignment=4,"string"==typeof c?_this.colorSpace=c:(be("THREE.Texture: Property .encoding has been replaced by .colorSpace."),_this.colorSpace=c===Bt?Gt:zt),_this.userData={},_this.version=0,_this.onUpdate=null,_this.isRenderTargetTexture=!1,_this.needsPMREMUpdate=!1;return _this;}_createClass(Fe,[{key:"image",get:function get(){return this.source.data;},set:function set(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.source.data=t;}},{key:"updateMatrix",value:function updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y);}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}},{key:"copy",value:function copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this;}},{key:"toJSON",value:function toJSON(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n;}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"});}},{key:"transformUv",value:function transformUv(t){if(this.mapping!==S)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case R:t.x=t.x-Math.floor(t.x);break;case C:t.x=t.x<0?0:1;break;case L:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);}if(t.y<0||t.y>1)switch(this.wrapT){case R:t.y=t.y-Math.floor(t.y);break;case C:t.y=t.y<0?0:1;break;case L:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);}return this.flipY&&(t.y=1-t.y),t;}},{key:"needsUpdate",set:function set(t){!0===t&&(this.version++,this.source.needsUpdate=!0);}},{key:"encoding",get:function get(){return be("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Gt?Bt:Ft;},set:function set(t){be("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===Bt?Gt:zt;}}]);return Fe;}(te);Fe.DEFAULT_IMAGE=null,Fe.DEFAULT_MAPPING=S,Fe.DEFAULT_ANISOTROPY=1;var Be=/*#__PURE__*/function(_Symbol$iterator2){function Be(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,Be);Be.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i;}_createClass(Be,[{key:"width",get:function get(){return this.z;},set:function set(t){this.z=t;}},{key:"height",get:function get(){return this.w;},set:function set(t){this.w=t;}},{key:"set",value:function set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this;}},{key:"setScalar",value:function setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this;}},{key:"setX",value:function setX(t){return this.x=t,this;}},{key:"setY",value:function setY(t){return this.y=t,this;}},{key:"setZ",value:function setZ(t){return this.z=t,this;}},{key:"setW",value:function setW(t){return this.w=t,this;}},{key:"setComponent",value:function setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t);}return this;}},{key:"getComponent",value:function getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t);}}},{key:"clone",value:function clone(){return new this.constructor(this.x,this.y,this.z,this.w);}},{key:"copy",value:function copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this;}},{key:"add",value:function add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this;}},{key:"addScalar",value:function addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this;}},{key:"addVectors",value:function addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this;}},{key:"addScaledVector",value:function addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this;}},{key:"sub",value:function sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this;}},{key:"subScalar",value:function subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this;}},{key:"subVectors",value:function subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this;}},{key:"multiply",value:function multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this;}},{key:"multiplyScalar",value:function multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this;}},{key:"applyMatrix4",value:function applyMatrix4(t){var e=this.x,n=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*e+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*e+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*e+s[7]*n+s[11]*i+s[15]*r,this;}},{key:"divideScalar",value:function divideScalar(t){return this.multiplyScalar(1/t);}},{key:"setAxisAngleFromQuaternion",value:function setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this;}},{key:"setAxisAngleFromRotationMatrix",value:function setAxisAngleFromRotationMatrix(t){var e,n,i,r;var s=.01,a=.1,o=t.elements,l=o[0],c=o[4],h=o[8],u=o[1],d=o[5],p=o[9],m=o[2],f=o[6],g=o[10];if(Math.abs(c-u)<s&&Math.abs(h-m)<s&&Math.abs(p-f)<s){if(Math.abs(c+u)<a&&Math.abs(h+m)<a&&Math.abs(p+f)<a&&Math.abs(l+d+g-3)<a)return this.set(1,0,0,0),this;e=Math.PI;var _t7=(l+1)/2,_o2=(d+1)/2,_2=(g+1)/2,_v=(c+u)/4,_x=(h+m)/4,_y=(p+f)/4;return _t7>_o2&&_t7>_2?_t7<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(_t7),i=_v/n,r=_x/n):_o2>_2?_o2<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(_o2),n=_v/i,r=_y/i):_2<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(_2),n=_x/r,i=_y/r),this.set(n,i,r,e),this;}var _=Math.sqrt((f-p)*(f-p)+(h-m)*(h-m)+(u-c)*(u-c));return Math.abs(_)<.001&&(_=1),this.x=(f-p)/_,this.y=(h-m)/_,this.z=(u-c)/_,this.w=Math.acos((l+d+g-1)/2),this;}},{key:"min",value:function min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this;}},{key:"max",value:function max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this;}},{key:"clamp",value:function clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this;}},{key:"clampScalar",value:function clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this;}},{key:"clampLength",value:function clampLength(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)));}},{key:"floor",value:function floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this;}},{key:"ceil",value:function ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this;}},{key:"round",value:function round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this;}},{key:"roundToZero",value:function roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this;}},{key:"negate",value:function negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this;}},{key:"dot",value:function dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;}},{key:"lengthSq",value:function lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;}},{key:"length",value:function length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);}},{key:"manhattanLength",value:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w);}},{key:"normalize",value:function normalize(){return this.divideScalar(this.length()||1);}},{key:"setLength",value:function setLength(t){return this.normalize().multiplyScalar(t);}},{key:"lerp",value:function lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this;}},{key:"lerpVectors",value:function lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this;}},{key:"equals",value:function equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w;}},{key:"fromArray",value:function fromArray(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this;}},{key:"toArray",value:function toArray(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t;}},{key:"fromBufferAttribute",value:function fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this;}},{key:"random",value:function random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this;}},{key:_Symbol$iterator2,value:/*#__PURE__*/_regeneratorRuntime().mark(function value(){return _regeneratorRuntime().wrap(function value$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return this.x;case 2:_context2.next=4;return this.y;case 4:_context2.next=6;return this.z;case 6:_context2.next=8;return this.w;case 8:case"end":return _context2.stop();}},value,this);})}]);return Be;}(Symbol.iterator);var ze=/*#__PURE__*/function(_te2){_inherits(ze,_te2);var _super2=_createSuper(ze);function ze(){var _this2;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};_classCallCheck(this,ze);_this2=_super2.call(this),_this2.isRenderTarget=!0,_this2.width=t,_this2.height=e,_this2.depth=1,_this2.scissor=new Be(0,0,t,e),_this2.scissorTest=!1,_this2.viewport=new Be(0,0,t,e);var i={width:t,height:e,depth:1};void 0!==n.encoding&&(be("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===Bt?Gt:zt),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:D,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),_this2.texture=new Fe(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),_this2.texture.isRenderTargetTexture=!0,_this2.texture.flipY=!1,_this2.texture.generateMipmaps=n.generateMipmaps,_this2.texture.internalFormat=n.internalFormat,_this2.depthBuffer=n.depthBuffer,_this2.stencilBuffer=n.stencilBuffer,_this2.depthTexture=n.depthTexture,_this2.samples=n.samples;return _this2;}_createClass(ze,[{key:"setSize",value:function setSize(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e);}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}},{key:"copy",value:function copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;var e=Object.assign({},t.texture.image);return this.texture.source=new De(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this;}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"});}}]);return ze;}(te);var Ge=/*#__PURE__*/function(_ze){_inherits(Ge,_ze);var _super3=_createSuper(Ge);function Ge(){var _this3;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};_classCallCheck(this,Ge);_this3=_super3.call(this,t,e,n),_this3.isWebGLRenderTarget=!0;return _this3;}return _createClass(Ge);}(ze);var He=/*#__PURE__*/function(_Fe){_inherits(He,_Fe);var _super4=_createSuper(He);function He(){var _this4;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,He);_this4=_super4.call(this,null),_this4.isDataArrayTexture=!0,_this4.image={data:t,width:e,height:n,depth:i},_this4.magFilter=P,_this4.minFilter=P,_this4.wrapR=C,_this4.generateMipmaps=!1,_this4.flipY=!1,_this4.unpackAlignment=1;return _this4;}return _createClass(He);}(Fe);var Ve=/*#__PURE__*/function(_Fe2){_inherits(Ve,_Fe2);var _super5=_createSuper(Ve);function Ve(){var _this5;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,Ve);_this5=_super5.call(this,null),_this5.isData3DTexture=!0,_this5.image={data:t,width:e,height:n,depth:i},_this5.magFilter=P,_this5.minFilter=P,_this5.wrapR=C,_this5.generateMipmaps=!1,_this5.flipY=!1,_this5.unpackAlignment=1;return _this5;}return _createClass(Ve);}(Fe);var ke=/*#__PURE__*/function(_Symbol$iterator3){function ke(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,ke);this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i;}_createClass(ke,[{key:"x",get:function get(){return this._x;},set:function set(t){this._x=t,this._onChangeCallback();}},{key:"y",get:function get(){return this._y;},set:function set(t){this._y=t,this._onChangeCallback();}},{key:"z",get:function get(){return this._z;},set:function set(t){this._z=t,this._onChangeCallback();}},{key:"w",get:function get(){return this._w;},set:function set(t){this._w=t,this._onChangeCallback();}},{key:"set",value:function set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this;}},{key:"clone",value:function clone(){return new this.constructor(this._x,this._y,this._z,this._w);}},{key:"copy",value:function copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this;}},{key:"setFromEuler",value:function setFromEuler(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;var n=t._x,i=t._y,r=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(n/2),c=a(i/2),h=a(r/2),u=o(n/2),d=o(i/2),p=o(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s);}return!0===e&&this._onChangeCallback(),this;}},{key:"setFromAxisAngle",value:function setFromAxisAngle(t,e){var n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this;}},{key:"setFromRotationMatrix",value:function setFromRotationMatrix(t){var e=t.elements,n=e[0],i=e[4],r=e[8],s=e[1],a=e[5],o=e[9],l=e[2],c=e[6],h=e[10],u=n+a+h;if(u>0){var _t8=.5/Math.sqrt(u+1);this._w=.25/_t8,this._x=(c-o)*_t8,this._y=(r-l)*_t8,this._z=(s-i)*_t8;}else if(n>a&&n>h){var _t9=2*Math.sqrt(1+n-a-h);this._w=(c-o)/_t9,this._x=.25*_t9,this._y=(i+s)/_t9,this._z=(r+l)/_t9;}else if(a>h){var _t10=2*Math.sqrt(1+a-n-h);this._w=(r-l)/_t10,this._x=(i+s)/_t10,this._y=.25*_t10,this._z=(o+c)/_t10;}else{var _t11=2*Math.sqrt(1+h-n-a);this._w=(s-i)/_t11,this._x=(r+l)/_t11,this._y=(o+c)/_t11,this._z=.25*_t11;}return this._onChangeCallback(),this;}},{key:"setFromUnitVectors",value:function setFromUnitVectors(t,e){var n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize();}},{key:"angleTo",value:function angleTo(t){return 2*Math.acos(Math.abs(ae(this.dot(t),-1,1)));}},{key:"rotateTowards",value:function rotateTowards(t,e){var n=this.angleTo(t);if(0===n)return this;var i=Math.min(1,e/n);return this.slerp(t,i),this;}},{key:"identity",value:function identity(){return this.set(0,0,0,1);}},{key:"invert",value:function invert(){return this.conjugate();}},{key:"conjugate",value:function conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this;}},{key:"dot",value:function dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w;}},{key:"lengthSq",value:function lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w;}},{key:"length",value:function length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w);}},{key:"normalize",value:function normalize(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this;}},{key:"multiply",value:function multiply(t){return this.multiplyQuaternions(this,t);}},{key:"premultiply",value:function premultiply(t){return this.multiplyQuaternions(t,this);}},{key:"multiplyQuaternions",value:function multiplyQuaternions(t,e){var n=t._x,i=t._y,r=t._z,s=t._w,a=e._x,o=e._y,l=e._z,c=e._w;return this._x=n*c+s*a+i*l-r*o,this._y=i*c+s*o+r*a-n*l,this._z=r*c+s*l+n*o-i*a,this._w=s*c-n*a-i*o-r*l,this._onChangeCallback(),this;}},{key:"slerp",value:function slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,i=this._y,r=this._z,s=this._w;var a=s*t._w+n*t._x+i*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;var o=1-a*a;if(o<=Number.EPSILON){var _t12=1-e;return this._w=_t12*s+e*this._w,this._x=_t12*n+e*this._x,this._y=_t12*i+e*this._y,this._z=_t12*r+e*this._z,this.normalize(),this;}var l=Math.sqrt(o),c=Math.atan2(l,a),h=Math.sin((1-e)*c)/l,u=Math.sin(e*c)/l;return this._w=s*h+this._w*u,this._x=n*h+this._x*u,this._y=i*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this;}},{key:"slerpQuaternions",value:function slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n);}},{key:"random",value:function random(){var t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(i),n*Math.sin(r),n*Math.cos(r),e*Math.sin(i));}},{key:"equals",value:function equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w;}},{key:"fromArray",value:function fromArray(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this;}},{key:"toArray",value:function toArray(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t;}},{key:"fromBufferAttribute",value:function fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this;}},{key:"toJSON",value:function toJSON(){return this.toArray();}},{key:"_onChange",value:function _onChange(t){return this._onChangeCallback=t,this;}},{key:"_onChangeCallback",value:function _onChangeCallback(){}},{key:_Symbol$iterator3,value:/*#__PURE__*/_regeneratorRuntime().mark(function value(){return _regeneratorRuntime().wrap(function value$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.next=2;return this._x;case 2:_context3.next=4;return this._y;case 4:_context3.next=6;return this._z;case 6:_context3.next=8;return this._w;case 8:case"end":return _context3.stop();}},value,this);})}],[{key:"slerpFlat",value:function slerpFlat(t,e,n,i,r,s,a){var o=n[i+0],l=n[i+1],c=n[i+2],h=n[i+3];var u=r[s+0],d=r[s+1],p=r[s+2],m=r[s+3];if(0===a)return t[e+0]=o,t[e+1]=l,t[e+2]=c,void(t[e+3]=h);if(1===a)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=m);if(h!==m||o!==u||l!==d||c!==p){var _t13=1-a;var _e7=o*u+l*d+c*p+h*m,_n7=_e7>=0?1:-1,_i4=1-_e7*_e7;if(_i4>Number.EPSILON){var _r3=Math.sqrt(_i4),_s2=Math.atan2(_r3,_e7*_n7);_t13=Math.sin(_t13*_s2)/_r3,a=Math.sin(a*_s2)/_r3;}var _r4=a*_n7;if(o=o*_t13+u*_r4,l=l*_t13+d*_r4,c=c*_t13+p*_r4,h=h*_t13+m*_r4,_t13===1-a){var _t14=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=_t14,l*=_t14,c*=_t14,h*=_t14;}}t[e]=o,t[e+1]=l,t[e+2]=c,t[e+3]=h;}},{key:"multiplyQuaternionsFlat",value:function multiplyQuaternionsFlat(t,e,n,i,r,s){var a=n[i],o=n[i+1],l=n[i+2],c=n[i+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=a*p+c*h+o*d-l*u,t[e+1]=o*p+c*u+l*h-a*d,t[e+2]=l*p+c*d+a*u-o*h,t[e+3]=c*p-a*h-o*u-l*d,t;}}]);return ke;}(Symbol.iterator);var We=/*#__PURE__*/function(_Symbol$iterator4){function We(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,We);We.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n;}_createClass(We,[{key:"set",value:function set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this;}},{key:"setScalar",value:function setScalar(t){return this.x=t,this.y=t,this.z=t,this;}},{key:"setX",value:function setX(t){return this.x=t,this;}},{key:"setY",value:function setY(t){return this.y=t,this;}},{key:"setZ",value:function setZ(t){return this.z=t,this;}},{key:"setComponent",value:function setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t);}return this;}},{key:"getComponent",value:function getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t);}}},{key:"clone",value:function clone(){return new this.constructor(this.x,this.y,this.z);}},{key:"copy",value:function copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this;}},{key:"add",value:function add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this;}},{key:"addScalar",value:function addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this;}},{key:"addVectors",value:function addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this;}},{key:"addScaledVector",value:function addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this;}},{key:"sub",value:function sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this;}},{key:"subScalar",value:function subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this;}},{key:"subVectors",value:function subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this;}},{key:"multiply",value:function multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this;}},{key:"multiplyScalar",value:function multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this;}},{key:"multiplyVectors",value:function multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this;}},{key:"applyEuler",value:function applyEuler(t){return this.applyQuaternion(je.setFromEuler(t));}},{key:"applyAxisAngle",value:function applyAxisAngle(t,e){return this.applyQuaternion(je.setFromAxisAngle(t,e));}},{key:"applyMatrix3",value:function applyMatrix3(t){var e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this;}},{key:"applyNormalMatrix",value:function applyNormalMatrix(t){return this.applyMatrix3(t).normalize();}},{key:"applyMatrix4",value:function applyMatrix4(t){var e=this.x,n=this.y,i=this.z,r=t.elements,s=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*s,this;}},{key:"applyQuaternion",value:function applyQuaternion(t){var e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,a=t.z,o=t.w,l=2*(s*i-a*n),c=2*(a*e-r*i),h=2*(r*n-s*e);return this.x=e+o*l+s*h-a*c,this.y=n+o*c+a*l-r*h,this.z=i+o*h+r*c-s*l,this;}},{key:"project",value:function project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix);}},{key:"unproject",value:function unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld);}},{key:"transformDirection",value:function transformDirection(t){var e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize();}},{key:"divide",value:function divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this;}},{key:"divideScalar",value:function divideScalar(t){return this.multiplyScalar(1/t);}},{key:"min",value:function min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this;}},{key:"max",value:function max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this;}},{key:"clamp",value:function clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this;}},{key:"clampScalar",value:function clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this;}},{key:"clampLength",value:function clampLength(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)));}},{key:"floor",value:function floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this;}},{key:"ceil",value:function ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this;}},{key:"round",value:function round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this;}},{key:"roundToZero",value:function roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this;}},{key:"negate",value:function negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this;}},{key:"dot",value:function dot(t){return this.x*t.x+this.y*t.y+this.z*t.z;}},{key:"lengthSq",value:function lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z;}},{key:"length",value:function length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);}},{key:"manhattanLength",value:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z);}},{key:"normalize",value:function normalize(){return this.divideScalar(this.length()||1);}},{key:"setLength",value:function setLength(t){return this.normalize().multiplyScalar(t);}},{key:"lerp",value:function lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this;}},{key:"lerpVectors",value:function lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this;}},{key:"cross",value:function cross(t){return this.crossVectors(this,t);}},{key:"crossVectors",value:function crossVectors(t,e){var n=t.x,i=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=i*o-r*a,this.y=r*s-n*o,this.z=n*a-i*s,this;}},{key:"projectOnVector",value:function projectOnVector(t){var e=t.lengthSq();if(0===e)return this.set(0,0,0);var n=t.dot(this)/e;return this.copy(t).multiplyScalar(n);}},{key:"projectOnPlane",value:function projectOnPlane(t){return Xe.copy(this).projectOnVector(t),this.sub(Xe);}},{key:"reflect",value:function reflect(t){return this.sub(Xe.copy(t).multiplyScalar(2*this.dot(t)));}},{key:"angleTo",value:function angleTo(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;var n=this.dot(t)/e;return Math.acos(ae(n,-1,1));}},{key:"distanceTo",value:function distanceTo(t){return Math.sqrt(this.distanceToSquared(t));}},{key:"distanceToSquared",value:function distanceToSquared(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i;}},{key:"manhattanDistanceTo",value:function manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z);}},{key:"setFromSpherical",value:function setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta);}},{key:"setFromSphericalCoords",value:function setFromSphericalCoords(t,e,n){var i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this;}},{key:"setFromCylindrical",value:function setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y);}},{key:"setFromCylindricalCoords",value:function setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this;}},{key:"setFromMatrixPosition",value:function setFromMatrixPosition(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this;}},{key:"setFromMatrixScale",value:function setFromMatrixScale(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this;}},{key:"setFromMatrixColumn",value:function setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e);}},{key:"setFromMatrix3Column",value:function setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e);}},{key:"setFromEuler",value:function setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this;}},{key:"setFromColor",value:function setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this;}},{key:"equals",value:function equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z;}},{key:"fromArray",value:function fromArray(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this;}},{key:"toArray",value:function toArray(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t;}},{key:"fromBufferAttribute",value:function fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this;}},{key:"random",value:function random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this;}},{key:"randomDirection",value:function randomDirection(){var t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,n=Math.sqrt(1-Math.pow(t,2));return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this;}},{key:_Symbol$iterator4,value:/*#__PURE__*/_regeneratorRuntime().mark(function value(){return _regeneratorRuntime().wrap(function value$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:_context4.next=2;return this.x;case 2:_context4.next=4;return this.y;case 4:_context4.next=6;return this.z;case 6:case"end":return _context4.stop();}},value,this);})}]);return We;}(Symbol.iterator);var Xe=new We(),je=new ke();var qe=/*#__PURE__*/function(){function qe(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new We(1/0,1/0,1/0);var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new We(-1/0,-1/0,-1/0);_classCallCheck(this,qe);this.isBox3=!0,this.min=t,this.max=e;}_createClass(qe,[{key:"set",value:function set(t,e){return this.min.copy(t),this.max.copy(e),this;}},{key:"setFromArray",value:function setFromArray(t){this.makeEmpty();for(var _e8=0,_n8=t.length;_e8<_n8;_e8+=3)this.expandByPoint(Ze.fromArray(t,_e8));return this;}},{key:"setFromBufferAttribute",value:function setFromBufferAttribute(t){this.makeEmpty();for(var _e9=0,_n9=t.count;_e9<_n9;_e9++)this.expandByPoint(Ze.fromBufferAttribute(t,_e9));return this;}},{key:"setFromPoints",value:function setFromPoints(t){this.makeEmpty();for(var _e10=0,_n10=t.length;_e10<_n10;_e10++)this.expandByPoint(t[_e10]);return this;}},{key:"setFromCenterAndSize",value:function setFromCenterAndSize(t,e){var n=Ze.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this;}},{key:"setFromObject",value:function setFromObject(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;return this.makeEmpty(),this.expandByObject(t,e);}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}},{key:"copy",value:function copy(t){return this.min.copy(t.min),this.max.copy(t.max),this;}},{key:"makeEmpty",value:function makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this;}},{key:"isEmpty",value:function isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z;}},{key:"getCenter",value:function getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5);}},{key:"getSize",value:function getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min);}},{key:"expandByPoint",value:function expandByPoint(t){return this.min.min(t),this.max.max(t),this;}},{key:"expandByVector",value:function expandByVector(t){return this.min.sub(t),this.max.add(t),this;}},{key:"expandByScalar",value:function expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this;}},{key:"expandByObject",value:function expandByObject(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;t.updateWorldMatrix(!1,!1);var n=t.geometry;if(void 0!==n){var _i5=n.getAttribute("position");if(!0===e&&void 0!==_i5&&!0!==t.isInstancedMesh)for(var _e11=0,_n11=_i5.count;_e11<_n11;_e11++)!0===t.isMesh?t.getVertexPosition(_e11,Ze):Ze.fromBufferAttribute(_i5,_e11),Ze.applyMatrix4(t.matrixWorld),this.expandByPoint(Ze);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),Je.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Je.copy(n.boundingBox)),Je.applyMatrix4(t.matrixWorld),this.union(Je);}var i=t.children;for(var _t15=0,_n12=i.length;_t15<_n12;_t15++)this.expandByObject(i[_t15],e);return this;}},{key:"containsPoint",value:function containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z);}},{key:"containsBox",value:function containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z;}},{key:"getParameter",value:function getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z));}},{key:"intersectsBox",value:function intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z);}},{key:"intersectsSphere",value:function intersectsSphere(t){return this.clampPoint(t.center,Ze),Ze.distanceToSquared(t.center)<=t.radius*t.radius;}},{key:"intersectsPlane",value:function intersectsPlane(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant;}},{key:"intersectsTriangle",value:function intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(rn),sn.subVectors(this.max,rn),Ke.subVectors(t.a,rn),$e.subVectors(t.b,rn),Qe.subVectors(t.c,rn),tn.subVectors($e,Ke),en.subVectors(Qe,$e),nn.subVectors(Ke,Qe);var e=[0,-tn.z,tn.y,0,-en.z,en.y,0,-nn.z,nn.y,tn.z,0,-tn.x,en.z,0,-en.x,nn.z,0,-nn.x,-tn.y,tn.x,0,-en.y,en.x,0,-nn.y,nn.x,0];return!!ln(e,Ke,$e,Qe,sn)&&(e=[1,0,0,0,1,0,0,0,1],!!ln(e,Ke,$e,Qe,sn)&&(an.crossVectors(tn,en),e=[an.x,an.y,an.z],ln(e,Ke,$e,Qe,sn)));}},{key:"clampPoint",value:function clampPoint(t,e){return e.copy(t).clamp(this.min,this.max);}},{key:"distanceToPoint",value:function distanceToPoint(t){return this.clampPoint(t,Ze).distanceTo(t);}},{key:"getBoundingSphere",value:function getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(Ze).length()),t;}},{key:"intersect",value:function intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this;}},{key:"union",value:function union(t){return this.min.min(t.min),this.max.max(t.max),this;}},{key:"applyMatrix4",value:function applyMatrix4(t){return this.isEmpty()||(Ye[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Ye[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Ye[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Ye[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Ye[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Ye[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Ye[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Ye[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Ye)),this;}},{key:"translate",value:function translate(t){return this.min.add(t),this.max.add(t),this;}},{key:"equals",value:function equals(t){return t.min.equals(this.min)&&t.max.equals(this.max);}}]);return qe;}();var Ye=[new We(),new We(),new We(),new We(),new We(),new We(),new We(),new We()],Ze=new We(),Je=new qe(),Ke=new We(),$e=new We(),Qe=new We(),tn=new We(),en=new We(),nn=new We(),rn=new We(),sn=new We(),an=new We(),on=new We();function ln(t,e,n,i,r){for(var _s3=0,_a2=t.length-3;_s3<=_a2;_s3+=3){on.fromArray(t,_s3);var _a3=r.x*Math.abs(on.x)+r.y*Math.abs(on.y)+r.z*Math.abs(on.z),_o3=e.dot(on),_l2=n.dot(on),_c2=i.dot(on);if(Math.max(-Math.max(_o3,_l2,_c2),Math.min(_o3,_l2,_c2))>_a3)return!1;}return!0;}var cn=new qe(),hn=new We(),un=new We();var dn=/*#__PURE__*/function(){function dn(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new We();var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;_classCallCheck(this,dn);this.isSphere=!0,this.center=t,this.radius=e;}_createClass(dn,[{key:"set",value:function set(t,e){return this.center.copy(t),this.radius=e,this;}},{key:"setFromPoints",value:function setFromPoints(t,e){var n=this.center;void 0!==e?n.copy(e):cn.setFromPoints(t).getCenter(n);var i=0;for(var _e12=0,_r5=t.length;_e12<_r5;_e12++)i=Math.max(i,n.distanceToSquared(t[_e12]));return this.radius=Math.sqrt(i),this;}},{key:"copy",value:function copy(t){return this.center.copy(t.center),this.radius=t.radius,this;}},{key:"isEmpty",value:function isEmpty(){return this.radius<0;}},{key:"makeEmpty",value:function makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this;}},{key:"containsPoint",value:function containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius;}},{key:"distanceToPoint",value:function distanceToPoint(t){return t.distanceTo(this.center)-this.radius;}},{key:"intersectsSphere",value:function intersectsSphere(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e;}},{key:"intersectsBox",value:function intersectsBox(t){return t.intersectsSphere(this);}},{key:"intersectsPlane",value:function intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius;}},{key:"clampPoint",value:function clampPoint(t,e){var n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e;}},{key:"getBoundingBox",value:function getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t);}},{key:"applyMatrix4",value:function applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this;}},{key:"translate",value:function translate(t){return this.center.add(t),this;}},{key:"expandByPoint",value:function expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;hn.subVectors(t,this.center);var e=hn.lengthSq();if(e>this.radius*this.radius){var _t16=Math.sqrt(e),_n13=.5*(_t16-this.radius);this.center.addScaledVector(hn,_n13/_t16),this.radius+=_n13;}return this;}},{key:"union",value:function union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(un.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(hn.copy(t.center).add(un)),this.expandByPoint(hn.copy(t.center).sub(un))),this);}},{key:"equals",value:function equals(t){return t.center.equals(this.center)&&t.radius===this.radius;}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}}]);return dn;}();var pn=new We(),mn=new We(),fn=new We(),gn=new We(),_n=new We(),vn=new We(),xn=new We();var yn=/*#__PURE__*/function(){function yn(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new We();var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new We(0,0,-1);_classCallCheck(this,yn);this.origin=t,this.direction=e;}_createClass(yn,[{key:"set",value:function set(t,e){return this.origin.copy(t),this.direction.copy(e),this;}},{key:"copy",value:function copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this;}},{key:"at",value:function at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t);}},{key:"lookAt",value:function lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this;}},{key:"recast",value:function recast(t){return this.origin.copy(this.at(t,pn)),this;}},{key:"closestPointToPoint",value:function closestPointToPoint(t,e){e.subVectors(t,this.origin);var n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n);}},{key:"distanceToPoint",value:function distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t));}},{key:"distanceSqToPoint",value:function distanceSqToPoint(t){var e=pn.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(pn.copy(this.origin).addScaledVector(this.direction,e),pn.distanceToSquared(t));}},{key:"distanceSqToSegment",value:function distanceSqToSegment(t,e,n,i){mn.copy(t).add(e).multiplyScalar(.5),fn.copy(e).sub(t).normalize(),gn.copy(this.origin).sub(mn);var r=.5*t.distanceTo(e),s=-this.direction.dot(fn),a=gn.dot(this.direction),o=-gn.dot(fn),l=gn.lengthSq(),c=Math.abs(1-s*s);var h,u,d,p;if(c>0){if(h=s*o-a,u=s*a-o,p=r*c,h>=0){if(u>=-p){if(u<=p){var _t17=1/c;h*=_t17,u*=_t17,d=h*(h+s*u+2*a)+u*(s*h+u+2*o)+l;}else u=r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;}else u=-r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;}else u<=-p?(h=Math.max(0,-(-s*r+a)),u=h>0?-r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l):u<=p?(h=0,u=Math.min(Math.max(-r,-o),r),d=u*(u+2*o)+l):(h=Math.max(0,-(s*r+a)),u=h>0?r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l);}else u=s>0?-r:r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(mn).addScaledVector(fn,u),d;}},{key:"intersectSphere",value:function intersectSphere(t,e){pn.subVectors(t.center,this.origin);var n=pn.dot(this.direction),i=pn.dot(pn)-n*n,r=t.radius*t.radius;if(i>r)return null;var s=Math.sqrt(r-i),a=n-s,o=n+s;return o<0?null:a<0?this.at(o,e):this.at(a,e);}},{key:"intersectsSphere",value:function intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius;}},{key:"distanceToPlane",value:function distanceToPlane(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null;}},{key:"intersectPlane",value:function intersectPlane(t,e){var n=this.distanceToPlane(t);return null===n?null:this.at(n,e);}},{key:"intersectsPlane",value:function intersectsPlane(t){var e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0;}},{key:"intersectBox",value:function intersectBox(t,e){var n,i,r,s,a,o;var l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(n=(t.min.x-u.x)*l,i=(t.max.x-u.x)*l):(n=(t.max.x-u.x)*l,i=(t.min.x-u.x)*l),c>=0?(r=(t.min.y-u.y)*c,s=(t.max.y-u.y)*c):(r=(t.max.y-u.y)*c,s=(t.min.y-u.y)*c),n>s||r>i?null:((r>n||isNaN(n))&&(n=r),(s<i||isNaN(i))&&(i=s),h>=0?(a=(t.min.z-u.z)*h,o=(t.max.z-u.z)*h):(a=(t.max.z-u.z)*h,o=(t.min.z-u.z)*h),n>o||a>i?null:((a>n||n!=n)&&(n=a),(o<i||i!=i)&&(i=o),i<0?null:this.at(n>=0?n:i,e)));}},{key:"intersectsBox",value:function intersectsBox(t){return null!==this.intersectBox(t,pn);}},{key:"intersectTriangle",value:function intersectTriangle(t,e,n,i,r){_n.subVectors(e,t),vn.subVectors(n,t),xn.crossVectors(_n,vn);var s,a=this.direction.dot(xn);if(a>0){if(i)return null;s=1;}else{if(!(a<0))return null;s=-1,a=-a;}gn.subVectors(this.origin,t);var o=s*this.direction.dot(vn.crossVectors(gn,vn));if(o<0)return null;var l=s*this.direction.dot(_n.cross(gn));if(l<0)return null;if(o+l>a)return null;var c=-s*gn.dot(xn);return c<0?null:this.at(c/a,r);}},{key:"applyMatrix4",value:function applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this;}},{key:"equals",value:function equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction);}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}}]);return yn;}();var Mn=/*#__PURE__*/function(){function Mn(t,e,n,i,r,s,a,o,l,c,h,u,d,p,m,f){_classCallCheck(this,Mn);Mn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,s,a,o,l,c,h,u,d,p,m,f);}_createClass(Mn,[{key:"set",value:function set(t,e,n,i,r,s,a,o,l,c,h,u,d,p,m,f){var g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=m,g[15]=f,this;}},{key:"identity",value:function identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this;}},{key:"clone",value:function clone(){return new Mn().fromArray(this.elements);}},{key:"copy",value:function copy(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this;}},{key:"copyPosition",value:function copyPosition(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this;}},{key:"setFromMatrix3",value:function setFromMatrix3(t){var e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this;}},{key:"extractBasis",value:function extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this;}},{key:"makeBasis",value:function makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this;}},{key:"extractRotation",value:function extractRotation(t){var e=this.elements,n=t.elements,i=1/Sn.setFromMatrixColumn(t,0).length(),r=1/Sn.setFromMatrixColumn(t,1).length(),s=1/Sn.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this;}},{key:"makeRotationFromEuler",value:function makeRotationFromEuler(t){var e=this.elements,n=t.x,i=t.y,r=t.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){var _t18=s*c,_n14=s*h,_i6=a*c,_r6=a*h;e[0]=o*c,e[4]=-o*h,e[8]=l,e[1]=_n14+_i6*l,e[5]=_t18-_r6*l,e[9]=-a*o,e[2]=_r6-_t18*l,e[6]=_i6+_n14*l,e[10]=s*o;}else if("YXZ"===t.order){var _t19=o*c,_n15=o*h,_i7=l*c,_r7=l*h;e[0]=_t19+_r7*a,e[4]=_i7*a-_n15,e[8]=s*l,e[1]=s*h,e[5]=s*c,e[9]=-a,e[2]=_n15*a-_i7,e[6]=_r7+_t19*a,e[10]=s*o;}else if("ZXY"===t.order){var _t20=o*c,_n16=o*h,_i8=l*c,_r8=l*h;e[0]=_t20-_r8*a,e[4]=-s*h,e[8]=_i8+_n16*a,e[1]=_n16+_i8*a,e[5]=s*c,e[9]=_r8-_t20*a,e[2]=-s*l,e[6]=a,e[10]=s*o;}else if("ZYX"===t.order){var _t21=s*c,_n17=s*h,_i9=a*c,_r9=a*h;e[0]=o*c,e[4]=_i9*l-_n17,e[8]=_t21*l+_r9,e[1]=o*h,e[5]=_r9*l+_t21,e[9]=_n17*l-_i9,e[2]=-l,e[6]=a*o,e[10]=s*o;}else if("YZX"===t.order){var _t22=s*o,_n18=s*l,_i10=a*o,_r10=a*l;e[0]=o*c,e[4]=_r10-_t22*h,e[8]=_i10*h+_n18,e[1]=h,e[5]=s*c,e[9]=-a*c,e[2]=-l*c,e[6]=_n18*h+_i10,e[10]=_t22-_r10*h;}else if("XZY"===t.order){var _t23=s*o,_n19=s*l,_i11=a*o,_r11=a*l;e[0]=o*c,e[4]=-h,e[8]=l*c,e[1]=_t23*h+_r11,e[5]=s*c,e[9]=_n19*h-_i11,e[2]=_i11*h-_n19,e[6]=a*c,e[10]=_r11*h+_t23;}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this;}},{key:"makeRotationFromQuaternion",value:function makeRotationFromQuaternion(t){return this.compose(Tn,t,En);}},{key:"lookAt",value:function lookAt(t,e,n){var i=this.elements;return Rn.subVectors(t,e),0===Rn.lengthSq()&&(Rn.z=1),Rn.normalize(),wn.crossVectors(n,Rn),0===wn.lengthSq()&&(1===Math.abs(n.z)?Rn.x+=1e-4:Rn.z+=1e-4,Rn.normalize(),wn.crossVectors(n,Rn)),wn.normalize(),An.crossVectors(Rn,wn),i[0]=wn.x,i[4]=An.x,i[8]=Rn.x,i[1]=wn.y,i[5]=An.y,i[9]=Rn.y,i[2]=wn.z,i[6]=An.z,i[10]=Rn.z,this;}},{key:"multiply",value:function multiply(t){return this.multiplyMatrices(this,t);}},{key:"premultiply",value:function premultiply(t){return this.multiplyMatrices(t,this);}},{key:"multiplyMatrices",value:function multiplyMatrices(t,e){var n=t.elements,i=e.elements,r=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],c=n[1],h=n[5],u=n[9],d=n[13],p=n[2],m=n[6],f=n[10],g=n[14],_=n[3],v=n[7],x=n[11],y=n[15],M=i[0],S=i[4],b=i[8],T=i[12],E=i[1],w=i[5],A=i[9],R=i[13],C=i[2],L=i[6],P=i[10],I=i[14],U=i[3],D=i[7],N=i[11],O=i[15];return r[0]=s*M+a*E+o*C+l*U,r[4]=s*S+a*w+o*L+l*D,r[8]=s*b+a*A+o*P+l*N,r[12]=s*T+a*R+o*I+l*O,r[1]=c*M+h*E+u*C+d*U,r[5]=c*S+h*w+u*L+d*D,r[9]=c*b+h*A+u*P+d*N,r[13]=c*T+h*R+u*I+d*O,r[2]=p*M+m*E+f*C+g*U,r[6]=p*S+m*w+f*L+g*D,r[10]=p*b+m*A+f*P+g*N,r[14]=p*T+m*R+f*I+g*O,r[3]=_*M+v*E+x*C+y*U,r[7]=_*S+v*w+x*L+y*D,r[11]=_*b+v*A+x*P+y*N,r[15]=_*T+v*R+x*I+y*O,this;}},{key:"multiplyScalar",value:function multiplyScalar(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this;}},{key:"determinant",value:function determinant(){var t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],s=t[1],a=t[5],o=t[9],l=t[13],c=t[2],h=t[6],u=t[10],d=t[14];return t[3]*(+r*o*h-i*l*h-r*a*u+n*l*u+i*a*d-n*o*d)+t[7]*(+e*o*d-e*l*u+r*s*u-i*s*d+i*l*c-r*o*c)+t[11]*(+e*l*h-e*a*d-r*s*h+n*s*d+r*a*c-n*l*c)+t[15]*(-i*a*c-e*o*h+e*a*u+i*s*h-n*s*u+n*o*c);}},{key:"transpose",value:function transpose(){var t=this.elements;var e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this;}},{key:"setPosition",value:function setPosition(t,e,n){var i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this;}},{key:"invert",value:function invert(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11],p=t[12],m=t[13],f=t[14],g=t[15],_=h*f*l-m*u*l+m*o*d-a*f*d-h*o*g+a*u*g,v=p*u*l-c*f*l-p*o*d+s*f*d+c*o*g-s*u*g,x=c*m*l-p*h*l+p*a*d-s*m*d-c*a*g+s*h*g,y=p*h*o-c*m*o-p*a*u+s*m*u+c*a*f-s*h*f,M=e*_+n*v+i*x+r*y;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var S=1/M;return t[0]=_*S,t[1]=(m*u*r-h*f*r-m*i*d+n*f*d+h*i*g-n*u*g)*S,t[2]=(a*f*r-m*o*r+m*i*l-n*f*l-a*i*g+n*o*g)*S,t[3]=(h*o*r-a*u*r-h*i*l+n*u*l+a*i*d-n*o*d)*S,t[4]=v*S,t[5]=(c*f*r-p*u*r+p*i*d-e*f*d-c*i*g+e*u*g)*S,t[6]=(p*o*r-s*f*r-p*i*l+e*f*l+s*i*g-e*o*g)*S,t[7]=(s*u*r-c*o*r+c*i*l-e*u*l-s*i*d+e*o*d)*S,t[8]=x*S,t[9]=(p*h*r-c*m*r-p*n*d+e*m*d+c*n*g-e*h*g)*S,t[10]=(s*m*r-p*a*r+p*n*l-e*m*l-s*n*g+e*a*g)*S,t[11]=(c*a*r-s*h*r-c*n*l+e*h*l+s*n*d-e*a*d)*S,t[12]=y*S,t[13]=(c*m*i-p*h*i+p*n*u-e*m*u-c*n*f+e*h*f)*S,t[14]=(p*a*i-s*m*i-p*n*o+e*m*o+s*n*f-e*a*f)*S,t[15]=(s*h*i-c*a*i+c*n*o-e*h*o-s*n*u+e*a*u)*S,this;}},{key:"scale",value:function scale(t){var e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this;}},{key:"getMaxScaleOnAxis",value:function getMaxScaleOnAxis(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i));}},{key:"makeTranslation",value:function makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this;}},{key:"makeRotationX",value:function makeRotationX(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this;}},{key:"makeRotationY",value:function makeRotationY(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this;}},{key:"makeRotationZ",value:function makeRotationZ(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this;}},{key:"makeRotationAxis",value:function makeRotationAxis(t,e){var n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,a=t.y,o=t.z,l=r*s,c=r*a;return this.set(l*s+n,l*a-i*o,l*o+i*a,0,l*a+i*o,c*a+n,c*o-i*s,0,l*o-i*a,c*o+i*s,r*o*o+n,0,0,0,0,1),this;}},{key:"makeScale",value:function makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this;}},{key:"makeShear",value:function makeShear(t,e,n,i,r,s){return this.set(1,n,r,0,t,1,s,0,e,i,1,0,0,0,0,1),this;}},{key:"compose",value:function compose(t,e,n){var i=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,l=r+r,c=s+s,h=a+a,u=r*l,d=r*c,p=r*h,m=s*c,f=s*h,g=a*h,_=o*l,v=o*c,x=o*h,y=n.x,M=n.y,S=n.z;return i[0]=(1-(m+g))*y,i[1]=(d+x)*y,i[2]=(p-v)*y,i[3]=0,i[4]=(d-x)*M,i[5]=(1-(u+g))*M,i[6]=(f+_)*M,i[7]=0,i[8]=(p+v)*S,i[9]=(f-_)*S,i[10]=(1-(u+m))*S,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this;}},{key:"decompose",value:function decompose(t,e,n){var i=this.elements;var r=Sn.set(i[0],i[1],i[2]).length();var s=Sn.set(i[4],i[5],i[6]).length(),a=Sn.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],bn.copy(this);var o=1/r,l=1/s,c=1/a;return bn.elements[0]*=o,bn.elements[1]*=o,bn.elements[2]*=o,bn.elements[4]*=l,bn.elements[5]*=l,bn.elements[6]*=l,bn.elements[8]*=c,bn.elements[9]*=c,bn.elements[10]*=c,e.setFromRotationMatrix(bn),n.x=r,n.y=s,n.z=a,this;}},{key:"makePerspective",value:function makePerspective(t,e,n,i,r,s){var a=arguments.length>6&&arguments[6]!==undefined?arguments[6]:2e3;var o=this.elements,l=2*r/(e-t),c=2*r/(n-i),h=(e+t)/(e-t),u=(n+i)/(n-i);var d,p;if(a===$t)d=-(s+r)/(s-r),p=-2*s*r/(s-r);else{if(a!==Qt)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);d=-s/(s-r),p=-s*r/(s-r);}return o[0]=l,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=c,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this;}},{key:"makeOrthographic",value:function makeOrthographic(t,e,n,i,r,s){var a=arguments.length>6&&arguments[6]!==undefined?arguments[6]:2e3;var o=this.elements,l=1/(e-t),c=1/(n-i),h=1/(s-r),u=(e+t)*l,d=(n+i)*c;var p,m;if(a===$t)p=(s+r)*h,m=-2*h;else{if(a!==Qt)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=r*h,m=-1*h;}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=m,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this;}},{key:"equals",value:function equals(t){var e=this.elements,n=t.elements;for(var _t24=0;_t24<16;_t24++)if(e[_t24]!==n[_t24])return!1;return!0;}},{key:"fromArray",value:function fromArray(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;for(var _n20=0;_n20<16;_n20++)this.elements[_n20]=t[_n20+e];return this;}},{key:"toArray",value:function toArray(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t;}}]);return Mn;}();var Sn=new We(),bn=new Mn(),Tn=new We(0,0,0),En=new We(1,1,1),wn=new We(),An=new We(),Rn=new We(),Cn=new Mn(),Ln=new ke();var Pn=/*#__PURE__*/function(_Symbol$iterator5){function Pn(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Pn.DEFAULT_ORDER;_classCallCheck(this,Pn);this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=i;}_createClass(Pn,[{key:"x",get:function get(){return this._x;},set:function set(t){this._x=t,this._onChangeCallback();}},{key:"y",get:function get(){return this._y;},set:function set(t){this._y=t,this._onChangeCallback();}},{key:"z",get:function get(){return this._z;},set:function set(t){this._z=t,this._onChangeCallback();}},{key:"order",get:function get(){return this._order;},set:function set(t){this._order=t,this._onChangeCallback();}},{key:"set",value:function set(t,e,n){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:this._order;return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this;}},{key:"clone",value:function clone(){return new this.constructor(this._x,this._y,this._z,this._order);}},{key:"copy",value:function copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this;}},{key:"setFromRotationMatrix",value:function setFromRotationMatrix(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this._order;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!0;var i=t.elements,r=i[0],s=i[4],a=i[8],o=i[1],l=i[5],c=i[9],h=i[2],u=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(ae(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ae(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(ae(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-ae(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(ae(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-ae(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e);}return this._order=e,!0===n&&this._onChangeCallback(),this;}},{key:"setFromQuaternion",value:function setFromQuaternion(t,e,n){return Cn.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Cn,e,n);}},{key:"setFromVector3",value:function setFromVector3(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this._order;return this.set(t.x,t.y,t.z,e);}},{key:"reorder",value:function reorder(t){return Ln.setFromEuler(this),this.setFromQuaternion(Ln,t);}},{key:"equals",value:function equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order;}},{key:"fromArray",value:function fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this;}},{key:"toArray",value:function toArray(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t;}},{key:"_onChange",value:function _onChange(t){return this._onChangeCallback=t,this;}},{key:"_onChangeCallback",value:function _onChangeCallback(){}},{key:_Symbol$iterator5,value:/*#__PURE__*/_regeneratorRuntime().mark(function value(){return _regeneratorRuntime().wrap(function value$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:_context5.next=2;return this._x;case 2:_context5.next=4;return this._y;case 4:_context5.next=6;return this._z;case 6:_context5.next=8;return this._order;case 8:case"end":return _context5.stop();}},value,this);})}]);return Pn;}(Symbol.iterator);Pn.DEFAULT_ORDER="XYZ";var In=/*#__PURE__*/function(){function In(){_classCallCheck(this,In);this.mask=1;}_createClass(In,[{key:"set",value:function set(t){this.mask=(1<<t|0)>>>0;}},{key:"enable",value:function enable(t){this.mask|=1<<t|0;}},{key:"enableAll",value:function enableAll(){this.mask=-1;}},{key:"toggle",value:function toggle(t){this.mask^=1<<t|0;}},{key:"disable",value:function disable(t){this.mask&=~(1<<t|0);}},{key:"disableAll",value:function disableAll(){this.mask=0;}},{key:"test",value:function test(t){return 0!=(this.mask&t.mask);}},{key:"isEnabled",value:function isEnabled(t){return 0!=(this.mask&(1<<t|0));}}]);return In;}();var Un=0;var Dn=new We(),Nn=new ke(),On=new Mn(),Fn=new We(),Bn=new We(),zn=new We(),Gn=new ke(),Hn=new We(1,0,0),Vn=new We(0,1,0),kn=new We(0,0,1),Wn={type:"added"},Xn={type:"removed"};var jn=/*#__PURE__*/function(_te3){_inherits(jn,_te3);var _super6=_createSuper(jn);function jn(){var _this6;_classCallCheck(this,jn);_this6=_super6.call(this),_this6.isObject3D=!0,Object.defineProperty(_assertThisInitialized(_this6),"id",{value:Un++}),_this6.uuid=se(),_this6.name="",_this6.type="Object3D",_this6.parent=null,_this6.children=[],_this6.up=jn.DEFAULT_UP.clone();var t=new We(),e=new Pn(),n=new ke(),i=new We(1,1,1);e._onChange(function(){n.setFromEuler(e,!1);}),n._onChange(function(){e.setFromQuaternion(n,void 0,!1);}),Object.defineProperties(_assertThisInitialized(_this6),{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Mn()},normalMatrix:{value:new fe()}}),_this6.matrix=new Mn(),_this6.matrixWorld=new Mn(),_this6.matrixAutoUpdate=jn.DEFAULT_MATRIX_AUTO_UPDATE,_this6.matrixWorldAutoUpdate=jn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,_this6.matrixWorldNeedsUpdate=!1,_this6.layers=new In(),_this6.visible=!0,_this6.castShadow=!1,_this6.receiveShadow=!1,_this6.frustumCulled=!0,_this6.renderOrder=0,_this6.animations=[],_this6.userData={};return _this6;}_createClass(jn,[{key:"onBeforeShadow",value:function onBeforeShadow(){}},{key:"onAfterShadow",value:function onAfterShadow(){}},{key:"onBeforeRender",value:function onBeforeRender(){}},{key:"onAfterRender",value:function onAfterRender(){}},{key:"applyMatrix4",value:function applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale);}},{key:"applyQuaternion",value:function applyQuaternion(t){return this.quaternion.premultiply(t),this;}},{key:"setRotationFromAxisAngle",value:function setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e);}},{key:"setRotationFromEuler",value:function setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0);}},{key:"setRotationFromMatrix",value:function setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t);}},{key:"setRotationFromQuaternion",value:function setRotationFromQuaternion(t){this.quaternion.copy(t);}},{key:"rotateOnAxis",value:function rotateOnAxis(t,e){return Nn.setFromAxisAngle(t,e),this.quaternion.multiply(Nn),this;}},{key:"rotateOnWorldAxis",value:function rotateOnWorldAxis(t,e){return Nn.setFromAxisAngle(t,e),this.quaternion.premultiply(Nn),this;}},{key:"rotateX",value:function rotateX(t){return this.rotateOnAxis(Hn,t);}},{key:"rotateY",value:function rotateY(t){return this.rotateOnAxis(Vn,t);}},{key:"rotateZ",value:function rotateZ(t){return this.rotateOnAxis(kn,t);}},{key:"translateOnAxis",value:function translateOnAxis(t,e){return Dn.copy(t).applyQuaternion(this.quaternion),this.position.add(Dn.multiplyScalar(e)),this;}},{key:"translateX",value:function translateX(t){return this.translateOnAxis(Hn,t);}},{key:"translateY",value:function translateY(t){return this.translateOnAxis(Vn,t);}},{key:"translateZ",value:function translateZ(t){return this.translateOnAxis(kn,t);}},{key:"localToWorld",value:function localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld);}},{key:"worldToLocal",value:function worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(On.copy(this.matrixWorld).invert());}},{key:"lookAt",value:function lookAt(t,e,n){t.isVector3?Fn.copy(t):Fn.set(t,e,n);var i=this.parent;this.updateWorldMatrix(!0,!1),Bn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?On.lookAt(Bn,Fn,this.up):On.lookAt(Fn,Bn,this.up),this.quaternion.setFromRotationMatrix(On),i&&(On.extractRotation(i.matrixWorld),Nn.setFromRotationMatrix(On),this.quaternion.premultiply(Nn.invert()));}},{key:"add",value:function add(t){if(arguments.length>1){for(var _t25=0;_t25<arguments.length;_t25++)this.add(arguments[_t25]);return this;}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Wn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this);}},{key:"remove",value:function remove(t){if(arguments.length>1){for(var _t26=0;_t26<arguments.length;_t26++)this.remove(arguments[_t26]);return this;}var e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Xn)),this;}},{key:"removeFromParent",value:function removeFromParent(){var t=this.parent;return null!==t&&t.remove(this),this;}},{key:"clear",value:function clear(){return this.remove.apply(this,_toConsumableArray(this.children));}},{key:"attach",value:function attach(t){return this.updateWorldMatrix(!0,!1),On.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),On.multiply(t.parent.matrixWorld)),t.applyMatrix4(On),this.add(t),t.updateWorldMatrix(!1,!0),this;}},{key:"getObjectById",value:function getObjectById(t){return this.getObjectByProperty("id",t);}},{key:"getObjectByName",value:function getObjectByName(t){return this.getObjectByProperty("name",t);}},{key:"getObjectByProperty",value:function getObjectByProperty(t,e){if(this[t]===e)return this;for(var _n21=0,_i12=this.children.length;_n21<_i12;_n21++){var _i13=this.children[_n21].getObjectByProperty(t,e);if(void 0!==_i13)return _i13;}}},{key:"getObjectsByProperty",value:function getObjectsByProperty(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];this[t]===e&&n.push(this);var i=this.children;for(var _r12=0,_s4=i.length;_r12<_s4;_r12++)i[_r12].getObjectsByProperty(t,e,n);return n;}},{key:"getWorldPosition",value:function getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld);}},{key:"getWorldQuaternion",value:function getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Bn,t,zn),t;}},{key:"getWorldScale",value:function getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Bn,Gn,t),t;}},{key:"getWorldDirection",value:function getWorldDirection(t){this.updateWorldMatrix(!0,!1);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize();}},{key:"raycast",value:function raycast(){}},{key:"traverse",value:function traverse(t){t(this);var e=this.children;for(var _n22=0,_i14=e.length;_n22<_i14;_n22++)e[_n22].traverse(t);}},{key:"traverseVisible",value:function traverseVisible(t){if(!1===this.visible)return;t(this);var e=this.children;for(var _n23=0,_i15=e.length;_n23<_i15;_n23++)e[_n23].traverseVisible(t);}},{key:"traverseAncestors",value:function traverseAncestors(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t));}},{key:"updateMatrix",value:function updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0;}},{key:"updateMatrixWorld",value:function updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var e=this.children;for(var _n24=0,_i16=e.length;_n24<_i16;_n24++){var _i17=e[_n24];!0!==_i17.matrixWorldAutoUpdate&&!0!==t||_i17.updateMatrixWorld(t);}}},{key:"updateWorldMatrix",value:function updateWorldMatrix(t,e){var n=this.parent;if(!0===t&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){var _t27=this.children;for(var _e13=0,_n25=_t27.length;_e13<_n25;_e13++){var _n26=_t27[_e13];!0===_n26.matrixWorldAutoUpdate&&_n26.updateWorldMatrix(!1,!0);}}}},{key:"toJSON",value:function toJSON(t){var e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});var i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid;}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(function(t){return{boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()};}),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);var _e14=this.geometry.parameters;if(void 0!==_e14&&void 0!==_e14.shapes){var _n27=_e14.shapes;if(Array.isArray(_n27))for(var _e15=0,_i18=_n27.length;_e15<_i18;_e15++){var _i19=_n27[_e15];r(t.shapes,_i19);}else r(t.shapes,_n27);}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){var _e16=[];for(var _n28=0,_i20=this.material.length;_n28<_i20;_n28++)_e16.push(r(t.materials,this.material[_n28]));i.material=_e16;}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(var _e17=0;_e17<this.children.length;_e17++)i.children.push(this.children[_e17].toJSON(t).object);}if(this.animations.length>0){i.animations=[];for(var _e18=0;_e18<this.animations.length;_e18++){var _n29=this.animations[_e18];i.animations.push(r(t.animations,_n29));}}if(e){var _e19=s(t.geometries),_i21=s(t.materials),_r13=s(t.textures),_a4=s(t.images),_o4=s(t.shapes),_l3=s(t.skeletons),_c3=s(t.animations),_h2=s(t.nodes);_e19.length>0&&(n.geometries=_e19),_i21.length>0&&(n.materials=_i21),_r13.length>0&&(n.textures=_r13),_a4.length>0&&(n.images=_a4),_o4.length>0&&(n.shapes=_o4),_l3.length>0&&(n.skeletons=_l3),_c3.length>0&&(n.animations=_c3),_h2.length>0&&(n.nodes=_h2);}return n.object=i,n;function s(t){var e=[];for(var _n30 in t){var _i22=t[_n30];delete _i22.metadata,e.push(_i22);}return e;}}},{key:"clone",value:function clone(t){return new this.constructor().copy(this,t);}},{key:"copy",value:function copy(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var _e20=0;_e20<t.children.length;_e20++){var _n31=t.children[_e20];this.add(_n31.clone());}return this;}}]);return jn;}(te);jn.DEFAULT_UP=new We(0,1,0),jn.DEFAULT_MATRIX_AUTO_UPDATE=!0,jn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var qn=new We(),Yn=new We(),Zn=new We(),Jn=new We(),Kn=new We(),$n=new We(),Qn=new We(),ti=new We(),ei=new We(),ni=new We();var ii=!1;var ri=/*#__PURE__*/function(){function ri(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new We();var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new We();var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new We();_classCallCheck(this,ri);this.a=t,this.b=e,this.c=n;}_createClass(ri,[{key:"set",value:function set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this;}},{key:"setFromPointsAndIndices",value:function setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this;}},{key:"setFromAttributeAndIndices",value:function setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this;}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}},{key:"copy",value:function copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this;}},{key:"getArea",value:function getArea(){return qn.subVectors(this.c,this.b),Yn.subVectors(this.a,this.b),.5*qn.cross(Yn).length();}},{key:"getMidpoint",value:function getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3);}},{key:"getNormal",value:function getNormal(t){return ri.getNormal(this.a,this.b,this.c,t);}},{key:"getPlane",value:function getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c);}},{key:"getBarycoord",value:function getBarycoord(t,e){return ri.getBarycoord(t,this.a,this.b,this.c,e);}},{key:"getUV",value:function getUV(t,e,n,i,r){return!1===ii&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),ii=!0),ri.getInterpolation(t,this.a,this.b,this.c,e,n,i,r);}},{key:"getInterpolation",value:function getInterpolation(t,e,n,i,r){return ri.getInterpolation(t,this.a,this.b,this.c,e,n,i,r);}},{key:"containsPoint",value:function containsPoint(t){return ri.containsPoint(t,this.a,this.b,this.c);}},{key:"isFrontFacing",value:function isFrontFacing(t){return ri.isFrontFacing(this.a,this.b,this.c,t);}},{key:"intersectsBox",value:function intersectsBox(t){return t.intersectsTriangle(this);}},{key:"closestPointToPoint",value:function closestPointToPoint(t,e){var n=this.a,i=this.b,r=this.c;var s,a;Kn.subVectors(i,n),$n.subVectors(r,n),ti.subVectors(t,n);var o=Kn.dot(ti),l=$n.dot(ti);if(o<=0&&l<=0)return e.copy(n);ei.subVectors(t,i);var c=Kn.dot(ei),h=$n.dot(ei);if(c>=0&&h<=c)return e.copy(i);var u=o*h-c*l;if(u<=0&&o>=0&&c<=0)return s=o/(o-c),e.copy(n).addScaledVector(Kn,s);ni.subVectors(t,r);var d=Kn.dot(ni),p=$n.dot(ni);if(p>=0&&d<=p)return e.copy(r);var m=d*l-o*p;if(m<=0&&l>=0&&p<=0)return a=l/(l-p),e.copy(n).addScaledVector($n,a);var f=c*p-d*h;if(f<=0&&h-c>=0&&d-p>=0)return Qn.subVectors(r,i),a=(h-c)/(h-c+(d-p)),e.copy(i).addScaledVector(Qn,a);var g=1/(f+m+u);return s=m*g,a=u*g,e.copy(n).addScaledVector(Kn,s).addScaledVector($n,a);}},{key:"equals",value:function equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c);}}],[{key:"getNormal",value:function getNormal(t,e,n,i){i.subVectors(n,e),qn.subVectors(t,e),i.cross(qn);var r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0);}},{key:"getBarycoord",value:function getBarycoord(t,e,n,i,r){qn.subVectors(i,e),Yn.subVectors(n,e),Zn.subVectors(t,e);var s=qn.dot(qn),a=qn.dot(Yn),o=qn.dot(Zn),l=Yn.dot(Yn),c=Yn.dot(Zn),h=s*l-a*a;if(0===h)return r.set(0,0,0),null;var u=1/h,d=(l*o-a*c)*u,p=(s*c-a*o)*u;return r.set(1-d-p,p,d);}},{key:"containsPoint",value:function containsPoint(t,e,n,i){return null!==this.getBarycoord(t,e,n,i,Jn)&&Jn.x>=0&&Jn.y>=0&&Jn.x+Jn.y<=1;}},{key:"getUV",value:function getUV(t,e,n,i,r,s,a,o){return!1===ii&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),ii=!0),this.getInterpolation(t,e,n,i,r,s,a,o);}},{key:"getInterpolation",value:function getInterpolation(t,e,n,i,r,s,a,o){return null===this.getBarycoord(t,e,n,i,Jn)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,Jn.x),o.addScaledVector(s,Jn.y),o.addScaledVector(a,Jn.z),o);}},{key:"isFrontFacing",value:function isFrontFacing(t,e,n,i){return qn.subVectors(n,e),Yn.subVectors(t,e),qn.cross(Yn).dot(i)<0;}}]);return ri;}();var si={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ai={h:0,s:0,l:0},oi={h:0,s:0,l:0};function li(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t;}var ci=/*#__PURE__*/function(_Symbol$iterator6){function ci(t,e,n){_classCallCheck(this,ci);return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n);}_createClass(ci,[{key:"set",value:function set(t,e,n){if(void 0===e&&void 0===n){var _e21=t;_e21&&_e21.isColor?this.copy(_e21):"number"==typeof _e21?this.setHex(_e21):"string"==typeof _e21&&this.setStyle(_e21);}else this.setRGB(t,e,n);return this;}},{key:"setScalar",value:function setScalar(t){return this.r=t,this.g=t,this.b=t,this;}},{key:"setHex",value:function setHex(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Gt;return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Re.toWorkingColorSpace(this,e),this;}},{key:"setRGB",value:function setRGB(t,e,n){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Re.workingColorSpace;return this.r=t,this.g=e,this.b=n,Re.toWorkingColorSpace(this,i),this;}},{key:"setHSL",value:function setHSL(t,e,n){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Re.workingColorSpace;if(t=oe(t,1),e=ae(e,0,1),n=ae(n,0,1),0===e)this.r=this.g=this.b=n;else{var _i23=n<=.5?n*(1+e):n+e-n*e,_r14=2*n-_i23;this.r=li(_r14,_i23,t+1/3),this.g=li(_r14,_i23,t),this.b=li(_r14,_i23,t-1/3);}return Re.toWorkingColorSpace(this,i),this;}},{key:"setStyle",value:function setStyle(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Gt;function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.");}var i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){var _r15;var _s5=i[1],_a5=i[2];switch(_s5){case"rgb":case"rgba":if(_r15=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(_a5))return n(_r15[4]),this.setRGB(Math.min(255,parseInt(_r15[1],10))/255,Math.min(255,parseInt(_r15[2],10))/255,Math.min(255,parseInt(_r15[3],10))/255,e);if(_r15=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(_a5))return n(_r15[4]),this.setRGB(Math.min(100,parseInt(_r15[1],10))/100,Math.min(100,parseInt(_r15[2],10))/100,Math.min(100,parseInt(_r15[3],10))/100,e);break;case"hsl":case"hsla":if(_r15=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(_a5))return n(_r15[4]),this.setHSL(parseFloat(_r15[1])/360,parseFloat(_r15[2])/100,parseFloat(_r15[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t);}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){var _n32=i[1],_r16=_n32.length;if(3===_r16)return this.setRGB(parseInt(_n32.charAt(0),16)/15,parseInt(_n32.charAt(1),16)/15,parseInt(_n32.charAt(2),16)/15,e);if(6===_r16)return this.setHex(parseInt(_n32,16),e);console.warn("THREE.Color: Invalid hex color "+t);}else if(t&&t.length>0)return this.setColorName(t,e);return this;}},{key:"setColorName",value:function setColorName(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Gt;var n=si[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this;}},{key:"clone",value:function clone(){return new this.constructor(this.r,this.g,this.b);}},{key:"copy",value:function copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this;}},{key:"copySRGBToLinear",value:function copySRGBToLinear(t){return this.r=Ce(t.r),this.g=Ce(t.g),this.b=Ce(t.b),this;}},{key:"copyLinearToSRGB",value:function copyLinearToSRGB(t){return this.r=Le(t.r),this.g=Le(t.g),this.b=Le(t.b),this;}},{key:"convertSRGBToLinear",value:function convertSRGBToLinear(){return this.copySRGBToLinear(this),this;}},{key:"convertLinearToSRGB",value:function convertLinearToSRGB(){return this.copyLinearToSRGB(this),this;}},{key:"getHex",value:function getHex(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Gt;return Re.fromWorkingColorSpace(hi.copy(this),t),65536*Math.round(ae(255*hi.r,0,255))+256*Math.round(ae(255*hi.g,0,255))+Math.round(ae(255*hi.b,0,255));}},{key:"getHexString",value:function getHexString(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Gt;return("000000"+this.getHex(t).toString(16)).slice(-6);}},{key:"getHSL",value:function getHSL(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Re.workingColorSpace;Re.fromWorkingColorSpace(hi.copy(this),e);var n=hi.r,i=hi.g,r=hi.b,s=Math.max(n,i,r),a=Math.min(n,i,r);var o,l;var c=(a+s)/2;if(a===s)o=0,l=0;else{var _t28=s-a;switch(l=c<=.5?_t28/(s+a):_t28/(2-s-a),s){case n:o=(i-r)/_t28+(i<r?6:0);break;case i:o=(r-n)/_t28+2;break;case r:o=(n-i)/_t28+4;}o/=6;}return t.h=o,t.s=l,t.l=c,t;}},{key:"getRGB",value:function getRGB(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Re.workingColorSpace;return Re.fromWorkingColorSpace(hi.copy(this),e),t.r=hi.r,t.g=hi.g,t.b=hi.b,t;}},{key:"getStyle",value:function getStyle(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Gt;Re.fromWorkingColorSpace(hi.copy(this),t);var e=hi.r,n=hi.g,i=hi.b;return t!==Gt?"color(".concat(t," ").concat(e.toFixed(3)," ").concat(n.toFixed(3)," ").concat(i.toFixed(3),")"):"rgb(".concat(Math.round(255*e),",").concat(Math.round(255*n),",").concat(Math.round(255*i),")");}},{key:"offsetHSL",value:function offsetHSL(t,e,n){return this.getHSL(ai),this.setHSL(ai.h+t,ai.s+e,ai.l+n);}},{key:"add",value:function add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this;}},{key:"addColors",value:function addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this;}},{key:"addScalar",value:function addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this;}},{key:"sub",value:function sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this;}},{key:"multiply",value:function multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this;}},{key:"multiplyScalar",value:function multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this;}},{key:"lerp",value:function lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this;}},{key:"lerpColors",value:function lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this;}},{key:"lerpHSL",value:function lerpHSL(t,e){this.getHSL(ai),t.getHSL(oi);var n=le(ai.h,oi.h,e),i=le(ai.s,oi.s,e),r=le(ai.l,oi.l,e);return this.setHSL(n,i,r),this;}},{key:"setFromVector3",value:function setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this;}},{key:"applyMatrix3",value:function applyMatrix3(t){var e=this.r,n=this.g,i=this.b,r=t.elements;return this.r=r[0]*e+r[3]*n+r[6]*i,this.g=r[1]*e+r[4]*n+r[7]*i,this.b=r[2]*e+r[5]*n+r[8]*i,this;}},{key:"equals",value:function equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b;}},{key:"fromArray",value:function fromArray(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this;}},{key:"toArray",value:function toArray(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t;}},{key:"fromBufferAttribute",value:function fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this;}},{key:"toJSON",value:function toJSON(){return this.getHex();}},{key:_Symbol$iterator6,value:/*#__PURE__*/_regeneratorRuntime().mark(function value(){return _regeneratorRuntime().wrap(function value$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:_context6.next=2;return this.r;case 2:_context6.next=4;return this.g;case 4:_context6.next=6;return this.b;case 6:case"end":return _context6.stop();}},value,this);})}]);return ci;}(Symbol.iterator);var hi=new ci();ci.NAMES=si;var ui=0;var di=/*#__PURE__*/function(_te4){_inherits(di,_te4);var _super7=_createSuper(di);function di(){var _this7;_classCallCheck(this,di);_this7=_super7.call(this),_this7.isMaterial=!0,Object.defineProperty(_assertThisInitialized(_this7),"id",{value:ui++}),_this7.uuid=se(),_this7.name="",_this7.type="Material",_this7.blending=1,_this7.side=s,_this7.vertexColors=!1,_this7.opacity=1,_this7.transparent=!1,_this7.alphaHash=!1,_this7.blendSrc=l,_this7.blendDst=c,_this7.blendEquation=o,_this7.blendSrcAlpha=null,_this7.blendDstAlpha=null,_this7.blendEquationAlpha=null,_this7.blendColor=new ci(0,0,0),_this7.blendAlpha=0,_this7.depthFunc=3,_this7.depthTest=!0,_this7.depthWrite=!0,_this7.stencilWriteMask=255,_this7.stencilFunc=519,_this7.stencilRef=0,_this7.stencilFuncMask=255,_this7.stencilFail=Yt,_this7.stencilZFail=Yt,_this7.stencilZPass=Yt,_this7.stencilWrite=!1,_this7.clippingPlanes=null,_this7.clipIntersection=!1,_this7.clipShadows=!1,_this7.shadowSide=null,_this7.colorWrite=!0,_this7.precision=null,_this7.polygonOffset=!1,_this7.polygonOffsetFactor=0,_this7.polygonOffsetUnits=0,_this7.dithering=!1,_this7.alphaToCoverage=!1,_this7.premultipliedAlpha=!1,_this7.forceSinglePass=!1,_this7.visible=!0,_this7.toneMapped=!0,_this7.userData={},_this7.version=0,_this7._alphaTest=0;return _this7;}_createClass(di,[{key:"alphaTest",get:function get(){return this._alphaTest;},set:function set(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t;}},{key:"onBuild",value:function onBuild(){}},{key:"onBeforeRender",value:function onBeforeRender(){}},{key:"onBeforeCompile",value:function onBeforeCompile(){}},{key:"customProgramCacheKey",value:function customProgramCacheKey(){return this.onBeforeCompile.toString();}},{key:"setValues",value:function setValues(t){if(void 0!==t)for(var _e22 in t){var _n33=t[_e22];if(void 0===_n33){console.warn("THREE.Material: parameter '".concat(_e22,"' has value of undefined."));continue;}var _i24=this[_e22];void 0!==_i24?_i24&&_i24.isColor?_i24.set(_n33):_i24&&_i24.isVector3&&_n33&&_n33.isVector3?_i24.copy(_n33):this[_e22]=_n33:console.warn("THREE.Material: '".concat(_e22,"' is not a property of THREE.").concat(this.type,"."));}}},{key:"toJSON",value:function toJSON(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(t){var e=[];for(var _n34 in t){var _i25=t[_n34];delete _i25.metadata,e.push(_i25);}return e;}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),this.side!==s&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==l&&(n.blendSrc=this.blendSrc),this.blendDst!==c&&(n.blendDst=this.blendDst),this.blendEquation!==o&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Yt&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Yt&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Yt&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){var _e23=i(t.textures),_r17=i(t.images);_e23.length>0&&(n.textures=_e23),_r17.length>0&&(n.images=_r17);}return n;}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}},{key:"copy",value:function copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes;var n=null;if(null!==e){var _t29=e.length;n=new Array(_t29);for(var _i26=0;_i26!==_t29;++_i26)n[_i26]=e[_i26].clone();}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this;}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"});}},{key:"needsUpdate",set:function set(t){!0===t&&this.version++;}}]);return di;}(te);var pi=/*#__PURE__*/function(_di){_inherits(pi,_di);var _super8=_createSuper(pi);function pi(t){var _this8;_classCallCheck(this,pi);_this8=_super8.call(this),_this8.isMeshBasicMaterial=!0,_this8.type="MeshBasicMaterial",_this8.color=new ci(16777215),_this8.map=null,_this8.lightMap=null,_this8.lightMapIntensity=1,_this8.aoMap=null,_this8.aoMapIntensity=1,_this8.specularMap=null,_this8.alphaMap=null,_this8.envMap=null,_this8.combine=h,_this8.reflectivity=1,_this8.refractionRatio=.98,_this8.wireframe=!1,_this8.wireframeLinewidth=1,_this8.wireframeLinecap="round",_this8.wireframeLinejoin="round",_this8.fog=!0,_this8.setValues(t);return _this8;}_createClass(pi,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(pi.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this;}}]);return pi;}(di);var mi=fi();function fi(){var t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),i=new Uint32Array(512),r=new Uint32Array(512);for(var _t30=0;_t30<256;++_t30){var _e24=_t30-127;_e24<-27?(i[_t30]=0,i[256|_t30]=32768,r[_t30]=24,r[256|_t30]=24):_e24<-14?(i[_t30]=1024>>-_e24-14,i[256|_t30]=1024>>-_e24-14|32768,r[_t30]=-_e24-1,r[256|_t30]=-_e24-1):_e24<=15?(i[_t30]=_e24+15<<10,i[256|_t30]=_e24+15<<10|32768,r[_t30]=13,r[256|_t30]=13):_e24<128?(i[_t30]=31744,i[256|_t30]=64512,r[_t30]=24,r[256|_t30]=24):(i[_t30]=31744,i[256|_t30]=64512,r[_t30]=13,r[256|_t30]=13);}var s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(var _t31=1;_t31<1024;++_t31){var _e25=_t31<<13,_n35=0;for(;0==(8388608&_e25);)_e25<<=1,_n35-=8388608;_e25&=-8388609,_n35+=947912704,s[_t31]=_e25|_n35;}for(var _t32=1024;_t32<2048;++_t32)s[_t32]=939524096+(_t32-1024<<13);for(var _t33=1;_t33<31;++_t33)a[_t33]=_t33<<23;a[31]=1199570944,a[32]=2147483648;for(var _t34=33;_t34<63;++_t34)a[_t34]=2147483648+(_t34-32<<23);a[63]=3347054592;for(var _t35=1;_t35<64;++_t35)32!==_t35&&(o[_t35]=1024);return{floatView:e,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o};}function gi(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=ae(t,-65504,65504),mi.floatView[0]=t;var e=mi.uint32View[0],n=e>>23&511;return mi.baseTable[n]+((8388607&e)>>mi.shiftTable[n]);}function _i(t){var e=t>>10;return mi.uint32View[0]=mi.mantissaTable[mi.offsetTable[e]+(1023&t)]+mi.exponentTable[e],mi.floatView[0];}var vi={toHalfFloat:gi,fromHalfFloat:_i},xi=new We(),yi=new me();var Mi=/*#__PURE__*/function(){function Mi(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!1;_classCallCheck(this,Mi);if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n,this.usage=Zt,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=H,this.version=0;}_createClass(Mi,[{key:"onUploadCallback",value:function onUploadCallback(){}},{key:"needsUpdate",set:function set(t){!0===t&&this.version++;}},{key:"updateRange",get:function get(){return console.warn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange;}},{key:"setUsage",value:function setUsage(t){return this.usage=t,this;}},{key:"addUpdateRange",value:function addUpdateRange(t,e){this.updateRanges.push({start:t,count:e});}},{key:"clearUpdateRanges",value:function clearUpdateRanges(){this.updateRanges.length=0;}},{key:"copy",value:function copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this;}},{key:"copyAt",value:function copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var _i27=0,_r18=this.itemSize;_i27<_r18;_i27++)this.array[t+_i27]=e.array[n+_i27];return this;}},{key:"copyArray",value:function copyArray(t){return this.array.set(t),this;}},{key:"applyMatrix3",value:function applyMatrix3(t){if(2===this.itemSize)for(var _e26=0,_n36=this.count;_e26<_n36;_e26++)yi.fromBufferAttribute(this,_e26),yi.applyMatrix3(t),this.setXY(_e26,yi.x,yi.y);else if(3===this.itemSize)for(var _e27=0,_n37=this.count;_e27<_n37;_e27++)xi.fromBufferAttribute(this,_e27),xi.applyMatrix3(t),this.setXYZ(_e27,xi.x,xi.y,xi.z);return this;}},{key:"applyMatrix4",value:function applyMatrix4(t){for(var _e28=0,_n38=this.count;_e28<_n38;_e28++)xi.fromBufferAttribute(this,_e28),xi.applyMatrix4(t),this.setXYZ(_e28,xi.x,xi.y,xi.z);return this;}},{key:"applyNormalMatrix",value:function applyNormalMatrix(t){for(var _e29=0,_n39=this.count;_e29<_n39;_e29++)xi.fromBufferAttribute(this,_e29),xi.applyNormalMatrix(t),this.setXYZ(_e29,xi.x,xi.y,xi.z);return this;}},{key:"transformDirection",value:function transformDirection(t){for(var _e30=0,_n40=this.count;_e30<_n40;_e30++)xi.fromBufferAttribute(this,_e30),xi.transformDirection(t),this.setXYZ(_e30,xi.x,xi.y,xi.z);return this;}},{key:"set",value:function set(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.array.set(t,e),this;}},{key:"getComponent",value:function getComponent(t,e){var n=this.array[t*this.itemSize+e];return this.normalized&&(n=ue(n,this.array)),n;}},{key:"setComponent",value:function setComponent(t,e,n){return this.normalized&&(n=de(n,this.array)),this.array[t*this.itemSize+e]=n,this;}},{key:"getX",value:function getX(t){var e=this.array[t*this.itemSize];return this.normalized&&(e=ue(e,this.array)),e;}},{key:"setX",value:function setX(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize]=e,this;}},{key:"getY",value:function getY(t){var e=this.array[t*this.itemSize+1];return this.normalized&&(e=ue(e,this.array)),e;}},{key:"setY",value:function setY(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize+1]=e,this;}},{key:"getZ",value:function getZ(t){var e=this.array[t*this.itemSize+2];return this.normalized&&(e=ue(e,this.array)),e;}},{key:"setZ",value:function setZ(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize+2]=e,this;}},{key:"getW",value:function getW(t){var e=this.array[t*this.itemSize+3];return this.normalized&&(e=ue(e,this.array)),e;}},{key:"setW",value:function setW(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize+3]=e,this;}},{key:"setXY",value:function setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=de(e,this.array),n=de(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this;}},{key:"setXYZ",value:function setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=de(e,this.array),n=de(n,this.array),i=de(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this;}},{key:"setXYZW",value:function setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=de(e,this.array),n=de(n,this.array),i=de(i,this.array),r=de(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this;}},{key:"onUpload",value:function onUpload(t){return this.onUploadCallback=t,this;}},{key:"clone",value:function clone(){return new this.constructor(this.array,this.itemSize).copy(this);}},{key:"toJSON",value:function toJSON(){var t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Zt&&(t.usage=this.usage),t;}}]);return Mi;}();var Si=/*#__PURE__*/function(_Mi){_inherits(Si,_Mi);var _super9=_createSuper(Si);function Si(t,e,n){_classCallCheck(this,Si);return _super9.call(this,new Uint16Array(t),e,n);}return _createClass(Si);}(Mi);var bi=/*#__PURE__*/function(_Mi2){_inherits(bi,_Mi2);var _super10=_createSuper(bi);function bi(t,e,n){_classCallCheck(this,bi);return _super10.call(this,new Uint32Array(t),e,n);}return _createClass(bi);}(Mi);var Ti=/*#__PURE__*/function(_Mi3){_inherits(Ti,_Mi3);var _super11=_createSuper(Ti);function Ti(t,e,n){_classCallCheck(this,Ti);return _super11.call(this,new Float32Array(t),e,n);}return _createClass(Ti);}(Mi);var Ei=0;var wi=new Mn(),Ai=new jn(),Ri=new We(),Ci=new qe(),Li=new qe(),Pi=new We();var Ii=/*#__PURE__*/function(_te5){_inherits(Ii,_te5);var _super12=_createSuper(Ii);function Ii(){var _this9;_classCallCheck(this,Ii);_this9=_super12.call(this),_this9.isBufferGeometry=!0,Object.defineProperty(_assertThisInitialized(_this9),"id",{value:Ei++}),_this9.uuid=se(),_this9.name="",_this9.type="BufferGeometry",_this9.index=null,_this9.attributes={},_this9.morphAttributes={},_this9.morphTargetsRelative=!1,_this9.groups=[],_this9.boundingBox=null,_this9.boundingSphere=null,_this9.drawRange={start:0,count:1/0},_this9.userData={};return _this9;}_createClass(Ii,[{key:"getIndex",value:function getIndex(){return this.index;}},{key:"setIndex",value:function setIndex(t){return Array.isArray(t)?this.index=new(_e(t)?bi:Si)(t,1):this.index=t,this;}},{key:"getAttribute",value:function getAttribute(t){return this.attributes[t];}},{key:"setAttribute",value:function setAttribute(t,e){return this.attributes[t]=e,this;}},{key:"deleteAttribute",value:function deleteAttribute(t){return delete this.attributes[t],this;}},{key:"hasAttribute",value:function hasAttribute(t){return void 0!==this.attributes[t];}},{key:"addGroup",value:function addGroup(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;this.groups.push({start:t,count:e,materialIndex:n});}},{key:"clearGroups",value:function clearGroups(){this.groups=[];}},{key:"setDrawRange",value:function setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e;}},{key:"applyMatrix4",value:function applyMatrix4(t){var e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var _e31=new fe().getNormalMatrix(t);n.applyNormalMatrix(_e31),n.needsUpdate=!0;}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this;}},{key:"applyQuaternion",value:function applyQuaternion(t){return wi.makeRotationFromQuaternion(t),this.applyMatrix4(wi),this;}},{key:"rotateX",value:function rotateX(t){return wi.makeRotationX(t),this.applyMatrix4(wi),this;}},{key:"rotateY",value:function rotateY(t){return wi.makeRotationY(t),this.applyMatrix4(wi),this;}},{key:"rotateZ",value:function rotateZ(t){return wi.makeRotationZ(t),this.applyMatrix4(wi),this;}},{key:"translate",value:function translate(t,e,n){return wi.makeTranslation(t,e,n),this.applyMatrix4(wi),this;}},{key:"scale",value:function scale(t,e,n){return wi.makeScale(t,e,n),this.applyMatrix4(wi),this;}},{key:"lookAt",value:function lookAt(t){return Ai.lookAt(t),Ai.updateMatrix(),this.applyMatrix4(Ai.matrix),this;}},{key:"center",value:function center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ri).negate(),this.translate(Ri.x,Ri.y,Ri.z),this;}},{key:"setFromPoints",value:function setFromPoints(t){var e=[];for(var _n41=0,_i28=t.length;_n41<_i28;_n41++){var _i29=t[_n41];e.push(_i29.x,_i29.y,_i29.z||0);}return this.setAttribute("position",new Ti(e,3)),this;}},{key:"computeBoundingBox",value:function computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new qe());var t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new We(-1/0,-1/0,-1/0),new We(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(var _t36=0,_n42=e.length;_t36<_n42;_t36++){var _n43=e[_t36];Ci.setFromBufferAttribute(_n43),this.morphTargetsRelative?(Pi.addVectors(this.boundingBox.min,Ci.min),this.boundingBox.expandByPoint(Pi),Pi.addVectors(this.boundingBox.max,Ci.max),this.boundingBox.expandByPoint(Pi)):(this.boundingBox.expandByPoint(Ci.min),this.boundingBox.expandByPoint(Ci.max));}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this);}},{key:"computeBoundingSphere",value:function computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new dn());var t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new We(),1/0);if(t){var _n44=this.boundingSphere.center;if(Ci.setFromBufferAttribute(t),e)for(var _t37=0,_n45=e.length;_t37<_n45;_t37++){var _n46=e[_t37];Li.setFromBufferAttribute(_n46),this.morphTargetsRelative?(Pi.addVectors(Ci.min,Li.min),Ci.expandByPoint(Pi),Pi.addVectors(Ci.max,Li.max),Ci.expandByPoint(Pi)):(Ci.expandByPoint(Li.min),Ci.expandByPoint(Li.max));}Ci.getCenter(_n44);var _i30=0;for(var _e32=0,_r19=t.count;_e32<_r19;_e32++)Pi.fromBufferAttribute(t,_e32),_i30=Math.max(_i30,_n44.distanceToSquared(Pi));if(e)for(var _r20=0,_s6=e.length;_r20<_s6;_r20++){var _s7=e[_r20],_a6=this.morphTargetsRelative;for(var _e33=0,_r21=_s7.count;_e33<_r21;_e33++)Pi.fromBufferAttribute(_s7,_e33),_a6&&(Ri.fromBufferAttribute(t,_e33),Pi.add(Ri)),_i30=Math.max(_i30,_n44.distanceToSquared(Pi));}this.boundingSphere.radius=Math.sqrt(_i30),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this);}}},{key:"computeTangents",value:function computeTangents(){var t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");var n=t.array,i=e.position.array,r=e.normal.array,s=e.uv.array,a=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Mi(new Float32Array(4*a),4));var o=this.getAttribute("tangent").array,l=[],c=[];for(var _t38=0;_t38<a;_t38++)l[_t38]=new We(),c[_t38]=new We();var h=new We(),u=new We(),d=new We(),p=new me(),m=new me(),f=new me(),g=new We(),_=new We();function v(t,e,n){h.fromArray(i,3*t),u.fromArray(i,3*e),d.fromArray(i,3*n),p.fromArray(s,2*t),m.fromArray(s,2*e),f.fromArray(s,2*n),u.sub(h),d.sub(h),m.sub(p),f.sub(p);var r=1/(m.x*f.y-f.x*m.y);isFinite(r)&&(g.copy(u).multiplyScalar(f.y).addScaledVector(d,-m.y).multiplyScalar(r),_.copy(d).multiplyScalar(m.x).addScaledVector(u,-f.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[n].add(g),c[t].add(_),c[e].add(_),c[n].add(_));}var x=this.groups;0===x.length&&(x=[{start:0,count:n.length}]);for(var _t39=0,_e34=x.length;_t39<_e34;++_t39){var _e35=x[_t39],_i31=_e35.start;for(var _t40=_i31,_r22=_i31+_e35.count;_t40<_r22;_t40+=3)v(n[_t40+0],n[_t40+1],n[_t40+2]);}var y=new We(),M=new We(),S=new We(),b=new We();function T(t){S.fromArray(r,3*t),b.copy(S);var e=l[t];y.copy(e),y.sub(S.multiplyScalar(S.dot(e))).normalize(),M.crossVectors(b,e);var n=M.dot(c[t])<0?-1:1;o[4*t]=y.x,o[4*t+1]=y.y,o[4*t+2]=y.z,o[4*t+3]=n;}for(var _t41=0,_e36=x.length;_t41<_e36;++_t41){var _e37=x[_t41],_i32=_e37.start;for(var _t42=_i32,_r23=_i32+_e37.count;_t42<_r23;_t42+=3)T(n[_t42+0]),T(n[_t42+1]),T(n[_t42+2]);}}},{key:"computeVertexNormals",value:function computeVertexNormals(){var t=this.index,e=this.getAttribute("position");if(void 0!==e){var _n47=this.getAttribute("normal");if(void 0===_n47)_n47=new Mi(new Float32Array(3*e.count),3),this.setAttribute("normal",_n47);else for(var _t43=0,_e38=_n47.count;_t43<_e38;_t43++)_n47.setXYZ(_t43,0,0,0);var _i33=new We(),_r24=new We(),_s8=new We(),_a7=new We(),_o5=new We(),_l4=new We(),_c4=new We(),_h3=new We();if(t)for(var _u2=0,_d=t.count;_u2<_d;_u2+=3){var _d2=t.getX(_u2+0),_p=t.getX(_u2+1),_m=t.getX(_u2+2);_i33.fromBufferAttribute(e,_d2),_r24.fromBufferAttribute(e,_p),_s8.fromBufferAttribute(e,_m),_c4.subVectors(_s8,_r24),_h3.subVectors(_i33,_r24),_c4.cross(_h3),_a7.fromBufferAttribute(_n47,_d2),_o5.fromBufferAttribute(_n47,_p),_l4.fromBufferAttribute(_n47,_m),_a7.add(_c4),_o5.add(_c4),_l4.add(_c4),_n47.setXYZ(_d2,_a7.x,_a7.y,_a7.z),_n47.setXYZ(_p,_o5.x,_o5.y,_o5.z),_n47.setXYZ(_m,_l4.x,_l4.y,_l4.z);}else for(var _t44=0,_a8=e.count;_t44<_a8;_t44+=3)_i33.fromBufferAttribute(e,_t44+0),_r24.fromBufferAttribute(e,_t44+1),_s8.fromBufferAttribute(e,_t44+2),_c4.subVectors(_s8,_r24),_h3.subVectors(_i33,_r24),_c4.cross(_h3),_n47.setXYZ(_t44+0,_c4.x,_c4.y,_c4.z),_n47.setXYZ(_t44+1,_c4.x,_c4.y,_c4.z),_n47.setXYZ(_t44+2,_c4.x,_c4.y,_c4.z);this.normalizeNormals(),_n47.needsUpdate=!0;}}},{key:"normalizeNormals",value:function normalizeNormals(){var t=this.attributes.normal;for(var _e39=0,_n48=t.count;_e39<_n48;_e39++)Pi.fromBufferAttribute(t,_e39),Pi.normalize(),t.setXYZ(_e39,Pi.x,Pi.y,Pi.z);}},{key:"toNonIndexed",value:function toNonIndexed(){function t(t,e){var n=t.array,i=t.itemSize,r=t.normalized,s=new n.constructor(e.length*i);var a=0,o=0;for(var _r25=0,_l5=e.length;_r25<_l5;_r25++){a=t.isInterleavedBufferAttribute?e[_r25]*t.data.stride+t.offset:e[_r25]*i;for(var _t45=0;_t45<i;_t45++)s[o++]=n[a++];}return new Mi(s,i,r);}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var e=new Ii(),n=this.index.array,i=this.attributes;for(var _r26 in i){var _s9=t(i[_r26],n);e.setAttribute(_r26,_s9);}var r=this.morphAttributes;for(var _i34 in r){var _s10=[],_a9=r[_i34];for(var _e40=0,_i35=_a9.length;_e40<_i35;_e40++){var _i36=t(_a9[_e40],n);_s10.push(_i36);}e.morphAttributes[_i34]=_s10;}e.morphTargetsRelative=this.morphTargetsRelative;var s=this.groups;for(var _t46=0,_n49=s.length;_t46<_n49;_t46++){var _n50=s[_t46];e.addGroup(_n50.start,_n50.count,_n50.materialIndex);}return e;}},{key:"toJSON",value:function toJSON(){var t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){var _e41=this.parameters;for(var _n51 in _e41)void 0!==_e41[_n51]&&(t[_n51]=_e41[_n51]);return t;}t.data={attributes:{}};var e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});var n=this.attributes;for(var _e42 in n){var _i37=n[_e42];t.data.attributes[_e42]=_i37.toJSON(t.data);}var i={};var r=!1;for(var _e43 in this.morphAttributes){var _n52=this.morphAttributes[_e43],_s11=[];for(var _e44=0,_i38=_n52.length;_e44<_i38;_e44++){var _i39=_n52[_e44];_s11.push(_i39.toJSON(t.data));}_s11.length>0&&(i[_e43]=_s11,r=!0);}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);var s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));var a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t;}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}},{key:"copy",value:function copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var e={};this.name=t.name;var n=t.index;null!==n&&this.setIndex(n.clone(e));var i=t.attributes;for(var _t47 in i){var _n53=i[_t47];this.setAttribute(_t47,_n53.clone(e));}var r=t.morphAttributes;for(var _t48 in r){var _n54=[],_i40=r[_t48];for(var _t49=0,_r27=_i40.length;_t49<_r27;_t49++)_n54.push(_i40[_t49].clone(e));this.morphAttributes[_t48]=_n54;}this.morphTargetsRelative=t.morphTargetsRelative;var s=t.groups;for(var _t50=0,_e45=s.length;_t50<_e45;_t50++){var _e46=s[_t50];this.addGroup(_e46.start,_e46.count,_e46.materialIndex);}var a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());var o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this;}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"});}}]);return Ii;}(te);var Ui=new Mn(),Di=new yn(),Ni=new dn(),Oi=new We(),Fi=new We(),Bi=new We(),zi=new We(),Gi=new We(),Hi=new We(),Vi=new me(),ki=new me(),Wi=new me(),Xi=new We(),ji=new We(),qi=new We(),Yi=new We(),Zi=new We();var Ji=/*#__PURE__*/function(_jn){_inherits(Ji,_jn);var _super13=_createSuper(Ji);function Ji(){var _this10;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Ii();var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new pi();_classCallCheck(this,Ji);_this10=_super13.call(this),_this10.isMesh=!0,_this10.type="Mesh",_this10.geometry=t,_this10.material=e,_this10.updateMorphTargets();return _this10;}_createClass(Ji,[{key:"copy",value:function copy(t,e){return _get(_getPrototypeOf(Ji.prototype),"copy",this).call(this,t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this;}},{key:"updateMorphTargets",value:function updateMorphTargets(){var t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){var _n55=t[e[0]];if(void 0!==_n55){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var _t51=0,_e47=_n55.length;_t51<_e47;_t51++){var _e48=_n55[_t51].name||String(_t51);this.morphTargetInfluences.push(0),this.morphTargetDictionary[_e48]=_t51;}}}}},{key:"getVertexPosition",value:function getVertexPosition(t,e){var n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,s=n.morphTargetsRelative;e.fromBufferAttribute(i,t);var a=this.morphTargetInfluences;if(r&&a){Hi.set(0,0,0);for(var _n56=0,_i41=r.length;_n56<_i41;_n56++){var _i42=a[_n56],_o6=r[_n56];0!==_i42&&(Gi.fromBufferAttribute(_o6,t),s?Hi.addScaledVector(Gi,_i42):Hi.addScaledVector(Gi.sub(e),_i42));}e.add(Hi);}return e;}},{key:"raycast",value:function raycast(t,e){var n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Ni.copy(n.boundingSphere),Ni.applyMatrix4(r),Di.copy(t.ray).recast(t.near),!1===Ni.containsPoint(Di.origin)){if(null===Di.intersectSphere(Ni,Oi))return;if(Di.origin.distanceToSquared(Oi)>Math.pow(t.far-t.near,2))return;}Ui.copy(r).invert(),Di.copy(t.ray).applyMatrix4(Ui),null!==n.boundingBox&&!1===Di.intersectsBox(n.boundingBox)||this._computeIntersections(t,e,Di);}}},{key:"_computeIntersections",value:function _computeIntersections(t,e,n){var i;var r=this.geometry,s=this.material,a=r.index,o=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,h=r.attributes.normal,u=r.groups,d=r.drawRange;if(null!==a){if(Array.isArray(s))for(var _r28=0,_o7=u.length;_r28<_o7;_r28++){var _o8=u[_r28],_p2=s[_o8.materialIndex];for(var _r29=Math.max(_o8.start,d.start),_s12=Math.min(a.count,Math.min(_o8.start+_o8.count,d.start+d.count));_r29<_s12;_r29+=3){i=Ki(this,_p2,t,n,l,c,h,a.getX(_r29),a.getX(_r29+1),a.getX(_r29+2)),i&&(i.faceIndex=Math.floor(_r29/3),i.face.materialIndex=_o8.materialIndex,e.push(i));}}else{for(var _r30=Math.max(0,d.start),_o9=Math.min(a.count,d.start+d.count);_r30<_o9;_r30+=3){i=Ki(this,s,t,n,l,c,h,a.getX(_r30),a.getX(_r30+1),a.getX(_r30+2)),i&&(i.faceIndex=Math.floor(_r30/3),e.push(i));}}}else if(void 0!==o)if(Array.isArray(s))for(var _r31=0,_a10=u.length;_r31<_a10;_r31++){var _a11=u[_r31],_p3=s[_a11.materialIndex];for(var _r32=Math.max(_a11.start,d.start),_s13=Math.min(o.count,Math.min(_a11.start+_a11.count,d.start+d.count));_r32<_s13;_r32+=3){i=Ki(this,_p3,t,n,l,c,h,_r32,_r32+1,_r32+2),i&&(i.faceIndex=Math.floor(_r32/3),i.face.materialIndex=_a11.materialIndex,e.push(i));}}else{for(var _r33=Math.max(0,d.start),_a12=Math.min(o.count,d.start+d.count);_r33<_a12;_r33+=3){i=Ki(this,s,t,n,l,c,h,_r33,_r33+1,_r33+2),i&&(i.faceIndex=Math.floor(_r33/3),e.push(i));}}}}]);return Ji;}(jn);function Ki(t,e,n,i,r,o,l,c,h,u){t.getVertexPosition(c,Fi),t.getVertexPosition(h,Bi),t.getVertexPosition(u,zi);var d=function(t,e,n,i,r,o,l,c){var h;if(h=e.side===a?i.intersectTriangle(l,o,r,!0,c):i.intersectTriangle(r,o,l,e.side===s,c),null===h)return null;Zi.copy(c),Zi.applyMatrix4(t.matrixWorld);var u=n.ray.origin.distanceTo(Zi);return u<n.near||u>n.far?null:{distance:u,point:Zi.clone(),object:t};}(t,e,n,i,Fi,Bi,zi,Yi);if(d){r&&(Vi.fromBufferAttribute(r,c),ki.fromBufferAttribute(r,h),Wi.fromBufferAttribute(r,u),d.uv=ri.getInterpolation(Yi,Fi,Bi,zi,Vi,ki,Wi,new me())),o&&(Vi.fromBufferAttribute(o,c),ki.fromBufferAttribute(o,h),Wi.fromBufferAttribute(o,u),d.uv1=ri.getInterpolation(Yi,Fi,Bi,zi,Vi,ki,Wi,new me()),d.uv2=d.uv1),l&&(Xi.fromBufferAttribute(l,c),ji.fromBufferAttribute(l,h),qi.fromBufferAttribute(l,u),d.normal=ri.getInterpolation(Yi,Fi,Bi,zi,Xi,ji,qi,new We()),d.normal.dot(i.direction)>0&&d.normal.multiplyScalar(-1));var _t52={a:c,b:h,c:u,normal:new We(),materialIndex:0};ri.getNormal(Fi,Bi,zi,_t52.normal),d.face=_t52;}return d;}var $i=/*#__PURE__*/function(_Ii){_inherits($i,_Ii);var _super14=_createSuper($i);function $i(){var _this11;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1;_classCallCheck(this,$i);_this11=_super14.call(this),_this11.type="BoxGeometry",_this11.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};var a=_assertThisInitialized(_this11);i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);var o=[],l=[],c=[],h=[];var u=0,d=0;function p(t,e,n,i,r,s,p,m,f,g,_){var v=s/f,x=p/g,y=s/2,M=p/2,S=m/2,b=f+1,T=g+1;var E=0,w=0;var A=new We();for(var _s14=0;_s14<T;_s14++){var _a13=_s14*x-M;for(var _o10=0;_o10<b;_o10++){var _u3=_o10*v-y;A[t]=_u3*i,A[e]=_a13*r,A[n]=S,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=m>0?1:-1,c.push(A.x,A.y,A.z),h.push(_o10/f),h.push(1-_s14/g),E+=1;}}for(var _t53=0;_t53<g;_t53++)for(var _e49=0;_e49<f;_e49++){var _n57=u+_e49+b*_t53,_i43=u+_e49+b*(_t53+1),_r34=u+(_e49+1)+b*(_t53+1),_s15=u+(_e49+1)+b*_t53;o.push(_n57,_i43,_s15),o.push(_i43,_r34,_s15),w+=6;}a.addGroup(d,w,_),d+=w,u+=E;}p("z","y","x",-1,-1,n,e,t,s,r,0),p("z","y","x",1,-1,n,e,-t,s,r,1),p("x","z","y",1,1,t,n,e,i,s,2),p("x","z","y",1,-1,t,n,-e,i,s,3),p("x","y","z",1,-1,t,e,n,i,r,4),p("x","y","z",-1,-1,t,e,-n,i,r,5),_this11.setIndex(o),_this11.setAttribute("position",new Ti(l,3)),_this11.setAttribute("normal",new Ti(c,3)),_this11.setAttribute("uv",new Ti(h,2));return _this11;}_createClass($i,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf($i.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this;}}],[{key:"fromJSON",value:function fromJSON(t){return new $i(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments);}}]);return $i;}(Ii);function Qi(t){var e={};for(var _n58 in t){e[_n58]={};for(var _i44 in t[_n58]){var _r35=t[_n58][_i44];_r35&&(_r35.isColor||_r35.isMatrix3||_r35.isMatrix4||_r35.isVector2||_r35.isVector3||_r35.isVector4||_r35.isTexture||_r35.isQuaternion)?_r35.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[_n58][_i44]=null):e[_n58][_i44]=_r35.clone():Array.isArray(_r35)?e[_n58][_i44]=_r35.slice():e[_n58][_i44]=_r35;}}return e;}function tr(t){var e={};for(var _n59=0;_n59<t.length;_n59++){var _i45=Qi(t[_n59]);for(var _t54 in _i45)e[_t54]=_i45[_t54];}return e;}function er(t){return null===t.getRenderTarget()?t.outputColorSpace:Re.workingColorSpace;}var nr={clone:Qi,merge:tr};var ir=/*#__PURE__*/function(_di2){_inherits(ir,_di2);var _super15=_createSuper(ir);function ir(t){var _this12;_classCallCheck(this,ir);_this12=_super15.call(this),_this12.isShaderMaterial=!0,_this12.type="ShaderMaterial",_this12.defines={},_this12.uniforms={},_this12.uniformsGroups=[],_this12.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",_this12.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",_this12.linewidth=1,_this12.wireframe=!1,_this12.wireframeLinewidth=1,_this12.fog=!1,_this12.lights=!1,_this12.clipping=!1,_this12.forceSinglePass=!0,_this12.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1},_this12.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},_this12.index0AttributeName=void 0,_this12.uniformsNeedUpdate=!1,_this12.glslVersion=null,void 0!==t&&_this12.setValues(t);return _this12;}_createClass(ir,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(ir.prototype),"copy",this).call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Qi(t.uniforms),this.uniformsGroups=function(t){var e=[];for(var _n60=0;_n60<t.length;_n60++)e.push(t[_n60].clone());return e;}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this;}},{key:"toJSON",value:function toJSON(t){var e=_get(_getPrototypeOf(ir.prototype),"toJSON",this).call(this,t);e.glslVersion=this.glslVersion,e.uniforms={};for(var _n61 in this.uniforms){var _i46=this.uniforms[_n61].value;_i46&&_i46.isTexture?e.uniforms[_n61]={type:"t",value:_i46.toJSON(t).uuid}:_i46&&_i46.isColor?e.uniforms[_n61]={type:"c",value:_i46.getHex()}:_i46&&_i46.isVector2?e.uniforms[_n61]={type:"v2",value:_i46.toArray()}:_i46&&_i46.isVector3?e.uniforms[_n61]={type:"v3",value:_i46.toArray()}:_i46&&_i46.isVector4?e.uniforms[_n61]={type:"v4",value:_i46.toArray()}:_i46&&_i46.isMatrix3?e.uniforms[_n61]={type:"m3",value:_i46.toArray()}:_i46&&_i46.isMatrix4?e.uniforms[_n61]={type:"m4",value:_i46.toArray()}:e.uniforms[_n61]={value:_i46};}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;var n={};for(var _t55 in this.extensions)!0===this.extensions[_t55]&&(n[_t55]=!0);return Object.keys(n).length>0&&(e.extensions=n),e;}}]);return ir;}(di);var rr=/*#__PURE__*/function(_jn2){_inherits(rr,_jn2);var _super16=_createSuper(rr);function rr(){var _this13;_classCallCheck(this,rr);_this13=_super16.call(this),_this13.isCamera=!0,_this13.type="Camera",_this13.matrixWorldInverse=new Mn(),_this13.projectionMatrix=new Mn(),_this13.projectionMatrixInverse=new Mn(),_this13.coordinateSystem=$t;return _this13;}_createClass(rr,[{key:"copy",value:function copy(t,e){return _get(_getPrototypeOf(rr.prototype),"copy",this).call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this;}},{key:"getWorldDirection",value:function getWorldDirection(t){return _get(_getPrototypeOf(rr.prototype),"getWorldDirection",this).call(this,t).negate();}},{key:"updateMatrixWorld",value:function updateMatrixWorld(t){_get(_getPrototypeOf(rr.prototype),"updateMatrixWorld",this).call(this,t),this.matrixWorldInverse.copy(this.matrixWorld).invert();}},{key:"updateWorldMatrix",value:function updateWorldMatrix(t,e){_get(_getPrototypeOf(rr.prototype),"updateWorldMatrix",this).call(this,t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert();}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}}]);return rr;}(jn);var sr=/*#__PURE__*/function(_rr){_inherits(sr,_rr);var _super17=_createSuper(sr);function sr(){var _this14;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:50;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:.1;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:2e3;_classCallCheck(this,sr);_this14=_super17.call(this),_this14.isPerspectiveCamera=!0,_this14.type="PerspectiveCamera",_this14.fov=t,_this14.zoom=1,_this14.near=n,_this14.far=i,_this14.focus=10,_this14.aspect=e,_this14.view=null,_this14.filmGauge=35,_this14.filmOffset=0,_this14.updateProjectionMatrix();return _this14;}_createClass(sr,[{key:"copy",value:function copy(t,e){return _get(_getPrototypeOf(sr.prototype),"copy",this).call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this;}},{key:"setFocalLength",value:function setFocalLength(t){var e=.5*this.getFilmHeight()/t;this.fov=2*re*Math.atan(e),this.updateProjectionMatrix();}},{key:"getFocalLength",value:function getFocalLength(){var t=Math.tan(.5*ie*this.fov);return .5*this.getFilmHeight()/t;}},{key:"getEffectiveFOV",value:function getEffectiveFOV(){return 2*re*Math.atan(Math.tan(.5*ie*this.fov)/this.zoom);}},{key:"getFilmWidth",value:function getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1);}},{key:"getFilmHeight",value:function getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1);}},{key:"setViewOffset",value:function setViewOffset(t,e,n,i,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix();}},{key:"clearViewOffset",value:function clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix();}},{key:"updateProjectionMatrix",value:function updateProjectionMatrix(){var t=this.near;var e=t*Math.tan(.5*ie*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;var s=this.view;if(null!==this.view&&this.view.enabled){var _t56=s.fullWidth,_a14=s.fullHeight;r+=s.offsetX*i/_t56,e-=s.offsetY*n/_a14,i*=s.width/_t56,n*=s.height/_a14;}var a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert();}},{key:"toJSON",value:function toJSON(t){var e=_get(_getPrototypeOf(sr.prototype),"toJSON",this).call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e;}}]);return sr;}(rr);var ar=-90;var or=/*#__PURE__*/function(_jn3){_inherits(or,_jn3);var _super18=_createSuper(or);function or(t,e,n){var _this15;_classCallCheck(this,or);_this15=_super18.call(this),_this15.type="CubeCamera",_this15.renderTarget=n,_this15.coordinateSystem=null,_this15.activeMipmapLevel=0;var i=new sr(ar,1,t,e);i.layers=_this15.layers,_this15.add(i);var r=new sr(ar,1,t,e);r.layers=_this15.layers,_this15.add(r);var s=new sr(ar,1,t,e);s.layers=_this15.layers,_this15.add(s);var a=new sr(ar,1,t,e);a.layers=_this15.layers,_this15.add(a);var o=new sr(ar,1,t,e);o.layers=_this15.layers,_this15.add(o);var l=new sr(ar,1,t,e);l.layers=_this15.layers,_this15.add(l);return _this15;}_createClass(or,[{key:"updateCoordinateSystem",value:function updateCoordinateSystem(){var t=this.coordinateSystem,e=this.children.concat(),_e50=_slicedToArray(e,6),n=_e50[0],i=_e50[1],r=_e50[2],s=_e50[3],a=_e50[4],o=_e50[5];var _iterator=_createForOfIteratorHelper(e),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _t57=_step.value;this.remove(_t57);}}catch(err){_iterator.e(err);}finally{_iterator.f();}if(t===$t)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(t!==Qt)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1);}var _iterator2=_createForOfIteratorHelper(e),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _t58=_step2.value;this.add(_t58),_t58.updateMatrixWorld();}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}},{key:"update",value:function update(t,e){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,i=this.activeMipmapLevel;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());var _this$children=_slicedToArray(this.children,6),r=_this$children[0],s=_this$children[1],a=_this$children[2],o=_this$children[3],l=_this$children[4],c=_this$children[5],h=t.getRenderTarget(),u=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;var m=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,i),t.render(e,r),t.setRenderTarget(n,1,i),t.render(e,s),t.setRenderTarget(n,2,i),t.render(e,a),t.setRenderTarget(n,3,i),t.render(e,o),t.setRenderTarget(n,4,i),t.render(e,l),n.texture.generateMipmaps=m,t.setRenderTarget(n,5,i),t.render(e,c),t.setRenderTarget(h,u,d),t.xr.enabled=p,n.texture.needsPMREMUpdate=!0;}}]);return or;}(jn);var lr=/*#__PURE__*/function(_Fe3){_inherits(lr,_Fe3);var _super19=_createSuper(lr);function lr(t,e,n,i,r,s,a,o,l,c){var _this16;_classCallCheck(this,lr);_this16=_super19.call(this,t=void 0!==t?t:[],e=void 0!==e?e:b,n,i,r,s,a,o,l,c),_this16.isCubeTexture=!0,_this16.flipY=!1;return _this16;}_createClass(lr,[{key:"images",get:function get(){return this.image;},set:function set(t){this.image=t;}}]);return lr;}(Fe);var cr=/*#__PURE__*/function(_Ge){_inherits(cr,_Ge);var _super20=_createSuper(cr);function cr(){var _this17;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,cr);_this17=_super20.call(this,t,t,e),_this17.isWebGLCubeRenderTarget=!0;var n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];void 0!==e.encoding&&(be("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),e.colorSpace=e.encoding===Bt?Gt:zt),_this17.texture=new lr(i,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),_this17.texture.isRenderTargetTexture=!0,_this17.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,_this17.texture.minFilter=void 0!==e.minFilter?e.minFilter:D;return _this17;}_createClass(cr,[{key:"fromEquirectangularTexture",value:function fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;var n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new $i(5,5,5),r=new ir({name:"CubemapFromEquirect",uniforms:Qi(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:a,blending:0});r.uniforms.tEquirect.value=e;var s=new Ji(i,r),o=e.minFilter;e.minFilter===O&&(e.minFilter=D);return new or(1,10,this).update(t,s),e.minFilter=o,s.geometry.dispose(),s.material.dispose(),this;}},{key:"clear",value:function clear(t,e,n,i){var r=t.getRenderTarget();for(var _r36=0;_r36<6;_r36++)t.setRenderTarget(this,_r36),t.clear(e,n,i);t.setRenderTarget(r);}}]);return cr;}(Ge);var hr=new We(),ur=new We(),dr=new fe();var pr=/*#__PURE__*/function(){function pr(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new We(1,0,0);var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,pr);this.isPlane=!0,this.normal=t,this.constant=e;}_createClass(pr,[{key:"set",value:function set(t,e){return this.normal.copy(t),this.constant=e,this;}},{key:"setComponents",value:function setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this;}},{key:"setFromNormalAndCoplanarPoint",value:function setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this;}},{key:"setFromCoplanarPoints",value:function setFromCoplanarPoints(t,e,n){var i=hr.subVectors(n,e).cross(ur.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this;}},{key:"copy",value:function copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this;}},{key:"normalize",value:function normalize(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this;}},{key:"negate",value:function negate(){return this.constant*=-1,this.normal.negate(),this;}},{key:"distanceToPoint",value:function distanceToPoint(t){return this.normal.dot(t)+this.constant;}},{key:"distanceToSphere",value:function distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius;}},{key:"projectPoint",value:function projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t));}},{key:"intersectLine",value:function intersectLine(t,e){var n=t.delta(hr),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;var r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(t.start).addScaledVector(n,r);}},{key:"intersectsLine",value:function intersectsLine(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0;}},{key:"intersectsBox",value:function intersectsBox(t){return t.intersectsPlane(this);}},{key:"intersectsSphere",value:function intersectsSphere(t){return t.intersectsPlane(this);}},{key:"coplanarPoint",value:function coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant);}},{key:"applyMatrix4",value:function applyMatrix4(t,e){var n=e||dr.getNormalMatrix(t),i=this.coplanarPoint(hr).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this;}},{key:"translate",value:function translate(t){return this.constant-=t.dot(this.normal),this;}},{key:"equals",value:function equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant;}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}}]);return pr;}();var mr=new dn(),fr=new We();var gr=/*#__PURE__*/function(){function gr(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new pr();var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new pr();var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new pr();var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:new pr();var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:new pr();var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:new pr();_classCallCheck(this,gr);this.planes=[t,e,n,i,r,s];}_createClass(gr,[{key:"set",value:function set(t,e,n,i,r,s){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this;}},{key:"copy",value:function copy(t){var e=this.planes;for(var _n62=0;_n62<6;_n62++)e[_n62].copy(t.planes[_n62]);return this;}},{key:"setFromProjectionMatrix",value:function setFromProjectionMatrix(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2e3;var n=this.planes,i=t.elements,r=i[0],s=i[1],a=i[2],o=i[3],l=i[4],c=i[5],h=i[6],u=i[7],d=i[8],p=i[9],m=i[10],f=i[11],g=i[12],_=i[13],v=i[14],x=i[15];if(n[0].setComponents(o-r,u-l,f-d,x-g).normalize(),n[1].setComponents(o+r,u+l,f+d,x+g).normalize(),n[2].setComponents(o+s,u+c,f+p,x+_).normalize(),n[3].setComponents(o-s,u-c,f-p,x-_).normalize(),n[4].setComponents(o-a,u-h,f-m,x-v).normalize(),e===$t)n[5].setComponents(o+a,u+h,f+m,x+v).normalize();else{if(e!==Qt)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);n[5].setComponents(a,h,m,v).normalize();}return this;}},{key:"intersectsObject",value:function intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),mr.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{var _e51=t.geometry;null===_e51.boundingSphere&&_e51.computeBoundingSphere(),mr.copy(_e51.boundingSphere).applyMatrix4(t.matrixWorld);}return this.intersectsSphere(mr);}},{key:"intersectsSprite",value:function intersectsSprite(t){return mr.center.set(0,0,0),mr.radius=.7071067811865476,mr.applyMatrix4(t.matrixWorld),this.intersectsSphere(mr);}},{key:"intersectsSphere",value:function intersectsSphere(t){var e=this.planes,n=t.center,i=-t.radius;for(var _t59=0;_t59<6;_t59++){if(e[_t59].distanceToPoint(n)<i)return!1;}return!0;}},{key:"intersectsBox",value:function intersectsBox(t){var e=this.planes;for(var _n63=0;_n63<6;_n63++){var _i47=e[_n63];if(fr.x=_i47.normal.x>0?t.max.x:t.min.x,fr.y=_i47.normal.y>0?t.max.y:t.min.y,fr.z=_i47.normal.z>0?t.max.z:t.min.z,_i47.distanceToPoint(fr)<0)return!1;}return!0;}},{key:"containsPoint",value:function containsPoint(t){var e=this.planes;for(var _n64=0;_n64<6;_n64++)if(e[_n64].distanceToPoint(t)<0)return!1;return!0;}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}}]);return gr;}();function _r(){var t=null,e=!1,n=null,i=null;function r(e,s){n(e,s),i=t.requestAnimationFrame(r);}return{start:function start(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0);},stop:function stop(){t.cancelAnimationFrame(i),e=!1;},setAnimationLoop:function setAnimationLoop(t){n=t;},setContext:function setContext(e){t=e;}};}function vr(t,e){var n=e.isWebGL2,i=new WeakMap();return{get:function get(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t);},remove:function remove(e){e.isInterleavedBufferAttribute&&(e=e.data);var n=i.get(e);n&&(t.deleteBuffer(n.buffer),i["delete"](e));},update:function update(e,r){if(e.isGLBufferAttribute){var _t60=i.get(e);return void((!_t60||_t60.version<e.version)&&i.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}));}e.isInterleavedBufferAttribute&&(e=e.data);var s=i.get(e);if(void 0===s)i.set(e,function(e,i){var r=e.array,s=e.usage,a=r.byteLength,o=t.createBuffer();var l;if(t.bindBuffer(i,o),t.bufferData(i,r,s),e.onUploadCallback(),r instanceof Float32Array)l=t.FLOAT;else if(r instanceof Uint16Array){if(e.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");l=t.HALF_FLOAT;}else l=t.UNSIGNED_SHORT;}else if(r instanceof Int16Array)l=t.SHORT;else if(r instanceof Uint32Array)l=t.UNSIGNED_INT;else if(r instanceof Int32Array)l=t.INT;else if(r instanceof Int8Array)l=t.BYTE;else if(r instanceof Uint8Array)l=t.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);l=t.UNSIGNED_BYTE;}return{buffer:o,type:l,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version,size:a};}(e,r));else if(s.version<e.version){if(s.size!==e.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(e,i,r){var s=i.array,a=i._updateRange,o=i.updateRanges;if(t.bindBuffer(r,e),-1===a.count&&0===o.length&&t.bufferSubData(r,0,s),0!==o.length){for(var _e52=0,_i48=o.length;_e52<_i48;_e52++){var _i49=o[_e52];n?t.bufferSubData(r,_i49.start*s.BYTES_PER_ELEMENT,s,_i49.start,_i49.count):t.bufferSubData(r,_i49.start*s.BYTES_PER_ELEMENT,s.subarray(_i49.start,_i49.start+_i49.count));}i.clearUpdateRanges();}-1!==a.count&&(n?t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1),i.onUploadCallback();}(s.buffer,e,r),s.version=e.version;}}};}var xr=/*#__PURE__*/function(_Ii2){_inherits(xr,_Ii2);var _super21=_createSuper(xr);function xr(){var _this18;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,xr);_this18=_super21.call(this),_this18.type="PlaneGeometry",_this18.parameters={width:t,height:e,widthSegments:n,heightSegments:i};var r=t/2,s=e/2,a=Math.floor(n),o=Math.floor(i),l=a+1,c=o+1,h=t/a,u=e/o,d=[],p=[],m=[],f=[];for(var _t61=0;_t61<c;_t61++){var _e53=_t61*u-s;for(var _n65=0;_n65<l;_n65++){var _i50=_n65*h-r;p.push(_i50,-_e53,0),m.push(0,0,1),f.push(_n65/a),f.push(1-_t61/o);}}for(var _t62=0;_t62<o;_t62++)for(var _e54=0;_e54<a;_e54++){var _n66=_e54+l*_t62,_i51=_e54+l*(_t62+1),_r37=_e54+1+l*(_t62+1),_s16=_e54+1+l*_t62;d.push(_n66,_i51,_s16),d.push(_i51,_r37,_s16);}_this18.setIndex(d),_this18.setAttribute("position",new Ti(p,3)),_this18.setAttribute("normal",new Ti(m,3)),_this18.setAttribute("uv",new Ti(f,2));return _this18;}_createClass(xr,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(xr.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this;}}],[{key:"fromJSON",value:function fromJSON(t){return new xr(t.width,t.height,t.widthSegments,t.heightSegments);}}]);return xr;}(Ii);var yr={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor *= toneMappingExposure;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\treturn color;\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Mr={common:{diffuse:{value:new ci(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new fe()},alphaMap:{value:null},alphaMapTransform:{value:new fe()},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new fe()}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new fe()}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new fe()}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new fe()},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new fe()},normalScale:{value:new me(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new fe()},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new fe()}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new fe()}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new fe()}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ci(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ci(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new fe()},alphaTest:{value:0},uvTransform:{value:new fe()}},sprite:{diffuse:{value:new ci(16777215)},opacity:{value:1},center:{value:new me(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new fe()},alphaMap:{value:null},alphaMapTransform:{value:new fe()},alphaTest:{value:0}}},Sr={basic:{uniforms:tr([Mr.common,Mr.specularmap,Mr.envmap,Mr.aomap,Mr.lightmap,Mr.fog]),vertexShader:yr.meshbasic_vert,fragmentShader:yr.meshbasic_frag},lambert:{uniforms:tr([Mr.common,Mr.specularmap,Mr.envmap,Mr.aomap,Mr.lightmap,Mr.emissivemap,Mr.bumpmap,Mr.normalmap,Mr.displacementmap,Mr.fog,Mr.lights,{emissive:{value:new ci(0)}}]),vertexShader:yr.meshlambert_vert,fragmentShader:yr.meshlambert_frag},phong:{uniforms:tr([Mr.common,Mr.specularmap,Mr.envmap,Mr.aomap,Mr.lightmap,Mr.emissivemap,Mr.bumpmap,Mr.normalmap,Mr.displacementmap,Mr.fog,Mr.lights,{emissive:{value:new ci(0)},specular:{value:new ci(1118481)},shininess:{value:30}}]),vertexShader:yr.meshphong_vert,fragmentShader:yr.meshphong_frag},standard:{uniforms:tr([Mr.common,Mr.envmap,Mr.aomap,Mr.lightmap,Mr.emissivemap,Mr.bumpmap,Mr.normalmap,Mr.displacementmap,Mr.roughnessmap,Mr.metalnessmap,Mr.fog,Mr.lights,{emissive:{value:new ci(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:yr.meshphysical_vert,fragmentShader:yr.meshphysical_frag},toon:{uniforms:tr([Mr.common,Mr.aomap,Mr.lightmap,Mr.emissivemap,Mr.bumpmap,Mr.normalmap,Mr.displacementmap,Mr.gradientmap,Mr.fog,Mr.lights,{emissive:{value:new ci(0)}}]),vertexShader:yr.meshtoon_vert,fragmentShader:yr.meshtoon_frag},matcap:{uniforms:tr([Mr.common,Mr.bumpmap,Mr.normalmap,Mr.displacementmap,Mr.fog,{matcap:{value:null}}]),vertexShader:yr.meshmatcap_vert,fragmentShader:yr.meshmatcap_frag},points:{uniforms:tr([Mr.points,Mr.fog]),vertexShader:yr.points_vert,fragmentShader:yr.points_frag},dashed:{uniforms:tr([Mr.common,Mr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yr.linedashed_vert,fragmentShader:yr.linedashed_frag},depth:{uniforms:tr([Mr.common,Mr.displacementmap]),vertexShader:yr.depth_vert,fragmentShader:yr.depth_frag},normal:{uniforms:tr([Mr.common,Mr.bumpmap,Mr.normalmap,Mr.displacementmap,{opacity:{value:1}}]),vertexShader:yr.meshnormal_vert,fragmentShader:yr.meshnormal_frag},sprite:{uniforms:tr([Mr.sprite,Mr.fog]),vertexShader:yr.sprite_vert,fragmentShader:yr.sprite_frag},background:{uniforms:{uvTransform:{value:new fe()},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:yr.background_vert,fragmentShader:yr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:yr.backgroundCube_vert,fragmentShader:yr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:yr.cube_vert,fragmentShader:yr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yr.equirect_vert,fragmentShader:yr.equirect_frag},distanceRGBA:{uniforms:tr([Mr.common,Mr.displacementmap,{referencePosition:{value:new We()},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yr.distanceRGBA_vert,fragmentShader:yr.distanceRGBA_frag},shadow:{uniforms:tr([Mr.lights,Mr.fog,{color:{value:new ci(0)},opacity:{value:1}}]),vertexShader:yr.shadow_vert,fragmentShader:yr.shadow_frag}};Sr.physical={uniforms:tr([Sr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new fe()},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new fe()},clearcoatNormalScale:{value:new me(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new fe()},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new fe()},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new fe()},sheen:{value:0},sheenColor:{value:new ci(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new fe()},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new fe()},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new fe()},transmissionSamplerSize:{value:new me()},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new fe()},attenuationDistance:{value:0},attenuationColor:{value:new ci(0)},specularColor:{value:new ci(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new fe()},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new fe()},anisotropyVector:{value:new me()},anisotropyMap:{value:null},anisotropyMapTransform:{value:new fe()}}]),vertexShader:yr.meshphysical_vert,fragmentShader:yr.meshphysical_frag};var br={r:0,b:0,g:0};function Tr(t,e,n,i,r,o,l){var c=new ci(0);var h,u,d=!0===o?0:1,p=null,m=0,f=null;function g(e,n){e.getRGB(br,er(t)),i.buffers.color.setClear(br.r,br.g,br.b,n,l);}return{getClearColor:function getClearColor(){return c;},setClearColor:function setClearColor(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;c.set(t),d=e,g(c,d);},getClearAlpha:function getClearAlpha(){return d;},setClearAlpha:function setClearAlpha(t){d=t,g(c,d);},render:function render(o,_){var v=!1,x=!0===_.isScene?_.background:null;if(x&&x.isTexture){x=(_.backgroundBlurriness>0?n:e).get(x);}null===x?g(c,d):x&&x.isColor&&(g(x,1),v=!0);var y=t.xr.getEnvironmentBlendMode();"additive"===y?i.buffers.color.setClear(0,0,0,1,l):"alpha-blend"===y&&i.buffers.color.setClear(0,0,0,0,l),(t.autoClear||v)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),x&&(x.isCubeTexture||x.mapping===A)?(void 0===u&&(u=new Ji(new $i(1,1,1),new ir({name:"BackgroundCubeMaterial",uniforms:Qi(Sr.backgroundCube.uniforms),vertexShader:Sr.backgroundCube.vertexShader,fragmentShader:Sr.backgroundCube.fragmentShader,side:a,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld);},Object.defineProperty(u.material,"envMap",{get:function get(){return this.uniforms.envMap.value;}}),r.update(u)),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&!1===x.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=_.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,u.material.toneMapped=Re.getTransfer(x.colorSpace)!==Xt,p===x&&m===x.version&&f===t.toneMapping||(u.material.needsUpdate=!0,p=x,m=x.version,f=t.toneMapping),u.layers.enableAll(),o.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(void 0===h&&(h=new Ji(new xr(2,2),new ir({name:"BackgroundMaterial",uniforms:Qi(Sr.background.uniforms),vertexShader:Sr.background.vertexShader,fragmentShader:Sr.background.fragmentShader,side:s,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function get(){return this.uniforms.t2D.value;}}),r.update(h)),h.material.uniforms.t2D.value=x,h.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,h.material.toneMapped=Re.getTransfer(x.colorSpace)!==Xt,!0===x.matrixAutoUpdate&&x.updateMatrix(),h.material.uniforms.uvTransform.value.copy(x.matrix),p===x&&m===x.version&&f===t.toneMapping||(h.material.needsUpdate=!0,p=x,m=x.version,f=t.toneMapping),h.layers.enableAll(),o.unshift(h,h.geometry,h.material,0,0,null));}};}function Er(t,e,n,i){var r=t.getParameter(t.MAX_VERTEX_ATTRIBS),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),a=i.isWebGL2||null!==s,o={},l=p(null);var c=l,h=!1;function u(e){return i.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e);}function d(e){return i.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e);}function p(t){var e=[],n=[],i=[];for(var _t63=0;_t63<r;_t63++)e[_t63]=0,n[_t63]=0,i[_t63]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:i,object:t,attributes:{},index:null};}function m(){var t=c.newAttributes;for(var _e55=0,_n67=t.length;_e55<_n67;_e55++)t[_e55]=0;}function f(t){g(t,0);}function g(n,r){var s=c.newAttributes,a=c.enabledAttributes,o=c.attributeDivisors;if(s[n]=1,0===a[n]&&(t.enableVertexAttribArray(n),a[n]=1),o[n]!==r){(i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),o[n]=r;}}function _(){var e=c.newAttributes,n=c.enabledAttributes;for(var _i52=0,_r38=n.length;_i52<_r38;_i52++)n[_i52]!==e[_i52]&&(t.disableVertexAttribArray(_i52),n[_i52]=0);}function v(e,n,i,r,s,a,o){!0===o?t.vertexAttribIPointer(e,n,i,s,a):t.vertexAttribPointer(e,n,i,r,s,a);}function x(){y(),h=!0,c!==l&&(c=l,u(c.object));}function y(){l.geometry=null,l.program=null,l.wireframe=!1;}return{setup:function setup(r,l,d,x,y){var M=!1;if(a){var _e56=function(e,n,r){var a=!0===r.wireframe;var l=o[e.id];void 0===l&&(l={},o[e.id]=l);var c=l[n.id];void 0===c&&(c={},l[n.id]=c);var h=c[a];void 0===h&&(h=p(i.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[a]=h);return h;}(x,d,l);c!==_e56&&(c=_e56,u(c.object)),M=function(t,e,n,i){var r=c.attributes,s=e.attributes;var a=0;var o=n.getAttributes();for(var _e57 in o){if(o[_e57].location>=0){var _n68=r[_e57];var _i53=s[_e57];if(void 0===_i53&&("instanceMatrix"===_e57&&t.instanceMatrix&&(_i53=t.instanceMatrix),"instanceColor"===_e57&&t.instanceColor&&(_i53=t.instanceColor)),void 0===_n68)return!0;if(_n68.attribute!==_i53)return!0;if(_i53&&_n68.data!==_i53.data)return!0;a++;}}return c.attributesNum!==a||c.index!==i;}(r,x,d,y),M&&function(t,e,n,i){var r={},s=e.attributes;var a=0;var o=n.getAttributes();for(var _e58 in o){if(o[_e58].location>=0){var _n69=s[_e58];void 0===_n69&&("instanceMatrix"===_e58&&t.instanceMatrix&&(_n69=t.instanceMatrix),"instanceColor"===_e58&&t.instanceColor&&(_n69=t.instanceColor));var _i54={};_i54.attribute=_n69,_n69&&_n69.data&&(_i54.data=_n69.data),r[_e58]=_i54,a++;}}c.attributes=r,c.attributesNum=a,c.index=i;}(r,x,d,y);}else{var _t64=!0===l.wireframe;c.geometry===x.id&&c.program===d.id&&c.wireframe===_t64||(c.geometry=x.id,c.program=d.id,c.wireframe=_t64,M=!0);}null!==y&&n.update(y,t.ELEMENT_ARRAY_BUFFER),(M||h)&&(h=!1,function(r,s,a,o){if(!1===i.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;m();var l=o.attributes,c=a.getAttributes(),h=s.defaultAttributeValues;for(var _e59 in c){var _s17=c[_e59];if(_s17.location>=0){var _a15=l[_e59];if(void 0===_a15&&("instanceMatrix"===_e59&&r.instanceMatrix&&(_a15=r.instanceMatrix),"instanceColor"===_e59&&r.instanceColor&&(_a15=r.instanceColor)),void 0!==_a15){var _e60=_a15.normalized,_l6=_a15.itemSize,_c5=n.get(_a15);if(void 0===_c5)continue;var _h4=_c5.buffer,_u4=_c5.type,_d3=_c5.bytesPerElement,_p4=!0===i.isWebGL2&&(_u4===t.INT||_u4===t.UNSIGNED_INT||_a15.gpuType===z);if(_a15.isInterleavedBufferAttribute){var _n70=_a15.data,_i55=_n70.stride,_c6=_a15.offset;if(_n70.isInstancedInterleavedBuffer){for(var _t65=0;_t65<_s17.locationSize;_t65++)g(_s17.location+_t65,_n70.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=_n70.meshPerAttribute*_n70.count);}else for(var _t66=0;_t66<_s17.locationSize;_t66++)f(_s17.location+_t66);t.bindBuffer(t.ARRAY_BUFFER,_h4);for(var _t67=0;_t67<_s17.locationSize;_t67++)v(_s17.location+_t67,_l6/_s17.locationSize,_u4,_e60,_i55*_d3,(_c6+_l6/_s17.locationSize*_t67)*_d3,_p4);}else{if(_a15.isInstancedBufferAttribute){for(var _t68=0;_t68<_s17.locationSize;_t68++)g(_s17.location+_t68,_a15.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=_a15.meshPerAttribute*_a15.count);}else for(var _t69=0;_t69<_s17.locationSize;_t69++)f(_s17.location+_t69);t.bindBuffer(t.ARRAY_BUFFER,_h4);for(var _t70=0;_t70<_s17.locationSize;_t70++)v(_s17.location+_t70,_l6/_s17.locationSize,_u4,_e60,_l6*_d3,_l6/_s17.locationSize*_t70*_d3,_p4);}}else if(void 0!==h){var _n71=h[_e59];if(void 0!==_n71)switch(_n71.length){case 2:t.vertexAttrib2fv(_s17.location,_n71);break;case 3:t.vertexAttrib3fv(_s17.location,_n71);break;case 4:t.vertexAttrib4fv(_s17.location,_n71);break;default:t.vertexAttrib1fv(_s17.location,_n71);}}}}_();}(r,l,d,x),null!==y&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.get(y).buffer));},reset:x,resetDefaultState:y,dispose:function dispose(){x();for(var _t71 in o){var _e61=o[_t71];for(var _t72 in _e61){var _n72=_e61[_t72];for(var _t73 in _n72)d(_n72[_t73].object),delete _n72[_t73];delete _e61[_t72];}delete o[_t71];}},releaseStatesOfGeometry:function releaseStatesOfGeometry(t){if(void 0===o[t.id])return;var e=o[t.id];for(var _t74 in e){var _n73=e[_t74];for(var _t75 in _n73)d(_n73[_t75].object),delete _n73[_t75];delete e[_t74];}delete o[t.id];},releaseStatesOfProgram:function releaseStatesOfProgram(t){for(var _e62 in o){var _n74=o[_e62];if(void 0===_n74[t.id])continue;var _i56=_n74[t.id];for(var _t76 in _i56)d(_i56[_t76].object),delete _i56[_t76];delete _n74[t.id];}},initAttributes:m,enableAttribute:f,disableUnusedAttributes:_};}function wr(t,e,n,i){var r=i.isWebGL2;var s;this.setMode=function(t){s=t;},this.render=function(e,i){t.drawArrays(s,e,i),n.update(i,s,1);},this.renderInstances=function(i,a,o){if(0===o)return;var l,c;if(r)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,i,a,o),n.update(a,s,o);},this.renderMultiDraw=function(t,i,r){if(0===r)return;var a=e.get("WEBGL_multi_draw");if(null===a)for(var _e63=0;_e63<r;_e63++)this.render(t[_e63],i[_e63]);else{a.multiDrawArraysWEBGL(s,t,0,i,0,r);var _e64=0;for(var _t77=0;_t77<r;_t77++)_e64+=i[_t77];n.update(_e64,s,1);}};}function Ar(t,e,n){var i;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump";}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp";}var s="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===t.constructor.name;var a=void 0!==n.precision?n.precision:"highp";var o=r(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);var l=s||e.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,h=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=t.getParameter(t.MAX_TEXTURE_SIZE),p=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),m=t.getParameter(t.MAX_VERTEX_ATTRIBS),f=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),g=t.getParameter(t.MAX_VARYING_VECTORS),_=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),v=u>0,x=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function getMaxAnisotropy(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){var _n75=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(_n75.MAX_TEXTURE_MAX_ANISOTROPY_EXT);}else i=0;return i;},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:f,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:v,floatFragmentTextures:x,floatVertexTextures:v&&x,maxSamples:s?t.getParameter(t.MAX_SAMPLES):0};}function Rr(t){var e=this;var n=null,i=0,r=!1,s=!1;var a=new pr(),o=new fe(),l={value:null,needsUpdate:!1};function c(t,n,i,r){var s=null!==t?t.length:0;var c=null;if(0!==s){if(c=l.value,!0!==r||null===c){var _e65=i+4*s,_r39=n.matrixWorldInverse;o.getNormalMatrix(_r39),(null===c||c.length<_e65)&&(c=new Float32Array(_e65));for(var _e66=0,_n76=i;_e66!==s;++_e66,_n76+=4)a.copy(t[_e66]).applyMatrix4(_r39,o),a.normal.toArray(c,_n76),c[_n76+3]=a.constant;}l.value=c,l.needsUpdate=!0;}return e.numPlanes=s,e.numIntersection=0,c;}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){var n=0!==t.length||e||0!==i||r;return r=e,i=t.length,n;},this.beginShadows=function(){s=!0,c(null);},this.endShadows=function(){s=!1;},this.setGlobalState=function(t,e){n=c(t,e,0);},this.setState=function(a,o,h){var u=a.clippingPlanes,d=a.clipIntersection,p=a.clipShadows,m=t.get(a);if(!r||null===u||0===u.length||s&&!p)s?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);e.numPlanes=i,e.numIntersection=0;}();else{var _t78=s?0:i,_e67=4*_t78;var _r40=m.clippingState||null;l.value=_r40,_r40=c(u,o,_e67,h);for(var _t79=0;_t79!==_e67;++_t79)_r40[_t79]=n[_t79];m.clippingState=_r40,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=_t78;}};}function Cr(t){var e=new WeakMap();function n(t,e){return e===E?t.mapping=b:e===w&&(t.mapping=T),t;}function i(t){var n=t.target;n.removeEventListener("dispose",i);var r=e.get(n);void 0!==r&&(e["delete"](n),r.dispose());}return{get:function get(r){if(r&&r.isTexture){var _s18=r.mapping;if(_s18===E||_s18===w){if(e.has(r)){return n(e.get(r).texture,r.mapping);}{var _s19=r.image;if(_s19&&_s19.height>0){var _a16=new cr(_s19.height/2);return _a16.fromEquirectangularTexture(t,r),e.set(r,_a16),r.addEventListener("dispose",i),n(_a16.texture,r.mapping);}return null;}}}return r;},dispose:function dispose(){e=new WeakMap();}};}var Lr=/*#__PURE__*/function(_rr2){_inherits(Lr,_rr2);var _super22=_createSuper(Lr);function Lr(){var _this19;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:-1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:-1;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:.1;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:2e3;_classCallCheck(this,Lr);_this19=_super22.call(this),_this19.isOrthographicCamera=!0,_this19.type="OrthographicCamera",_this19.zoom=1,_this19.view=null,_this19.left=t,_this19.right=e,_this19.top=n,_this19.bottom=i,_this19.near=r,_this19.far=s,_this19.updateProjectionMatrix();return _this19;}_createClass(Lr,[{key:"copy",value:function copy(t,e){return _get(_getPrototypeOf(Lr.prototype),"copy",this).call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this;}},{key:"setViewOffset",value:function setViewOffset(t,e,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix();}},{key:"clearViewOffset",value:function clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix();}},{key:"updateProjectionMatrix",value:function updateProjectionMatrix(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;var r=n-t,s=n+t,a=i+e,o=i-e;if(null!==this.view&&this.view.enabled){var _t80=(this.right-this.left)/this.view.fullWidth/this.zoom,_e68=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=_t80*this.view.offsetX,s=r+_t80*this.view.width,a-=_e68*this.view.offsetY,o=a-_e68*this.view.height;}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert();}},{key:"toJSON",value:function toJSON(t){var e=_get(_getPrototypeOf(Lr.prototype),"toJSON",this).call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e;}}]);return Lr;}(rr);var Pr=[.125,.215,.35,.446,.526,.582],Ir=20,Ur=new Lr(),Dr=new ci();var Nr=null,Or=0,Fr=0;var Br=(1+Math.sqrt(5))/2,zr=1/Br,Gr=[new We(1,1,1),new We(-1,1,1),new We(1,1,-1),new We(-1,1,-1),new We(0,Br,zr),new We(0,Br,-zr),new We(zr,0,Br),new We(-zr,0,Br),new We(Br,zr,0),new We(-Br,zr,0)];var Hr=/*#__PURE__*/function(){function Hr(t){_classCallCheck(this,Hr);this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial);}_createClass(Hr,[{key:"fromScene",value:function fromScene(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:.1;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:100;Nr=this._renderer.getRenderTarget(),Or=this._renderer.getActiveCubeFace(),Fr=this._renderer.getActiveMipmapLevel(),this._setSize(256);var r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r;}},{key:"fromEquirectangular",value:function fromEquirectangular(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this._fromTexture(t,e);}},{key:"fromCubemap",value:function fromCubemap(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this._fromTexture(t,e);}},{key:"compileCubemapShader",value:function compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Xr(),this._compileMaterial(this._cubemapMaterial));}},{key:"compileEquirectangularShader",value:function compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Wr(),this._compileMaterial(this._equirectMaterial));}},{key:"dispose",value:function dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose();}},{key:"_setSize",value:function _setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax);}},{key:"_dispose",value:function _dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(var _t81=0;_t81<this._lodPlanes.length;_t81++)this._lodPlanes[_t81].dispose();}},{key:"_cleanup",value:function _cleanup(t){this._renderer.setRenderTarget(Nr,Or,Fr),t.scissorTest=!1,kr(t,0,0,t.width,t.height);}},{key:"_fromTexture",value:function _fromTexture(t,e){t.mapping===b||t.mapping===T?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Nr=this._renderer.getRenderTarget(),Or=this._renderer.getActiveCubeFace(),Fr=this._renderer.getActiveMipmapLevel();var n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n;}},{key:"_allocateTargets",value:function _allocateTargets(){var t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:D,minFilter:D,generateMipmaps:!1,type:V,format:j,colorSpace:Ht,depthBuffer:!1},i=Vr(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){var _ref;null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Vr(t,e,n);var _i57=this._lodMax;(_ref=function(t){var e=[],n=[],i=[];var r=t;var s=t-4+1+Pr.length;for(var _a17=0;_a17<s;_a17++){var _s20=Math.pow(2,r);n.push(_s20);var _o11=1/_s20;_a17>t-4?_o11=Pr[_a17-t+4-1]:0===_a17&&(_o11=0),i.push(_o11);var _l7=1/(_s20-2),_c7=-_l7,_h5=1+_l7,_u5=[_c7,_c7,_h5,_c7,_h5,_h5,_c7,_c7,_h5,_h5,_c7,_h5],_d4=6,_p5=6,_m2=3,_f=2,_g=1,_3=new Float32Array(_m2*_p5*_d4),_v2=new Float32Array(_f*_p5*_d4),_x2=new Float32Array(_g*_p5*_d4);for(var _t82=0;_t82<_d4;_t82++){var _e69=_t82%3*2/3-1,_n77=_t82>2?0:-1,_i58=[_e69,_n77,0,_e69+2/3,_n77,0,_e69+2/3,_n77+1,0,_e69,_n77,0,_e69+2/3,_n77+1,0,_e69,_n77+1,0];_3.set(_i58,_m2*_p5*_t82),_v2.set(_u5,_f*_p5*_t82);var _r41=[_t82,_t82,_t82,_t82,_t82,_t82];_x2.set(_r41,_g*_p5*_t82);}var _y2=new Ii();_y2.setAttribute("position",new Mi(_3,_m2)),_y2.setAttribute("uv",new Mi(_v2,_f)),_y2.setAttribute("faceIndex",new Mi(_x2,_g)),e.push(_y2),r>4&&r--;}return{lodPlanes:e,sizeLods:n,sigmas:i};}(_i57),this._sizeLods=_ref.sizeLods,this._lodPlanes=_ref.lodPlanes,this._sigmas=_ref.sigmas),this._blurMaterial=function(t,e,n){var i=new Float32Array(Ir),r=new We(0,1,0),s=new ir({name:"SphericalGaussianBlur",defines:{n:Ir,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(t,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:jr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return s;}(_i57,t,e);}return i;}},{key:"_compileMaterial",value:function _compileMaterial(t){var e=new Ji(this._lodPlanes[0],t);this._renderer.compile(e,Ur);}},{key:"_sceneToCubeUV",value:function _sceneToCubeUV(t,e,n,i){var r=new sr(90,1,e,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,h=l.toneMapping;l.getClearColor(Dr),l.toneMapping=p,l.autoClear=!1;var u=new pi({name:"PMREM.Background",side:a,depthWrite:!1,depthTest:!1}),d=new Ji(new $i(),u);var m=!1;var f=t.background;f?f.isColor&&(u.color.copy(f),t.background=null,m=!0):(u.color.copy(Dr),m=!0);for(var _e70=0;_e70<6;_e70++){var _n78=_e70%3;0===_n78?(r.up.set(0,s[_e70],0),r.lookAt(o[_e70],0,0)):1===_n78?(r.up.set(0,0,s[_e70]),r.lookAt(0,o[_e70],0)):(r.up.set(0,s[_e70],0),r.lookAt(0,0,o[_e70]));var _a18=this._cubeSize;kr(i,_n78*_a18,_e70>2?_a18:0,_a18,_a18),l.setRenderTarget(i),m&&l.render(d,r),l.render(t,r);}d.geometry.dispose(),d.material.dispose(),l.toneMapping=h,l.autoClear=c,t.background=f;}},{key:"_textureToCubeUV",value:function _textureToCubeUV(t,e){var n=this._renderer,i=t.mapping===b||t.mapping===T;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=Xr()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Wr());var r=i?this._cubemapMaterial:this._equirectMaterial,s=new Ji(this._lodPlanes[0],r);r.uniforms.envMap.value=t;var a=this._cubeSize;kr(e,0,0,3*a,2*a),n.setRenderTarget(e),n.render(s,Ur);}},{key:"_applyPMREM",value:function _applyPMREM(t){var e=this._renderer,n=e.autoClear;e.autoClear=!1;for(var _e71=1;_e71<this._lodPlanes.length;_e71++){var _n79=Math.sqrt(this._sigmas[_e71]*this._sigmas[_e71]-this._sigmas[_e71-1]*this._sigmas[_e71-1]),_i59=Gr[(_e71-1)%Gr.length];this._blur(t,_e71-1,_e71,_n79,_i59);}e.autoClear=n;}},{key:"_blur",value:function _blur(t,e,n,i,r){var s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,i,"latitudinal",r),this._halfBlur(s,t,n,n,i,"longitudinal",r);}},{key:"_halfBlur",value:function _halfBlur(t,e,n,i,r,s,a){var o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");var c=new Ji(this._lodPlanes[i],l),h=l.uniforms,u=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,m=isFinite(r)?1+Math.floor(3*p):Ir;m>Ir&&console.warn("sigmaRadians, ".concat(r,", is too large and will clip, as it requested ").concat(m," samples when the maximum is set to 20"));var f=[];var g=0;for(var _t83=0;_t83<Ir;++_t83){var _e72=_t83/p,_n80=Math.exp(-_e72*_e72/2);f.push(_n80),0===_t83?g+=_n80:_t83<m&&(g+=2*_n80);}for(var _t84=0;_t84<f.length;_t84++)f[_t84]=f[_t84]/g;h.envMap.value=t.texture,h.samples.value=m,h.weights.value=f,h.latitudinal.value="latitudinal"===s,a&&(h.poleAxis.value=a);var _=this._lodMax;h.dTheta.value=d,h.mipInt.value=_-n;var v=this._sizeLods[i];kr(e,3*v*(i>_-4?i-_+4:0),4*(this._cubeSize-v),3*v,2*v),o.setRenderTarget(e),o.render(c,Ur);}}]);return Hr;}();function Vr(t,e,n){var i=new Ge(t,e,n);return i.texture.mapping=A,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i;}function kr(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r);}function Wr(){return new ir({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:jr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});}function Xr(){return new ir({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:jr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});}function jr(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t";}function qr(t){var e=new WeakMap(),n=null;function i(t){var n=t.target;n.removeEventListener("dispose",i);var r=e.get(n);void 0!==r&&(e["delete"](n),r.dispose());}return{get:function get(r){if(r&&r.isTexture){var _s21=r.mapping,_a19=_s21===E||_s21===w,_o12=_s21===b||_s21===T;if(_a19||_o12){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;var _i60=e.get(r);return null===n&&(n=new Hr(t)),_i60=_a19?n.fromEquirectangular(r,_i60):n.fromCubemap(r,_i60),e.set(r,_i60),_i60.texture;}if(e.has(r))return e.get(r).texture;{var _s22=r.image;if(_a19&&_s22&&_s22.height>0||_o12&&_s22&&function(t){var e=0;var n=6;for(var _i61=0;_i61<n;_i61++)void 0!==t[_i61]&&e++;return e===n;}(_s22)){null===n&&(n=new Hr(t));var _s23=_a19?n.fromEquirectangular(r):n.fromCubemap(r);return e.set(r,_s23),r.addEventListener("dispose",i),_s23.texture;}return null;}}}return r;},dispose:function dispose(){e=new WeakMap(),null!==n&&(n.dispose(),n=null);}};}function Yr(t){var e={};function n(n){if(void 0!==e[n])return e[n];var i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n);}return e[n]=i,i;}return{has:function has(t){return null!==n(t);},init:function init(t){t.isWebGL2?(n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance")):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture");},get:function get(t){var e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e;}};}function Zr(t,e,n,i){var r={},s=new WeakMap();function a(t){var o=t.target;null!==o.index&&e.remove(o.index);for(var _t85 in o.attributes)e.remove(o.attributes[_t85]);for(var _t86 in o.morphAttributes){var _n81=o.morphAttributes[_t86];for(var _t87=0,_i62=_n81.length;_t87<_i62;_t87++)e.remove(_n81[_t87]);}o.removeEventListener("dispose",a),delete r[o.id];var l=s.get(o);l&&(e.remove(l),s["delete"](o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--;}function o(t){var n=[],i=t.index,r=t.attributes.position;var a=0;if(null!==i){var _t88=i.array;a=i.version;for(var _e73=0,_i63=_t88.length;_e73<_i63;_e73+=3){var _i64=_t88[_e73+0],_r42=_t88[_e73+1],_s24=_t88[_e73+2];n.push(_i64,_r42,_r42,_s24,_s24,_i64);}}else{if(void 0===r)return;{var _t89=r.array;a=r.version;for(var _e74=0,_i65=_t89.length/3-1;_e74<_i65;_e74+=3){var _t90=_e74+0,_i66=_e74+1,_r43=_e74+2;n.push(_t90,_i66,_i66,_r43,_r43,_t90);}}}var o=new(_e(n)?bi:Si)(n,1);o.version=a;var l=s.get(t);l&&e.remove(l),s.set(t,o);}return{get:function get(t,e){return!0===r[e.id]||(e.addEventListener("dispose",a),r[e.id]=!0,n.memory.geometries++),e;},update:function update(n){var i=n.attributes;for(var _n82 in i)e.update(i[_n82],t.ARRAY_BUFFER);var r=n.morphAttributes;for(var _n83 in r){var _i67=r[_n83];for(var _n84=0,_r44=_i67.length;_n84<_r44;_n84++)e.update(_i67[_n84],t.ARRAY_BUFFER);}},getWireframeAttribute:function getWireframeAttribute(t){var e=s.get(t);if(e){var _n85=t.index;null!==_n85&&e.version<_n85.version&&o(t);}else o(t);return s.get(t);}};}function Jr(t,e,n,i){var r=i.isWebGL2;var s,a,o;this.setMode=function(t){s=t;},this.setIndex=function(t){a=t.type,o=t.bytesPerElement;},this.render=function(e,i){t.drawElements(s,i,a,e*o),n.update(i,s,1);},this.renderInstances=function(i,l,c){if(0===c)return;var h,u;if(r)h=t,u="drawElementsInstanced";else if(h=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,a,i*o,c),n.update(l,s,c);},this.renderMultiDraw=function(t,i,r){if(0===r)return;var l=e.get("WEBGL_multi_draw");if(null===l)for(var _e75=0;_e75<r;_e75++)this.render(t[_e75]/o,i[_e75]);else{l.multiDrawElementsWEBGL(s,i,0,a,t,0,r);var _e76=0;for(var _t91=0;_t91<r;_t91++)_e76+=i[_t91];n.update(_e76,s,1);}};}function Kr(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function reset(){e.calls=0,e.triangles=0,e.points=0,e.lines=0;},update:function update(n,i,r){switch(e.calls++,i){case t.TRIANGLES:e.triangles+=r*(n/3);break;case t.LINES:e.lines+=r*(n/2);break;case t.LINE_STRIP:e.lines+=r*(n-1);break;case t.LINE_LOOP:e.lines+=r*n;break;case t.POINTS:e.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i);}}};}function $r(t,e){return t[0]-e[0];}function Qr(t,e){return Math.abs(e[1])-Math.abs(t[1]);}function ts(t,e,n){var i={},r=new Float32Array(8),s=new WeakMap(),a=new Be(),o=[];for(var _t92=0;_t92<8;_t92++)o[_t92]=[_t92,0];return{update:function update(l,c,h){var u=l.morphTargetInfluences;if(!0===e.isWebGL2){var _d5=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,_p6=void 0!==_d5?_d5.length:0;var _m3=s.get(c);if(void 0===_m3||_m3.count!==_p6){var _C=function _C(){_A.dispose(),s["delete"](c),c.removeEventListener("dispose",_C);};void 0!==_m3&&_m3.texture.dispose();var _4=void 0!==c.morphAttributes.position,_v3=void 0!==c.morphAttributes.normal,_x3=void 0!==c.morphAttributes.color,_y3=c.morphAttributes.position||[],_M=c.morphAttributes.normal||[],_S=c.morphAttributes.color||[];var _b=0;!0===_4&&(_b=1),!0===_v3&&(_b=2),!0===_x3&&(_b=3);var _T=c.attributes.position.count*_b,_E=1;_T>e.maxTextureSize&&(_E=Math.ceil(_T/e.maxTextureSize),_T=e.maxTextureSize);var _w=new Float32Array(_T*_E*4*_p6),_A=new He(_w,_T,_E,_p6);_A.type=H,_A.needsUpdate=!0;var _R=4*_b;for(var _L=0;_L<_p6;_L++){var _P=_y3[_L],_I=_M[_L],_U=_S[_L],_D=_T*_E*4*_L;for(var _N=0;_N<_P.count;_N++){var _O=_N*_R;!0===_4&&(a.fromBufferAttribute(_P,_N),_w[_D+_O+0]=a.x,_w[_D+_O+1]=a.y,_w[_D+_O+2]=a.z,_w[_D+_O+3]=0),!0===_v3&&(a.fromBufferAttribute(_I,_N),_w[_D+_O+4]=a.x,_w[_D+_O+5]=a.y,_w[_D+_O+6]=a.z,_w[_D+_O+7]=0),!0===_x3&&(a.fromBufferAttribute(_U,_N),_w[_D+_O+8]=a.x,_w[_D+_O+9]=a.y,_w[_D+_O+10]=a.z,_w[_D+_O+11]=4===_U.itemSize?a.w:1);}}_m3={count:_p6,texture:_A,size:new me(_T,_E)},s.set(c,_m3),c.addEventListener("dispose",_C);}var _f2=0;for(var _F=0;_F<u.length;_F++)_f2+=u[_F];var _g2=c.morphTargetsRelative?1:1-_f2;h.getUniforms().setValue(t,"morphTargetBaseInfluence",_g2),h.getUniforms().setValue(t,"morphTargetInfluences",u),h.getUniforms().setValue(t,"morphTargetsTexture",_m3.texture,n),h.getUniforms().setValue(t,"morphTargetsTextureSize",_m3.size);}else{var _B=void 0===u?0:u.length;var _z=i[c.id];if(void 0===_z||_z.length!==_B){_z=[];for(var _X=0;_X<_B;_X++)_z[_X]=[_X,0];i[c.id]=_z;}for(var _j=0;_j<_B;_j++){var _q=_z[_j];_q[0]=_j,_q[1]=u[_j];}_z.sort(Qr);for(var _Y=0;_Y<8;_Y++)_Y<_B&&_z[_Y][1]?(o[_Y][0]=_z[_Y][0],o[_Y][1]=_z[_Y][1]):(o[_Y][0]=Number.MAX_SAFE_INTEGER,o[_Y][1]=0);o.sort($r);var _G=c.morphAttributes.position,_V=c.morphAttributes.normal;var _k=0;for(var _Z=0;_Z<8;_Z++){var _J=o[_Z],_K=_J[0],_$=_J[1];_K!==Number.MAX_SAFE_INTEGER&&_$?(_G&&c.getAttribute("morphTarget"+_Z)!==_G[_K]&&c.setAttribute("morphTarget"+_Z,_G[_K]),_V&&c.getAttribute("morphNormal"+_Z)!==_V[_K]&&c.setAttribute("morphNormal"+_Z,_V[_K]),r[_Z]=_$,_k+=_$):(_G&&!0===c.hasAttribute("morphTarget"+_Z)&&c.deleteAttribute("morphTarget"+_Z),_V&&!0===c.hasAttribute("morphNormal"+_Z)&&c.deleteAttribute("morphNormal"+_Z),r[_Z]=0);}var _W=c.morphTargetsRelative?1:1-_k;h.getUniforms().setValue(t,"morphTargetBaseInfluence",_W),h.getUniforms().setValue(t,"morphTargetInfluences",r);}}};}function es(t,e,n,i){var r=new WeakMap();function s(t){var e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor);}return{update:function update(a){var o=i.render.frame,l=a.geometry,c=e.get(a,l);if(r.get(c)!==o&&(e.update(c),r.set(c,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),r.get(a)!==o&&(n.update(a.instanceMatrix,t.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,t.ARRAY_BUFFER),r.set(a,o))),a.isSkinnedMesh){var _t93=a.skeleton;r.get(_t93)!==o&&(_t93.update(),r.set(_t93,o));}return c;},dispose:function dispose(){r=new WeakMap();}};}var ns=/*#__PURE__*/function(_Fe4){_inherits(ns,_Fe4);var _super23=_createSuper(ns);function ns(t,e,n,i,r,s,a,o,l,c){var _this20;_classCallCheck(this,ns);if((c=void 0!==c?c:q)!==q&&c!==Y)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===q&&(n=G),void 0===n&&c===Y&&(n=X),_this20=_super23.call(this,null,i,r,s,a,o,c,n,l),_this20.isDepthTexture=!0,_this20.image={width:t,height:e},_this20.magFilter=void 0!==a?a:P,_this20.minFilter=void 0!==o?o:P,_this20.flipY=!1,_this20.generateMipmaps=!1,_this20.compareFunction=null;return _this20;}_createClass(ns,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(ns.prototype),"copy",this).call(this,t),this.compareFunction=t.compareFunction,this;}},{key:"toJSON",value:function toJSON(t){var e=_get(_getPrototypeOf(ns.prototype),"toJSON",this).call(this,t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e;}}]);return ns;}(Fe);var is=new Fe(),rs=new ns(1,1);rs.compareFunction=515;var ss=new He(),as=new Ve(),os=new lr(),ls=[],cs=[],hs=new Float32Array(16),us=new Float32Array(9),ds=new Float32Array(4);function ps(t,e,n){var i=t[0];if(i<=0||i>0)return t;var r=e*n;var s=ls[r];if(void 0===s&&(s=new Float32Array(r),ls[r]=s),0!==e){i.toArray(s,0);for(var _i68=1,_r45=0;_i68!==e;++_i68)_r45+=n,t[_i68].toArray(s,_r45);}return s;}function ms(t,e){if(t.length!==e.length)return!1;for(var _n86=0,_i69=t.length;_n86<_i69;_n86++)if(t[_n86]!==e[_n86])return!1;return!0;}function fs(t,e){for(var _n87=0,_i70=e.length;_n87<_i70;_n87++)t[_n87]=e[_n87];}function gs(t,e){var n=cs[e];void 0===n&&(n=new Int32Array(e),cs[e]=n);for(var _i71=0;_i71!==e;++_i71)n[_i71]=t.allocateTextureUnit();return n;}function _s(t,e){var n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e);}function vs(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ms(n,e))return;t.uniform2fv(this.addr,e),fs(n,e);}}function xs(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(ms(n,e))return;t.uniform3fv(this.addr,e),fs(n,e);}}function ys(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ms(n,e))return;t.uniform4fv(this.addr,e),fs(n,e);}}function Ms(t,e){var n=this.cache,i=e.elements;if(void 0===i){if(ms(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),fs(n,e);}else{if(ms(n,i))return;ds.set(i),t.uniformMatrix2fv(this.addr,!1,ds),fs(n,i);}}function Ss(t,e){var n=this.cache,i=e.elements;if(void 0===i){if(ms(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),fs(n,e);}else{if(ms(n,i))return;us.set(i),t.uniformMatrix3fv(this.addr,!1,us),fs(n,i);}}function bs(t,e){var n=this.cache,i=e.elements;if(void 0===i){if(ms(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),fs(n,e);}else{if(ms(n,i))return;hs.set(i),t.uniformMatrix4fv(this.addr,!1,hs),fs(n,i);}}function Ts(t,e){var n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e);}function Es(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ms(n,e))return;t.uniform2iv(this.addr,e),fs(n,e);}}function ws(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(ms(n,e))return;t.uniform3iv(this.addr,e),fs(n,e);}}function As(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ms(n,e))return;t.uniform4iv(this.addr,e),fs(n,e);}}function Rs(t,e){var n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e);}function Cs(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ms(n,e))return;t.uniform2uiv(this.addr,e),fs(n,e);}}function Ls(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(ms(n,e))return;t.uniform3uiv(this.addr,e),fs(n,e);}}function Ps(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ms(n,e))return;t.uniform4uiv(this.addr,e),fs(n,e);}}function Is(t,e,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r);var s=this.type===t.SAMPLER_2D_SHADOW?rs:is;n.setTexture2D(e||s,r);}function Us(t,e,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||as,r);}function Ds(t,e,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||os,r);}function Ns(t,e,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||ss,r);}function Os(t,e){t.uniform1fv(this.addr,e);}function Fs(t,e){var n=ps(e,this.size,2);t.uniform2fv(this.addr,n);}function Bs(t,e){var n=ps(e,this.size,3);t.uniform3fv(this.addr,n);}function zs(t,e){var n=ps(e,this.size,4);t.uniform4fv(this.addr,n);}function Gs(t,e){var n=ps(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n);}function Hs(t,e){var n=ps(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n);}function Vs(t,e){var n=ps(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n);}function ks(t,e){t.uniform1iv(this.addr,e);}function Ws(t,e){t.uniform2iv(this.addr,e);}function Xs(t,e){t.uniform3iv(this.addr,e);}function js(t,e){t.uniform4iv(this.addr,e);}function qs(t,e){t.uniform1uiv(this.addr,e);}function Ys(t,e){t.uniform2uiv(this.addr,e);}function Zs(t,e){t.uniform3uiv(this.addr,e);}function Js(t,e){t.uniform4uiv(this.addr,e);}function Ks(t,e,n){var i=this.cache,r=e.length,s=gs(n,r);ms(i,s)||(t.uniform1iv(this.addr,s),fs(i,s));for(var _t94=0;_t94!==r;++_t94)n.setTexture2D(e[_t94]||is,s[_t94]);}function $s(t,e,n){var i=this.cache,r=e.length,s=gs(n,r);ms(i,s)||(t.uniform1iv(this.addr,s),fs(i,s));for(var _t95=0;_t95!==r;++_t95)n.setTexture3D(e[_t95]||as,s[_t95]);}function Qs(t,e,n){var i=this.cache,r=e.length,s=gs(n,r);ms(i,s)||(t.uniform1iv(this.addr,s),fs(i,s));for(var _t96=0;_t96!==r;++_t96)n.setTextureCube(e[_t96]||os,s[_t96]);}function ta(t,e,n){var i=this.cache,r=e.length,s=gs(n,r);ms(i,s)||(t.uniform1iv(this.addr,s),fs(i,s));for(var _t97=0;_t97!==r;++_t97)n.setTexture2DArray(e[_t97]||ss,s[_t97]);}var ea=/*#__PURE__*/_createClass(function ea(t,e,n){_classCallCheck(this,ea);this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.setValue=function(t){switch(t){case 5126:return _s;case 35664:return vs;case 35665:return xs;case 35666:return ys;case 35674:return Ms;case 35675:return Ss;case 35676:return bs;case 5124:case 35670:return Ts;case 35667:case 35671:return Es;case 35668:case 35672:return ws;case 35669:case 35673:return As;case 5125:return Rs;case 36294:return Cs;case 36295:return Ls;case 36296:return Ps;case 35678:case 36198:case 36298:case 36306:case 35682:return Is;case 35679:case 36299:case 36307:return Us;case 35680:case 36300:case 36308:case 36293:return Ds;case 36289:case 36303:case 36311:case 36292:return Ns;}}(e.type);});var na=/*#__PURE__*/_createClass(function na(t,e,n){_classCallCheck(this,na);this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Os;case 35664:return Fs;case 35665:return Bs;case 35666:return zs;case 35674:return Gs;case 35675:return Hs;case 35676:return Vs;case 5124:case 35670:return ks;case 35667:case 35671:return Ws;case 35668:case 35672:return Xs;case 35669:case 35673:return js;case 5125:return qs;case 36294:return Ys;case 36295:return Zs;case 36296:return Js;case 35678:case 36198:case 36298:case 36306:case 35682:return Ks;case 35679:case 36299:case 36307:return $s;case 35680:case 36300:case 36308:case 36293:return Qs;case 36289:case 36303:case 36311:case 36292:return ta;}}(e.type);});var ia=/*#__PURE__*/function(){function ia(t){_classCallCheck(this,ia);this.id=t,this.seq=[],this.map={};}_createClass(ia,[{key:"setValue",value:function setValue(t,e,n){var i=this.seq;for(var _r46=0,_s25=i.length;_r46!==_s25;++_r46){var _s26=i[_r46];_s26.setValue(t,e[_s26.id],n);}}}]);return ia;}();var ra=/(\w+)(\])?(\[|\.)?/g;function sa(t,e){t.seq.push(e),t.map[e.id]=e;}function aa(t,e,n){var i=t.name,r=i.length;for(ra.lastIndex=0;;){var _s27=ra.exec(i),_a20=ra.lastIndex;var _o13=_s27[1];var _l8="]"===_s27[2],_c8=_s27[3];if(_l8&&(_o13|=0),void 0===_c8||"["===_c8&&_a20+2===r){sa(n,void 0===_c8?new ea(_o13,t,e):new na(_o13,t,e));break;}{var _t98=n.map[_o13];void 0===_t98&&(_t98=new ia(_o13),sa(n,_t98)),n=_t98;}}}var oa=/*#__PURE__*/function(){function oa(t,e){_classCallCheck(this,oa);this.seq=[],this.map={};var n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(var _i72=0;_i72<n;++_i72){var _n88=t.getActiveUniform(e,_i72);aa(_n88,t.getUniformLocation(e,_n88.name),this);}}_createClass(oa,[{key:"setValue",value:function setValue(t,e,n,i){var r=this.map[e];void 0!==r&&r.setValue(t,n,i);}},{key:"setOptional",value:function setOptional(t,e,n){var i=e[n];void 0!==i&&this.setValue(t,n,i);}}],[{key:"upload",value:function upload(t,e,n,i){for(var _r47=0,_s28=e.length;_r47!==_s28;++_r47){var _s29=e[_r47],_a21=n[_s29.id];!1!==_a21.needsUpdate&&_s29.setValue(t,_a21.value,i);}}},{key:"seqWithValue",value:function seqWithValue(t,e){var n=[];for(var _i73=0,_r48=t.length;_i73!==_r48;++_i73){var _r49=t[_i73];_r49.id in e&&n.push(_r49);}return n;}}]);return oa;}();function la(t,e,n){var i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i;}var ca=37297;var ha=0;function ua(t,e,n){var i=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(i&&""===r)return"";var s=/ERROR: 0:(\d+)/.exec(r);if(s){var _i74=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){var n=t.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,n.length);for(var _t99=r;_t99<s;_t99++){var _r50=_t99+1;i.push("".concat(_r50===e?">":" "," ").concat(_r50,": ").concat(n[_t99]));}return i.join("\n");}(t.getShaderSource(e),_i74);}return r;}function da(t,e){var n=function(t){var e=Re.getPrimaries(Re.workingColorSpace),n=Re.getPrimaries(t);var i;switch(e===n?i="":e===qt&&n===jt?i="LinearDisplayP3ToLinearSRGB":e===jt&&n===qt&&(i="LinearSRGBToLinearDisplayP3"),t){case Ht:case kt:return[i,"LinearTransferOETF"];case Gt:case Vt:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),[i,"LinearTransferOETF"];}}(e);return"vec4 ".concat(t,"( vec4 value ) { return ").concat(n[0],"( ").concat(n[1],"( value ) ); }");}function pa(t,e){var n;switch(e){case m:n="Linear";break;case f:n="Reinhard";break;case g:n="OptimizedCineon";break;case _:n="ACESFilmic";break;case x:n="AgX";break;case v:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear";}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }";}function ma(t){return""!==t;}function fa(t,e){var n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows);}function ga(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection);}var _a=/^[ \t]*#include +<([\w\d./]+)>/gm;function va(t){return t.replace(_a,ya);}var xa=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function ya(t,e){var n=yr[e];if(void 0===n){var _t100=xa.get(e);if(void 0===_t100)throw new Error("Can not resolve #include <"+e+">");n=yr[_t100],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,_t100);}return va(n);}var Ma=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Sa(t){return t.replace(Ma,ba);}function ba(t,e,n,i){var r="";for(var _t101=parseInt(e);_t101<parseInt(n);_t101++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+_t101+" ]").replace(/UNROLLED_LOOP_INDEX/g,_t101);return r;}function Ta(t){var e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e;}function Ea(t,e,s,a){var o=t.getContext(),l=s.defines;var c=s.vertexShader,m=s.fragmentShader;var f=function(t){var e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===n?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===i?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===r&&(e="SHADOWMAP_TYPE_VSM"),e;}(s),g=function(t){var e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case b:case T:e="ENVMAP_TYPE_CUBE";break;case A:e="ENVMAP_TYPE_CUBE_UV";}return e;}(s),_=function(t){var e="ENVMAP_MODE_REFLECTION";t.envMap&&t.envMapMode===T&&(e="ENVMAP_MODE_REFRACTION");return e;}(s),v=function(t){var e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case h:e="ENVMAP_BLENDING_MULTIPLY";break;case u:e="ENVMAP_BLENDING_MIX";break;case d:e="ENVMAP_BLENDING_ADD";}return e;}(s),x=function(t){var e=t.envMapCubeUVHeight;if(null===e)return null;var n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n};}(s),y=s.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.normalMapTangentSpace||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ma).join("\n");}(s),M=function(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":""].filter(ma).join("\n");}(s),S=function(t){var e=[];for(var _n89 in t){var _i75=t[_n89];!1!==_i75&&e.push("#define "+_n89+" "+_i75);}return e.join("\n");}(l),E=o.createProgram();var w,R,C=s.glslVersion?"#version "+s.glslVersion+"\n":"";s.isRawShaderMaterial?(w=["#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,S].filter(ma).join("\n"),w.length>0&&(w+="\n"),R=[y,"#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,S].filter(ma).join("\n"),R.length>0&&(R+="\n")):(w=[Ta(s),"#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,S,s.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",s.batching?"#define USE_BATCHING":"",s.instancing?"#define USE_INSTANCING":"",s.instancingColor?"#define USE_INSTANCING_COLOR":"",s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp2?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+_:"",s.lightMap?"#define USE_LIGHTMAP":"",s.aoMap?"#define USE_AOMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",s.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",s.displacementMap?"#define USE_DISPLACEMENTMAP":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.anisotropy?"#define USE_ANISOTROPY":"",s.anisotropyMap?"#define USE_ANISOTROPYMAP":"",s.clearcoatMap?"#define USE_CLEARCOATMAP":"",s.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",s.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",s.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",s.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",s.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metalnessMap?"#define USE_METALNESSMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.alphaHash?"#define USE_ALPHAHASH":"",s.transmission?"#define USE_TRANSMISSION":"",s.transmissionMap?"#define USE_TRANSMISSIONMAP":"",s.thicknessMap?"#define USE_THICKNESSMAP":"",s.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",s.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",s.mapUv?"#define MAP_UV "+s.mapUv:"",s.alphaMapUv?"#define ALPHAMAP_UV "+s.alphaMapUv:"",s.lightMapUv?"#define LIGHTMAP_UV "+s.lightMapUv:"",s.aoMapUv?"#define AOMAP_UV "+s.aoMapUv:"",s.emissiveMapUv?"#define EMISSIVEMAP_UV "+s.emissiveMapUv:"",s.bumpMapUv?"#define BUMPMAP_UV "+s.bumpMapUv:"",s.normalMapUv?"#define NORMALMAP_UV "+s.normalMapUv:"",s.displacementMapUv?"#define DISPLACEMENTMAP_UV "+s.displacementMapUv:"",s.metalnessMapUv?"#define METALNESSMAP_UV "+s.metalnessMapUv:"",s.roughnessMapUv?"#define ROUGHNESSMAP_UV "+s.roughnessMapUv:"",s.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+s.anisotropyMapUv:"",s.clearcoatMapUv?"#define CLEARCOATMAP_UV "+s.clearcoatMapUv:"",s.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+s.clearcoatNormalMapUv:"",s.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+s.clearcoatRoughnessMapUv:"",s.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+s.iridescenceMapUv:"",s.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+s.iridescenceThicknessMapUv:"",s.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+s.sheenColorMapUv:"",s.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+s.sheenRoughnessMapUv:"",s.specularMapUv?"#define SPECULARMAP_UV "+s.specularMapUv:"",s.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+s.specularColorMapUv:"",s.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+s.specularIntensityMapUv:"",s.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+s.transmissionMapUv:"",s.thicknessMapUv?"#define THICKNESSMAP_UV "+s.thicknessMapUv:"",s.vertexTangents&&!1===s.flatShading?"#define USE_TANGENT":"",s.vertexColors?"#define USE_COLOR":"",s.vertexAlphas?"#define USE_COLOR_ALPHA":"",s.vertexUv1s?"#define USE_UV1":"",s.vertexUv2s?"#define USE_UV2":"",s.vertexUv3s?"#define USE_UV3":"",s.pointsUvs?"#define USE_POINTS_UV":"",s.flatShading?"#define FLAT_SHADED":"",s.skinning?"#define USE_SKINNING":"",s.morphTargets?"#define USE_MORPHTARGETS":"",s.morphNormals&&!1===s.flatShading?"#define USE_MORPHNORMALS":"",s.morphColors&&s.isWebGL2?"#define USE_MORPHCOLORS":"",s.morphTargetsCount>0&&s.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",s.morphTargetsCount>0&&s.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+s.morphTextureStride:"",s.morphTargetsCount>0&&s.isWebGL2?"#define MORPHTARGETS_COUNT "+s.morphTargetsCount:"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+f:"",s.sizeAttenuation?"#define USE_SIZEATTENUATION":"",s.numLightProbes>0?"#define USE_LIGHT_PROBES":"",s.useLegacyLights?"#define LEGACY_LIGHTS":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",s.logarithmicDepthBuffer&&s.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ma).join("\n"),R=[y,Ta(s),"#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,S,s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp2?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.matcap?"#define USE_MATCAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+g:"",s.envMap?"#define "+_:"",s.envMap?"#define "+v:"",x?"#define CUBEUV_TEXEL_WIDTH "+x.texelWidth:"",x?"#define CUBEUV_TEXEL_HEIGHT "+x.texelHeight:"",x?"#define CUBEUV_MAX_MIP "+x.maxMip+".0":"",s.lightMap?"#define USE_LIGHTMAP":"",s.aoMap?"#define USE_AOMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",s.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.anisotropy?"#define USE_ANISOTROPY":"",s.anisotropyMap?"#define USE_ANISOTROPYMAP":"",s.clearcoat?"#define USE_CLEARCOAT":"",s.clearcoatMap?"#define USE_CLEARCOATMAP":"",s.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",s.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",s.iridescence?"#define USE_IRIDESCENCE":"",s.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",s.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",s.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metalnessMap?"#define USE_METALNESSMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.alphaTest?"#define USE_ALPHATEST":"",s.alphaHash?"#define USE_ALPHAHASH":"",s.sheen?"#define USE_SHEEN":"",s.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",s.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",s.transmission?"#define USE_TRANSMISSION":"",s.transmissionMap?"#define USE_TRANSMISSIONMAP":"",s.thicknessMap?"#define USE_THICKNESSMAP":"",s.vertexTangents&&!1===s.flatShading?"#define USE_TANGENT":"",s.vertexColors||s.instancingColor?"#define USE_COLOR":"",s.vertexAlphas?"#define USE_COLOR_ALPHA":"",s.vertexUv1s?"#define USE_UV1":"",s.vertexUv2s?"#define USE_UV2":"",s.vertexUv3s?"#define USE_UV3":"",s.pointsUvs?"#define USE_POINTS_UV":"",s.gradientMap?"#define USE_GRADIENTMAP":"",s.flatShading?"#define FLAT_SHADED":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+f:"",s.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",s.numLightProbes>0?"#define USE_LIGHT_PROBES":"",s.useLegacyLights?"#define LEGACY_LIGHTS":"",s.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",s.logarithmicDepthBuffer&&s.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",s.toneMapping!==p?"#define TONE_MAPPING":"",s.toneMapping!==p?yr.tonemapping_pars_fragment:"",s.toneMapping!==p?pa("toneMapping",s.toneMapping):"",s.dithering?"#define DITHERING":"",s.opaque?"#define OPAQUE":"",yr.colorspace_pars_fragment,da("linearToOutputTexel",s.outputColorSpace),s.useDepthPacking?"#define DEPTH_PACKING "+s.depthPacking:"","\n"].filter(ma).join("\n")),c=va(c),c=fa(c,s),c=ga(c,s),m=va(m),m=fa(m,s),m=ga(m,s),c=Sa(c),m=Sa(m),s.isWebGL2&&!0!==s.isRawShaderMaterial&&(C="#version 300 es\n",w=[M,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+w,R=["precision mediump sampler2DArray;","#define varying in",s.glslVersion===Jt?"":"layout(location = 0) out highp vec4 pc_fragColor;",s.glslVersion===Jt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+R);var L=C+w+c,P=C+R+m,I=la(o,o.VERTEX_SHADER,L),U=la(o,o.FRAGMENT_SHADER,P);function D(e){if(t.debug.checkShaderErrors){var _n90=o.getProgramInfoLog(E).trim(),_i76=o.getShaderInfoLog(I).trim(),_r51=o.getShaderInfoLog(U).trim();var _s30=!0,_a22=!0;if(!1===o.getProgramParameter(E,o.LINK_STATUS)){if(_s30=!1,"function"==typeof t.debug.onShaderError)t.debug.onShaderError(o,E,I,U);else{var _t102=ua(o,I,"vertex"),_e77=ua(o,U,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(E,o.VALIDATE_STATUS)+"\n\nProgram Info Log: "+_n90+"\n"+_t102+"\n"+_e77);}}else""!==_n90?console.warn("THREE.WebGLProgram: Program Info Log:",_n90):""!==_i76&&""!==_r51||(_a22=!1);_a22&&(e.diagnostics={runnable:_s30,programLog:_n90,vertexShader:{log:_i76,prefix:w},fragmentShader:{log:_r51,prefix:R}});}o.deleteShader(I),o.deleteShader(U),N=new oa(o,E),O=function(t,e){var n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(var _r52=0;_r52<i;_r52++){var _i77=t.getActiveAttrib(e,_r52),_s31=_i77.name;var _a23=1;_i77.type===t.FLOAT_MAT2&&(_a23=2),_i77.type===t.FLOAT_MAT3&&(_a23=3),_i77.type===t.FLOAT_MAT4&&(_a23=4),n[_s31]={type:_i77.type,location:t.getAttribLocation(e,_s31),locationSize:_a23};}return n;}(o,E);}var N,O;o.attachShader(E,I),o.attachShader(E,U),void 0!==s.index0AttributeName?o.bindAttribLocation(E,0,s.index0AttributeName):!0===s.morphTargets&&o.bindAttribLocation(E,0,"position"),o.linkProgram(E),this.getUniforms=function(){return void 0===N&&D(this),N;},this.getAttributes=function(){return void 0===O&&D(this),O;};var F=!1===s.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===F&&(F=o.getProgramParameter(E,ca)),F;},this.destroy=function(){a.releaseStatesOfProgram(this),o.deleteProgram(E),this.program=void 0;},this.type=s.shaderType,this.name=s.shaderName,this.id=ha++,this.cacheKey=e,this.usedTimes=1,this.program=E,this.vertexShader=I,this.fragmentShader=U,this;}var wa=0;var Aa=/*#__PURE__*/function(){function Aa(){_classCallCheck(this,Aa);this.shaderCache=new Map(),this.materialCache=new Map();}_createClass(Aa,[{key:"update",value:function update(t){var e=t.vertexShader,n=t.fragmentShader,i=this._getShaderStage(e),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(t);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this;}},{key:"remove",value:function remove(t){var e=this.materialCache.get(t);var _iterator3=_createForOfIteratorHelper(e),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _t103=_step3.value;_t103.usedTimes--,0===_t103.usedTimes&&this.shaderCache["delete"](_t103.code);}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}return this.materialCache["delete"](t),this;}},{key:"getVertexShaderID",value:function getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id;}},{key:"getFragmentShaderID",value:function getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id;}},{key:"dispose",value:function dispose(){this.shaderCache.clear(),this.materialCache.clear();}},{key:"_getShaderCacheForMaterial",value:function _getShaderCacheForMaterial(t){var e=this.materialCache;var n=e.get(t);return void 0===n&&(n=new Set(),e.set(t,n)),n;}},{key:"_getShaderStage",value:function _getShaderStage(t){var e=this.shaderCache;var n=e.get(t);return void 0===n&&(n=new Ra(t),e.set(t,n)),n;}}]);return Aa;}();var Ra=/*#__PURE__*/_createClass(function Ra(t){_classCallCheck(this,Ra);this.id=wa++,this.code=t,this.usedTimes=0;});function Ca(t,e,n,i,r,s,o){var l=new In(),c=new Aa(),h=[],u=r.isWebGL2,d=r.logarithmicDepthBuffer,m=r.vertexTextures;var f=r.precision;var g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(t){return 0===t?"uv":"uv".concat(t);}return{getParameters:function getParameters(s,l,h,v,x){var y=v.fog,M=x.geometry,S=s.isMeshStandardMaterial?v.environment:null,b=(s.isMeshStandardMaterial?n:e).get(s.envMap||S),T=b&&b.mapping===A?b.image.height:null,E=g[s.type];null!==s.precision&&(f=r.getMaxPrecision(s.precision),f!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",f,"instead."));var w=M.morphAttributes.position||M.morphAttributes.normal||M.morphAttributes.color,R=void 0!==w?w.length:0;var C,L,P,I,U=0;if(void 0!==M.morphAttributes.position&&(U=1),void 0!==M.morphAttributes.normal&&(U=2),void 0!==M.morphAttributes.color&&(U=3),E){var _t104=Sr[E];C=_t104.vertexShader,L=_t104.fragmentShader;}else C=s.vertexShader,L=s.fragmentShader,c.update(s),P=c.getVertexShaderID(s),I=c.getFragmentShaderID(s);var D=t.getRenderTarget(),N=!0===x.isInstancedMesh,O=!0===x.isBatchedMesh,F=!!s.map,B=!!s.matcap,z=!!b,G=!!s.aoMap,H=!!s.lightMap,V=!!s.bumpMap,k=!!s.normalMap,W=!!s.displacementMap,X=!!s.emissiveMap,j=!!s.metalnessMap,q=!!s.roughnessMap,Y=s.anisotropy>0,Z=s.clearcoat>0,J=s.iridescence>0,K=s.sheen>0,$=s.transmission>0,Q=Y&&!!s.anisotropyMap,tt=Z&&!!s.clearcoatMap,et=Z&&!!s.clearcoatNormalMap,nt=Z&&!!s.clearcoatRoughnessMap,it=J&&!!s.iridescenceMap,rt=J&&!!s.iridescenceThicknessMap,st=K&&!!s.sheenColorMap,at=K&&!!s.sheenRoughnessMap,ot=!!s.specularMap,lt=!!s.specularColorMap,ct=!!s.specularIntensityMap,ht=$&&!!s.transmissionMap,ut=$&&!!s.thicknessMap,dt=!!s.gradientMap,pt=!!s.alphaMap,mt=s.alphaTest>0,ft=!!s.alphaHash,gt=!!s.extensions,_t=!!M.attributes.uv1,vt=!!M.attributes.uv2,xt=!!M.attributes.uv3;var yt=p;return s.toneMapped&&(null!==D&&!0!==D.isXRRenderTarget||(yt=t.toneMapping)),{isWebGL2:u,shaderID:E,shaderType:s.type,shaderName:s.name,vertexShader:C,fragmentShader:L,defines:s.defines,customVertexShaderID:P,customFragmentShaderID:I,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:f,batching:O,instancing:N,instancingColor:N&&null!==x.instanceColor,supportsVertexTextures:m,outputColorSpace:null===D?t.outputColorSpace:!0===D.isXRRenderTarget?D.texture.colorSpace:Ht,map:F,matcap:B,envMap:z,envMapMode:z&&b.mapping,envMapCubeUVHeight:T,aoMap:G,lightMap:H,bumpMap:V,normalMap:k,displacementMap:m&&W,emissiveMap:X,normalMapObjectSpace:k&&1===s.normalMapType,normalMapTangentSpace:k&&0===s.normalMapType,metalnessMap:j,roughnessMap:q,anisotropy:Y,anisotropyMap:Q,clearcoat:Z,clearcoatMap:tt,clearcoatNormalMap:et,clearcoatRoughnessMap:nt,iridescence:J,iridescenceMap:it,iridescenceThicknessMap:rt,sheen:K,sheenColorMap:st,sheenRoughnessMap:at,specularMap:ot,specularColorMap:lt,specularIntensityMap:ct,transmission:$,transmissionMap:ht,thicknessMap:ut,gradientMap:dt,opaque:!1===s.transparent&&1===s.blending,alphaMap:pt,alphaTest:mt,alphaHash:ft,combine:s.combine,mapUv:F&&_(s.map.channel),aoMapUv:G&&_(s.aoMap.channel),lightMapUv:H&&_(s.lightMap.channel),bumpMapUv:V&&_(s.bumpMap.channel),normalMapUv:k&&_(s.normalMap.channel),displacementMapUv:W&&_(s.displacementMap.channel),emissiveMapUv:X&&_(s.emissiveMap.channel),metalnessMapUv:j&&_(s.metalnessMap.channel),roughnessMapUv:q&&_(s.roughnessMap.channel),anisotropyMapUv:Q&&_(s.anisotropyMap.channel),clearcoatMapUv:tt&&_(s.clearcoatMap.channel),clearcoatNormalMapUv:et&&_(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:nt&&_(s.clearcoatRoughnessMap.channel),iridescenceMapUv:it&&_(s.iridescenceMap.channel),iridescenceThicknessMapUv:rt&&_(s.iridescenceThicknessMap.channel),sheenColorMapUv:st&&_(s.sheenColorMap.channel),sheenRoughnessMapUv:at&&_(s.sheenRoughnessMap.channel),specularMapUv:ot&&_(s.specularMap.channel),specularColorMapUv:lt&&_(s.specularColorMap.channel),specularIntensityMapUv:ct&&_(s.specularIntensityMap.channel),transmissionMapUv:ht&&_(s.transmissionMap.channel),thicknessMapUv:ut&&_(s.thicknessMap.channel),alphaMapUv:pt&&_(s.alphaMap.channel),vertexTangents:!!M.attributes.tangent&&(k||Y),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!M.attributes.color&&4===M.attributes.color.itemSize,vertexUv1s:_t,vertexUv2s:vt,vertexUv3s:xt,pointsUvs:!0===x.isPoints&&!!M.attributes.uv&&(F||pt),fog:!!y,useFog:!0===s.fog,fogExp2:y&&y.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===x.isSkinnedMesh,morphTargets:void 0!==M.morphAttributes.position,morphNormals:void 0!==M.morphAttributes.normal,morphColors:void 0!==M.morphAttributes.color,morphTargetsCount:R,morphTextureStride:U,numDirLights:l.directional.length,numPointLights:l.point.length,numSpotLights:l.spot.length,numSpotLightMaps:l.spotLightMap.length,numRectAreaLights:l.rectArea.length,numHemiLights:l.hemi.length,numDirLightShadows:l.directionalShadowMap.length,numPointLightShadows:l.pointShadowMap.length,numSpotLightShadows:l.spotShadowMap.length,numSpotLightShadowsWithMaps:l.numSpotLightShadowsWithMaps,numLightProbes:l.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.length>0,shadowMapType:t.shadowMap.type,toneMapping:yt,useLegacyLights:t._useLegacyLights,decodeVideoTexture:F&&!0===s.map.isVideoTexture&&Re.getTransfer(s.map.colorSpace)===Xt,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:s.side===a,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:gt&&!0===s.extensions.derivatives,extensionFragDepth:gt&&!0===s.extensions.fragDepth,extensionDrawBuffers:gt&&!0===s.extensions.drawBuffers,extensionShaderTextureLOD:gt&&!0===s.extensions.shaderTextureLOD,extensionClipCullDistance:gt&&s.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()};},getProgramCacheKey:function getProgramCacheKey(e){var n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(var _t105 in e.defines)n.push(_t105),n.push(e.defines[_t105]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking);}(n,e),function(t,e){l.disableAll(),e.isWebGL2&&l.enable(0);e.supportsVertexTextures&&l.enable(1);e.instancing&&l.enable(2);e.instancingColor&&l.enable(3);e.matcap&&l.enable(4);e.envMap&&l.enable(5);e.normalMapObjectSpace&&l.enable(6);e.normalMapTangentSpace&&l.enable(7);e.clearcoat&&l.enable(8);e.iridescence&&l.enable(9);e.alphaTest&&l.enable(10);e.vertexColors&&l.enable(11);e.vertexAlphas&&l.enable(12);e.vertexUv1s&&l.enable(13);e.vertexUv2s&&l.enable(14);e.vertexUv3s&&l.enable(15);e.vertexTangents&&l.enable(16);e.anisotropy&&l.enable(17);e.alphaHash&&l.enable(18);e.batching&&l.enable(19);t.push(l.mask),l.disableAll(),e.fog&&l.enable(0);e.useFog&&l.enable(1);e.flatShading&&l.enable(2);e.logarithmicDepthBuffer&&l.enable(3);e.skinning&&l.enable(4);e.morphTargets&&l.enable(5);e.morphNormals&&l.enable(6);e.morphColors&&l.enable(7);e.premultipliedAlpha&&l.enable(8);e.shadowMapEnabled&&l.enable(9);e.useLegacyLights&&l.enable(10);e.doubleSided&&l.enable(11);e.flipSided&&l.enable(12);e.useDepthPacking&&l.enable(13);e.dithering&&l.enable(14);e.transmission&&l.enable(15);e.sheen&&l.enable(16);e.opaque&&l.enable(17);e.pointsUvs&&l.enable(18);e.decodeVideoTexture&&l.enable(19);t.push(l.mask);}(n,e),n.push(t.outputColorSpace)),n.push(e.customProgramCacheKey),n.join();},getUniforms:function getUniforms(t){var e=g[t.type];var n;if(e){var _t106=Sr[e];n=nr.clone(_t106.uniforms);}else n=t.uniforms;return n;},acquireProgram:function acquireProgram(e,n){var i;for(var _t107=0,_e78=h.length;_t107<_e78;_t107++){var _e79=h[_t107];if(_e79.cacheKey===n){i=_e79,++i.usedTimes;break;}}return void 0===i&&(i=new Ea(t,n,e,s),h.push(i)),i;},releaseProgram:function releaseProgram(t){if(0==--t.usedTimes){var _e80=h.indexOf(t);h[_e80]=h[h.length-1],h.pop(),t.destroy();}},releaseShaderCache:function releaseShaderCache(t){c.remove(t);},programs:h,dispose:function dispose(){c.dispose();}};}function La(){var t=new WeakMap();return{get:function get(e){var n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n;},remove:function remove(e){t["delete"](e);},update:function update(e,n,i){t.get(e)[n]=i;},dispose:function dispose(){t=new WeakMap();}};}function Pa(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id;}function Ia(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id;}function Ua(){var t=[];var e=0;var n=[],i=[],r=[];function s(n,i,r,s,a,o){var l=t[e];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:a,group:o},t[e]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=a,l.group=o),e++,l;}return{opaque:n,transmissive:i,transparent:r,init:function init(){e=0,n.length=0,i.length=0,r.length=0;},push:function push(t,e,a,o,l,c){var h=s(t,e,a,o,l,c);a.transmission>0?i.push(h):!0===a.transparent?r.push(h):n.push(h);},unshift:function unshift(t,e,a,o,l,c){var h=s(t,e,a,o,l,c);a.transmission>0?i.unshift(h):!0===a.transparent?r.unshift(h):n.unshift(h);},finish:function finish(){for(var _n91=e,_i78=t.length;_n91<_i78;_n91++){var _e81=t[_n91];if(null===_e81.id)break;_e81.id=null,_e81.object=null,_e81.geometry=null,_e81.material=null,_e81.group=null;}},sort:function sort(t,e){n.length>1&&n.sort(t||Pa),i.length>1&&i.sort(e||Ia),r.length>1&&r.sort(e||Ia);}};}function Da(){var t=new WeakMap();return{get:function get(e,n){var i=t.get(e);var r;return void 0===i?(r=new Ua(),t.set(e,[r])):n>=i.length?(r=new Ua(),i.push(r)):r=i[n],r;},dispose:function dispose(){t=new WeakMap();}};}function Na(){var t={};return{get:function get(e){if(void 0!==t[e.id])return t[e.id];var n;switch(e.type){case"DirectionalLight":n={direction:new We(),color:new ci()};break;case"SpotLight":n={position:new We(),direction:new We(),color:new ci(),distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new We(),color:new ci(),distance:0,decay:0};break;case"HemisphereLight":n={direction:new We(),skyColor:new ci(),groundColor:new ci()};break;case"RectAreaLight":n={color:new ci(),position:new We(),halfWidth:new We(),halfHeight:new We()};}return t[e.id]=n,n;}};}var Oa=0;function Fa(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0);}function Ba(t,e){var n=new Na(),i=function(){var t={};return{get:function get(e){if(void 0!==t[e.id])return t[e.id];var n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new me()};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new me(),shadowCameraNear:1,shadowCameraFar:1e3};}return t[e.id]=n,n;}};}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(var _t108=0;_t108<9;_t108++)r.probe.push(new We());var s=new We(),a=new Mn(),o=new Mn();return{setup:function setup(s,a){var o=0,l=0,c=0;for(var _t109=0;_t109<9;_t109++)r.probe[_t109].set(0,0,0);var h=0,u=0,d=0,p=0,m=0,f=0,g=0,_=0,v=0,x=0,y=0;s.sort(Fa);var M=!0===a?Math.PI:1;for(var _t110=0,_e82=s.length;_t110<_e82;_t110++){var _e83=s[_t110],_a24=_e83.color,_S2=_e83.intensity,_b2=_e83.distance,_T2=_e83.shadow&&_e83.shadow.map?_e83.shadow.map.texture:null;if(_e83.isAmbientLight)o+=_a24.r*_S2*M,l+=_a24.g*_S2*M,c+=_a24.b*_S2*M;else if(_e83.isLightProbe){for(var _t111=0;_t111<9;_t111++)r.probe[_t111].addScaledVector(_e83.sh.coefficients[_t111],_S2);y++;}else if(_e83.isDirectionalLight){var _t112=n.get(_e83);if(_t112.color.copy(_e83.color).multiplyScalar(_e83.intensity*M),_e83.castShadow){var _t113=_e83.shadow,_n92=i.get(_e83);_n92.shadowBias=_t113.bias,_n92.shadowNormalBias=_t113.normalBias,_n92.shadowRadius=_t113.radius,_n92.shadowMapSize=_t113.mapSize,r.directionalShadow[h]=_n92,r.directionalShadowMap[h]=_T2,r.directionalShadowMatrix[h]=_e83.shadow.matrix,f++;}r.directional[h]=_t112,h++;}else if(_e83.isSpotLight){var _t114=n.get(_e83);_t114.position.setFromMatrixPosition(_e83.matrixWorld),_t114.color.copy(_a24).multiplyScalar(_S2*M),_t114.distance=_b2,_t114.coneCos=Math.cos(_e83.angle),_t114.penumbraCos=Math.cos(_e83.angle*(1-_e83.penumbra)),_t114.decay=_e83.decay,r.spot[d]=_t114;var _s32=_e83.shadow;if(_e83.map&&(r.spotLightMap[v]=_e83.map,v++,_s32.updateMatrices(_e83),_e83.castShadow&&x++),r.spotLightMatrix[d]=_s32.matrix,_e83.castShadow){var _t115=i.get(_e83);_t115.shadowBias=_s32.bias,_t115.shadowNormalBias=_s32.normalBias,_t115.shadowRadius=_s32.radius,_t115.shadowMapSize=_s32.mapSize,r.spotShadow[d]=_t115,r.spotShadowMap[d]=_T2,_++;}d++;}else if(_e83.isRectAreaLight){var _t116=n.get(_e83);_t116.color.copy(_a24).multiplyScalar(_S2),_t116.halfWidth.set(.5*_e83.width,0,0),_t116.halfHeight.set(0,.5*_e83.height,0),r.rectArea[p]=_t116,p++;}else if(_e83.isPointLight){var _t117=n.get(_e83);if(_t117.color.copy(_e83.color).multiplyScalar(_e83.intensity*M),_t117.distance=_e83.distance,_t117.decay=_e83.decay,_e83.castShadow){var _t118=_e83.shadow,_n93=i.get(_e83);_n93.shadowBias=_t118.bias,_n93.shadowNormalBias=_t118.normalBias,_n93.shadowRadius=_t118.radius,_n93.shadowMapSize=_t118.mapSize,_n93.shadowCameraNear=_t118.camera.near,_n93.shadowCameraFar=_t118.camera.far,r.pointShadow[u]=_n93,r.pointShadowMap[u]=_T2,r.pointShadowMatrix[u]=_e83.shadow.matrix,g++;}r.point[u]=_t117,u++;}else if(_e83.isHemisphereLight){var _t119=n.get(_e83);_t119.skyColor.copy(_e83.color).multiplyScalar(_S2*M),_t119.groundColor.copy(_e83.groundColor).multiplyScalar(_S2*M),r.hemi[m]=_t119,m++;}}p>0&&(e.isWebGL2?!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Mr.LTC_FLOAT_1,r.rectAreaLTC2=Mr.LTC_FLOAT_2):(r.rectAreaLTC1=Mr.LTC_HALF_1,r.rectAreaLTC2=Mr.LTC_HALF_2):!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Mr.LTC_FLOAT_1,r.rectAreaLTC2=Mr.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Mr.LTC_HALF_1,r.rectAreaLTC2=Mr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=c;var S=r.hash;S.directionalLength===h&&S.pointLength===u&&S.spotLength===d&&S.rectAreaLength===p&&S.hemiLength===m&&S.numDirectionalShadows===f&&S.numPointShadows===g&&S.numSpotShadows===_&&S.numSpotMaps===v&&S.numLightProbes===y||(r.directional.length=h,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=m,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=_+v-x,r.spotLightMap.length=v,r.numSpotLightShadowsWithMaps=x,r.numLightProbes=y,S.directionalLength=h,S.pointLength=u,S.spotLength=d,S.rectAreaLength=p,S.hemiLength=m,S.numDirectionalShadows=f,S.numPointShadows=g,S.numSpotShadows=_,S.numSpotMaps=v,S.numLightProbes=y,r.version=Oa++);},setupView:function setupView(t,e){var n=0,i=0,l=0,c=0,h=0;var u=e.matrixWorldInverse;for(var _e84=0,_d6=t.length;_e84<_d6;_e84++){var _d7=t[_e84];if(_d7.isDirectionalLight){var _t120=r.directional[n];_t120.direction.setFromMatrixPosition(_d7.matrixWorld),s.setFromMatrixPosition(_d7.target.matrixWorld),_t120.direction.sub(s),_t120.direction.transformDirection(u),n++;}else if(_d7.isSpotLight){var _t121=r.spot[l];_t121.position.setFromMatrixPosition(_d7.matrixWorld),_t121.position.applyMatrix4(u),_t121.direction.setFromMatrixPosition(_d7.matrixWorld),s.setFromMatrixPosition(_d7.target.matrixWorld),_t121.direction.sub(s),_t121.direction.transformDirection(u),l++;}else if(_d7.isRectAreaLight){var _t122=r.rectArea[c];_t122.position.setFromMatrixPosition(_d7.matrixWorld),_t122.position.applyMatrix4(u),o.identity(),a.copy(_d7.matrixWorld),a.premultiply(u),o.extractRotation(a),_t122.halfWidth.set(.5*_d7.width,0,0),_t122.halfHeight.set(0,.5*_d7.height,0),_t122.halfWidth.applyMatrix4(o),_t122.halfHeight.applyMatrix4(o),c++;}else if(_d7.isPointLight){var _t123=r.point[i];_t123.position.setFromMatrixPosition(_d7.matrixWorld),_t123.position.applyMatrix4(u),i++;}else if(_d7.isHemisphereLight){var _t124=r.hemi[h];_t124.direction.setFromMatrixPosition(_d7.matrixWorld),_t124.direction.transformDirection(u),h++;}}},state:r};}function za(t,e){var n=new Ba(t,e),i=[],r=[];return{init:function init(){i.length=0,r.length=0;},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function setupLights(t){n.setup(i,t);},setupLightsView:function setupLightsView(t){n.setupView(i,t);},pushLight:function pushLight(t){i.push(t);},pushShadow:function pushShadow(t){r.push(t);}};}function Ga(t,e){var n=new WeakMap();return{get:function get(i){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var s=n.get(i);var a;return void 0===s?(a=new za(t,e),n.set(i,[a])):r>=s.length?(a=new za(t,e),s.push(a)):a=s[r],a;},dispose:function dispose(){n=new WeakMap();}};}var Ha=/*#__PURE__*/function(_di3){_inherits(Ha,_di3);var _super24=_createSuper(Ha);function Ha(t){var _this21;_classCallCheck(this,Ha);_this21=_super24.call(this),_this21.isMeshDepthMaterial=!0,_this21.type="MeshDepthMaterial",_this21.depthPacking=3200,_this21.map=null,_this21.alphaMap=null,_this21.displacementMap=null,_this21.displacementScale=1,_this21.displacementBias=0,_this21.wireframe=!1,_this21.wireframeLinewidth=1,_this21.setValues(t);return _this21;}_createClass(Ha,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(Ha.prototype),"copy",this).call(this,t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this;}}]);return Ha;}(di);var Va=/*#__PURE__*/function(_di4){_inherits(Va,_di4);var _super25=_createSuper(Va);function Va(t){var _this22;_classCallCheck(this,Va);_this22=_super25.call(this),_this22.isMeshDistanceMaterial=!0,_this22.type="MeshDistanceMaterial",_this22.map=null,_this22.alphaMap=null,_this22.displacementMap=null,_this22.displacementScale=1,_this22.displacementBias=0,_this22.setValues(t);return _this22;}_createClass(Va,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(Va.prototype),"copy",this).call(this,t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this;}}]);return Va;}(di);function ka(t,e,i){var _f3;var o=new gr();var l=new me(),c=new me(),h=new Be(),u=new Ha({depthPacking:3201}),d=new Va(),p={},m=i.maxTextureSize,f=(_f3={},_defineProperty(_f3,s,a),_defineProperty(_f3,a,s),_defineProperty(_f3,2,2),_f3),g=new ir({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new me()},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),_=g.clone();_.defines.HORIZONTAL_PASS=1;var v=new Ii();v.setAttribute("position",new Mi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var x=new Ji(v,g),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=n;var M=this.type;function S(n,i){var r=e.update(x);g.defines.VSM_SAMPLES!==n.blurSamples&&(g.defines.VSM_SAMPLES=n.blurSamples,_.defines.VSM_SAMPLES=n.blurSamples,g.needsUpdate=!0,_.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Ge(l.x,l.y)),g.uniforms.shadow_pass.value=n.map.texture,g.uniforms.resolution.value=n.mapSize,g.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,r,g,x,null),_.uniforms.shadow_pass.value=n.mapPass.texture,_.uniforms.resolution.value=n.mapSize,_.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,r,_,x,null);}function b(e,n,i,s){var a=null;var o=!0===i.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==o)a=o;else if(a=!0===i.isPointLight?d:u,t.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){var _t125=a.uuid,_e85=n.uuid;var _i79=p[_t125];void 0===_i79&&(_i79={},p[_t125]=_i79);var _r53=_i79[_e85];void 0===_r53&&(_r53=a.clone(),_i79[_e85]=_r53,n.addEventListener("dispose",E)),a=_r53;}if(a.visible=n.visible,a.wireframe=n.wireframe,a.side=s===r?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:f[n.side],a.alphaMap=n.alphaMap,a.alphaTest=n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===i.isPointLight&&!0===a.isMeshDistanceMaterial){t.properties.get(a).light=i;}return a;}function T(n,i,s,a,l){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&l===r)&&(!n.frustumCulled||o.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);var _r54=e.update(n),_o14=n.material;if(Array.isArray(_o14)){var _e86=_r54.groups;for(var _c9=0,_h6=_e86.length;_c9<_h6;_c9++){var _h7=_e86[_c9],_u6=_o14[_h7.materialIndex];if(_u6&&_u6.visible){var _e87=b(n,_u6,a,l);n.onBeforeShadow(t,n,i,s,_r54,_e87,_h7),t.renderBufferDirect(s,null,_r54,_e87,n,_h7),n.onAfterShadow(t,n,i,s,_r54,_e87,_h7);}}}else if(_o14.visible){var _e88=b(n,_o14,a,l);n.onBeforeShadow(t,n,i,s,_r54,_e88,null),t.renderBufferDirect(s,null,_r54,_e88,n,null),n.onAfterShadow(t,n,i,s,_r54,_e88,null);}}var c=n.children;for(var _t126=0,_e89=c.length;_t126<_e89;_t126++)T(c[_t126],i,s,a,l);}function E(t){t.target.removeEventListener("dispose",E);for(var _e90 in p){var _n94=p[_e90],_i80=t.target.uuid;if(_i80 in _n94){_n94[_i80].dispose(),delete _n94[_i80];}}}this.render=function(e,n,i){if(!1===y.enabled)return;if(!1===y.autoUpdate&&!1===y.needsUpdate)return;if(0===e.length)return;var s=t.getRenderTarget(),a=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);var p=M!==r&&this.type===r,f=M===r&&this.type!==r;for(var _s33=0,_a25=e.length;_s33<_a25;_s33++){var _a26=e[_s33],_u7=_a26.shadow;if(void 0===_u7){console.warn("THREE.WebGLShadowMap:",_a26,"has no shadow.");continue;}if(!1===_u7.autoUpdate&&!1===_u7.needsUpdate)continue;l.copy(_u7.mapSize);var _g3=_u7.getFrameExtents();if(l.multiply(_g3),c.copy(_u7.mapSize),(l.x>m||l.y>m)&&(l.x>m&&(c.x=Math.floor(m/_g3.x),l.x=c.x*_g3.x,_u7.mapSize.x=c.x),l.y>m&&(c.y=Math.floor(m/_g3.y),l.y=c.y*_g3.y,_u7.mapSize.y=c.y)),null===_u7.map||!0===p||!0===f){var _t127=this.type!==r?{minFilter:P,magFilter:P}:{};null!==_u7.map&&_u7.map.dispose(),_u7.map=new Ge(l.x,l.y,_t127),_u7.map.texture.name=_a26.name+".shadowMap",_u7.camera.updateProjectionMatrix();}t.setRenderTarget(_u7.map),t.clear();var _5=_u7.getViewportCount();for(var _t128=0;_t128<_5;_t128++){var _e91=_u7.getViewport(_t128);h.set(c.x*_e91.x,c.y*_e91.y,c.x*_e91.z,c.y*_e91.w),d.viewport(h),_u7.updateMatrices(_a26,_t128),o=_u7.getFrustum(),T(n,i,_u7.camera,_a26,this.type);}!0!==_u7.isPointLightShadow&&this.type===r&&S(_u7,i),_u7.needsUpdate=!1;}M=this.type,y.needsUpdate=!1,t.setRenderTarget(s,a,u);};}function Wa(t,e,n){var _Y2,_Z2;var i=n.isWebGL2;var r=new function(){var e=!1;var n=new Be();var i=null;var r=new Be(0,0,0,0);return{setMask:function setMask(n){i===n||e||(t.colorMask(n,n,n,n),i=n);},setLocked:function setLocked(t){e=t;},setClear:function setClear(e,i,s,a,o){!0===o&&(e*=a,i*=a,s*=a),n.set(e,i,s,a),!1===r.equals(n)&&(t.clearColor(e,i,s,a),r.copy(n));},reset:function reset(){e=!1,i=null,r.set(-1,0,0,0);}};}(),s=new function(){var e=!1,n=null,i=null,r=null;return{setTest:function setTest(e){e?j(t.DEPTH_TEST):q(t.DEPTH_TEST);},setMask:function setMask(i){n===i||e||(t.depthMask(i),n=i);},setFunc:function setFunc(e){if(i!==e){switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL);}i=e;}},setLocked:function setLocked(t){e=t;},setClear:function setClear(e){r!==e&&(t.clearDepth(e),r=e);},reset:function reset(){e=!1,n=null,i=null,r=null;}};}(),h=new function(){var e=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function setTest(n){e||(n?j(t.STENCIL_TEST):q(t.STENCIL_TEST));},setMask:function setMask(i){n===i||e||(t.stencilMask(i),n=i);},setFunc:function setFunc(e,n,a){i===e&&r===n&&s===a||(t.stencilFunc(e,n,a),i=e,r=n,s=a);},setOp:function setOp(e,n,i){a===e&&o===n&&l===i||(t.stencilOp(e,n,i),a=e,o=n,l=i);},setLocked:function setLocked(t){e=t;},setClear:function setClear(e){c!==e&&(t.clearStencil(e),c=e);},reset:function reset(){e=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null;}};}(),u=new WeakMap(),d=new WeakMap();var p={},m={},f=new WeakMap(),g=[],_=null,v=!1,x=null,y=null,M=null,S=null,b=null,T=null,E=null,w=new ci(0,0,0),A=0,R=!1,C=null,L=null,P=null,I=null,U=null;var D=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);var N=!1,O=0;var F=t.getParameter(t.VERSION);-1!==F.indexOf("WebGL")?(O=parseFloat(/^WebGL (\d)/.exec(F)[1]),N=O>=1):-1!==F.indexOf("OpenGL ES")&&(O=parseFloat(/^OpenGL ES (\d)/.exec(F)[1]),N=O>=2);var B=null,z={};var G=t.getParameter(t.SCISSOR_BOX),H=t.getParameter(t.VIEWPORT),V=new Be().fromArray(G),k=new Be().fromArray(H);function W(e,n,r,s){var a=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(var _o15=0;_o15<r;_o15++)!i||e!==t.TEXTURE_3D&&e!==t.TEXTURE_2D_ARRAY?t.texImage2D(n+_o15,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,a):t.texImage3D(n,0,t.RGBA,1,1,s,0,t.RGBA,t.UNSIGNED_BYTE,a);return o;}var X={};function j(e){!0!==p[e]&&(t.enable(e),p[e]=!0);}function q(e){!1!==p[e]&&(t.disable(e),p[e]=!1);}X[t.TEXTURE_2D]=W(t.TEXTURE_2D,t.TEXTURE_2D,1),X[t.TEXTURE_CUBE_MAP]=W(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(X[t.TEXTURE_2D_ARRAY]=W(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),X[t.TEXTURE_3D]=W(t.TEXTURE_3D,t.TEXTURE_3D,1,1)),r.setClear(0,0,0,1),s.setClear(1),h.setClear(0),j(t.DEPTH_TEST),s.setFunc(3),K(!1),$(1),j(t.CULL_FACE),J(0);var Y=(_Y2={},_defineProperty(_Y2,o,t.FUNC_ADD),_defineProperty(_Y2,101,t.FUNC_SUBTRACT),_defineProperty(_Y2,102,t.FUNC_REVERSE_SUBTRACT),_Y2);if(i)Y[103]=t.MIN,Y[104]=t.MAX;else{var _t129=e.get("EXT_blend_minmax");null!==_t129&&(Y[103]=_t129.MIN_EXT,Y[104]=_t129.MAX_EXT);}var Z=(_Z2={200:t.ZERO,201:t.ONE,202:t.SRC_COLOR},_defineProperty(_Z2,l,t.SRC_ALPHA),_defineProperty(_Z2,210,t.SRC_ALPHA_SATURATE),_defineProperty(_Z2,208,t.DST_COLOR),_defineProperty(_Z2,206,t.DST_ALPHA),_defineProperty(_Z2,203,t.ONE_MINUS_SRC_COLOR),_defineProperty(_Z2,c,t.ONE_MINUS_SRC_ALPHA),_defineProperty(_Z2,209,t.ONE_MINUS_DST_COLOR),_defineProperty(_Z2,207,t.ONE_MINUS_DST_ALPHA),_defineProperty(_Z2,211,t.CONSTANT_COLOR),_defineProperty(_Z2,212,t.ONE_MINUS_CONSTANT_COLOR),_defineProperty(_Z2,213,t.CONSTANT_ALPHA),_defineProperty(_Z2,214,t.ONE_MINUS_CONSTANT_ALPHA),_Z2);function J(e,n,i,r,s,a,l,c,h,u){if(0!==e){if(!1===v&&(j(t.BLEND),v=!0),5===e)s=s||n,a=a||i,l=l||r,n===y&&s===b||(t.blendEquationSeparate(Y[n],Y[s]),y=n,b=s),i===M&&r===S&&a===T&&l===E||(t.blendFuncSeparate(Z[i],Z[r],Z[a],Z[l]),M=i,S=r,T=a,E=l),!1!==c.equals(w)&&h===A||(t.blendColor(c.r,c.g,c.b,h),w.copy(c),A=h),x=e,R=!1;else if(e!==x||u!==R){if(y===o&&b===o||(t.blendEquation(t.FUNC_ADD),y=o,b=o),u)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);}M=null,S=null,T=null,E=null,w.set(0,0,0),A=0,x=e,R=u;}}else!0===v&&(q(t.BLEND),v=!1);}function K(e){C!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),C=e);}function $(e){0!==e?(j(t.CULL_FACE),e!==L&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):q(t.CULL_FACE),L=e;}function Q(e,n,i){e?(j(t.POLYGON_OFFSET_FILL),I===n&&U===i||(t.polygonOffset(n,i),I=n,U=i)):q(t.POLYGON_OFFSET_FILL);}return{buffers:{color:r,depth:s,stencil:h},enable:j,disable:q,bindFramebuffer:function bindFramebuffer(e,n){return m[e]!==n&&(t.bindFramebuffer(e,n),m[e]=n,i&&(e===t.DRAW_FRAMEBUFFER&&(m[t.FRAMEBUFFER]=n),e===t.FRAMEBUFFER&&(m[t.DRAW_FRAMEBUFFER]=n)),!0);},drawBuffers:function drawBuffers(i,r){var s=g,a=!1;if(i){if(s=f.get(r),void 0===s&&(s=[],f.set(r,s)),i.isWebGLMultipleRenderTargets){var _e92=i.texture;if(s.length!==_e92.length||s[0]!==t.COLOR_ATTACHMENT0){for(var _n95=0,_i81=_e92.length;_n95<_i81;_n95++)s[_n95]=t.COLOR_ATTACHMENT0+_n95;s.length=_e92.length,a=!0;}}else s[0]!==t.COLOR_ATTACHMENT0&&(s[0]=t.COLOR_ATTACHMENT0,a=!0);}else s[0]!==t.BACK&&(s[0]=t.BACK,a=!0);a&&(n.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s));},useProgram:function useProgram(e){return _!==e&&(t.useProgram(e),_=e,!0);},setBlending:J,setMaterial:function setMaterial(e,n){2===e.side?q(t.CULL_FACE):j(t.CULL_FACE);var i=e.side===a;n&&(i=!i),K(i),1===e.blending&&!1===e.transparent?J(0):J(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.blendColor,e.blendAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),r.setMask(e.colorWrite);var o=e.stencilWrite;h.setTest(o),o&&(h.setMask(e.stencilWriteMask),h.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),h.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Q(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?j(t.SAMPLE_ALPHA_TO_COVERAGE):q(t.SAMPLE_ALPHA_TO_COVERAGE);},setFlipSided:K,setCullFace:$,setLineWidth:function setLineWidth(e){e!==P&&(N&&t.lineWidth(e),P=e);},setPolygonOffset:Q,setScissorTest:function setScissorTest(e){e?j(t.SCISSOR_TEST):q(t.SCISSOR_TEST);},activeTexture:function activeTexture(e){void 0===e&&(e=t.TEXTURE0+D-1),B!==e&&(t.activeTexture(e),B=e);},bindTexture:function bindTexture(e,n,i){void 0===i&&(i=null===B?t.TEXTURE0+D-1:B);var r=z[i];void 0===r&&(r={type:void 0,texture:void 0},z[i]=r),r.type===e&&r.texture===n||(B!==i&&(t.activeTexture(i),B=i),t.bindTexture(e,n||X[e]),r.type=e,r.texture=n);},unbindTexture:function unbindTexture(){var e=z[B];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0);},compressedTexImage2D:function compressedTexImage2D(){try{t.compressedTexImage2D.apply(t,arguments);}catch(t){console.error("THREE.WebGLState:",t);}},compressedTexImage3D:function compressedTexImage3D(){try{t.compressedTexImage3D.apply(t,arguments);}catch(t){console.error("THREE.WebGLState:",t);}},texImage2D:function texImage2D(){try{t.texImage2D.apply(t,arguments);}catch(t){console.error("THREE.WebGLState:",t);}},texImage3D:function texImage3D(){try{t.texImage3D.apply(t,arguments);}catch(t){console.error("THREE.WebGLState:",t);}},updateUBOMapping:function updateUBOMapping(e,n){var i=d.get(n);void 0===i&&(i=new WeakMap(),d.set(n,i));var r=i.get(e);void 0===r&&(r=t.getUniformBlockIndex(n,e.name),i.set(e,r));},uniformBlockBinding:function uniformBlockBinding(e,n){var i=d.get(n).get(e);u.get(n)!==i&&(t.uniformBlockBinding(n,i,e.__bindingPointIndex),u.set(n,i));},texStorage2D:function texStorage2D(){try{t.texStorage2D.apply(t,arguments);}catch(t){console.error("THREE.WebGLState:",t);}},texStorage3D:function texStorage3D(){try{t.texStorage3D.apply(t,arguments);}catch(t){console.error("THREE.WebGLState:",t);}},texSubImage2D:function texSubImage2D(){try{t.texSubImage2D.apply(t,arguments);}catch(t){console.error("THREE.WebGLState:",t);}},texSubImage3D:function texSubImage3D(){try{t.texSubImage3D.apply(t,arguments);}catch(t){console.error("THREE.WebGLState:",t);}},compressedTexSubImage2D:function compressedTexSubImage2D(){try{t.compressedTexSubImage2D.apply(t,arguments);}catch(t){console.error("THREE.WebGLState:",t);}},compressedTexSubImage3D:function compressedTexSubImage3D(){try{t.compressedTexSubImage3D.apply(t,arguments);}catch(t){console.error("THREE.WebGLState:",t);}},scissor:function scissor(e){!1===V.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),V.copy(e));},viewport:function viewport(e){!1===k.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),k.copy(e));},reset:function reset(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),!0===i&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),p={},B=null,z={},m={},f=new WeakMap(),g=[],_=null,v=!1,x=null,y=null,M=null,S=null,b=null,T=null,E=null,w=new ci(0,0,0),A=0,R=!1,C=null,L=null,P=null,I=null,U=null,V.set(0,0,t.canvas.width,t.canvas.height),k.set(0,0,t.canvas.width,t.canvas.height),r.reset(),s.reset(),h.reset();}};}function Xa(t,e,n,i,r,s,a){var _A2,_z2;var o=r.isWebGL2,l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),h=new WeakMap();var u;var d=new WeakMap();var p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d");}catch(t){}function m(t,e){return p?new OffscreenCanvas(t,e):ye("canvas");}function f(t,e,n,i){var r=1;if((t.width>i||t.height>i)&&(r=i/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){var _i82=e?he:Math.floor,_s34=_i82(r*t.width),_a27=_i82(r*t.height);void 0===u&&(u=m(_s34,_a27));var _o16=n?m(_s34,_a27):u;_o16.width=_s34,_o16.height=_a27;return _o16.getContext("2d").drawImage(t,0,0,_s34,_a27),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+_s34+"x"+_a27+")."),_o16;}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t;}return t;}function g(t){return ce(t.width)&&ce(t.height);}function _(t,e){return t.generateMipmaps&&e&&t.minFilter!==P&&t.minFilter!==D;}function v(e){t.generateMipmap(e);}function x(n,i,r,s){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:!1;if(!1===o)return i;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'");}var l=i;if(i===t.RED&&(r===t.FLOAT&&(l=t.R32F),r===t.HALF_FLOAT&&(l=t.R16F),r===t.UNSIGNED_BYTE&&(l=t.R8)),i===t.RED_INTEGER&&(r===t.UNSIGNED_BYTE&&(l=t.R8UI),r===t.UNSIGNED_SHORT&&(l=t.R16UI),r===t.UNSIGNED_INT&&(l=t.R32UI),r===t.BYTE&&(l=t.R8I),r===t.SHORT&&(l=t.R16I),r===t.INT&&(l=t.R32I)),i===t.RG&&(r===t.FLOAT&&(l=t.RG32F),r===t.HALF_FLOAT&&(l=t.RG16F),r===t.UNSIGNED_BYTE&&(l=t.RG8)),i===t.RGBA){var _e93=a?Wt:Re.getTransfer(s);r===t.FLOAT&&(l=t.RGBA32F),r===t.HALF_FLOAT&&(l=t.RGBA16F),r===t.UNSIGNED_BYTE&&(l=_e93===Xt?t.SRGB8_ALPHA8:t.RGBA8),r===t.UNSIGNED_SHORT_4_4_4_4&&(l=t.RGBA4),r===t.UNSIGNED_SHORT_5_5_5_1&&(l=t.RGB5_A1);}return l!==t.R16F&&l!==t.R32F&&l!==t.RG16F&&l!==t.RG32F&&l!==t.RGBA16F&&l!==t.RGBA32F||e.get("EXT_color_buffer_float"),l;}function y(t,e,n){return!0===_(t,n)||t.isFramebufferTexture&&t.minFilter!==P&&t.minFilter!==D?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1;}function M(e){return e===P||e===I||e===U?t.NEAREST:t.LINEAR;}function S(t){var e=t.target;e.removeEventListener("dispose",S),function(t){var e=i.get(t);if(void 0===e.__webglInit)return;var n=t.source,r=d.get(n);if(r){var _i83=r[e.__cacheKey];_i83.usedTimes--,0===_i83.usedTimes&&T(t),0===Object.keys(r).length&&d["delete"](n);}i.remove(t);}(e),e.isVideoTexture&&h["delete"](e);}function b(e){var n=e.target;n.removeEventListener("dispose",b),function(e){var n=e.texture,r=i.get(e),s=i.get(n);void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),a.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(var _e94=0;_e94<6;_e94++){if(Array.isArray(r.__webglFramebuffer[_e94]))for(var _n96=0;_n96<r.__webglFramebuffer[_e94].length;_n96++)t.deleteFramebuffer(r.__webglFramebuffer[_e94][_n96]);else t.deleteFramebuffer(r.__webglFramebuffer[_e94]);r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[_e94]);}else{if(Array.isArray(r.__webglFramebuffer))for(var _e95=0;_e95<r.__webglFramebuffer.length;_e95++)t.deleteFramebuffer(r.__webglFramebuffer[_e95]);else t.deleteFramebuffer(r.__webglFramebuffer);if(r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(var _e96=0;_e96<r.__webglColorRenderbuffer.length;_e96++)r.__webglColorRenderbuffer[_e96]&&t.deleteRenderbuffer(r.__webglColorRenderbuffer[_e96]);r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer);}if(e.isWebGLMultipleRenderTargets)for(var _e97=0,_r55=n.length;_e97<_r55;_e97++){var _r56=i.get(n[_e97]);_r56.__webglTexture&&(t.deleteTexture(_r56.__webglTexture),a.memory.textures--),i.remove(n[_e97]);}i.remove(n),i.remove(e);}(n);}function T(e){var n=i.get(e);t.deleteTexture(n.__webglTexture);var r=e.source;delete d.get(r)[n.__cacheKey],a.memory.textures--;}var E=0;function w(e,r){var s=i.get(e);if(e.isVideoTexture&&function(t){var e=a.render.frame;h.get(t)!==e&&(h.set(t,e),t.update());}(e),!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version){var _t130=e.image;if(null===_t130)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==_t130.complete)return void J(s,e,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");}}n.bindTexture(t.TEXTURE_2D,s.__webglTexture,t.TEXTURE0+r);}var A=(_A2={},_defineProperty(_A2,R,t.REPEAT),_defineProperty(_A2,C,t.CLAMP_TO_EDGE),_defineProperty(_A2,L,t.MIRRORED_REPEAT),_A2),z=(_z2={},_defineProperty(_z2,P,t.NEAREST),_defineProperty(_z2,I,t.NEAREST_MIPMAP_NEAREST),_defineProperty(_z2,U,t.NEAREST_MIPMAP_LINEAR),_defineProperty(_z2,D,t.LINEAR),_defineProperty(_z2,N,t.LINEAR_MIPMAP_NEAREST),_defineProperty(_z2,O,t.LINEAR_MIPMAP_LINEAR),_z2),k={512:t.NEVER,519:t.ALWAYS,513:t.LESS,515:t.LEQUAL,514:t.EQUAL,518:t.GEQUAL,516:t.GREATER,517:t.NOTEQUAL};function W(n,s,a){if(a?(t.texParameteri(n,t.TEXTURE_WRAP_S,A[s.wrapS]),t.texParameteri(n,t.TEXTURE_WRAP_T,A[s.wrapT]),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,A[s.wrapR]),t.texParameteri(n,t.TEXTURE_MAG_FILTER,z[s.magFilter]),t.texParameteri(n,t.TEXTURE_MIN_FILTER,z[s.minFilter])):(t.texParameteri(n,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(n,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),s.wrapS===C&&s.wrapT===C||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,t.TEXTURE_MAG_FILTER,M(s.magFilter)),t.texParameteri(n,t.TEXTURE_MIN_FILTER,M(s.minFilter)),s.minFilter!==P&&s.minFilter!==D&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),s.compareFunction&&(t.texParameteri(n,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(n,t.TEXTURE_COMPARE_FUNC,k[s.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){var _a28=e.get("EXT_texture_filter_anisotropic");if(s.magFilter===P)return;if(s.minFilter!==U&&s.minFilter!==O)return;if(s.type===H&&!1===e.has("OES_texture_float_linear"))return;if(!1===o&&s.type===V&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(t.texParameterf(n,_a28.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy);}}function Z(e,n){var i=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",S));var r=n.source;var s=d.get(r);void 0===s&&(s={},d.set(r,s));var o=function(t){var e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join();}(n);if(o!==e.__cacheKey){void 0===s[o]&&(s[o]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,i=!0),s[o].usedTimes++;var _r57=s[e.__cacheKey];void 0!==_r57&&(s[e.__cacheKey].usedTimes--,0===_r57.usedTimes&&T(n)),e.__cacheKey=o,e.__webglTexture=s[o].texture;}return i;}function J(e,a,l){var c=t.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(c=t.TEXTURE_2D_ARRAY),a.isData3DTexture&&(c=t.TEXTURE_3D);var h=Z(e,a),u=a.source;n.bindTexture(c,e.__webglTexture,t.TEXTURE0+l);var d=i.get(u);if(u.version!==d.__version||!0===h){n.activeTexture(t.TEXTURE0+l);var _e98=Re.getPrimaries(Re.workingColorSpace),_i84=a.colorSpace===zt?null:Re.getPrimaries(a.colorSpace),_p7=a.colorSpace===zt||_e98===_i84?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,a.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,a.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,_p7);var _m4=function(t){return!o&&(t.wrapS!==C||t.wrapT!==C||t.minFilter!==P&&t.minFilter!==D);}(a)&&!1===g(a.image);var _M2=f(a.image,_m4,!1,r.maxTextureSize);_M2=nt(a,_M2);var _S3=g(_M2)||o,_b3=s.convert(a.format,a.colorSpace);var _T3,_E2=s.convert(a.type),_w2=x(a.internalFormat,_b3,_E2,a.colorSpace,a.isVideoTexture);W(c,a,_S3);var _A3=a.mipmaps,_R2=o&&!0!==a.isVideoTexture&&_w2!==at,_L2=void 0===d.__version||!0===h,_I2=y(a,_M2,_S3);if(a.isDepthTexture)_w2=t.DEPTH_COMPONENT,o?_w2=a.type===H?t.DEPTH_COMPONENT32F:a.type===G?t.DEPTH_COMPONENT24:a.type===X?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT16:a.type===H&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),a.format===q&&_w2===t.DEPTH_COMPONENT&&a.type!==B&&a.type!==G&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),a.type=G,_E2=s.convert(a.type)),a.format===Y&&_w2===t.DEPTH_COMPONENT&&(_w2=t.DEPTH_STENCIL,a.type!==X&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),a.type=X,_E2=s.convert(a.type))),_L2&&(_R2?n.texStorage2D(t.TEXTURE_2D,1,_w2,_M2.width,_M2.height):n.texImage2D(t.TEXTURE_2D,0,_w2,_M2.width,_M2.height,0,_b3,_E2,null));else if(a.isDataTexture){if(_A3.length>0&&_S3){_R2&&_L2&&n.texStorage2D(t.TEXTURE_2D,_I2,_w2,_A3[0].width,_A3[0].height);for(var _e99=0,_i85=_A3.length;_e99<_i85;_e99++)_T3=_A3[_e99],_R2?n.texSubImage2D(t.TEXTURE_2D,_e99,0,0,_T3.width,_T3.height,_b3,_E2,_T3.data):n.texImage2D(t.TEXTURE_2D,_e99,_w2,_T3.width,_T3.height,0,_b3,_E2,_T3.data);a.generateMipmaps=!1;}else _R2?(_L2&&n.texStorage2D(t.TEXTURE_2D,_I2,_w2,_M2.width,_M2.height),n.texSubImage2D(t.TEXTURE_2D,0,0,0,_M2.width,_M2.height,_b3,_E2,_M2.data)):n.texImage2D(t.TEXTURE_2D,0,_w2,_M2.width,_M2.height,0,_b3,_E2,_M2.data);}else if(a.isCompressedTexture){if(a.isCompressedArrayTexture){_R2&&_L2&&n.texStorage3D(t.TEXTURE_2D_ARRAY,_I2,_w2,_A3[0].width,_A3[0].height,_M2.depth);for(var _e100=0,_i86=_A3.length;_e100<_i86;_e100++)_T3=_A3[_e100],a.format!==j?null!==_b3?_R2?n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,_e100,0,0,0,_T3.width,_T3.height,_M2.depth,_b3,_T3.data,0,0):n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,_e100,_w2,_T3.width,_T3.height,_M2.depth,0,_T3.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_R2?n.texSubImage3D(t.TEXTURE_2D_ARRAY,_e100,0,0,0,_T3.width,_T3.height,_M2.depth,_b3,_E2,_T3.data):n.texImage3D(t.TEXTURE_2D_ARRAY,_e100,_w2,_T3.width,_T3.height,_M2.depth,0,_b3,_E2,_T3.data);}else{_R2&&_L2&&n.texStorage2D(t.TEXTURE_2D,_I2,_w2,_A3[0].width,_A3[0].height);for(var _e101=0,_i87=_A3.length;_e101<_i87;_e101++)_T3=_A3[_e101],a.format!==j?null!==_b3?_R2?n.compressedTexSubImage2D(t.TEXTURE_2D,_e101,0,0,_T3.width,_T3.height,_b3,_T3.data):n.compressedTexImage2D(t.TEXTURE_2D,_e101,_w2,_T3.width,_T3.height,0,_T3.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_R2?n.texSubImage2D(t.TEXTURE_2D,_e101,0,0,_T3.width,_T3.height,_b3,_E2,_T3.data):n.texImage2D(t.TEXTURE_2D,_e101,_w2,_T3.width,_T3.height,0,_b3,_E2,_T3.data);}}else if(a.isDataArrayTexture)_R2?(_L2&&n.texStorage3D(t.TEXTURE_2D_ARRAY,_I2,_w2,_M2.width,_M2.height,_M2.depth),n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,_M2.width,_M2.height,_M2.depth,_b3,_E2,_M2.data)):n.texImage3D(t.TEXTURE_2D_ARRAY,0,_w2,_M2.width,_M2.height,_M2.depth,0,_b3,_E2,_M2.data);else if(a.isData3DTexture)_R2?(_L2&&n.texStorage3D(t.TEXTURE_3D,_I2,_w2,_M2.width,_M2.height,_M2.depth),n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,_M2.width,_M2.height,_M2.depth,_b3,_E2,_M2.data)):n.texImage3D(t.TEXTURE_3D,0,_w2,_M2.width,_M2.height,_M2.depth,0,_b3,_E2,_M2.data);else if(a.isFramebufferTexture){if(_L2)if(_R2)n.texStorage2D(t.TEXTURE_2D,_I2,_w2,_M2.width,_M2.height);else{var _e102=_M2.width,_i88=_M2.height;for(var _r58=0;_r58<_I2;_r58++)n.texImage2D(t.TEXTURE_2D,_r58,_w2,_e102,_i88,0,_b3,_E2,null),_e102>>=1,_i88>>=1;}}else if(_A3.length>0&&_S3){_R2&&_L2&&n.texStorage2D(t.TEXTURE_2D,_I2,_w2,_A3[0].width,_A3[0].height);for(var _e103=0,_i89=_A3.length;_e103<_i89;_e103++)_T3=_A3[_e103],_R2?n.texSubImage2D(t.TEXTURE_2D,_e103,0,0,_b3,_E2,_T3):n.texImage2D(t.TEXTURE_2D,_e103,_w2,_b3,_E2,_T3);a.generateMipmaps=!1;}else _R2?(_L2&&n.texStorage2D(t.TEXTURE_2D,_I2,_w2,_M2.width,_M2.height),n.texSubImage2D(t.TEXTURE_2D,0,0,0,_b3,_E2,_M2)):n.texImage2D(t.TEXTURE_2D,0,_w2,_b3,_E2,_M2);_(a,_S3)&&v(c),d.__version=u.version,a.onUpdate&&a.onUpdate(a);}e.__version=a.version;}function K(e,r,a,o,c,h){var u=s.convert(a.format,a.colorSpace),d=s.convert(a.type),p=x(a.internalFormat,u,d,a.colorSpace);if(!i.get(r).__hasExternalTextures){var _e104=Math.max(1,r.width>>h),_i90=Math.max(1,r.height>>h);c===t.TEXTURE_3D||c===t.TEXTURE_2D_ARRAY?n.texImage3D(c,h,p,_e104,_i90,r.depth,0,u,d,null):n.texImage2D(c,h,p,_e104,_i90,0,u,d,null);}n.bindFramebuffer(t.FRAMEBUFFER,e),et(r)?l.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,o,c,i.get(a).__webglTexture,0,tt(r)):(c===t.TEXTURE_2D||c>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,o,c,i.get(a).__webglTexture,h),n.bindFramebuffer(t.FRAMEBUFFER,null);}function $(e,n,i){if(t.bindRenderbuffer(t.RENDERBUFFER,e),n.depthBuffer&&!n.stencilBuffer){var _r59=!0===o?t.DEPTH_COMPONENT24:t.DEPTH_COMPONENT16;if(i||et(n)){var _e105=n.depthTexture;_e105&&_e105.isDepthTexture&&(_e105.type===H?_r59=t.DEPTH_COMPONENT32F:_e105.type===G&&(_r59=t.DEPTH_COMPONENT24));var _i91=tt(n);et(n)?l.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,_i91,_r59,n.width,n.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,_i91,_r59,n.width,n.height);}else t.renderbufferStorage(t.RENDERBUFFER,_r59,n.width,n.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e);}else if(n.depthBuffer&&n.stencilBuffer){var _r60=tt(n);i&&!1===et(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,_r60,t.DEPTH24_STENCIL8,n.width,n.height):et(n)?l.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,_r60,t.DEPTH24_STENCIL8,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e);}else{var _e106=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(var _r61=0;_r61<_e106.length;_r61++){var _a29=_e106[_r61],_o17=s.convert(_a29.format,_a29.colorSpace),_c10=s.convert(_a29.type),_h8=x(_a29.internalFormat,_o17,_c10,_a29.colorSpace),_u8=tt(n);i&&!1===et(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,_u8,_h8,n.width,n.height):et(n)?l.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,_u8,_h8,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,_h8,n.width,n.height);}}t.bindRenderbuffer(t.RENDERBUFFER,null);}function Q(e){var r=i.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),w(r.depthTexture,0);var s=i.get(r.depthTexture).__webglTexture,a=tt(r);if(r.depthTexture.format===q)et(r)?l.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==Y)throw new Error("Unknown depthTexture format");et(r)?l.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0);}}(r.__webglFramebuffer,e);}else if(s){r.__webglDepthbuffer=[];for(var _i92=0;_i92<6;_i92++)n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[_i92]),r.__webglDepthbuffer[_i92]=t.createRenderbuffer(),$(r.__webglDepthbuffer[_i92],e,!1);}else n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),$(r.__webglDepthbuffer,e,!1);n.bindFramebuffer(t.FRAMEBUFFER,null);}function tt(t){return Math.min(r.maxSamples,t.samples);}function et(t){var n=i.get(t);return o&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture;}function nt(t,n){var i=t.colorSpace,r=t.format,s=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===Kt||i!==Ht&&i!==zt&&(Re.getTransfer(i)===Xt?!1===o?!0===e.has("EXT_sRGB")&&r===j?(t.format=Kt,t.minFilter=D,t.generateMipmaps=!1):n=Ie.sRGBToLinear(n):r===j&&s===F||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),n;}this.allocateTextureUnit=function(){var t=E;return t>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+r.maxTextures),E+=1,t;},this.resetTextureUnits=function(){E=0;},this.setTexture2D=w,this.setTexture2DArray=function(e,r){var s=i.get(e);e.version>0&&s.__version!==e.version?J(s,e,r):n.bindTexture(t.TEXTURE_2D_ARRAY,s.__webglTexture,t.TEXTURE0+r);},this.setTexture3D=function(e,r){var s=i.get(e);e.version>0&&s.__version!==e.version?J(s,e,r):n.bindTexture(t.TEXTURE_3D,s.__webglTexture,t.TEXTURE0+r);},this.setTextureCube=function(e,a){var l=i.get(e);e.version>0&&l.__version!==e.version?function(e,a,l){if(6!==a.image.length)return;var c=Z(e,a),h=a.source;n.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+l);var u=i.get(h);if(h.version!==u.__version||!0===c){n.activeTexture(t.TEXTURE0+l);var _e107=Re.getPrimaries(Re.workingColorSpace),_i93=a.colorSpace===zt?null:Re.getPrimaries(a.colorSpace),_d8=a.colorSpace===zt||_e107===_i93?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,a.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,a.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,_d8);var _p8=a.isCompressedTexture||a.image[0].isCompressedTexture,_m5=a.image[0]&&a.image[0].isDataTexture,_M3=[];for(var _t131=0;_t131<6;_t131++)_M3[_t131]=_p8||_m5?_m5?a.image[_t131].image:a.image[_t131]:f(a.image[_t131],!1,!0,r.maxCubemapSize),_M3[_t131]=nt(a,_M3[_t131]);var _S4=_M3[0],_b4=g(_S4)||o,_T4=s.convert(a.format,a.colorSpace),_E3=s.convert(a.type),_w3=x(a.internalFormat,_T4,_E3,a.colorSpace),_A4=o&&!0!==a.isVideoTexture,_R3=void 0===u.__version||!0===c;var _C2,_L3=y(a,_S4,_b4);if(W(t.TEXTURE_CUBE_MAP,a,_b4),_p8){_A4&&_R3&&n.texStorage2D(t.TEXTURE_CUBE_MAP,_L3,_w3,_S4.width,_S4.height);for(var _e108=0;_e108<6;_e108++){_C2=_M3[_e108].mipmaps;for(var _i94=0;_i94<_C2.length;_i94++){var _r62=_C2[_i94];a.format!==j?null!==_T4?_A4?n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+_e108,_i94,0,0,_r62.width,_r62.height,_T4,_r62.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+_e108,_i94,_w3,_r62.width,_r62.height,0,_r62.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_A4?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+_e108,_i94,0,0,_r62.width,_r62.height,_T4,_E3,_r62.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+_e108,_i94,_w3,_r62.width,_r62.height,0,_T4,_E3,_r62.data);}}}else{_C2=a.mipmaps,_A4&&_R3&&(_C2.length>0&&_L3++,n.texStorage2D(t.TEXTURE_CUBE_MAP,_L3,_w3,_M3[0].width,_M3[0].height));for(var _e109=0;_e109<6;_e109++)if(_m5){_A4?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+_e109,0,0,0,_M3[_e109].width,_M3[_e109].height,_T4,_E3,_M3[_e109].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+_e109,0,_w3,_M3[_e109].width,_M3[_e109].height,0,_T4,_E3,_M3[_e109].data);for(var _i95=0;_i95<_C2.length;_i95++){var _r63=_C2[_i95].image[_e109].image;_A4?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+_e109,_i95+1,0,0,_r63.width,_r63.height,_T4,_E3,_r63.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+_e109,_i95+1,_w3,_r63.width,_r63.height,0,_T4,_E3,_r63.data);}}else{_A4?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+_e109,0,0,0,_T4,_E3,_M3[_e109]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+_e109,0,_w3,_T4,_E3,_M3[_e109]);for(var _i96=0;_i96<_C2.length;_i96++){var _r64=_C2[_i96];_A4?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+_e109,_i96+1,0,0,_T4,_E3,_r64.image[_e109]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+_e109,_i96+1,_w3,_T4,_E3,_r64.image[_e109]);}}}_(a,_b4)&&v(t.TEXTURE_CUBE_MAP),u.__version=h.version,a.onUpdate&&a.onUpdate(a);}e.__version=a.version;}(l,e,a):n.bindTexture(t.TEXTURE_CUBE_MAP,l.__webglTexture,t.TEXTURE0+a);},this.rebindTextures=function(e,n,r){var s=i.get(e);void 0!==n&&K(s.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==r&&Q(e);},this.setupRenderTarget=function(e){var l=e.texture,c=i.get(e),h=i.get(l);e.addEventListener("dispose",b),!0!==e.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=t.createTexture()),h.__version=l.version,a.memory.textures++);var u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=g(e)||o;if(u){c.__webglFramebuffer=[];for(var _e110=0;_e110<6;_e110++)if(o&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer[_e110]=[];for(var _n97=0;_n97<l.mipmaps.length;_n97++)c.__webglFramebuffer[_e110][_n97]=t.createFramebuffer();}else c.__webglFramebuffer[_e110]=t.createFramebuffer();}else{if(o&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer=[];for(var _e111=0;_e111<l.mipmaps.length;_e111++)c.__webglFramebuffer[_e111]=t.createFramebuffer();}else c.__webglFramebuffer=t.createFramebuffer();if(d)if(r.drawBuffers){var _n98=e.texture;for(var _e112=0,_r65=_n98.length;_e112<_r65;_e112++){var _r66=i.get(_n98[_e112]);void 0===_r66.__webglTexture&&(_r66.__webglTexture=t.createTexture(),a.memory.textures++);}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&e.samples>0&&!1===et(e)){var _i97=d?l:[l];c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(var _n99=0;_n99<_i97.length;_n99++){var _r67=_i97[_n99];c.__webglColorRenderbuffer[_n99]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,c.__webglColorRenderbuffer[_n99]);var _a30=s.convert(_r67.format,_r67.colorSpace),_o18=s.convert(_r67.type),_l9=x(_r67.internalFormat,_a30,_o18,_r67.colorSpace,!0===e.isXRRenderTarget),_h9=tt(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,_h9,_l9,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+_n99,t.RENDERBUFFER,c.__webglColorRenderbuffer[_n99]);}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),$(c.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null);}}if(u){n.bindTexture(t.TEXTURE_CUBE_MAP,h.__webglTexture),W(t.TEXTURE_CUBE_MAP,l,p);for(var _n100=0;_n100<6;_n100++)if(o&&l.mipmaps&&l.mipmaps.length>0)for(var _i98=0;_i98<l.mipmaps.length;_i98++)K(c.__webglFramebuffer[_n100][_i98],e,l,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+_n100,_i98);else K(c.__webglFramebuffer[_n100],e,l,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+_n100,0);_(l,p)&&v(t.TEXTURE_CUBE_MAP),n.unbindTexture();}else if(d){var _r68=e.texture;for(var _s35=0,_a31=_r68.length;_s35<_a31;_s35++){var _a32=_r68[_s35],_o19=i.get(_a32);n.bindTexture(t.TEXTURE_2D,_o19.__webglTexture),W(t.TEXTURE_2D,_a32,p),K(c.__webglFramebuffer,e,_a32,t.COLOR_ATTACHMENT0+_s35,t.TEXTURE_2D,0),_(_a32,p)&&v(t.TEXTURE_2D);}n.unbindTexture();}else{var _i99=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(o?_i99=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(_i99,h.__webglTexture),W(_i99,l,p),o&&l.mipmaps&&l.mipmaps.length>0)for(var _n101=0;_n101<l.mipmaps.length;_n101++)K(c.__webglFramebuffer[_n101],e,l,t.COLOR_ATTACHMENT0,_i99,_n101);else K(c.__webglFramebuffer,e,l,t.COLOR_ATTACHMENT0,_i99,0);_(l,p)&&v(_i99),n.unbindTexture();}e.depthBuffer&&Q(e);},this.updateRenderTargetMipmap=function(e){var r=g(e)||o,s=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(var _a33=0,_o20=s.length;_a33<_o20;_a33++){var _o21=s[_a33];if(_(_o21,r)){var _r69=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,_s36=i.get(_o21).__webglTexture;n.bindTexture(_r69,_s36),v(_r69),n.unbindTexture();}}},this.updateMultisampleRenderTarget=function(e){if(o&&e.samples>0&&!1===et(e)){var _r70=e.isWebGLMultipleRenderTargets?e.texture:[e.texture],_s37=e.width,_a34=e.height;var _o22=t.COLOR_BUFFER_BIT;var _l10=[],_h10=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,_u9=i.get(e),_d9=!0===e.isWebGLMultipleRenderTargets;if(_d9)for(var _e113=0;_e113<_r70.length;_e113++)n.bindFramebuffer(t.FRAMEBUFFER,_u9.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+_e113,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,_u9.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+_e113,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,_u9.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,_u9.__webglFramebuffer);for(var _n102=0;_n102<_r70.length;_n102++){_l10.push(t.COLOR_ATTACHMENT0+_n102),e.depthBuffer&&_l10.push(_h10);var _p9=void 0!==_u9.__ignoreDepthValues&&_u9.__ignoreDepthValues;if(!1===_p9&&(e.depthBuffer&&(_o22|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&(_o22|=t.STENCIL_BUFFER_BIT)),_d9&&t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,_u9.__webglColorRenderbuffer[_n102]),!0===_p9&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[_h10]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[_h10])),_d9){var _e114=i.get(_r70[_n102]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,_e114,0);}t.blitFramebuffer(0,0,_s37,_a34,0,0,_s37,_a34,_o22,t.NEAREST),c&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,_l10);}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),_d9)for(var _e115=0;_e115<_r70.length;_e115++){n.bindFramebuffer(t.FRAMEBUFFER,_u9.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+_e115,t.RENDERBUFFER,_u9.__webglColorRenderbuffer[_e115]);var _s38=i.get(_r70[_e115]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,_u9.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+_e115,t.TEXTURE_2D,_s38,0);}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,_u9.__webglMultisampledFramebuffer);}},this.setupDepthRenderbuffer=Q,this.setupFrameBufferTexture=K,this.useMultisampledRTT=et;}function ja(t,e,n){var i=n.isWebGL2;return{convert:function convert(n){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var s;var a=Re.getTransfer(r);if(n===F)return t.UNSIGNED_BYTE;if(n===k)return t.UNSIGNED_SHORT_4_4_4_4;if(n===W)return t.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return t.BYTE;if(1011===n)return t.SHORT;if(n===B)return t.UNSIGNED_SHORT;if(n===z)return t.INT;if(n===G)return t.UNSIGNED_INT;if(n===H)return t.FLOAT;if(n===V)return i?t.HALF_FLOAT:(s=e.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===n)return t.ALPHA;if(n===j)return t.RGBA;if(1024===n)return t.LUMINANCE;if(1025===n)return t.LUMINANCE_ALPHA;if(n===q)return t.DEPTH_COMPONENT;if(n===Y)return t.DEPTH_STENCIL;if(n===Kt)return s=e.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(1028===n)return t.RED;if(n===Z)return t.RED_INTEGER;if(1030===n)return t.RG;if(n===J)return t.RG_INTEGER;if(n===K)return t.RGBA_INTEGER;if(n===$||n===Q||n===tt||n===et)if(a===Xt){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(n===$)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Q)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===tt)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===et)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(n===$)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Q)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===tt)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===et)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT;}if(n===nt||n===it||n===rt||n===st){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(n===nt)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===it)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===rt)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===st)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;}if(n===at)return s=e.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===ot||n===lt){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(n===ot)return a===Xt?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===lt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC;}if(n===ct||n===ht||n===ut||n===dt||n===pt||n===mt||n===ft||n===gt||n===_t||n===vt||n===xt||n===yt||n===Mt||n===St){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(n===ct)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===ht)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===ut)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===dt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===pt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===mt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===ft)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===gt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===_t)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===vt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===xt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===yt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Mt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===St)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR;}if(n===bt||n===Tt||n===Et){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(n===bt)return a===Xt?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Tt)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Et)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT;}if(36283===n||n===wt||n===At||n===Rt){if(s=e.get("EXT_texture_compression_rgtc"),null===s)return null;if(n===bt)return s.COMPRESSED_RED_RGTC1_EXT;if(n===wt)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===At)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Rt)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;}return n===X?i?t.UNSIGNED_INT_24_8:(s=e.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==t[n]?t[n]:null;}};}var qa=/*#__PURE__*/function(_sr){_inherits(qa,_sr);var _super26=_createSuper(qa);function qa(){var _this23;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];_classCallCheck(this,qa);_this23=_super26.call(this),_this23.isArrayCamera=!0,_this23.cameras=t;return _this23;}return _createClass(qa);}(sr);var Ya=/*#__PURE__*/function(_jn4){_inherits(Ya,_jn4);var _super27=_createSuper(Ya);function Ya(){var _this24;_classCallCheck(this,Ya);_this24=_super27.call(this),_this24.isGroup=!0,_this24.type="Group";return _this24;}return _createClass(Ya);}(jn);var Za={type:"move"};var Ja=/*#__PURE__*/function(){function Ja(){_classCallCheck(this,Ja);this._targetRay=null,this._grip=null,this._hand=null;}_createClass(Ja,[{key:"getHandSpace",value:function getHandSpace(){return null===this._hand&&(this._hand=new Ya(),this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand;}},{key:"getTargetRaySpace",value:function getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Ya(),this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new We(),this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new We()),this._targetRay;}},{key:"getGripSpace",value:function getGripSpace(){return null===this._grip&&(this._grip=new Ya(),this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new We(),this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new We()),this._grip;}},{key:"dispatchEvent",value:function dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this;}},{key:"connect",value:function connect(t){if(t&&t.hand){var _e116=this._hand;if(_e116){var _iterator4=_createForOfIteratorHelper(t.hand.values()),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var _n103=_step4.value;this._getHandJoint(_e116,_n103);}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}}}return this.dispatchEvent({type:"connected",data:t}),this;}},{key:"disconnect",value:function disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this;}},{key:"update",value:function update(t,e,n){var i=null,r=null,s=null;var a=this._targetRay,o=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){s=!0;var _iterator5=_createForOfIteratorHelper(t.hand.values()),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var _i101=_step5.value;var _t132=e.getJointPose(_i101,n),_r72=this._getHandJoint(l,_i101);null!==_t132&&(_r72.matrix.fromArray(_t132.transform.matrix),_r72.matrix.decompose(_r72.position,_r72.rotation,_r72.scale),_r72.matrixWorldNeedsUpdate=!0,_r72.jointRadius=_t132.radius),_r72.visible=null!==_t132;}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}var _i100=l.joints["index-finger-tip"],_r71=l.joints["thumb-tip"],_a35=_i100.position.distanceTo(_r71.position),_o23=.02,_c11=.005;l.inputState.pinching&&_a35>_o23+_c11?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&_a35<=_o23-_c11&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}));}else null!==o&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(i=e.getPose(t.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Za)));}return null!==a&&(a.visible=null!==i),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this;}},{key:"_getHandJoint",value:function _getHandJoint(t,e){if(void 0===t.joints[e.jointName]){var _n104=new Ya();_n104.matrixAutoUpdate=!1,_n104.visible=!1,t.joints[e.jointName]=_n104,t.add(_n104);}return t.joints[e.jointName];}}]);return Ja;}();var Ka=/*#__PURE__*/function(_te6){_inherits(Ka,_te6);var _super28=_createSuper(Ka);function Ka(t,e){var _this25;_classCallCheck(this,Ka);_this25=_super28.call(this);var n=_assertThisInitialized(_this25);var i=null,r=1,s=null,a="local-floor",o=1,l=null,c=null,h=null,u=null,d=null,p=null;var m=e.getContextAttributes();var f=null,g=null;var _=[],v=[],x=new me();var y=null;var M=new sr();M.layers.enable(1),M.viewport=new Be();var S=new sr();S.layers.enable(2),S.viewport=new Be();var b=[M,S],T=new qa();T.layers.enable(1),T.layers.enable(2);var E=null,w=null;function A(t){var e=v.indexOf(t.inputSource);if(-1===e)return;var n=_[e];void 0!==n&&(n.update(t.inputSource,t.frame,l||s),n.dispatchEvent({type:t.type,data:t.inputSource}));}function R(){i.removeEventListener("select",A),i.removeEventListener("selectstart",A),i.removeEventListener("selectend",A),i.removeEventListener("squeeze",A),i.removeEventListener("squeezestart",A),i.removeEventListener("squeezeend",A),i.removeEventListener("end",R),i.removeEventListener("inputsourceschange",C);for(var _t133=0;_t133<_.length;_t133++){var _e117=v[_t133];null!==_e117&&(v[_t133]=null,_[_t133].disconnect(_e117));}E=null,w=null,t.setRenderTarget(f),d=null,u=null,h=null,i=null,g=null,D.stop(),n.isPresenting=!1,t.setPixelRatio(y),t.setSize(x.width,x.height,!1),n.dispatchEvent({type:"sessionend"});}function C(t){for(var _e118=0;_e118<t.removed.length;_e118++){var _n105=t.removed[_e118],_i102=v.indexOf(_n105);_i102>=0&&(v[_i102]=null,_[_i102].disconnect(_n105));}for(var _e119=0;_e119<t.added.length;_e119++){var _n106=t.added[_e119];var _i103=v.indexOf(_n106);if(-1===_i103){for(var _t134=0;_t134<_.length;_t134++){if(_t134>=v.length){v.push(_n106),_i103=_t134;break;}if(null===v[_t134]){v[_t134]=_n106,_i103=_t134;break;}}if(-1===_i103)break;}var _r73=_[_i103];_r73&&_r73.connect(_n106);}}_this25.cameraAutoUpdate=!0,_this25.enabled=!1,_this25.isPresenting=!1,_this25.getController=function(t){var e=_[t];return void 0===e&&(e=new Ja(),_[t]=e),e.getTargetRaySpace();},_this25.getControllerGrip=function(t){var e=_[t];return void 0===e&&(e=new Ja(),_[t]=e),e.getGripSpace();},_this25.getHand=function(t){var e=_[t];return void 0===e&&(e=new Ja(),_[t]=e),e.getHandSpace();},_this25.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.");},_this25.setReferenceSpaceType=function(t){a=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.");},_this25.getReferenceSpace=function(){return l||s;},_this25.setReferenceSpace=function(t){l=t;},_this25.getBaseLayer=function(){return null!==u?u:d;},_this25.getBinding=function(){return h;},_this25.getFrame=function(){return p;},_this25.getSession=function(){return i;},_this25.setSession=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(c){var _n107,_n108,_s39,_a36,_o24;return _regeneratorRuntime().wrap(function _callee$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:if(!(i=c,null!==i)){_context7.next=36;break;}f=t.getRenderTarget();i.addEventListener("select",A);i.addEventListener("selectstart",A);i.addEventListener("selectend",A);i.addEventListener("squeeze",A);i.addEventListener("squeezestart",A);i.addEventListener("squeezeend",A);i.addEventListener("end",R);i.addEventListener("inputsourceschange",C);_context7.t0=!0!==m.xrCompatible;if(!_context7.t0){_context7.next=14;break;}_context7.next=14;return e.makeXRCompatible();case 14:y=t.getPixelRatio();t.getSize(x);if(!(void 0===i.renderState.layers||!1===t.capabilities.isWebGL2)){_context7.next=21;break;}_n107={antialias:void 0!==i.renderState.layers||m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,e,_n107),i.updateRenderState({baseLayer:d}),t.setPixelRatio(1),t.setSize(d.framebufferWidth,d.framebufferHeight,!1),g=new Ge(d.framebufferWidth,d.framebufferHeight,{format:j,type:F,colorSpace:t.outputColorSpace,stencilBuffer:m.stencil});_context7.next=26;break;case 21:_n108=null,_s39=null,_a36=null;m.depth&&(_a36=m.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,_n108=m.stencil?Y:q,_s39=m.stencil?X:G);_o24={colorFormat:e.RGBA8,depthFormat:_a36,scaleFactor:r};h=new XRWebGLBinding(i,e),u=h.createProjectionLayer(_o24),i.updateRenderState({layers:[u]}),t.setPixelRatio(1),t.setSize(u.textureWidth,u.textureHeight,!1),g=new Ge(u.textureWidth,u.textureHeight,{format:j,type:F,depthTexture:new ns(u.textureWidth,u.textureHeight,_s39,void 0,void 0,void 0,void 0,void 0,void 0,_n108),stencilBuffer:m.stencil,colorSpace:t.outputColorSpace,samples:m.antialias?4:0});t.properties.get(g).__ignoreDepthValues=u.ignoreDepthValues;case 26:g.isXRRenderTarget=!0;this.setFoveation(o);l=null;_context7.next=31;return i.requestReferenceSpace(a);case 31:s=_context7.sent;D.setContext(i);D.start();n.isPresenting=!0;n.dispatchEvent({type:"sessionstart"});case 36:case"end":return _context7.stop();}},_callee,this);}));return function(_x4){return _ref2.apply(this,arguments);};}(),_this25.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode;};var L=new We(),P=new We();function I(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert();}_this25.updateCamera=function(t){if(null===i)return;T.near=S.near=M.near=t.near,T.far=S.far=M.far=t.far,E===T.near&&w===T.far||(i.updateRenderState({depthNear:T.near,depthFar:T.far}),E=T.near,w=T.far);var e=t.parent,n=T.cameras;I(T,e);for(var _t135=0;_t135<n.length;_t135++)I(n[_t135],e);2===n.length?function(t,e,n){L.setFromMatrixPosition(e.matrixWorld),P.setFromMatrixPosition(n.matrixWorld);var i=L.distanceTo(P),r=e.projectionMatrix.elements,s=n.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=a*h,p=a*u,m=i/(-h+u),f=m*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(f),t.translateZ(m),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();var g=a+m,_=o+m,v=d-f,x=p+(i-f),y=l*o/_*g,M=c*o/_*g;t.projectionMatrix.makePerspective(v,x,y,M,g,_),t.projectionMatrixInverse.copy(t.projectionMatrix).invert();}(T,M,S):T.projectionMatrix.copy(M.projectionMatrix),function(t,e,n){null===n?t.matrix.copy(e.matrixWorld):(t.matrix.copy(n.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld));t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*re*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1);}(t,T,e);},_this25.getCamera=function(){return T;},_this25.getFoveation=function(){if(null!==u||null!==d)return o;},_this25.setFoveation=function(t){o=t,null!==u&&(u.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t);};var U=null;var D=new _r();D.setAnimationLoop(function(e,i){if(c=i.getViewerPose(l||s),p=i,null!==c){var _e120=c.views;null!==d&&(t.setRenderTargetFramebuffer(g,d.framebuffer),t.setRenderTarget(g));var _n109=!1;_e120.length!==T.cameras.length&&(T.cameras.length=0,_n109=!0);for(var _i104=0;_i104<_e120.length;_i104++){var _r74=_e120[_i104];var _s40=null;if(null!==d)_s40=d.getViewport(_r74);else{var _e121=h.getViewSubImage(u,_r74);_s40=_e121.viewport,0===_i104&&(t.setRenderTargetTextures(g,_e121.colorTexture,u.ignoreDepthValues?void 0:_e121.depthStencilTexture),t.setRenderTarget(g));}var _a37=b[_i104];void 0===_a37&&(_a37=new sr(),_a37.layers.enable(_i104),_a37.viewport=new Be(),b[_i104]=_a37),_a37.matrix.fromArray(_r74.transform.matrix),_a37.matrix.decompose(_a37.position,_a37.quaternion,_a37.scale),_a37.projectionMatrix.fromArray(_r74.projectionMatrix),_a37.projectionMatrixInverse.copy(_a37.projectionMatrix).invert(),_a37.viewport.set(_s40.x,_s40.y,_s40.width,_s40.height),0===_i104&&(T.matrix.copy(_a37.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),!0===_n109&&T.cameras.push(_a37);}}for(var _t136=0;_t136<_.length;_t136++){var _e122=v[_t136],_n110=_[_t136];null!==_e122&&void 0!==_n110&&_n110.update(_e122,i,l||s);}U&&U(e,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null;}),_this25.setAnimationLoop=function(t){U=t;},_this25.dispose=function(){};return _this25;}return _createClass(Ka);}(te);function $a(t,e){function n(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix);}function i(i,r){i.opacity.value=r.opacity,r.color&&i.diffuse.value.copy(r.color),r.emissive&&i.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(i.map.value=r.map,n(r.map,i.mapTransform)),r.alphaMap&&(i.alphaMap.value=r.alphaMap,n(r.alphaMap,i.alphaMapTransform)),r.bumpMap&&(i.bumpMap.value=r.bumpMap,n(r.bumpMap,i.bumpMapTransform),i.bumpScale.value=r.bumpScale,r.side===a&&(i.bumpScale.value*=-1)),r.normalMap&&(i.normalMap.value=r.normalMap,n(r.normalMap,i.normalMapTransform),i.normalScale.value.copy(r.normalScale),r.side===a&&i.normalScale.value.negate()),r.displacementMap&&(i.displacementMap.value=r.displacementMap,n(r.displacementMap,i.displacementMapTransform),i.displacementScale.value=r.displacementScale,i.displacementBias.value=r.displacementBias),r.emissiveMap&&(i.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,i.emissiveMapTransform)),r.specularMap&&(i.specularMap.value=r.specularMap,n(r.specularMap,i.specularMapTransform)),r.alphaTest>0&&(i.alphaTest.value=r.alphaTest);var s=e.get(r).envMap;if(s&&(i.envMap.value=s,i.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,i.reflectivity.value=r.reflectivity,i.ior.value=r.ior,i.refractionRatio.value=r.refractionRatio),r.lightMap){i.lightMap.value=r.lightMap;var _e123=!0===t._useLegacyLights?Math.PI:1;i.lightMapIntensity.value=r.lightMapIntensity*_e123,n(r.lightMap,i.lightMapTransform);}r.aoMap&&(i.aoMap.value=r.aoMap,i.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,i.aoMapTransform));}return{refreshFogUniforms:function refreshFogUniforms(e,n){n.color.getRGB(e.fogColor.value,er(t)),n.isFog?(e.fogNear.value=n.near,e.fogFar.value=n.far):n.isFogExp2&&(e.fogDensity.value=n.density);},refreshMaterialUniforms:function refreshMaterialUniforms(t,r,s,o,l){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(t,r):r.isMeshToonMaterial?(i(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);}(t,r)):r.isMeshPhongMaterial?(i(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4);}(t,r)):r.isMeshStandardMaterial?(i(t,r),function(t,i){t.metalness.value=i.metalness,i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap,n(i.metalnessMap,t.metalnessMapTransform));t.roughness.value=i.roughness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap,n(i.roughnessMap,t.roughnessMapTransform));var r=e.get(i).envMap;r&&(t.envMapIntensity.value=i.envMapIntensity);}(t,r),r.isMeshPhysicalMaterial&&function(t,e,i){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,n(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,n(e.sheenRoughnessMap,t.sheenRoughnessMapTransform)));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,n(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,n(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,n(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),e.side===a&&t.clearcoatNormalScale.value.negate()));e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,n(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,n(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform)));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,n(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,n(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,n(e.anisotropyMap,t.anisotropyMapTransform)));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,n(e.specularColorMap,t.specularColorMapTransform));e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,n(e.specularIntensityMap,t.specularIntensityMapTransform));}(t,r,l)):r.isMeshMatcapMaterial?(i(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap);}(t,r)):r.isMeshDepthMaterial?i(t,r):r.isMeshDistanceMaterial?(i(t,r),function(t,n){var i=e.get(n).light;t.referencePosition.value.setFromMatrixPosition(i.matrixWorld),t.nearDistance.value=i.shadow.camera.near,t.farDistance.value=i.shadow.camera.far;}(t,r)):r.isMeshNormalMaterial?i(t,r):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform));}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale;}(t,r)):r.isPointsMaterial?function(t,e,i,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*r,e.map&&(t.map.value=e.map,n(e.map,t.uvTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);}(t,r,s,o):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1);}};}function Qa(t,e,n,i){var r={},s={},a=[];var o=n.isWebGL2?t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(t,e,n,i){var r=t.value,s=e+"_"+n;if(void 0===i[s])return i[s]="number"==typeof r||"boolean"==typeof r?r:r.clone(),!0;{var _t137=i[s];if("number"==typeof r||"boolean"==typeof r){if(_t137!==r)return i[s]=r,!0;}else if(!1===_t137.equals(r))return _t137.copy(r),!0;}return!1;}function c(t){var e={boundary:0,storage:0};return"number"==typeof t||"boolean"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e;}function h(e){var n=e.target;n.removeEventListener("dispose",h);var i=a.indexOf(n.__bindingPointIndex);a.splice(i,1),t.deleteBuffer(r[n.id]),delete r[n.id],delete s[n.id];}return{bind:function bind(t,e){var n=e.program;i.uniformBlockBinding(t,n);},update:function update(n,u){var d=r[n.id];void 0===d&&(!function(t){var e=t.uniforms;var n=0;var i=16;for(var _t138=0,_r75=e.length;_t138<_r75;_t138++){var _r76=Array.isArray(e[_t138])?e[_t138]:[e[_t138]];for(var _t139=0,_e124=_r76.length;_t139<_e124;_t139++){var _e125=_r76[_t139],_s41=Array.isArray(_e125.value)?_e125.value:[_e125.value];for(var _t140=0,_r77=_s41.length;_t140<_r77;_t140++){var _r78=c(_s41[_t140]),_a38=n%i;0!==_a38&&i-_a38<_r78.boundary&&(n+=i-_a38),_e125.__data=new Float32Array(_r78.storage/Float32Array.BYTES_PER_ELEMENT),_e125.__offset=n,n+=_r78.storage;}}}var r=n%i;r>0&&(n+=i-r);t.__size=n,t.__cache={};}(n),d=function(e){var n=function(){for(var _t141=0;_t141<o;_t141++)if(-1===a.indexOf(_t141))return a.push(_t141),_t141;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0;}();e.__bindingPointIndex=n;var i=t.createBuffer(),r=e.__size,s=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,i),t.bufferData(t.UNIFORM_BUFFER,r,s),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,n,i),i;}(n),r[n.id]=d,n.addEventListener("dispose",h));var p=u.program;i.updateUBOMapping(n,p);var m=e.render.frame;s[n.id]!==m&&(!function(e){var n=r[e.id],i=e.uniforms,s=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,n);for(var _e126=0,_n111=i.length;_e126<_n111;_e126++){var _n112=Array.isArray(i[_e126])?i[_e126]:[i[_e126]];for(var _i105=0,_r79=_n112.length;_i105<_r79;_i105++){var _r80=_n112[_i105];if(!0===l(_r80,_e126,_i105,s)){var _e127=_r80.__offset,_n113=Array.isArray(_r80.value)?_r80.value:[_r80.value];var _i106=0;for(var _s42=0;_s42<_n113.length;_s42++){var _a39=_n113[_s42],_o25=c(_a39);"number"==typeof _a39||"boolean"==typeof _a39?(_r80.__data[0]=_a39,t.bufferSubData(t.UNIFORM_BUFFER,_e127+_i106,_r80.__data)):_a39.isMatrix3?(_r80.__data[0]=_a39.elements[0],_r80.__data[1]=_a39.elements[1],_r80.__data[2]=_a39.elements[2],_r80.__data[3]=0,_r80.__data[4]=_a39.elements[3],_r80.__data[5]=_a39.elements[4],_r80.__data[6]=_a39.elements[5],_r80.__data[7]=0,_r80.__data[8]=_a39.elements[6],_r80.__data[9]=_a39.elements[7],_r80.__data[10]=_a39.elements[8],_r80.__data[11]=0):(_a39.toArray(_r80.__data,_i106),_i106+=_o25.storage/Float32Array.BYTES_PER_ELEMENT);}t.bufferSubData(t.UNIFORM_BUFFER,_e127,_r80.__data);}}}t.bindBuffer(t.UNIFORM_BUFFER,null);}(n),s[n.id]=m);},dispose:function dispose(){for(var _e128 in r)t.deleteBuffer(r[_e128]);a=[],r={},s={};}};}var to=/*#__PURE__*/function(){function to(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,to);var _t$canvas=t.canvas,n=_t$canvas===void 0?Me():_t$canvas,_t$context=t.context,i=_t$context===void 0?null:_t$context,_t$depth=t.depth,r=_t$depth===void 0?!0:_t$depth,_t$stencil=t.stencil,o=_t$stencil===void 0?!0:_t$stencil,_t$alpha=t.alpha,l=_t$alpha===void 0?!1:_t$alpha,_t$antialias=t.antialias,c=_t$antialias===void 0?!1:_t$antialias,_t$premultipliedAlpha=t.premultipliedAlpha,h=_t$premultipliedAlpha===void 0?!0:_t$premultipliedAlpha,_t$preserveDrawingBuf=t.preserveDrawingBuffer,u=_t$preserveDrawingBuf===void 0?!1:_t$preserveDrawingBuf,_t$powerPreference=t.powerPreference,d=_t$powerPreference===void 0?"default":_t$powerPreference,_t$failIfMajorPerform=t.failIfMajorPerformanceCaveat,m=_t$failIfMajorPerform===void 0?!1:_t$failIfMajorPerform;var f;this.isWebGLRenderer=!0,f=null!==i?i.getContextAttributes().alpha:l;var g=new Uint32Array(4),_=new Int32Array(4);var v=null,x=null;var y=[],M=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Gt,this._useLegacyLights=!1,this.toneMapping=p,this.toneMappingExposure=1;var S=this;var b=!1,T=0,E=0,w=null,A=-1,R=null;var C=new Be(),L=new Be();var P=null;var I=new ci(0);var U=0,D=n.width,N=n.height,z=1,q=null,Y=null;var $=new Be(0,0,D,N),Q=new Be(0,0,D,N);var tt=!1;var et=new gr();var nt=!1,it=!1,rt=null;var st=new Mn(),at=new me(),ot=new We(),lt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ct(){return null===w?z:1;}var ht,ut,dt,pt,mt,ft,gt,_t,vt,xt,yt,Mt,St,bt,Tt,Et,wt,At,Rt,Ct,Lt,Pt,It,Ut,Dt=i;function Nt(t,e){for(var _i107=0;_i107<t.length;_i107++){var _r81=t[_i107],_s43=n.getContext(_r81,e);if(null!==_s43)return _s43;}return null;}try{var _t142={alpha:!0,depth:r,stencil:o,antialias:c,premultipliedAlpha:h,preserveDrawingBuffer:u,powerPreference:d,failIfMajorPerformanceCaveat:m};if("setAttribute"in n&&n.setAttribute("data-engine","three.js r".concat(e)),n.addEventListener("webglcontextlost",Bt,!1),n.addEventListener("webglcontextrestored",zt,!1),n.addEventListener("webglcontextcreationerror",Vt,!1),null===Dt){var _e129=["webgl2","webgl","experimental-webgl"];if(!0===S.isWebGL1Renderer&&_e129.shift(),Dt=Nt(_e129,_t142),null===Dt)throw Nt(_e129)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");}"undefined"!=typeof WebGLRenderingContext&&Dt instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===Dt.getShaderPrecisionFormat&&(Dt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1};});}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t;}function Ot(){ht=new Yr(Dt),ut=new Ar(Dt,ht,t),ht.init(ut),Pt=new ja(Dt,ht,ut),dt=new Wa(Dt,ht,ut),pt=new Kr(Dt),mt=new La(),ft=new Xa(Dt,ht,dt,mt,ut,Pt,pt),gt=new Cr(S),_t=new qr(S),vt=new vr(Dt,ut),It=new Er(Dt,ht,vt,ut),xt=new Zr(Dt,vt,pt,It),yt=new es(Dt,xt,vt,pt),Rt=new ts(Dt,ut,ft),Et=new Rr(mt),Mt=new Ca(S,gt,_t,ht,ut,It,Et),St=new $a(S,mt),bt=new Da(),Tt=new Ga(ht,ut),At=new Tr(S,gt,_t,dt,yt,f,h),wt=new ka(S,yt,ut),Ut=new Qa(Dt,pt,ut,dt),Ct=new wr(Dt,ht,pt,ut),Lt=new Jr(Dt,ht,pt,ut),pt.programs=Mt.programs,S.capabilities=ut,S.extensions=ht,S.properties=mt,S.renderLists=bt,S.shadowMap=wt,S.state=dt,S.info=pt;}Ot();var Ft=new Ka(S,Dt);function Bt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0;}function zt(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;var t=pt.autoReset,e=wt.enabled,n=wt.autoUpdate,i=wt.needsUpdate,r=wt.type;Ot(),pt.autoReset=t,wt.enabled=e,wt.autoUpdate=n,wt.needsUpdate=i,wt.type=r;}function Vt(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage);}function kt(t){var e=t.target;e.removeEventListener("dispose",kt),function(t){(function(t){var e=mt.get(t).programs;void 0!==e&&(e.forEach(function(t){Mt.releaseProgram(t);}),t.isShaderMaterial&&Mt.releaseShaderCache(t));})(t),mt.remove(t);}(e);}function Wt(t,e,n){!0===t.transparent&&2===t.side&&!1===t.forceSinglePass?(t.side=a,t.needsUpdate=!0,Qt(t,e,n),t.side=s,t.needsUpdate=!0,Qt(t,e,n),t.side=2):Qt(t,e,n);}this.xr=Ft,this.getContext=function(){return Dt;},this.getContextAttributes=function(){return Dt.getContextAttributes();},this.forceContextLoss=function(){var t=ht.get("WEBGL_lose_context");t&&t.loseContext();},this.forceContextRestore=function(){var t=ht.get("WEBGL_lose_context");t&&t.restoreContext();},this.getPixelRatio=function(){return z;},this.setPixelRatio=function(t){void 0!==t&&(z=t,this.setSize(D,N,!1));},this.getSize=function(t){return t.set(D,N);},this.setSize=function(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!0;Ft.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(D=t,N=e,n.width=Math.floor(t*z),n.height=Math.floor(e*z),!0===i&&(n.style.width=t+"px",n.style.height=e+"px"),this.setViewport(0,0,t,e));},this.getDrawingBufferSize=function(t){return t.set(D*z,N*z).floor();},this.setDrawingBufferSize=function(t,e,i){D=t,N=e,z=i,n.width=Math.floor(t*i),n.height=Math.floor(e*i),this.setViewport(0,0,t,e);},this.getCurrentViewport=function(t){return t.copy(C);},this.getViewport=function(t){return t.copy($);},this.setViewport=function(t,e,n,i){t.isVector4?$.set(t.x,t.y,t.z,t.w):$.set(t,e,n,i),dt.viewport(C.copy($).multiplyScalar(z).floor());},this.getScissor=function(t){return t.copy(Q);},this.setScissor=function(t,e,n,i){t.isVector4?Q.set(t.x,t.y,t.z,t.w):Q.set(t,e,n,i),dt.scissor(L.copy(Q).multiplyScalar(z).floor());},this.getScissorTest=function(){return tt;},this.setScissorTest=function(t){dt.setScissorTest(tt=t);},this.setOpaqueSort=function(t){q=t;},this.setTransparentSort=function(t){Y=t;},this.getClearColor=function(t){return t.copy(At.getClearColor());},this.setClearColor=function(){At.setClearColor.apply(At,arguments);},this.getClearAlpha=function(){return At.getClearAlpha();},this.setClearAlpha=function(){At.setClearAlpha.apply(At,arguments);},this.clear=function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!0;var i=0;if(t){var _t143=!1;if(null!==w){var _e130=w.texture.format;_t143=_e130===K||_e130===J||_e130===Z;}if(_t143){var _t144=w.texture.type,_e131=_t144===F||_t144===G||_t144===B||_t144===X||_t144===k||_t144===W,_n114=At.getClearColor(),_i108=At.getClearAlpha(),_r82=_n114.r,_s44=_n114.g,_a40=_n114.b;_e131?(g[0]=_r82,g[1]=_s44,g[2]=_a40,g[3]=_i108,Dt.clearBufferuiv(Dt.COLOR,0,g)):(_[0]=_r82,_[1]=_s44,_[2]=_a40,_[3]=_i108,Dt.clearBufferiv(Dt.COLOR,0,_));}else i|=Dt.COLOR_BUFFER_BIT;}e&&(i|=Dt.DEPTH_BUFFER_BIT),n&&(i|=Dt.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Dt.clear(i);},this.clearColor=function(){this.clear(!0,!1,!1);},this.clearDepth=function(){this.clear(!1,!0,!1);},this.clearStencil=function(){this.clear(!1,!1,!0);},this.dispose=function(){n.removeEventListener("webglcontextlost",Bt,!1),n.removeEventListener("webglcontextrestored",zt,!1),n.removeEventListener("webglcontextcreationerror",Vt,!1),bt.dispose(),Tt.dispose(),mt.dispose(),gt.dispose(),_t.dispose(),yt.dispose(),It.dispose(),Ut.dispose(),Mt.dispose(),Ft.dispose(),Ft.removeEventListener("sessionstart",jt),Ft.removeEventListener("sessionend",qt),rt&&(rt.dispose(),rt=null),Yt.stop();},this.renderBufferDirect=function(t,e,n,i,r,s){null===e&&(e=lt);var a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(t,e,n,i,r){!0!==e.isScene&&(e=lt);ft.resetTextureUnits();var s=e.fog,a=i.isMeshStandardMaterial?e.environment:null,o=null===w?S.outputColorSpace:!0===w.isXRRenderTarget?w.texture.colorSpace:Ht,l=(i.isMeshStandardMaterial?_t:gt).get(i.envMap||a),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,h=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),u=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,m=!!n.morphAttributes.color;var f=p;i.toneMapped&&(null!==w&&!0!==w.isXRRenderTarget||(f=S.toneMapping));var g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,_=void 0!==g?g.length:0,v=mt.get(i),y=x.state.lights;if(!0===nt&&(!0===it||t!==R)){var _e132=t===R&&i.id===A;Et.setState(i,t,_e132);}var M=!1;i.version===v.__version?v.needsLights&&v.lightsStateVersion!==y.state.version||v.outputColorSpace!==o||r.isBatchedMesh&&!1===v.batching?M=!0:r.isBatchedMesh||!0!==v.batching?r.isInstancedMesh&&!1===v.instancing?M=!0:r.isInstancedMesh||!0!==v.instancing?r.isSkinnedMesh&&!1===v.skinning?M=!0:r.isSkinnedMesh||!0!==v.skinning?r.isInstancedMesh&&!0===v.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===v.instancingColor&&null!==r.instanceColor||v.envMap!==l||!0===i.fog&&v.fog!==s?M=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===Et.numPlanes&&v.numIntersection===Et.numIntersection?(v.vertexAlphas!==c||v.vertexTangents!==h||v.morphTargets!==u||v.morphNormals!==d||v.morphColors!==m||v.toneMapping!==f||!0===ut.isWebGL2&&v.morphTargetsCount!==_)&&(M=!0):M=!0:M=!0:M=!0:M=!0:(M=!0,v.__version=i.version);var b=v.currentProgram;!0===M&&(b=Qt(i,e,r));var T=!1,E=!1,C=!1;var L=b.getUniforms(),P=v.uniforms;dt.useProgram(b.program)&&(T=!0,E=!0,C=!0);i.id!==A&&(A=i.id,E=!0);if(T||R!==t){L.setValue(Dt,"projectionMatrix",t.projectionMatrix),L.setValue(Dt,"viewMatrix",t.matrixWorldInverse);var _e133=L.map.cameraPosition;void 0!==_e133&&_e133.setValue(Dt,ot.setFromMatrixPosition(t.matrixWorld)),ut.logarithmicDepthBuffer&&L.setValue(Dt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&L.setValue(Dt,"isOrthographic",!0===t.isOrthographicCamera),R!==t&&(R=t,E=!0,C=!0);}if(r.isSkinnedMesh){L.setOptional(Dt,r,"bindMatrix"),L.setOptional(Dt,r,"bindMatrixInverse");var _t145=r.skeleton;_t145&&(ut.floatVertexTextures?(null===_t145.boneTexture&&_t145.computeBoneTexture(),L.setValue(Dt,"boneTexture",_t145.boneTexture,ft)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."));}r.isBatchedMesh&&(L.setOptional(Dt,r,"batchingTexture"),L.setValue(Dt,"batchingTexture",r._matricesTexture,ft));var I=n.morphAttributes;(void 0!==I.position||void 0!==I.normal||void 0!==I.color&&!0===ut.isWebGL2)&&Rt.update(r,n,b);(E||v.receiveShadow!==r.receiveShadow)&&(v.receiveShadow=r.receiveShadow,L.setValue(Dt,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(P.envMap.value=l,P.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);E&&(L.setValue(Dt,"toneMappingExposure",S.toneMappingExposure),v.needsLights&&(D=C,(U=P).ambientLightColor.needsUpdate=D,U.lightProbe.needsUpdate=D,U.directionalLights.needsUpdate=D,U.directionalLightShadows.needsUpdate=D,U.pointLights.needsUpdate=D,U.pointLightShadows.needsUpdate=D,U.spotLights.needsUpdate=D,U.spotLightShadows.needsUpdate=D,U.rectAreaLights.needsUpdate=D,U.hemisphereLights.needsUpdate=D),s&&!0===i.fog&&St.refreshFogUniforms(P,s),St.refreshMaterialUniforms(P,i,z,N,rt),oa.upload(Dt,te(v),P,ft));var U,D;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(oa.upload(Dt,te(v),P,ft),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&L.setValue(Dt,"center",r.center);if(L.setValue(Dt,"modelViewMatrix",r.modelViewMatrix),L.setValue(Dt,"normalMatrix",r.normalMatrix),L.setValue(Dt,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){var _t146=i.uniformsGroups;for(var _e134=0,_n115=_t146.length;_e134<_n115;_e134++)if(ut.isWebGL2){var _n116=_t146[_e134];Ut.update(_n116,b),Ut.bind(_n116,b);}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.");}return b;}(t,e,n,i,r);dt.setMaterial(i,a);var l=n.index,c=1;if(!0===i.wireframe){if(l=xt.getWireframeAttribute(n),void 0===l)return;c=2;}var h=n.drawRange,u=n.attributes.position;var d=h.start*c,m=(h.start+h.count)*c;null!==s&&(d=Math.max(d,s.start*c),m=Math.min(m,(s.start+s.count)*c)),null!==l?(d=Math.max(d,0),m=Math.min(m,l.count)):null!=u&&(d=Math.max(d,0),m=Math.min(m,u.count));var f=m-d;if(f<0||f===1/0)return;var g;It.setup(r,i,o,n,l);var _=Ct;if(null!==l&&(g=vt.get(l),_=Lt,_.setIndex(g)),r.isMesh)!0===i.wireframe?(dt.setLineWidth(i.wireframeLinewidth*ct()),_.setMode(Dt.LINES)):_.setMode(Dt.TRIANGLES);else if(r.isLine){var _t147=i.linewidth;void 0===_t147&&(_t147=1),dt.setLineWidth(_t147*ct()),r.isLineSegments?_.setMode(Dt.LINES):r.isLineLoop?_.setMode(Dt.LINE_LOOP):_.setMode(Dt.LINE_STRIP);}else r.isPoints?_.setMode(Dt.POINTS):r.isSprite&&_.setMode(Dt.TRIANGLES);if(r.isBatchedMesh)_.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else if(r.isInstancedMesh)_.renderInstances(d,f,r.count);else if(n.isInstancedBufferGeometry){var _t148=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,_e135=Math.min(n.instanceCount,_t148);_.renderInstances(d,f,_e135);}else _.render(d,f);},this.compile=function(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;null===n&&(n=t),x=Tt.get(n),x.init(),M.push(x),n.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(x.pushLight(t),t.castShadow&&x.pushShadow(t));}),t!==n&&t.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(x.pushLight(t),t.castShadow&&x.pushShadow(t));}),x.setupLights(S._useLegacyLights);var i=new Set();return t.traverse(function(t){var e=t.material;if(e)if(Array.isArray(e))for(var _r83=0;_r83<e.length;_r83++){var _s45=e[_r83];Wt(_s45,n,t),i.add(_s45);}else Wt(e,n,t),i.add(e);}),M.pop(),x=null,i;},this.compileAsync=function(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var i=this.compile(t,e,n);return new Promise(function(e){function n(){i.forEach(function(t){mt.get(t).currentProgram.isReady()&&i["delete"](t);}),0!==i.size?setTimeout(n,10):e(t);}null!==ht.get("KHR_parallel_shader_compile")?n():setTimeout(n,10);});};var Xt=null;function jt(){Yt.stop();}function qt(){Yt.start();}var Yt=new _r();function Zt(t,e,n,i){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)x.pushLight(t),t.castShadow&&x.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||et.intersectsSprite(t)){i&&ot.setFromMatrixPosition(t.matrixWorld).applyMatrix4(st);var _e136=yt.update(t),_r84=t.material;_r84.visible&&v.push(t,_e136,_r84,n,ot.z,null);}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||et.intersectsObject(t))){var _e137=yt.update(t),_r85=t.material;if(i&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),ot.copy(t.boundingSphere.center)):(null===_e137.boundingSphere&&_e137.computeBoundingSphere(),ot.copy(_e137.boundingSphere.center)),ot.applyMatrix4(t.matrixWorld).applyMatrix4(st)),Array.isArray(_r85)){var _i109=_e137.groups;for(var _s46=0,_a41=_i109.length;_s46<_a41;_s46++){var _a42=_i109[_s46],_o26=_r85[_a42.materialIndex];_o26&&_o26.visible&&v.push(t,_e137,_o26,n,ot.z,_a42);}}else _r85.visible&&v.push(t,_e137,_r85,n,ot.z,null);}var r=t.children;for(var _t149=0,_s47=r.length;_t149<_s47;_t149++)Zt(r[_t149],e,n,i);}function Jt(t,e,n,i){var r=t.opaque,s=t.transmissive,o=t.transparent;x.setupLightsView(n),!0===nt&&Et.setGlobalState(S.clippingPlanes,n),s.length>0&&function(t,e,n,i){var r=!0===n.isScene?n.overrideMaterial:null;if(null!==r)return;var s=ut.isWebGL2;null===rt&&(rt=new Ge(1,1,{generateMipmaps:!0,type:ht.has("EXT_color_buffer_half_float")?V:F,minFilter:O,samples:s?4:0}));S.getDrawingBufferSize(at),s?rt.setSize(at.x,at.y):rt.setSize(he(at.x),he(at.y));var o=S.getRenderTarget();S.setRenderTarget(rt),S.getClearColor(I),U=S.getClearAlpha(),U<1&&S.setClearColor(16777215,.5);S.clear();var l=S.toneMapping;S.toneMapping=p,Kt(t,n,i),ft.updateMultisampleRenderTarget(rt),ft.updateRenderTargetMipmap(rt);var c=!1;for(var _t150=0,_r86=e.length;_t150<_r86;_t150++){var _r87=e[_t150],_s48=_r87.object,_o27=_r87.geometry,_l11=_r87.material,_h11=_r87.group;if(2===_l11.side&&_s48.layers.test(i.layers)){var _t151=_l11.side;_l11.side=a,_l11.needsUpdate=!0,$t(_s48,n,i,_o27,_l11,_h11),_l11.side=_t151,_l11.needsUpdate=!0,c=!0;}}!0===c&&(ft.updateMultisampleRenderTarget(rt),ft.updateRenderTargetMipmap(rt));S.setRenderTarget(o),S.setClearColor(I,U),S.toneMapping=l;}(r,s,e,n),i&&dt.viewport(C.copy(i)),r.length>0&&Kt(r,e,n),s.length>0&&Kt(s,e,n),o.length>0&&Kt(o,e,n),dt.buffers.depth.setTest(!0),dt.buffers.depth.setMask(!0),dt.buffers.color.setMask(!0),dt.setPolygonOffset(!1);}function Kt(t,e,n){var i=!0===e.isScene?e.overrideMaterial:null;for(var _r88=0,_s49=t.length;_r88<_s49;_r88++){var _s50=t[_r88],_a43=_s50.object,_o28=_s50.geometry,_l12=null===i?_s50.material:i,_c12=_s50.group;_a43.layers.test(n.layers)&&$t(_a43,e,n,_o28,_l12,_c12);}}function $t(t,e,n,i,r,o){t.onBeforeRender(S,e,n,i,r,o),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(S,e,n,i,t,o),!0===r.transparent&&2===r.side&&!1===r.forceSinglePass?(r.side=a,r.needsUpdate=!0,S.renderBufferDirect(n,e,i,r,t,o),r.side=s,r.needsUpdate=!0,S.renderBufferDirect(n,e,i,r,t,o),r.side=2):S.renderBufferDirect(n,e,i,r,t,o),t.onAfterRender(S,e,n,i,r,o);}function Qt(t,e,n){!0!==e.isScene&&(e=lt);var i=mt.get(t),r=x.state.lights,s=x.state.shadowsArray,a=r.state.version,o=Mt.getParameters(t,r.state,s,e,n),l=Mt.getProgramCacheKey(o);var c=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=(t.isMeshStandardMaterial?_t:gt).get(t.envMap||i.environment),void 0===c&&(t.addEventListener("dispose",kt),c=new Map(),i.programs=c);var h=c.get(l);if(void 0!==h){if(i.currentProgram===h&&i.lightsStateVersion===a)return ee(t,o),h;}else o.uniforms=Mt.getUniforms(t),t.onBuild(n,o,S),t.onBeforeCompile(o,S),h=Mt.acquireProgram(o,l),c.set(l,h),i.uniforms=o.uniforms;var u=i.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=Et.uniform),ee(t,o),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights;}(t),i.lightsStateVersion=a,i.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotLightMatrix.value=r.state.spotLightMatrix,u.spotLightMap.value=r.state.spotLightMap,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=h,i.uniformsList=null,h;}function te(t){if(null===t.uniformsList){var _e138=t.currentProgram.getUniforms();t.uniformsList=oa.seqWithValue(_e138.seq,t.uniforms);}return t.uniformsList;}function ee(t,e){var n=mt.get(t);n.outputColorSpace=e.outputColorSpace,n.batching=e.batching,n.instancing=e.instancing,n.instancingColor=e.instancingColor,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping;}Yt.setAnimationLoop(function(t){Xt&&Xt(t);}),"undefined"!=typeof self&&Yt.setContext(self),this.setAnimationLoop=function(t){Xt=t,Ft.setAnimationLoop(t),null===t?Yt.stop():Yt.start();},Ft.addEventListener("sessionstart",jt),Ft.addEventListener("sessionend",qt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===Ft.enabled&&!0===Ft.isPresenting&&(!0===Ft.cameraAutoUpdate&&Ft.updateCamera(e),e=Ft.getCamera()),!0===t.isScene&&t.onBeforeRender(S,t,e,w),x=Tt.get(t,M.length),x.init(),M.push(x),st.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),et.setFromProjectionMatrix(st),it=this.localClippingEnabled,nt=Et.init(this.clippingPlanes,it),v=bt.get(t,y.length),v.init(),y.push(v),Zt(t,e,0,S.sortObjects),v.finish(),!0===S.sortObjects&&v.sort(q,Y),this.info.render.frame++,!0===nt&&Et.beginShadows();var n=x.state.shadowsArray;if(wt.render(n,t,e),!0===nt&&Et.endShadows(),!0===this.info.autoReset&&this.info.reset(),At.render(v,t),x.setupLights(S._useLegacyLights),e.isArrayCamera){var _n117=e.cameras;for(var _e139=0,_i110=_n117.length;_e139<_i110;_e139++){var _i111=_n117[_e139];Jt(v,t,_i111,_i111.viewport);}}else Jt(v,t,e);null!==w&&(ft.updateMultisampleRenderTarget(w),ft.updateRenderTargetMipmap(w)),!0===t.isScene&&t.onAfterRender(S,t,e),It.resetDefaultState(),A=-1,R=null,M.pop(),x=M.length>0?M[M.length-1]:null,y.pop(),v=y.length>0?y[y.length-1]:null;},this.getActiveCubeFace=function(){return T;},this.getActiveMipmapLevel=function(){return E;},this.getRenderTarget=function(){return w;},this.setRenderTargetTextures=function(t,e,n){mt.get(t.texture).__webglTexture=e,mt.get(t.depthTexture).__webglTexture=n;var i=mt.get(t);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===ht.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1));},this.setRenderTargetFramebuffer=function(t,e){var n=mt.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e;},this.setRenderTarget=function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;w=t,T=e,E=n;var i=!0,r=null,s=!1,a=!1;if(t){var _o29=mt.get(t);void 0!==_o29.__useDefaultFramebuffer?(dt.bindFramebuffer(Dt.FRAMEBUFFER,null),i=!1):void 0===_o29.__webglFramebuffer?ft.setupRenderTarget(t):_o29.__hasExternalTextures&&ft.rebindTextures(t,mt.get(t.texture).__webglTexture,mt.get(t.depthTexture).__webglTexture);var _l13=t.texture;(_l13.isData3DTexture||_l13.isDataArrayTexture||_l13.isCompressedArrayTexture)&&(a=!0);var _c13=mt.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=Array.isArray(_c13[e])?_c13[e][n]:_c13[e],s=!0):r=ut.isWebGL2&&t.samples>0&&!1===ft.useMultisampledRTT(t)?mt.get(t).__webglMultisampledFramebuffer:Array.isArray(_c13)?_c13[n]:_c13,C.copy(t.viewport),L.copy(t.scissor),P=t.scissorTest;}else C.copy($).multiplyScalar(z).floor(),L.copy(Q).multiplyScalar(z).floor(),P=tt;if(dt.bindFramebuffer(Dt.FRAMEBUFFER,r)&&ut.drawBuffers&&i&&dt.drawBuffers(t,r),dt.viewport(C),dt.scissor(L),dt.setScissorTest(P),s){var _i112=mt.get(t.texture);Dt.framebufferTexture2D(Dt.FRAMEBUFFER,Dt.COLOR_ATTACHMENT0,Dt.TEXTURE_CUBE_MAP_POSITIVE_X+e,_i112.__webglTexture,n);}else if(a){var _i113=mt.get(t.texture),_r89=e||0;Dt.framebufferTextureLayer(Dt.FRAMEBUFFER,Dt.COLOR_ATTACHMENT0,_i113.__webglTexture,n||0,_r89);}A=-1;},this.readRenderTargetPixels=function(t,e,n,i,r,s,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");var o=mt.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){dt.bindFramebuffer(Dt.FRAMEBUFFER,o);try{var _a44=t.texture,_o30=_a44.format,_l14=_a44.type;if(_o30!==j&&Pt.convert(_o30)!==Dt.getParameter(Dt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var _c14=_l14===V&&(ht.has("EXT_color_buffer_half_float")||ut.isWebGL2&&ht.has("EXT_color_buffer_float"));if(!(_l14===F||Pt.convert(_l14)===Dt.getParameter(Dt.IMPLEMENTATION_COLOR_READ_TYPE)||_l14===H&&(ut.isWebGL2||ht.has("OES_texture_float")||ht.has("WEBGL_color_buffer_float"))||_c14))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&Dt.readPixels(e,n,i,r,Pt.convert(_o30),Pt.convert(_l14),s);}finally{var _t152=null!==w?mt.get(w).__webglFramebuffer:null;dt.bindFramebuffer(Dt.FRAMEBUFFER,_t152);}}},this.copyFramebufferToTexture=function(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var i=Math.pow(2,-n),r=Math.floor(e.image.width*i),s=Math.floor(e.image.height*i);ft.setTexture2D(e,0),Dt.copyTexSubImage2D(Dt.TEXTURE_2D,n,0,0,t.x,t.y,r,s),dt.unbindTexture();},this.copyTextureToTexture=function(t,e,n){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var r=e.image.width,s=e.image.height,a=Pt.convert(n.format),o=Pt.convert(n.type);ft.setTexture2D(n,0),Dt.pixelStorei(Dt.UNPACK_FLIP_Y_WEBGL,n.flipY),Dt.pixelStorei(Dt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),Dt.pixelStorei(Dt.UNPACK_ALIGNMENT,n.unpackAlignment),e.isDataTexture?Dt.texSubImage2D(Dt.TEXTURE_2D,i,t.x,t.y,r,s,a,o,e.image.data):e.isCompressedTexture?Dt.compressedTexSubImage2D(Dt.TEXTURE_2D,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):Dt.texSubImage2D(Dt.TEXTURE_2D,i,t.x,t.y,a,o,e.image),0===i&&n.generateMipmaps&&Dt.generateMipmap(Dt.TEXTURE_2D),dt.unbindTexture();},this.copyTextureToTexture3D=function(t,e,n,i){var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;if(S.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");var s=t.max.x-t.min.x+1,a=t.max.y-t.min.y+1,o=t.max.z-t.min.z+1,l=Pt.convert(i.format),c=Pt.convert(i.type);var h;if(i.isData3DTexture)ft.setTexture3D(i,0),h=Dt.TEXTURE_3D;else{if(!i.isDataArrayTexture&&!i.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ft.setTexture2DArray(i,0),h=Dt.TEXTURE_2D_ARRAY;}Dt.pixelStorei(Dt.UNPACK_FLIP_Y_WEBGL,i.flipY),Dt.pixelStorei(Dt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),Dt.pixelStorei(Dt.UNPACK_ALIGNMENT,i.unpackAlignment);var u=Dt.getParameter(Dt.UNPACK_ROW_LENGTH),d=Dt.getParameter(Dt.UNPACK_IMAGE_HEIGHT),p=Dt.getParameter(Dt.UNPACK_SKIP_PIXELS),m=Dt.getParameter(Dt.UNPACK_SKIP_ROWS),f=Dt.getParameter(Dt.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[r]:n.image;Dt.pixelStorei(Dt.UNPACK_ROW_LENGTH,g.width),Dt.pixelStorei(Dt.UNPACK_IMAGE_HEIGHT,g.height),Dt.pixelStorei(Dt.UNPACK_SKIP_PIXELS,t.min.x),Dt.pixelStorei(Dt.UNPACK_SKIP_ROWS,t.min.y),Dt.pixelStorei(Dt.UNPACK_SKIP_IMAGES,t.min.z),n.isDataTexture||n.isData3DTexture?Dt.texSubImage3D(h,r,e.x,e.y,e.z,s,a,o,l,c,g.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Dt.compressedTexSubImage3D(h,r,e.x,e.y,e.z,s,a,o,l,g.data)):Dt.texSubImage3D(h,r,e.x,e.y,e.z,s,a,o,l,c,g),Dt.pixelStorei(Dt.UNPACK_ROW_LENGTH,u),Dt.pixelStorei(Dt.UNPACK_IMAGE_HEIGHT,d),Dt.pixelStorei(Dt.UNPACK_SKIP_PIXELS,p),Dt.pixelStorei(Dt.UNPACK_SKIP_ROWS,m),Dt.pixelStorei(Dt.UNPACK_SKIP_IMAGES,f),0===r&&i.generateMipmaps&&Dt.generateMipmap(h),dt.unbindTexture();},this.initTexture=function(t){t.isCubeTexture?ft.setTextureCube(t,0):t.isData3DTexture?ft.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?ft.setTexture2DArray(t,0):ft.setTexture2D(t,0),dt.unbindTexture();},this.resetState=function(){T=0,E=0,w=null,dt.reset(),It.reset();},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}));}_createClass(to,[{key:"coordinateSystem",get:function get(){return $t;}},{key:"outputColorSpace",get:function get(){return this._outputColorSpace;},set:function set(t){this._outputColorSpace=t;var e=this.getContext();e.drawingBufferColorSpace=t===Vt?"display-p3":"srgb",e.unpackColorSpace=Re.workingColorSpace===kt?"display-p3":"srgb";}},{key:"outputEncoding",get:function get(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Gt?Bt:Ft;},set:function set(t){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=t===Bt?Gt:Ht;}},{key:"useLegacyLights",get:function get(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights;},set:function set(t){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=t;}}]);return to;}();var eo=/*#__PURE__*/function(_to){_inherits(eo,_to);var _super29=_createSuper(eo);function eo(){_classCallCheck(this,eo);return _super29.apply(this,arguments);}return _createClass(eo);}(to);eo.prototype.isWebGL1Renderer=!0;var no=/*#__PURE__*/function(){function no(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:25e-5;_classCallCheck(this,no);this.isFogExp2=!0,this.name="",this.color=new ci(t),this.density=e;}_createClass(no,[{key:"clone",value:function clone(){return new no(this.color,this.density);}},{key:"toJSON",value:function toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density};}}]);return no;}();var io=/*#__PURE__*/function(){function io(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1e3;_classCallCheck(this,io);this.isFog=!0,this.name="",this.color=new ci(t),this.near=e,this.far=n;}_createClass(io,[{key:"clone",value:function clone(){return new io(this.color,this.near,this.far);}},{key:"toJSON",value:function toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far};}}]);return io;}();var ro=/*#__PURE__*/function(_jn5){_inherits(ro,_jn5);var _super30=_createSuper(ro);function ro(){var _this26;_classCallCheck(this,ro);_this26=_super30.call(this),_this26.isScene=!0,_this26.type="Scene",_this26.background=null,_this26.environment=null,_this26.fog=null,_this26.backgroundBlurriness=0,_this26.backgroundIntensity=1,_this26.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:_assertThisInitialized(_this26)}));return _this26;}_createClass(ro,[{key:"copy",value:function copy(t,e){return _get(_getPrototypeOf(ro.prototype),"copy",this).call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this;}},{key:"toJSON",value:function toJSON(t){var e=_get(_getPrototypeOf(ro.prototype),"toJSON",this).call(this,t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e;}}]);return ro;}(jn);var so=/*#__PURE__*/function(){function so(t,e){_classCallCheck(this,so);this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Zt,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=se();}_createClass(so,[{key:"onUploadCallback",value:function onUploadCallback(){}},{key:"needsUpdate",set:function set(t){!0===t&&this.version++;}},{key:"updateRange",get:function get(){return console.warn("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange;}},{key:"setUsage",value:function setUsage(t){return this.usage=t,this;}},{key:"addUpdateRange",value:function addUpdateRange(t,e){this.updateRanges.push({start:t,count:e});}},{key:"clearUpdateRanges",value:function clearUpdateRanges(){this.updateRanges.length=0;}},{key:"copy",value:function copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this;}},{key:"copyAt",value:function copyAt(t,e,n){t*=this.stride,n*=e.stride;for(var _i114=0,_r90=this.stride;_i114<_r90;_i114++)this.array[t+_i114]=e.array[n+_i114];return this;}},{key:"set",value:function set(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.array.set(t,e),this;}},{key:"clone",value:function clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=se()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n;}},{key:"onUpload",value:function onUpload(t){return this.onUploadCallback=t,this;}},{key:"toJSON",value:function toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=se()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride};}}]);return so;}();var ao=new We();var oo=/*#__PURE__*/function(){function oo(t,e,n){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:!1;_classCallCheck(this,oo);this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=i;}_createClass(oo,[{key:"count",get:function get(){return this.data.count;}},{key:"array",get:function get(){return this.data.array;}},{key:"needsUpdate",set:function set(t){this.data.needsUpdate=t;}},{key:"applyMatrix4",value:function applyMatrix4(t){for(var _e140=0,_n118=this.data.count;_e140<_n118;_e140++)ao.fromBufferAttribute(this,_e140),ao.applyMatrix4(t),this.setXYZ(_e140,ao.x,ao.y,ao.z);return this;}},{key:"applyNormalMatrix",value:function applyNormalMatrix(t){for(var _e141=0,_n119=this.count;_e141<_n119;_e141++)ao.fromBufferAttribute(this,_e141),ao.applyNormalMatrix(t),this.setXYZ(_e141,ao.x,ao.y,ao.z);return this;}},{key:"transformDirection",value:function transformDirection(t){for(var _e142=0,_n120=this.count;_e142<_n120;_e142++)ao.fromBufferAttribute(this,_e142),ao.transformDirection(t),this.setXYZ(_e142,ao.x,ao.y,ao.z);return this;}},{key:"setX",value:function setX(t,e){return this.normalized&&(e=de(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this;}},{key:"setY",value:function setY(t,e){return this.normalized&&(e=de(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this;}},{key:"setZ",value:function setZ(t,e){return this.normalized&&(e=de(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this;}},{key:"setW",value:function setW(t,e){return this.normalized&&(e=de(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this;}},{key:"getX",value:function getX(t){var e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=ue(e,this.array)),e;}},{key:"getY",value:function getY(t){var e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=ue(e,this.array)),e;}},{key:"getZ",value:function getZ(t){var e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=ue(e,this.array)),e;}},{key:"getW",value:function getW(t){var e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=ue(e,this.array)),e;}},{key:"setXY",value:function setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=de(e,this.array),n=de(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this;}},{key:"setXYZ",value:function setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=de(e,this.array),n=de(n,this.array),i=de(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this;}},{key:"setXYZW",value:function setXYZW(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=de(e,this.array),n=de(n,this.array),i=de(i,this.array),r=de(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this;}},{key:"clone",value:function clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");var _t153=[];for(var _e143=0;_e143<this.count;_e143++){var _n121=_e143*this.data.stride+this.offset;for(var _e144=0;_e144<this.itemSize;_e144++)_t153.push(this.data.array[_n121+_e144]);}return new Mi(new this.array.constructor(_t153),this.itemSize,this.normalized);}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new oo(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);}},{key:"toJSON",value:function toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");var _t154=[];for(var _e145=0;_e145<this.count;_e145++){var _n122=_e145*this.data.stride+this.offset;for(var _e146=0;_e146<this.itemSize;_e146++)_t154.push(this.data.array[_n122+_e146]);}return{itemSize:this.itemSize,type:this.array.constructor.name,array:_t154,normalized:this.normalized};}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};}}]);return oo;}();var lo=/*#__PURE__*/function(_di5){_inherits(lo,_di5);var _super31=_createSuper(lo);function lo(t){var _this27;_classCallCheck(this,lo);_this27=_super31.call(this),_this27.isSpriteMaterial=!0,_this27.type="SpriteMaterial",_this27.color=new ci(16777215),_this27.map=null,_this27.alphaMap=null,_this27.rotation=0,_this27.sizeAttenuation=!0,_this27.transparent=!0,_this27.fog=!0,_this27.setValues(t);return _this27;}_createClass(lo,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(lo.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this;}}]);return lo;}(di);var co;var ho=new We(),uo=new We(),po=new We(),mo=new me(),fo=new me(),go=new Mn(),_o=new We(),vo=new We(),xo=new We(),yo=new me(),Mo=new me(),So=new me();var bo=/*#__PURE__*/function(_jn6){_inherits(bo,_jn6);var _super32=_createSuper(bo);function bo(){var _this28;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new lo();_classCallCheck(this,bo);if(_this28=_super32.call(this),_this28.isSprite=!0,_this28.type="Sprite",void 0===co){co=new Ii();var _t155=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),_e147=new so(_t155,5);co.setIndex([0,1,2,0,2,3]),co.setAttribute("position",new oo(_e147,3,0,!1)),co.setAttribute("uv",new oo(_e147,2,3,!1));}_this28.geometry=co,_this28.material=t,_this28.center=new me(.5,.5);return _possibleConstructorReturn(_this28);}_createClass(bo,[{key:"raycast",value:function raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),uo.setFromMatrixScale(this.matrixWorld),go.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),po.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&uo.multiplyScalar(-po.z);var n=this.material.rotation;var i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));var s=this.center;To(_o.set(-.5,-.5,0),po,s,uo,i,r),To(vo.set(.5,-.5,0),po,s,uo,i,r),To(xo.set(.5,.5,0),po,s,uo,i,r),yo.set(0,0),Mo.set(1,0),So.set(1,1);var a=t.ray.intersectTriangle(_o,vo,xo,!1,ho);if(null===a&&(To(vo.set(-.5,.5,0),po,s,uo,i,r),Mo.set(0,1),a=t.ray.intersectTriangle(_o,xo,vo,!1,ho),null===a))return;var o=t.ray.origin.distanceTo(ho);o<t.near||o>t.far||e.push({distance:o,point:ho.clone(),uv:ri.getInterpolation(ho,_o,vo,xo,yo,Mo,So,new me()),face:null,object:this});}},{key:"copy",value:function copy(t,e){return _get(_getPrototypeOf(bo.prototype),"copy",this).call(this,t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this;}}]);return bo;}(jn);function To(t,e,n,i,r,s){mo.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(fo.x=s*mo.x-r*mo.y,fo.y=r*mo.x+s*mo.y):fo.copy(mo),t.copy(e),t.x+=fo.x,t.y+=fo.y,t.applyMatrix4(go);}var Eo=new We(),wo=new We();var Ao=/*#__PURE__*/function(_jn7){_inherits(Ao,_jn7);var _super33=_createSuper(Ao);function Ao(){var _this29;_classCallCheck(this,Ao);_this29=_super33.call(this),_this29._currentLevel=0,_this29.type="LOD",Object.defineProperties(_assertThisInitialized(_this29),{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),_this29.autoUpdate=!0;return _this29;}_createClass(Ao,[{key:"copy",value:function copy(t){_get(_getPrototypeOf(Ao.prototype),"copy",this).call(this,t,!1);var e=t.levels;for(var _t156=0,_n123=e.length;_t156<_n123;_t156++){var _n124=e[_t156];this.addLevel(_n124.object.clone(),_n124.distance,_n124.hysteresis);}return this.autoUpdate=t.autoUpdate,this;}},{key:"addLevel",value:function addLevel(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;e=Math.abs(e);var i=this.levels;var r;for(r=0;r<i.length&&!(e<i[r].distance);r++);return i.splice(r,0,{distance:e,hysteresis:n,object:t}),this.add(t),this;}},{key:"getCurrentLevel",value:function getCurrentLevel(){return this._currentLevel;}},{key:"getObjectForDistance",value:function getObjectForDistance(t){var e=this.levels;if(e.length>0){var _n125,_i115;for(_n125=1,_i115=e.length;_n125<_i115;_n125++){var _i116=e[_n125].distance;if(e[_n125].object.visible&&(_i116-=_i116*e[_n125].hysteresis),t<_i116)break;}return e[_n125-1].object;}return null;}},{key:"raycast",value:function raycast(t,e){if(this.levels.length>0){Eo.setFromMatrixPosition(this.matrixWorld);var _n126=t.ray.origin.distanceTo(Eo);this.getObjectForDistance(_n126).raycast(t,e);}}},{key:"update",value:function update(t){var e=this.levels;if(e.length>1){Eo.setFromMatrixPosition(t.matrixWorld),wo.setFromMatrixPosition(this.matrixWorld);var _n127=Eo.distanceTo(wo)/t.zoom;var _i117,_r91;for(e[0].object.visible=!0,_i117=1,_r91=e.length;_i117<_r91;_i117++){var _t157=e[_i117].distance;if(e[_i117].object.visible&&(_t157-=_t157*e[_i117].hysteresis),!(_n127>=_t157))break;e[_i117-1].object.visible=!1,e[_i117].object.visible=!0;}for(this._currentLevel=_i117-1;_i117<_r91;_i117++)e[_i117].object.visible=!1;}}},{key:"toJSON",value:function toJSON(t){var e=_get(_getPrototypeOf(Ao.prototype),"toJSON",this).call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];var n=this.levels;for(var _t158=0,_i118=n.length;_t158<_i118;_t158++){var _i119=n[_t158];e.object.levels.push({object:_i119.object.uuid,distance:_i119.distance,hysteresis:_i119.hysteresis});}return e;}}]);return Ao;}(jn);var Ro=new We(),Co=new Be(),Lo=new Be(),Po=new We(),Io=new Mn(),Uo=new We(),Do=new dn(),No=new Mn(),Oo=new yn();var Fo=/*#__PURE__*/function(_Ji){_inherits(Fo,_Ji);var _super34=_createSuper(Fo);function Fo(t,e){var _this30;_classCallCheck(this,Fo);_this30=_super34.call(this,t,e),_this30.isSkinnedMesh=!0,_this30.type="SkinnedMesh",_this30.bindMode=y,_this30.bindMatrix=new Mn(),_this30.bindMatrixInverse=new Mn(),_this30.boundingBox=null,_this30.boundingSphere=null;return _this30;}_createClass(Fo,[{key:"computeBoundingBox",value:function computeBoundingBox(){var t=this.geometry;null===this.boundingBox&&(this.boundingBox=new qe()),this.boundingBox.makeEmpty();var e=t.getAttribute("position");for(var _t159=0;_t159<e.count;_t159++)this.getVertexPosition(_t159,Uo),this.boundingBox.expandByPoint(Uo);}},{key:"computeBoundingSphere",value:function computeBoundingSphere(){var t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new dn()),this.boundingSphere.makeEmpty();var e=t.getAttribute("position");for(var _t160=0;_t160<e.count;_t160++)this.getVertexPosition(_t160,Uo),this.boundingSphere.expandByPoint(Uo);}},{key:"copy",value:function copy(t,e){return _get(_getPrototypeOf(Fo.prototype),"copy",this).call(this,t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this;}},{key:"raycast",value:function raycast(t,e){var n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),Do.copy(this.boundingSphere),Do.applyMatrix4(i),!1!==t.ray.intersectsSphere(Do)&&(No.copy(i).invert(),Oo.copy(t.ray).applyMatrix4(No),null!==this.boundingBox&&!1===Oo.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,Oo)));}},{key:"getVertexPosition",value:function getVertexPosition(t,e){return _get(_getPrototypeOf(Fo.prototype),"getVertexPosition",this).call(this,t,e),this.applyBoneTransform(t,e),e;}},{key:"bind",value:function bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert();}},{key:"pose",value:function pose(){this.skeleton.pose();}},{key:"normalizeSkinWeights",value:function normalizeSkinWeights(){var t=new Be(),e=this.geometry.attributes.skinWeight;for(var _n128=0,_i120=e.count;_n128<_i120;_n128++){t.fromBufferAttribute(e,_n128);var _i121=1/t.manhattanLength();_i121!==1/0?t.multiplyScalar(_i121):t.set(1,0,0,0),e.setXYZW(_n128,t.x,t.y,t.z,t.w);}}},{key:"updateMatrixWorld",value:function updateMatrixWorld(t){_get(_getPrototypeOf(Fo.prototype),"updateMatrixWorld",this).call(this,t),this.bindMode===y?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===M?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode);}},{key:"applyBoneTransform",value:function applyBoneTransform(t,e){var n=this.skeleton,i=this.geometry;Co.fromBufferAttribute(i.attributes.skinIndex,t),Lo.fromBufferAttribute(i.attributes.skinWeight,t),Ro.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(var _t161=0;_t161<4;_t161++){var _i122=Lo.getComponent(_t161);if(0!==_i122){var _r92=Co.getComponent(_t161);Io.multiplyMatrices(n.bones[_r92].matrixWorld,n.boneInverses[_r92]),e.addScaledVector(Po.copy(Ro).applyMatrix4(Io),_i122);}}return e.applyMatrix4(this.bindMatrixInverse);}},{key:"boneTransform",value:function boneTransform(t,e){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(t,e);}}]);return Fo;}(Ji);var Bo=/*#__PURE__*/function(_jn8){_inherits(Bo,_jn8);var _super35=_createSuper(Bo);function Bo(){var _this31;_classCallCheck(this,Bo);_this31=_super35.call(this),_this31.isBone=!0,_this31.type="Bone";return _this31;}return _createClass(Bo);}(jn);var zo=/*#__PURE__*/function(_Fe5){_inherits(zo,_Fe5);var _super36=_createSuper(zo);function zo(){var _this32;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var i=arguments.length>3?arguments[3]:undefined;var r=arguments.length>4?arguments[4]:undefined;var s=arguments.length>5?arguments[5]:undefined;var a=arguments.length>6?arguments[6]:undefined;var o=arguments.length>7?arguments[7]:undefined;var l=arguments.length>8&&arguments[8]!==undefined?arguments[8]:1003;var c=arguments.length>9&&arguments[9]!==undefined?arguments[9]:1003;var h=arguments.length>10?arguments[10]:undefined;var u=arguments.length>11?arguments[11]:undefined;_classCallCheck(this,zo);_this32=_super36.call(this,null,s,a,o,l,c,i,r,h,u),_this32.isDataTexture=!0,_this32.image={data:t,width:e,height:n},_this32.generateMipmaps=!1,_this32.flipY=!1,_this32.unpackAlignment=1;return _this32;}return _createClass(zo);}(Fe);var Go=new Mn(),Ho=new Mn();var Vo=/*#__PURE__*/function(){function Vo(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];_classCallCheck(this,Vo);this.uuid=se(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init();}_createClass(Vo,[{key:"init",value:function init(){var t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var _t162=0,_e148=this.bones.length;_t162<_e148;_t162++)this.boneInverses.push(new Mn());}}},{key:"calculateInverses",value:function calculateInverses(){this.boneInverses.length=0;for(var _t163=0,_e149=this.bones.length;_t163<_e149;_t163++){var _e150=new Mn();this.bones[_t163]&&_e150.copy(this.bones[_t163].matrixWorld).invert(),this.boneInverses.push(_e150);}}},{key:"pose",value:function pose(){for(var _t164=0,_e151=this.bones.length;_t164<_e151;_t164++){var _e152=this.bones[_t164];_e152&&_e152.matrixWorld.copy(this.boneInverses[_t164]).invert();}for(var _t165=0,_e153=this.bones.length;_t165<_e153;_t165++){var _e154=this.bones[_t165];_e154&&(_e154.parent&&_e154.parent.isBone?(_e154.matrix.copy(_e154.parent.matrixWorld).invert(),_e154.matrix.multiply(_e154.matrixWorld)):_e154.matrix.copy(_e154.matrixWorld),_e154.matrix.decompose(_e154.position,_e154.quaternion,_e154.scale));}}},{key:"update",value:function update(){var t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(var _i123=0,_r93=t.length;_i123<_r93;_i123++){var _r94=t[_i123]?t[_i123].matrixWorld:Ho;Go.multiplyMatrices(_r94,e[_i123]),Go.toArray(n,16*_i123);}null!==i&&(i.needsUpdate=!0);}},{key:"clone",value:function clone(){return new Vo(this.bones,this.boneInverses);}},{key:"computeBoneTexture",value:function computeBoneTexture(){var t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);var e=new Float32Array(t*t*4);e.set(this.boneMatrices);var n=new zo(e,t,t,j,H);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this;}},{key:"getBoneByName",value:function getBoneByName(t){for(var _e155=0,_n129=this.bones.length;_e155<_n129;_e155++){var _n130=this.bones[_e155];if(_n130.name===t)return _n130;}}},{key:"dispose",value:function dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null);}},{key:"fromJSON",value:function fromJSON(t,e){this.uuid=t.uuid;for(var _n131=0,_i124=t.bones.length;_n131<_i124;_n131++){var _i125=t.bones[_n131];var _r95=e[_i125];void 0===_r95&&(console.warn("THREE.Skeleton: No bone found with UUID:",_i125),_r95=new Bo()),this.bones.push(_r95),this.boneInverses.push(new Mn().fromArray(t.boneInverses[_n131]));}return this.init(),this;}},{key:"toJSON",value:function toJSON(){var t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;var e=this.bones,n=this.boneInverses;for(var _i126=0,_r96=e.length;_i126<_r96;_i126++){var _r97=e[_i126];t.bones.push(_r97.uuid);var _s51=n[_i126];t.boneInverses.push(_s51.toArray());}return t;}}]);return Vo;}();var ko=/*#__PURE__*/function(_Mi4){_inherits(ko,_Mi4);var _super37=_createSuper(ko);function ko(t,e,n){var _this33;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,ko);_this33=_super37.call(this,t,e,n),_this33.isInstancedBufferAttribute=!0,_this33.meshPerAttribute=i;return _this33;}_createClass(ko,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(ko.prototype),"copy",this).call(this,t),this.meshPerAttribute=t.meshPerAttribute,this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(ko.prototype),"toJSON",this).call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t;}}]);return ko;}(Mi);var Wo=new Mn(),Xo=new Mn(),jo=[],qo=new qe(),Yo=new Mn(),Zo=new Ji(),Jo=new dn();var Ko=/*#__PURE__*/function(_Ji2){_inherits(Ko,_Ji2);var _super38=_createSuper(Ko);function Ko(t,e,n){var _this34;_classCallCheck(this,Ko);_this34=_super38.call(this,t,e),_this34.isInstancedMesh=!0,_this34.instanceMatrix=new ko(new Float32Array(16*n),16),_this34.instanceColor=null,_this34.count=n,_this34.boundingBox=null,_this34.boundingSphere=null;for(var _t166=0;_t166<n;_t166++)_this34.setMatrixAt(_t166,Yo);return _this34;}_createClass(Ko,[{key:"computeBoundingBox",value:function computeBoundingBox(){var t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new qe()),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(var _n132=0;_n132<e;_n132++)this.getMatrixAt(_n132,Wo),qo.copy(t.boundingBox).applyMatrix4(Wo),this.boundingBox.union(qo);}},{key:"computeBoundingSphere",value:function computeBoundingSphere(){var t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new dn()),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(var _n133=0;_n133<e;_n133++)this.getMatrixAt(_n133,Wo),Jo.copy(t.boundingSphere).applyMatrix4(Wo),this.boundingSphere.union(Jo);}},{key:"copy",value:function copy(t,e){return _get(_getPrototypeOf(Ko.prototype),"copy",this).call(this,t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this;}},{key:"getColorAt",value:function getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t);}},{key:"getMatrixAt",value:function getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t);}},{key:"raycast",value:function raycast(t,e){var n=this.matrixWorld,i=this.count;if(Zo.geometry=this.geometry,Zo.material=this.material,void 0!==Zo.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Jo.copy(this.boundingSphere),Jo.applyMatrix4(n),!1!==t.ray.intersectsSphere(Jo)))for(var _r98=0;_r98<i;_r98++){this.getMatrixAt(_r98,Wo),Xo.multiplyMatrices(n,Wo),Zo.matrixWorld=Xo,Zo.raycast(t,jo);for(var _t167=0,_n134=jo.length;_t167<_n134;_t167++){var _n135=jo[_t167];_n135.instanceId=_r98,_n135.object=this,e.push(_n135);}jo.length=0;}}},{key:"setColorAt",value:function setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new ko(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t);}},{key:"setMatrixAt",value:function setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t);}},{key:"updateMorphTargets",value:function updateMorphTargets(){}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"});}}]);return Ko;}(Ji);function $o(t,e){return t.z-e.z;}function Qo(t,e){return e.z-t.z;}var tl=/*#__PURE__*/function(){function tl(){_classCallCheck(this,tl);this.index=0,this.pool=[],this.list=[];}_createClass(tl,[{key:"push",value:function push(t,e){var n=this.pool,i=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1});var r=n[this.index];i.push(r),this.index++,r.start=t.start,r.count=t.count,r.z=e;}},{key:"reset",value:function reset(){this.list.length=0,this.index=0;}}]);return tl;}();var el="batchId",nl=new Mn(),il=new Mn(),rl=new Mn(),sl=new Mn(),al=new gr(),ol=new qe(),ll=new dn(),cl=new We(),hl=new tl(),ul=new Ji(),dl=[];function pl(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var i=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){var _r99=t.count;for(var _s52=0;_s52<_r99;_s52++)for(var _r100=0;_r100<i;_r100++)e.setComponent(_s52+n,_r100,t.getComponent(_s52,_r100));}else e.array.set(t.array,n*i);e.needsUpdate=!0;}var ml=/*#__PURE__*/function(_Ji3){_inherits(ml,_Ji3);var _super39=_createSuper(ml);function ml(t,e){var _this35;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2*e;var i=arguments.length>3?arguments[3]:undefined;_classCallCheck(this,ml);_this35=_super39.call(this,new Ii(),i),_this35.isBatchedMesh=!0,_this35.perObjectFrustumCulled=!0,_this35.sortObjects=!0,_this35.boundingBox=null,_this35.boundingSphere=null,_this35.customSort=null,_this35._drawRanges=[],_this35._reservedRanges=[],_this35._visibility=[],_this35._active=[],_this35._bounds=[],_this35._maxGeometryCount=t,_this35._maxVertexCount=e,_this35._maxIndexCount=n,_this35._geometryInitialized=!1,_this35._geometryCount=0,_this35._multiDrawCounts=new Int32Array(t),_this35._multiDrawStarts=new Int32Array(t),_this35._multiDrawCount=0,_this35._visibilityChanged=!0,_this35._matricesTexture=null,_this35._initMatricesTexture();return _this35;}_createClass(ml,[{key:"maxGeometryCount",get:function get(){return this._maxGeometryCount;}},{key:"_initMatricesTexture",value:function _initMatricesTexture(){var t=Math.sqrt(4*this._maxGeometryCount);t=4*Math.ceil(t/4),t=Math.max(t,4);var e=new Float32Array(t*t*4),n=new zo(e,t,t,j,H);this._matricesTexture=n;}},{key:"_initializeGeometry",value:function _initializeGeometry(t){var e=this.geometry,n=this._maxVertexCount,i=this._maxGeometryCount,r=this._maxIndexCount;if(!1===this._geometryInitialized){for(var _i127 in t.attributes){var _r101=t.getAttribute(_i127),_s53=_r101.array,_a45=_r101.itemSize,_o31=_r101.normalized,_l15=new _s53.constructor(n*_a45),_c15=new _r101.constructor(_l15,_a45,_o31);_c15.setUsage(_r101.usage),e.setAttribute(_i127,_c15);}if(null!==t.getIndex()){var _t168=n>65536?new Uint32Array(r):new Uint16Array(r);e.setIndex(new Mi(_t168,1));}var _s54=i>65536?new Uint32Array(n):new Uint16Array(n);e.setAttribute(el,new Mi(_s54,1)),this._geometryInitialized=!0;}}},{key:"_validateGeometry",value:function _validateGeometry(t){if(t.getAttribute(el))throw new Error("BatchedMesh: Geometry cannot use attribute \"".concat(el,"\""));var e=this.geometry;if(Boolean(t.getIndex())!==Boolean(e.getIndex()))throw new Error('BatchedMesh: All geometries must consistently have "index".');for(var _n136 in e.attributes){if(_n136===el)continue;if(!t.hasAttribute(_n136))throw new Error("BatchedMesh: Added geometry missing \"".concat(_n136,"\". All geometries must have consistent attributes."));var _i128=t.getAttribute(_n136),_r102=e.getAttribute(_n136);if(_i128.itemSize!==_r102.itemSize||_i128.normalized!==_r102.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.");}}},{key:"setCustomSort",value:function setCustomSort(t){return this.customSort=t,this;}},{key:"computeBoundingBox",value:function computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new qe());var t=this._geometryCount,e=this.boundingBox,n=this._active;e.makeEmpty();for(var _i129=0;_i129<t;_i129++)!1!==n[_i129]&&(this.getMatrixAt(_i129,nl),this.getBoundingBoxAt(_i129,ol).applyMatrix4(nl),e.union(ol));}},{key:"computeBoundingSphere",value:function computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new dn());var t=this._geometryCount,e=this.boundingSphere,n=this._active;e.makeEmpty();for(var _i130=0;_i130<t;_i130++)!1!==n[_i130]&&(this.getMatrixAt(_i130,nl),this.getBoundingSphereAt(_i130,ll).applyMatrix4(nl),e.union(ll));}},{key:"addGeometry",value:function addGeometry(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;if(this._initializeGeometry(t),this._validateGeometry(t),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");var i={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};var r=null;var s=this._reservedRanges,a=this._drawRanges,o=this._bounds;0!==this._geometryCount&&(r=s[s.length-1]),i.vertexCount=-1===e?t.getAttribute("position").count:e,i.vertexStart=null===r?0:r.vertexStart+r.vertexCount;var l=t.getIndex(),c=null!==l;if(c&&(i.indexCount=-1===n?l.count:n,i.indexStart=null===r?0:r.indexStart+r.indexCount),-1!==i.indexStart&&i.indexStart+i.indexCount>this._maxIndexCount||i.vertexStart+i.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");var h=this._visibility,u=this._active,d=this._matricesTexture,p=this._matricesTexture.image.data;h.push(!0),u.push(!0);var m=this._geometryCount;this._geometryCount++,rl.toArray(p,16*m),d.needsUpdate=!0,s.push(i),a.push({start:c?i.indexStart:i.vertexStart,count:-1}),o.push({boxInitialized:!1,box:new qe(),sphereInitialized:!1,sphere:new dn()});var f=this.geometry.getAttribute(el);for(var _t169=0;_t169<i.vertexCount;_t169++)f.setX(i.vertexStart+_t169,m);return f.needsUpdate=!0,this.setGeometryAt(m,t),m;}},{key:"setGeometryAt",value:function setGeometryAt(t,e){if(t>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);var n=this.geometry,i=null!==n.getIndex(),r=n.getIndex(),s=e.getIndex(),a=this._reservedRanges[t];if(i&&s.count>a.indexCount||e.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");var o=a.vertexStart,l=a.vertexCount;for(var _t170 in n.attributes){if(_t170===el)continue;var _i131=e.getAttribute(_t170),_r103=n.getAttribute(_t170);pl(_i131,_r103,o);var _s55=_i131.itemSize;for(var _t171=_i131.count,_e156=l;_t171<_e156;_t171++){var _e157=o+_t171;for(var _t172=0;_t172<_s55;_t172++)_r103.setComponent(_e157,_t172,0);}_r103.needsUpdate=!0;}if(i){var _t173=a.indexStart;for(var _e158=0;_e158<s.count;_e158++)r.setX(_t173+_e158,o+s.getX(_e158));for(var _e159=s.count,_n137=a.indexCount;_e159<_n137;_e159++)r.setX(_t173+_e159,o);r.needsUpdate=!0;}var c=this._bounds[t];null!==e.boundingBox?(c.box.copy(e.boundingBox),c.boxInitialized=!0):c.boxInitialized=!1,null!==e.boundingSphere?(c.sphere.copy(e.boundingSphere),c.sphereInitialized=!0):c.sphereInitialized=!1;var h=this._drawRanges[t],u=e.getAttribute("position");return h.count=i?s.count:u.count,this._visibilityChanged=!0,t;}},{key:"deleteGeometry",value:function deleteGeometry(t){var e=this._active;return t>=e.length||!1===e[t]||(e[t]=!1,this._visibilityChanged=!0),this;}},{key:"getBoundingBoxAt",value:function getBoundingBoxAt(t,e){if(!1===this._active[t])return this;var n=this._bounds[t],i=n.box,r=this.geometry;if(!1===n.boxInitialized){i.makeEmpty();var _e160=r.index,_s56=r.attributes.position,_a46=this._drawRanges[t];for(var _t174=_a46.start,_n138=_a46.start+_a46.count;_t174<_n138;_t174++){var _n139=_t174;_e160&&(_n139=_e160.getX(_n139)),i.expandByPoint(cl.fromBufferAttribute(_s56,_n139));}n.boxInitialized=!0;}return e.copy(i),e;}},{key:"getBoundingSphereAt",value:function getBoundingSphereAt(t,e){if(!1===this._active[t])return this;var n=this._bounds[t],i=n.sphere,r=this.geometry;if(!1===n.sphereInitialized){i.makeEmpty(),this.getBoundingBoxAt(t,ol),ol.getCenter(i.center);var _e161=r.index,_s57=r.attributes.position,_a47=this._drawRanges[t];var _o32=0;for(var _t175=_a47.start,_n140=_a47.start+_a47.count;_t175<_n140;_t175++){var _n141=_t175;_e161&&(_n141=_e161.getX(_n141)),cl.fromBufferAttribute(_s57,_n141),_o32=Math.max(_o32,i.center.distanceToSquared(cl));}i.radius=Math.sqrt(_o32),n.sphereInitialized=!0;}return e.copy(i),e;}},{key:"setMatrixAt",value:function setMatrixAt(t,e){var n=this._active,i=this._matricesTexture,r=this._matricesTexture.image.data;return t>=this._geometryCount||!1===n[t]||(e.toArray(r,16*t),i.needsUpdate=!0),this;}},{key:"getMatrixAt",value:function getMatrixAt(t,e){var n=this._active,i=this._matricesTexture.image.data;return t>=this._geometryCount||!1===n[t]?null:e.fromArray(i,16*t);}},{key:"setVisibleAt",value:function setVisibleAt(t,e){var n=this._visibility,i=this._active;return t>=this._geometryCount||!1===i[t]||n[t]===e||(n[t]=e,this._visibilityChanged=!0),this;}},{key:"getVisibleAt",value:function getVisibleAt(t){var e=this._visibility,n=this._active;return!(t>=this._geometryCount||!1===n[t])&&e[t];}},{key:"raycast",value:function raycast(t,e){var n=this._visibility,i=this._active,r=this._drawRanges,s=this._geometryCount,a=this.matrixWorld,o=this.geometry;ul.material=this.material,ul.geometry.index=o.index,ul.geometry.attributes=o.attributes,null===ul.geometry.boundingBox&&(ul.geometry.boundingBox=new qe()),null===ul.geometry.boundingSphere&&(ul.geometry.boundingSphere=new dn());for(var _o33=0;_o33<s;_o33++){if(!n[_o33]||!i[_o33])continue;var _s58=r[_o33];ul.geometry.setDrawRange(_s58.start,_s58.count),this.getMatrixAt(_o33,ul.matrixWorld).premultiply(a),this.getBoundingBoxAt(_o33,ul.geometry.boundingBox),this.getBoundingSphereAt(_o33,ul.geometry.boundingSphere),ul.raycast(t,dl);for(var _t176=0,_n142=dl.length;_t176<_n142;_t176++){var _n143=dl[_t176];_n143.object=this,_n143.batchId=_o33,e.push(_n143);}dl.length=0;}ul.material=null,ul.geometry.index=null,ul.geometry.attributes={},ul.geometry.setDrawRange(0,1/0);}},{key:"copy",value:function copy(t){return _get(_getPrototypeOf(ml.prototype),"copy",this).call(this,t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=null!==t.boundingBox?t.boundingBox.clone():null,this.boundingSphere=null!==t.boundingSphere?t.boundingSphere.clone():null,this._drawRanges=t._drawRanges.map(function(t){return _objectSpread({},t);}),this._reservedRanges=t._reservedRanges.map(function(t){return _objectSpread({},t);}),this._visibility=t._visibility.slice(),this._active=t._active.slice(),this._bounds=t._bounds.map(function(t){return{boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()};}),this._maxGeometryCount=t._maxGeometryCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this;}},{key:"dispose",value:function dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this;}},{key:"onBeforeRender",value:function onBeforeRender(t,e,n,i,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;var s=i.getIndex(),a=null===s?1:s.array.BYTES_PER_ELEMENT,o=this._visibility,l=this._multiDrawStarts,c=this._multiDrawCounts,h=this._drawRanges,u=this.perObjectFrustumCulled;u&&(sl.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),al.setFromProjectionMatrix(sl,t.isWebGPURenderer?Qt:$t));var d=0;if(this.sortObjects){il.copy(this.matrixWorld).invert(),cl.setFromMatrixPosition(n.matrixWorld).applyMatrix4(il);for(var _t177=0,_e162=o.length;_t177<_e162;_t177++)if(o[_t177]){this.getMatrixAt(_t177,nl),this.getBoundingSphereAt(_t177,ll).applyMatrix4(nl);var _e163=!1;if(u&&(_e163=!al.intersectsSphere(ll)),!_e163){var _e164=cl.distanceTo(ll.center);hl.push(h[_t177],_e164);}}var _t178=hl.list,_e165=this.customSort;null===_e165?_t178.sort(r.transparent?Qo:$o):_e165.call(this,_t178,n);for(var _e166=0,_n144=_t178.length;_e166<_n144;_e166++){var _n145=_t178[_e166];l[d]=_n145.start*a,c[d]=_n145.count,d++;}hl.reset();}else for(var _t179=0,_e167=o.length;_t179<_e167;_t179++)if(o[_t179]){var _e168=!1;if(u&&(this.getMatrixAt(_t179,nl),this.getBoundingSphereAt(_t179,ll).applyMatrix4(nl),_e168=!al.intersectsSphere(ll)),!_e168){var _e169=h[_t179];l[d]=_e169.start*a,c[d]=_e169.count,d++;}}this._multiDrawCount=d,this._visibilityChanged=!1;}},{key:"onBeforeShadow",value:function onBeforeShadow(t,e,n,i,r,s){this.onBeforeRender(t,null,i,r,s);}}]);return ml;}(Ji);var fl=/*#__PURE__*/function(_di6){_inherits(fl,_di6);var _super40=_createSuper(fl);function fl(t){var _this36;_classCallCheck(this,fl);_this36=_super40.call(this),_this36.isLineBasicMaterial=!0,_this36.type="LineBasicMaterial",_this36.color=new ci(16777215),_this36.map=null,_this36.linewidth=1,_this36.linecap="round",_this36.linejoin="round",_this36.fog=!0,_this36.setValues(t);return _this36;}_createClass(fl,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(fl.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this;}}]);return fl;}(di);var gl=new We(),_l=new We(),vl=new Mn(),xl=new yn(),yl=new dn();var Ml=/*#__PURE__*/function(_jn9){_inherits(Ml,_jn9);var _super41=_createSuper(Ml);function Ml(){var _this37;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Ii();var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new fl();_classCallCheck(this,Ml);_this37=_super41.call(this),_this37.isLine=!0,_this37.type="Line",_this37.geometry=t,_this37.material=e,_this37.updateMorphTargets();return _this37;}_createClass(Ml,[{key:"copy",value:function copy(t,e){return _get(_getPrototypeOf(Ml.prototype),"copy",this).call(this,t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this;}},{key:"computeLineDistances",value:function computeLineDistances(){var t=this.geometry;if(null===t.index){var _e170=t.attributes.position,_n146=[0];for(var _t180=1,_i132=_e170.count;_t180<_i132;_t180++)gl.fromBufferAttribute(_e170,_t180-1),_l.fromBufferAttribute(_e170,_t180),_n146[_t180]=_n146[_t180-1],_n146[_t180]+=gl.distanceTo(_l);t.setAttribute("lineDistance",new Ti(_n146,1));}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this;}},{key:"raycast",value:function raycast(t,e){var n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),yl.copy(n.boundingSphere),yl.applyMatrix4(i),yl.radius+=r,!1===t.ray.intersectsSphere(yl))return;vl.copy(i).invert(),xl.copy(t.ray).applyMatrix4(vl);var a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new We(),c=new We(),h=new We(),u=new We(),d=this.isLineSegments?2:1,p=n.index,m=n.attributes.position;if(null!==p){for(var _n147=Math.max(0,s.start),_i133=Math.min(p.count,s.start+s.count)-1;_n147<_i133;_n147+=d){var _i134=p.getX(_n147),_r104=p.getX(_n147+1);l.fromBufferAttribute(m,_i134),c.fromBufferAttribute(m,_r104);if(xl.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);var _s59=t.ray.origin.distanceTo(u);_s59<t.near||_s59>t.far||e.push({distance:_s59,point:h.clone().applyMatrix4(this.matrixWorld),index:_n147,face:null,faceIndex:null,object:this});}}else{for(var _n148=Math.max(0,s.start),_i135=Math.min(m.count,s.start+s.count)-1;_n148<_i135;_n148+=d){l.fromBufferAttribute(m,_n148),c.fromBufferAttribute(m,_n148+1);if(xl.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);var _i136=t.ray.origin.distanceTo(u);_i136<t.near||_i136>t.far||e.push({distance:_i136,point:h.clone().applyMatrix4(this.matrixWorld),index:_n148,face:null,faceIndex:null,object:this});}}}},{key:"updateMorphTargets",value:function updateMorphTargets(){var t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){var _n149=t[e[0]];if(void 0!==_n149){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var _t181=0,_e171=_n149.length;_t181<_e171;_t181++){var _e172=_n149[_t181].name||String(_t181);this.morphTargetInfluences.push(0),this.morphTargetDictionary[_e172]=_t181;}}}}}]);return Ml;}(jn);var Sl=new We(),bl=new We();var Tl=/*#__PURE__*/function(_Ml){_inherits(Tl,_Ml);var _super42=_createSuper(Tl);function Tl(t,e){var _this38;_classCallCheck(this,Tl);_this38=_super42.call(this,t,e),_this38.isLineSegments=!0,_this38.type="LineSegments";return _this38;}_createClass(Tl,[{key:"computeLineDistances",value:function computeLineDistances(){var t=this.geometry;if(null===t.index){var _e173=t.attributes.position,_n150=[];for(var _t182=0,_i137=_e173.count;_t182<_i137;_t182+=2)Sl.fromBufferAttribute(_e173,_t182),bl.fromBufferAttribute(_e173,_t182+1),_n150[_t182]=0===_t182?0:_n150[_t182-1],_n150[_t182+1]=_n150[_t182]+Sl.distanceTo(bl);t.setAttribute("lineDistance",new Ti(_n150,1));}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this;}}]);return Tl;}(Ml);var El=/*#__PURE__*/function(_Ml2){_inherits(El,_Ml2);var _super43=_createSuper(El);function El(t,e){var _this39;_classCallCheck(this,El);_this39=_super43.call(this,t,e),_this39.isLineLoop=!0,_this39.type="LineLoop";return _this39;}return _createClass(El);}(Ml);var wl=/*#__PURE__*/function(_di7){_inherits(wl,_di7);var _super44=_createSuper(wl);function wl(t){var _this40;_classCallCheck(this,wl);_this40=_super44.call(this),_this40.isPointsMaterial=!0,_this40.type="PointsMaterial",_this40.color=new ci(16777215),_this40.map=null,_this40.alphaMap=null,_this40.size=1,_this40.sizeAttenuation=!0,_this40.fog=!0,_this40.setValues(t);return _this40;}_createClass(wl,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(wl.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this;}}]);return wl;}(di);var Al=new Mn(),Rl=new yn(),Cl=new dn(),Ll=new We();var Pl=/*#__PURE__*/function(_jn10){_inherits(Pl,_jn10);var _super45=_createSuper(Pl);function Pl(){var _this41;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Ii();var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new wl();_classCallCheck(this,Pl);_this41=_super45.call(this),_this41.isPoints=!0,_this41.type="Points",_this41.geometry=t,_this41.material=e,_this41.updateMorphTargets();return _this41;}_createClass(Pl,[{key:"copy",value:function copy(t,e){return _get(_getPrototypeOf(Pl.prototype),"copy",this).call(this,t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this;}},{key:"raycast",value:function raycast(t,e){var n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Cl.copy(n.boundingSphere),Cl.applyMatrix4(i),Cl.radius+=r,!1===t.ray.intersectsSphere(Cl))return;Al.copy(i).invert(),Rl.copy(t.ray).applyMatrix4(Al);var a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=n.index,c=n.attributes.position;if(null!==l){for(var _n151=Math.max(0,s.start),_r105=Math.min(l.count,s.start+s.count);_n151<_r105;_n151++){var _r106=l.getX(_n151);Ll.fromBufferAttribute(c,_r106),Il(Ll,_r106,o,i,t,e,this);}}else{for(var _n152=Math.max(0,s.start),_r107=Math.min(c.count,s.start+s.count);_n152<_r107;_n152++)Ll.fromBufferAttribute(c,_n152),Il(Ll,_n152,o,i,t,e,this);}}},{key:"updateMorphTargets",value:function updateMorphTargets(){var t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){var _n153=t[e[0]];if(void 0!==_n153){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var _t183=0,_e174=_n153.length;_t183<_e174;_t183++){var _e175=_n153[_t183].name||String(_t183);this.morphTargetInfluences.push(0),this.morphTargetDictionary[_e175]=_t183;}}}}}]);return Pl;}(jn);function Il(t,e,n,i,r,s,a){var o=Rl.distanceSqToPoint(t);if(o<n){var _n154=new We();Rl.closestPointToPoint(t,_n154),_n154.applyMatrix4(i);var _l16=r.ray.origin.distanceTo(_n154);if(_l16<r.near||_l16>r.far)return;s.push({distance:_l16,distanceToRay:Math.sqrt(o),point:_n154,index:e,face:null,object:a});}}var Ul=/*#__PURE__*/function(_Fe6){_inherits(Ul,_Fe6);var _super46=_createSuper(Ul);function Ul(t,e,n,i,r,s,a,o,l,c,h,u){var _this42;_classCallCheck(this,Ul);_this42=_super46.call(this,null,s,a,o,l,c,i,r,h,u),_this42.isCompressedTexture=!0,_this42.image={width:e,height:n},_this42.mipmaps=t,_this42.flipY=!1,_this42.generateMipmaps=!1;return _this42;}return _createClass(Ul);}(Fe);var Dl=/*#__PURE__*/function(){function Dl(){_classCallCheck(this,Dl);this.type="Curve",this.arcLengthDivisions=200;}_createClass(Dl,[{key:"getPoint",value:function getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null;}},{key:"getPointAt",value:function getPointAt(t,e){var n=this.getUtoTmapping(t);return this.getPoint(n,e);}},{key:"getPoints",value:function getPoints(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:5;var e=[];for(var _n155=0;_n155<=t;_n155++)e.push(this.getPoint(_n155/t));return e;}},{key:"getSpacedPoints",value:function getSpacedPoints(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:5;var e=[];for(var _n156=0;_n156<=t;_n156++)e.push(this.getPointAt(_n156/t));return e;}},{key:"getLength",value:function getLength(){var t=this.getLengths();return t[t.length-1];}},{key:"getLengths",value:function getLengths(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e=[];var n,i=this.getPoint(0),r=0;e.push(0);for(var _s60=1;_s60<=t;_s60++)n=this.getPoint(_s60/t),r+=n.distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e;}},{key:"updateArcLengths",value:function updateArcLengths(){this.needsUpdate=!0,this.getLengths();}},{key:"getUtoTmapping",value:function getUtoTmapping(t,e){var n=this.getLengths();var i=0;var r=n.length;var s;s=e||t*n[r-1];var a,o=0,l=r-1;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),a=n[i]-s,a<0)o=i+1;else{if(!(a>0)){l=i;break;}l=i-1;}if(i=l,n[i]===s)return i/(r-1);var c=n[i];return(i+(s-c)/(n[i+1]-c))/(r-1);}},{key:"getTangent",value:function getTangent(t,e){var n=1e-4;var i=t-n,r=t+n;i<0&&(i=0),r>1&&(r=1);var s=this.getPoint(i),a=this.getPoint(r),o=e||(s.isVector2?new me():new We());return o.copy(a).sub(s).normalize(),o;}},{key:"getTangentAt",value:function getTangentAt(t,e){var n=this.getUtoTmapping(t);return this.getTangent(n,e);}},{key:"computeFrenetFrames",value:function computeFrenetFrames(t,e){var n=new We(),i=[],r=[],s=[],a=new We(),o=new Mn();for(var _e176=0;_e176<=t;_e176++){var _n157=_e176/t;i[_e176]=this.getTangentAt(_n157,new We());}r[0]=new We(),s[0]=new We();var l=Number.MAX_VALUE;var c=Math.abs(i[0].x),h=Math.abs(i[0].y),u=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),u<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(var _e177=1;_e177<=t;_e177++){if(r[_e177]=r[_e177-1].clone(),s[_e177]=s[_e177-1].clone(),a.crossVectors(i[_e177-1],i[_e177]),a.length()>Number.EPSILON){a.normalize();var _t184=Math.acos(ae(i[_e177-1].dot(i[_e177]),-1,1));r[_e177].applyMatrix4(o.makeRotationAxis(a,_t184));}s[_e177].crossVectors(i[_e177],r[_e177]);}if(!0===e){var _e178=Math.acos(ae(r[0].dot(r[t]),-1,1));_e178/=t,i[0].dot(a.crossVectors(r[0],r[t]))>0&&(_e178=-_e178);for(var _n158=1;_n158<=t;_n158++)r[_n158].applyMatrix4(o.makeRotationAxis(i[_n158],_e178*_n158)),s[_n158].crossVectors(i[_n158],r[_n158]);}return{tangents:i,normals:r,binormals:s};}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}},{key:"copy",value:function copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this;}},{key:"toJSON",value:function toJSON(){var t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t;}},{key:"fromJSON",value:function fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this;}}]);return Dl;}();var Nl=/*#__PURE__*/function(_Dl){_inherits(Nl,_Dl);var _super47=_createSuper(Nl);function Nl(){var _this43;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:2*Math.PI;var a=arguments.length>6&&arguments[6]!==undefined?arguments[6]:!1;var o=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;_classCallCheck(this,Nl);_this43=_super47.call(this),_this43.isEllipseCurve=!0,_this43.type="EllipseCurve",_this43.aX=t,_this43.aY=e,_this43.xRadius=n,_this43.yRadius=i,_this43.aStartAngle=r,_this43.aEndAngle=s,_this43.aClockwise=a,_this43.aRotation=o;return _this43;}_createClass(Nl,[{key:"getPoint",value:function getPoint(t,e){var n=e||new me(),i=2*Math.PI;var r=this.aEndAngle-this.aStartAngle;var s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);var a=this.aStartAngle+t*r;var o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var _t185=Math.cos(this.aRotation),_e179=Math.sin(this.aRotation),_n159=o-this.aX,_i138=l-this.aY;o=_n159*_t185-_i138*_e179+this.aX,l=_n159*_e179+_i138*_t185+this.aY;}return n.set(o,l);}},{key:"copy",value:function copy(t){return _get(_getPrototypeOf(Nl.prototype),"copy",this).call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(Nl.prototype),"toJSON",this).call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t;}},{key:"fromJSON",value:function fromJSON(t){return _get(_getPrototypeOf(Nl.prototype),"fromJSON",this).call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this;}}]);return Nl;}(Dl);var Ol=/*#__PURE__*/function(_Nl){_inherits(Ol,_Nl);var _super48=_createSuper(Ol);function Ol(t,e,n,i,r,s){var _this44;_classCallCheck(this,Ol);_this44=_super48.call(this,t,e,n,n,i,r,s),_this44.isArcCurve=!0,_this44.type="ArcCurve";return _this44;}return _createClass(Ol);}(Nl);function Fl(){var t=0,e=0,n=0,i=0;function r(r,s,a,o){t=r,e=a,n=-3*r+3*s-2*a-o,i=2*r-2*s+a+o;}return{initCatmullRom:function initCatmullRom(t,e,n,i,s){r(e,n,s*(n-t),s*(i-e));},initNonuniformCatmullRom:function initNonuniformCatmullRom(t,e,n,i,s,a,o){var l=(e-t)/s-(n-t)/(s+a)+(n-e)/a,c=(n-e)/a-(i-e)/(a+o)+(i-n)/o;l*=a,c*=a,r(e,n,l,c);},calc:function calc(r){var s=r*r;return t+e*r+n*s+i*(s*r);}};}var Bl=new We(),zl=new Fl(),Gl=new Fl(),Hl=new Fl();var Vl=/*#__PURE__*/function(_Dl2){_inherits(Vl,_Dl2);var _super49=_createSuper(Vl);function Vl(){var _this45;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"centripetal";var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:.5;_classCallCheck(this,Vl);_this45=_super49.call(this),_this45.isCatmullRomCurve3=!0,_this45.type="CatmullRomCurve3",_this45.points=t,_this45.closed=e,_this45.curveType=n,_this45.tension=i;return _this45;}_createClass(Vl,[{key:"getPoint",value:function getPoint(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new We();var n=e,i=this.points,r=i.length,s=(r-(this.closed?0:1))*t;var a,o,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?a=i[(l-1)%r]:(Bl.subVectors(i[0],i[1]).add(i[0]),a=Bl);var h=i[l%r],u=i[(l+1)%r];if(this.closed||l+2<r?o=i[(l+2)%r]:(Bl.subVectors(i[r-1],i[r-2]).add(i[r-1]),o=Bl),"centripetal"===this.curveType||"chordal"===this.curveType){var _t186="chordal"===this.curveType?.5:.25;var _e180=Math.pow(a.distanceToSquared(h),_t186),_n160=Math.pow(h.distanceToSquared(u),_t186),_i139=Math.pow(u.distanceToSquared(o),_t186);_n160<1e-4&&(_n160=1),_e180<1e-4&&(_e180=_n160),_i139<1e-4&&(_i139=_n160),zl.initNonuniformCatmullRom(a.x,h.x,u.x,o.x,_e180,_n160,_i139),Gl.initNonuniformCatmullRom(a.y,h.y,u.y,o.y,_e180,_n160,_i139),Hl.initNonuniformCatmullRom(a.z,h.z,u.z,o.z,_e180,_n160,_i139);}else"catmullrom"===this.curveType&&(zl.initCatmullRom(a.x,h.x,u.x,o.x,this.tension),Gl.initCatmullRom(a.y,h.y,u.y,o.y,this.tension),Hl.initCatmullRom(a.z,h.z,u.z,o.z,this.tension));return n.set(zl.calc(c),Gl.calc(c),Hl.calc(c)),n;}},{key:"copy",value:function copy(t){_get(_getPrototypeOf(Vl.prototype),"copy",this).call(this,t),this.points=[];for(var _e181=0,_n161=t.points.length;_e181<_n161;_e181++){var _n162=t.points[_e181];this.points.push(_n162.clone());}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(Vl.prototype),"toJSON",this).call(this);t.points=[];for(var _e182=0,_n163=this.points.length;_e182<_n163;_e182++){var _n164=this.points[_e182];t.points.push(_n164.toArray());}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t;}},{key:"fromJSON",value:function fromJSON(t){_get(_getPrototypeOf(Vl.prototype),"fromJSON",this).call(this,t),this.points=[];for(var _e183=0,_n165=t.points.length;_e183<_n165;_e183++){var _n166=t.points[_e183];this.points.push(new We().fromArray(_n166));}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this;}}]);return Vl;}(Dl);function kl(t,e,n,i,r){var s=.5*(i-e),a=.5*(r-n),o=t*t;return(2*n-2*i+s+a)*(t*o)+(-3*n+3*i-2*s-a)*o+s*t+n;}function Wl(t,e,n,i){return function(t,e){var n=1-t;return n*n*e;}(t,e)+function(t,e){return 2*(1-t)*t*e;}(t,n)+function(t,e){return t*t*e;}(t,i);}function Xl(t,e,n,i,r){return function(t,e){var n=1-t;return n*n*n*e;}(t,e)+function(t,e){var n=1-t;return 3*n*n*t*e;}(t,n)+function(t,e){return 3*(1-t)*t*t*e;}(t,i)+function(t,e){return t*t*t*e;}(t,r);}var jl=/*#__PURE__*/function(_Dl3){_inherits(jl,_Dl3);var _super50=_createSuper(jl);function jl(){var _this46;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new me();var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new me();var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new me();var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:new me();_classCallCheck(this,jl);_this46=_super50.call(this),_this46.isCubicBezierCurve=!0,_this46.type="CubicBezierCurve",_this46.v0=t,_this46.v1=e,_this46.v2=n,_this46.v3=i;return _this46;}_createClass(jl,[{key:"getPoint",value:function getPoint(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new me();var n=e,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(Xl(t,i.x,r.x,s.x,a.x),Xl(t,i.y,r.y,s.y,a.y)),n;}},{key:"copy",value:function copy(t){return _get(_getPrototypeOf(jl.prototype),"copy",this).call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(jl.prototype),"toJSON",this).call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t;}},{key:"fromJSON",value:function fromJSON(t){return _get(_getPrototypeOf(jl.prototype),"fromJSON",this).call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this;}}]);return jl;}(Dl);var ql=/*#__PURE__*/function(_Dl4){_inherits(ql,_Dl4);var _super51=_createSuper(ql);function ql(){var _this47;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new We();var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new We();var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new We();var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:new We();_classCallCheck(this,ql);_this47=_super51.call(this),_this47.isCubicBezierCurve3=!0,_this47.type="CubicBezierCurve3",_this47.v0=t,_this47.v1=e,_this47.v2=n,_this47.v3=i;return _this47;}_createClass(ql,[{key:"getPoint",value:function getPoint(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new We();var n=e,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(Xl(t,i.x,r.x,s.x,a.x),Xl(t,i.y,r.y,s.y,a.y),Xl(t,i.z,r.z,s.z,a.z)),n;}},{key:"copy",value:function copy(t){return _get(_getPrototypeOf(ql.prototype),"copy",this).call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(ql.prototype),"toJSON",this).call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t;}},{key:"fromJSON",value:function fromJSON(t){return _get(_getPrototypeOf(ql.prototype),"fromJSON",this).call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this;}}]);return ql;}(Dl);var Yl=/*#__PURE__*/function(_Dl5){_inherits(Yl,_Dl5);var _super52=_createSuper(Yl);function Yl(){var _this48;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new me();var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new me();_classCallCheck(this,Yl);_this48=_super52.call(this),_this48.isLineCurve=!0,_this48.type="LineCurve",_this48.v1=t,_this48.v2=e;return _this48;}_createClass(Yl,[{key:"getPoint",value:function getPoint(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new me();var n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n;}},{key:"getPointAt",value:function getPointAt(t,e){return this.getPoint(t,e);}},{key:"getTangent",value:function getTangent(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new me();return e.subVectors(this.v2,this.v1).normalize();}},{key:"getTangentAt",value:function getTangentAt(t,e){return this.getTangent(t,e);}},{key:"copy",value:function copy(t){return _get(_getPrototypeOf(Yl.prototype),"copy",this).call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(Yl.prototype),"toJSON",this).call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t;}},{key:"fromJSON",value:function fromJSON(t){return _get(_getPrototypeOf(Yl.prototype),"fromJSON",this).call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this;}}]);return Yl;}(Dl);var Zl=/*#__PURE__*/function(_Dl6){_inherits(Zl,_Dl6);var _super53=_createSuper(Zl);function Zl(){var _this49;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new We();var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new We();_classCallCheck(this,Zl);_this49=_super53.call(this),_this49.isLineCurve3=!0,_this49.type="LineCurve3",_this49.v1=t,_this49.v2=e;return _this49;}_createClass(Zl,[{key:"getPoint",value:function getPoint(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new We();var n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n;}},{key:"getPointAt",value:function getPointAt(t,e){return this.getPoint(t,e);}},{key:"getTangent",value:function getTangent(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new We();return e.subVectors(this.v2,this.v1).normalize();}},{key:"getTangentAt",value:function getTangentAt(t,e){return this.getTangent(t,e);}},{key:"copy",value:function copy(t){return _get(_getPrototypeOf(Zl.prototype),"copy",this).call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(Zl.prototype),"toJSON",this).call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t;}},{key:"fromJSON",value:function fromJSON(t){return _get(_getPrototypeOf(Zl.prototype),"fromJSON",this).call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this;}}]);return Zl;}(Dl);var Jl=/*#__PURE__*/function(_Dl7){_inherits(Jl,_Dl7);var _super54=_createSuper(Jl);function Jl(){var _this50;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new me();var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new me();var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new me();_classCallCheck(this,Jl);_this50=_super54.call(this),_this50.isQuadraticBezierCurve=!0,_this50.type="QuadraticBezierCurve",_this50.v0=t,_this50.v1=e,_this50.v2=n;return _this50;}_createClass(Jl,[{key:"getPoint",value:function getPoint(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new me();var n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(Wl(t,i.x,r.x,s.x),Wl(t,i.y,r.y,s.y)),n;}},{key:"copy",value:function copy(t){return _get(_getPrototypeOf(Jl.prototype),"copy",this).call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(Jl.prototype),"toJSON",this).call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t;}},{key:"fromJSON",value:function fromJSON(t){return _get(_getPrototypeOf(Jl.prototype),"fromJSON",this).call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this;}}]);return Jl;}(Dl);var Kl=/*#__PURE__*/function(_Dl8){_inherits(Kl,_Dl8);var _super55=_createSuper(Kl);function Kl(){var _this51;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new We();var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new We();var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new We();_classCallCheck(this,Kl);_this51=_super55.call(this),_this51.isQuadraticBezierCurve3=!0,_this51.type="QuadraticBezierCurve3",_this51.v0=t,_this51.v1=e,_this51.v2=n;return _this51;}_createClass(Kl,[{key:"getPoint",value:function getPoint(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new We();var n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(Wl(t,i.x,r.x,s.x),Wl(t,i.y,r.y,s.y),Wl(t,i.z,r.z,s.z)),n;}},{key:"copy",value:function copy(t){return _get(_getPrototypeOf(Kl.prototype),"copy",this).call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(Kl.prototype),"toJSON",this).call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t;}},{key:"fromJSON",value:function fromJSON(t){return _get(_getPrototypeOf(Kl.prototype),"fromJSON",this).call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this;}}]);return Kl;}(Dl);var $l=/*#__PURE__*/function(_Dl9){_inherits($l,_Dl9);var _super56=_createSuper($l);function $l(){var _this52;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];_classCallCheck(this,$l);_this52=_super56.call(this),_this52.isSplineCurve=!0,_this52.type="SplineCurve",_this52.points=t;return _this52;}_createClass($l,[{key:"getPoint",value:function getPoint(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new me();var n=e,i=this.points,r=(i.length-1)*t,s=Math.floor(r),a=r-s,o=i[0===s?s:s-1],l=i[s],c=i[s>i.length-2?i.length-1:s+1],h=i[s>i.length-3?i.length-1:s+2];return n.set(kl(a,o.x,l.x,c.x,h.x),kl(a,o.y,l.y,c.y,h.y)),n;}},{key:"copy",value:function copy(t){_get(_getPrototypeOf($l.prototype),"copy",this).call(this,t),this.points=[];for(var _e184=0,_n167=t.points.length;_e184<_n167;_e184++){var _n168=t.points[_e184];this.points.push(_n168.clone());}return this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf($l.prototype),"toJSON",this).call(this);t.points=[];for(var _e185=0,_n169=this.points.length;_e185<_n169;_e185++){var _n170=this.points[_e185];t.points.push(_n170.toArray());}return t;}},{key:"fromJSON",value:function fromJSON(t){_get(_getPrototypeOf($l.prototype),"fromJSON",this).call(this,t),this.points=[];for(var _e186=0,_n171=t.points.length;_e186<_n171;_e186++){var _n172=t.points[_e186];this.points.push(new me().fromArray(_n172));}return this;}}]);return $l;}(Dl);var Ql=Object.freeze({__proto__:null,ArcCurve:Ol,CatmullRomCurve3:Vl,CubicBezierCurve:jl,CubicBezierCurve3:ql,EllipseCurve:Nl,LineCurve:Yl,LineCurve3:Zl,QuadraticBezierCurve:Jl,QuadraticBezierCurve3:Kl,SplineCurve:$l});var tc=/*#__PURE__*/function(_Dl10){_inherits(tc,_Dl10);var _super57=_createSuper(tc);function tc(){var _this53;_classCallCheck(this,tc);_this53=_super57.call(this),_this53.type="CurvePath",_this53.curves=[],_this53.autoClose=!1;return _this53;}_createClass(tc,[{key:"add",value:function add(t){this.curves.push(t);}},{key:"closePath",value:function closePath(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){var _n173=!0===t.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Ql[_n173](e,t));}return this;}},{key:"getPoint",value:function getPoint(t,e){var n=t*this.getLength(),i=this.getCurveLengths();var r=0;for(;r<i.length;){if(i[r]>=n){var _t187=i[r]-n,_s61=this.curves[r],_a48=_s61.getLength(),_o34=0===_a48?0:1-_t187/_a48;return _s61.getPointAt(_o34,e);}r++;}return null;}},{key:"getLength",value:function getLength(){var t=this.getCurveLengths();return t[t.length-1];}},{key:"updateArcLengths",value:function updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths();}},{key:"getCurveLengths",value:function getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;var t=[];var e=0;for(var _n174=0,_i140=this.curves.length;_n174<_i140;_n174++)e+=this.curves[_n174].getLength(),t.push(e);return this.cacheLengths=t,t;}},{key:"getSpacedPoints",value:function getSpacedPoints(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:40;var e=[];for(var _n175=0;_n175<=t;_n175++)e.push(this.getPoint(_n175/t));return this.autoClose&&e.push(e[0]),e;}},{key:"getPoints",value:function getPoints(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:12;var e=[];var n;for(var _i141=0,_r108=this.curves;_i141<_r108.length;_i141++){var _s62=_r108[_i141],_a49=_s62.isEllipseCurve?2*t:_s62.isLineCurve||_s62.isLineCurve3?1:_s62.isSplineCurve?t*_s62.points.length:t,_o35=_s62.getPoints(_a49);for(var _t188=0;_t188<_o35.length;_t188++){var _i142=_o35[_t188];n&&n.equals(_i142)||(e.push(_i142),n=_i142);}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e;}},{key:"copy",value:function copy(t){_get(_getPrototypeOf(tc.prototype),"copy",this).call(this,t),this.curves=[];for(var _e187=0,_n176=t.curves.length;_e187<_n176;_e187++){var _n177=t.curves[_e187];this.curves.push(_n177.clone());}return this.autoClose=t.autoClose,this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(tc.prototype),"toJSON",this).call(this);t.autoClose=this.autoClose,t.curves=[];for(var _e188=0,_n178=this.curves.length;_e188<_n178;_e188++){var _n179=this.curves[_e188];t.curves.push(_n179.toJSON());}return t;}},{key:"fromJSON",value:function fromJSON(t){_get(_getPrototypeOf(tc.prototype),"fromJSON",this).call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var _e189=0,_n180=t.curves.length;_e189<_n180;_e189++){var _n181=t.curves[_e189];this.curves.push(new Ql[_n181.type]().fromJSON(_n181));}return this;}}]);return tc;}(Dl);var ec=/*#__PURE__*/function(_tc){_inherits(ec,_tc);var _super58=_createSuper(ec);function ec(t){var _this54;_classCallCheck(this,ec);_this54=_super58.call(this),_this54.type="Path",_this54.currentPoint=new me(),t&&_this54.setFromPoints(t);return _this54;}_createClass(ec,[{key:"setFromPoints",value:function setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(var _e190=1,_n182=t.length;_e190<_n182;_e190++)this.lineTo(t[_e190].x,t[_e190].y);return this;}},{key:"moveTo",value:function moveTo(t,e){return this.currentPoint.set(t,e),this;}},{key:"lineTo",value:function lineTo(t,e){var n=new Yl(this.currentPoint.clone(),new me(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this;}},{key:"quadraticCurveTo",value:function quadraticCurveTo(t,e,n,i){var r=new Jl(this.currentPoint.clone(),new me(t,e),new me(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this;}},{key:"bezierCurveTo",value:function bezierCurveTo(t,e,n,i,r,s){var a=new jl(this.currentPoint.clone(),new me(t,e),new me(n,i),new me(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this;}},{key:"splineThru",value:function splineThru(t){var e=[this.currentPoint.clone()].concat(t),n=new $l(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this;}},{key:"arc",value:function arc(t,e,n,i,r,s){var a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,n,i,r,s),this;}},{key:"absarc",value:function absarc(t,e,n,i,r,s){return this.absellipse(t,e,n,n,i,r,s),this;}},{key:"ellipse",value:function ellipse(t,e,n,i,r,s,a,o){var l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,i,r,s,a,o),this;}},{key:"absellipse",value:function absellipse(t,e,n,i,r,s,a,o){var l=new Nl(t,e,n,i,r,s,a,o);if(this.curves.length>0){var _t189=l.getPoint(0);_t189.equals(this.currentPoint)||this.lineTo(_t189.x,_t189.y);}this.curves.push(l);var c=l.getPoint(1);return this.currentPoint.copy(c),this;}},{key:"copy",value:function copy(t){return _get(_getPrototypeOf(ec.prototype),"copy",this).call(this,t),this.currentPoint.copy(t.currentPoint),this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(ec.prototype),"toJSON",this).call(this);return t.currentPoint=this.currentPoint.toArray(),t;}},{key:"fromJSON",value:function fromJSON(t){return _get(_getPrototypeOf(ec.prototype),"fromJSON",this).call(this,t),this.currentPoint.fromArray(t.currentPoint),this;}}]);return ec;}(tc);var nc=/*#__PURE__*/function(_Ii3){_inherits(nc,_Ii3);var _super59=_createSuper(nc);function nc(){var _this55;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[new me(0,-.5),new me(.5,0),new me(0,.5)];var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:12;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:2*Math.PI;_classCallCheck(this,nc);_this55=_super59.call(this),_this55.type="LatheGeometry",_this55.parameters={points:t,segments:e,phiStart:n,phiLength:i},e=Math.floor(e),i=ae(i,0,2*Math.PI);var r=[],s=[],a=[],o=[],l=[],c=1/e,h=new We(),u=new me(),d=new We(),p=new We(),m=new We();var f=0,g=0;for(var _e191=0;_e191<=t.length-1;_e191++)switch(_e191){case 0:f=t[_e191+1].x-t[_e191].x,g=t[_e191+1].y-t[_e191].y,d.x=1*g,d.y=-f,d.z=0*g,m.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case t.length-1:o.push(m.x,m.y,m.z);break;default:f=t[_e191+1].x-t[_e191].x,g=t[_e191+1].y-t[_e191].y,d.x=1*g,d.y=-f,d.z=0*g,p.copy(d),d.x+=m.x,d.y+=m.y,d.z+=m.z,d.normalize(),o.push(d.x,d.y,d.z),m.copy(p);}for(var _r109=0;_r109<=e;_r109++){var _d10=n+_r109*c*i,_p10=Math.sin(_d10),_m6=Math.cos(_d10);for(var _n183=0;_n183<=t.length-1;_n183++){h.x=t[_n183].x*_p10,h.y=t[_n183].y,h.z=t[_n183].x*_m6,s.push(h.x,h.y,h.z),u.x=_r109/e,u.y=_n183/(t.length-1),a.push(u.x,u.y);var _i143=o[3*_n183+0]*_p10,_c16=o[3*_n183+1],_d11=o[3*_n183+0]*_m6;l.push(_i143,_c16,_d11);}}for(var _n184=0;_n184<e;_n184++)for(var _e192=0;_e192<t.length-1;_e192++){var _i144=_e192+_n184*t.length,_s63=_i144,_a50=_i144+t.length,_o36=_i144+t.length+1,_l17=_i144+1;r.push(_s63,_a50,_l17),r.push(_o36,_l17,_a50);}_this55.setIndex(r),_this55.setAttribute("position",new Ti(s,3)),_this55.setAttribute("uv",new Ti(a,2)),_this55.setAttribute("normal",new Ti(l,3));return _this55;}_createClass(nc,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(nc.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this;}}],[{key:"fromJSON",value:function fromJSON(t){return new nc(t.points,t.segments,t.phiStart,t.phiLength);}}]);return nc;}(Ii);var ic=/*#__PURE__*/function(_nc){_inherits(ic,_nc);var _super60=_createSuper(ic);function ic(){var _this56;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:4;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:8;_classCallCheck(this,ic);var r=new ec();r.absarc(0,-e/2,t,1.5*Math.PI,0),r.absarc(0,e/2,t,0,.5*Math.PI),_this56=_super60.call(this,r.getPoints(n),i),_this56.type="CapsuleGeometry",_this56.parameters={radius:t,length:e,capSegments:n,radialSegments:i};return _this56;}_createClass(ic,null,[{key:"fromJSON",value:function fromJSON(t){return new ic(t.radius,t.length,t.capSegments,t.radialSegments);}}]);return ic;}(nc);var rc=/*#__PURE__*/function(_Ii4){_inherits(rc,_Ii4);var _super61=_createSuper(rc);function rc(){var _this57;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:32;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:2*Math.PI;_classCallCheck(this,rc);_this57=_super61.call(this),_this57.type="CircleGeometry",_this57.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},e=Math.max(3,e);var r=[],s=[],a=[],o=[],l=new We(),c=new me();s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(var _r110=0,_h12=3;_r110<=e;_r110++,_h12+=3){var _u10=n+_r110/e*i;l.x=t*Math.cos(_u10),l.y=t*Math.sin(_u10),s.push(l.x,l.y,l.z),a.push(0,0,1),c.x=(s[_h12]/t+1)/2,c.y=(s[_h12+1]/t+1)/2,o.push(c.x,c.y);}for(var _t190=1;_t190<=e;_t190++)r.push(_t190,_t190+1,0);_this57.setIndex(r),_this57.setAttribute("position",new Ti(s,3)),_this57.setAttribute("normal",new Ti(a,3)),_this57.setAttribute("uv",new Ti(o,2));return _this57;}_createClass(rc,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(rc.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this;}}],[{key:"fromJSON",value:function fromJSON(t){return new rc(t.radius,t.segments,t.thetaStart,t.thetaLength);}}]);return rc;}(Ii);var sc=/*#__PURE__*/function(_Ii5){_inherits(sc,_Ii5);var _super62=_createSuper(sc);function sc(){var _this58;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:32;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:!1;var a=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var o=arguments.length>7&&arguments[7]!==undefined?arguments[7]:2*Math.PI;_classCallCheck(this,sc);_this58=_super62.call(this),_this58.type="CylinderGeometry",_this58.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};var l=_assertThisInitialized(_this58);i=Math.floor(i),r=Math.floor(r);var c=[],h=[],u=[],d=[];var p=0;var m=[],f=n/2;var g=0;function _(n){var r=p,s=new me(),m=new We();var _=0;var v=!0===n?t:e,x=!0===n?1:-1;for(var _t191=1;_t191<=i;_t191++)h.push(0,f*x,0),u.push(0,x,0),d.push(.5,.5),p++;var y=p;for(var _t192=0;_t192<=i;_t192++){var _e193=_t192/i*o+a,_n185=Math.cos(_e193),_r111=Math.sin(_e193);m.x=v*_r111,m.y=f*x,m.z=v*_n185,h.push(m.x,m.y,m.z),u.push(0,x,0),s.x=.5*_n185+.5,s.y=.5*_r111*x+.5,d.push(s.x,s.y),p++;}for(var _t193=0;_t193<i;_t193++){var _e194=r+_t193,_i145=y+_t193;!0===n?c.push(_i145,_i145+1,_e194):c.push(_i145+1,_i145,_e194),_+=3;}l.addGroup(g,_,!0===n?1:2),g+=_;}!function(){var s=new We(),_=new We();var v=0;var x=(e-t)/n;for(var _l18=0;_l18<=r;_l18++){var _c17=[],_g4=_l18/r,_v4=_g4*(e-t)+t;for(var _t194=0;_t194<=i;_t194++){var _e195=_t194/i,_r112=_e195*o+a,_l19=Math.sin(_r112),_m7=Math.cos(_r112);_.x=_v4*_l19,_.y=-_g4*n+f,_.z=_v4*_m7,h.push(_.x,_.y,_.z),s.set(_l19,x,_m7).normalize(),u.push(s.x,s.y,s.z),d.push(_e195,1-_g4),_c17.push(p++);}m.push(_c17);}for(var _t195=0;_t195<i;_t195++)for(var _e196=0;_e196<r;_e196++){var _n186=m[_e196][_t195],_i146=m[_e196+1][_t195],_r113=m[_e196+1][_t195+1],_s64=m[_e196][_t195+1];c.push(_n186,_i146,_s64),c.push(_i146,_r113,_s64),v+=6;}l.addGroup(g,v,0),g+=v;}(),!1===s&&(t>0&&_(!0),e>0&&_(!1)),_this58.setIndex(c),_this58.setAttribute("position",new Ti(h,3)),_this58.setAttribute("normal",new Ti(u,3)),_this58.setAttribute("uv",new Ti(d,2));return _this58;}_createClass(sc,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(sc.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this;}}],[{key:"fromJSON",value:function fromJSON(t){return new sc(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength);}}]);return sc;}(Ii);var ac=/*#__PURE__*/function(_sc){_inherits(ac,_sc);var _super63=_createSuper(ac);function ac(){var _this59;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:32;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:!1;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var a=arguments.length>6&&arguments[6]!==undefined?arguments[6]:2*Math.PI;_classCallCheck(this,ac);_this59=_super63.call(this,0,t,e,n,i,r,s,a),_this59.type="ConeGeometry",_this59.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:a};return _this59;}_createClass(ac,null,[{key:"fromJSON",value:function fromJSON(t){return new ac(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength);}}]);return ac;}(sc);var oc=/*#__PURE__*/function(_Ii6){_inherits(oc,_Ii6);var _super64=_createSuper(oc);function oc(){var _this60;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,oc);_this60=_super64.call(this),_this60.type="PolyhedronGeometry",_this60.parameters={vertices:t,indices:e,radius:n,detail:i};var r=[],s=[];function a(t,e,n,i){var r=i+1,s=[];for(var _i147=0;_i147<=r;_i147++){s[_i147]=[];var _a51=t.clone().lerp(n,_i147/r),_o37=e.clone().lerp(n,_i147/r),_l20=r-_i147;for(var _t196=0;_t196<=_l20;_t196++)s[_i147][_t196]=0===_t196&&_i147===r?_a51:_a51.clone().lerp(_o37,_t196/_l20);}for(var _t197=0;_t197<r;_t197++)for(var _e197=0;_e197<2*(r-_t197)-1;_e197++){var _n187=Math.floor(_e197/2);_e197%2==0?(o(s[_t197][_n187+1]),o(s[_t197+1][_n187]),o(s[_t197][_n187])):(o(s[_t197][_n187+1]),o(s[_t197+1][_n187+1]),o(s[_t197+1][_n187]));}}function o(t){r.push(t.x,t.y,t.z);}function l(e,n){var i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2];}function c(t,e,n,i){i<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=i/2/Math.PI+.5);}function h(t){return Math.atan2(t.z,-t.x);}!function(t){var n=new We(),i=new We(),r=new We();for(var _s65=0;_s65<e.length;_s65+=3)l(e[_s65+0],n),l(e[_s65+1],i),l(e[_s65+2],r),a(n,i,r,t);}(i),function(t){var e=new We();for(var _n188=0;_n188<r.length;_n188+=3)e.x=r[_n188+0],e.y=r[_n188+1],e.z=r[_n188+2],e.normalize().multiplyScalar(t),r[_n188+0]=e.x,r[_n188+1]=e.y,r[_n188+2]=e.z;}(n),function(){var t=new We();for(var _n189=0;_n189<r.length;_n189+=3){t.x=r[_n189+0],t.y=r[_n189+1],t.z=r[_n189+2];var _i148=h(t)/2/Math.PI+.5,_a52=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(_i148,1-_a52);}var e;(function(){var t=new We(),e=new We(),n=new We(),i=new We(),a=new me(),o=new me(),l=new me();for(var _u11=0,_d12=0;_u11<r.length;_u11+=9,_d12+=6){t.set(r[_u11+0],r[_u11+1],r[_u11+2]),e.set(r[_u11+3],r[_u11+4],r[_u11+5]),n.set(r[_u11+6],r[_u11+7],r[_u11+8]),a.set(s[_d12+0],s[_d12+1]),o.set(s[_d12+2],s[_d12+3]),l.set(s[_d12+4],s[_d12+5]),i.copy(t).add(e).add(n).divideScalar(3);var _p11=h(i);c(a,_d12+0,t,_p11),c(o,_d12+2,e,_p11),c(l,_d12+4,n,_p11);}})(),function(){for(var _t198=0;_t198<s.length;_t198+=6){var _e198=s[_t198+0],_n190=s[_t198+2],_i149=s[_t198+4],_r114=Math.max(_e198,_n190,_i149),_a53=Math.min(_e198,_n190,_i149);_r114>.9&&_a53<.1&&(_e198<.2&&(s[_t198+0]+=1),_n190<.2&&(s[_t198+2]+=1),_i149<.2&&(s[_t198+4]+=1));}}();}(),_this60.setAttribute("position",new Ti(r,3)),_this60.setAttribute("normal",new Ti(r.slice(),3)),_this60.setAttribute("uv",new Ti(s,2)),0===i?_this60.computeVertexNormals():_this60.normalizeNormals();return _this60;}_createClass(oc,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(oc.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this;}}],[{key:"fromJSON",value:function fromJSON(t){return new oc(t.vertices,t.indices,t.radius,t.details);}}]);return oc;}(Ii);var lc=/*#__PURE__*/function(_oc){_inherits(lc,_oc);var _super65=_createSuper(lc);function lc(){var _this61;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,lc);var n=(1+Math.sqrt(5))/2,i=1/n;_this61=_super65.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),_this61.type="DodecahedronGeometry",_this61.parameters={radius:t,detail:e};return _this61;}_createClass(lc,null,[{key:"fromJSON",value:function fromJSON(t){return new lc(t.radius,t.detail);}}]);return lc;}(oc);var cc=new We(),hc=new We(),uc=new We(),dc=new ri();var pc=/*#__PURE__*/function(_Ii7){_inherits(pc,_Ii7);var _super66=_createSuper(pc);function pc(){var _this62;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;_classCallCheck(this,pc);if(_this62=_super66.call(this),_this62.type="EdgesGeometry",_this62.parameters={geometry:t,thresholdAngle:e},null!==t){var _n191=4,_i150=Math.pow(10,_n191),_r115=Math.cos(ie*e),_s66=t.getIndex(),_a54=t.getAttribute("position"),_o38=_s66?_s66.count:_a54.count,_l21=[0,0,0],_c18=["a","b","c"],_h13=new Array(3),_u12={},_d13=[];for(var _t199=0;_t199<_o38;_t199+=3){_s66?(_l21[0]=_s66.getX(_t199),_l21[1]=_s66.getX(_t199+1),_l21[2]=_s66.getX(_t199+2)):(_l21[0]=_t199,_l21[1]=_t199+1,_l21[2]=_t199+2);var _e199=dc.a,_n192=dc.b,_o39=dc.c;if(_e199.fromBufferAttribute(_a54,_l21[0]),_n192.fromBufferAttribute(_a54,_l21[1]),_o39.fromBufferAttribute(_a54,_l21[2]),dc.getNormal(uc),_h13[0]="".concat(Math.round(_e199.x*_i150),",").concat(Math.round(_e199.y*_i150),",").concat(Math.round(_e199.z*_i150)),_h13[1]="".concat(Math.round(_n192.x*_i150),",").concat(Math.round(_n192.y*_i150),",").concat(Math.round(_n192.z*_i150)),_h13[2]="".concat(Math.round(_o39.x*_i150),",").concat(Math.round(_o39.y*_i150),",").concat(Math.round(_o39.z*_i150)),_h13[0]!==_h13[1]&&_h13[1]!==_h13[2]&&_h13[2]!==_h13[0])for(var _t200=0;_t200<3;_t200++){var _e200=(_t200+1)%3,_n193=_h13[_t200],_i151=_h13[_e200],_s67=dc[_c18[_t200]],_a55=dc[_c18[_e200]],_o40="".concat(_n193,"_").concat(_i151),_p12="".concat(_i151,"_").concat(_n193);_p12 in _u12&&_u12[_p12]?(uc.dot(_u12[_p12].normal)<=_r115&&(_d13.push(_s67.x,_s67.y,_s67.z),_d13.push(_a55.x,_a55.y,_a55.z)),_u12[_p12]=null):_o40 in _u12||(_u12[_o40]={index0:_l21[_t200],index1:_l21[_e200],normal:uc.clone()});}}for(var _t201 in _u12)if(_u12[_t201]){var _u12$_t=_u12[_t201],_e201=_u12$_t.index0,_n194=_u12$_t.index1;cc.fromBufferAttribute(_a54,_e201),hc.fromBufferAttribute(_a54,_n194),_d13.push(cc.x,cc.y,cc.z),_d13.push(hc.x,hc.y,hc.z);}_this62.setAttribute("position",new Ti(_d13,3));}return _possibleConstructorReturn(_this62);}_createClass(pc,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(pc.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this;}}]);return pc;}(Ii);var mc=/*#__PURE__*/function(_ec){_inherits(mc,_ec);var _super67=_createSuper(mc);function mc(t){var _this63;_classCallCheck(this,mc);_this63=_super67.call(this,t),_this63.uuid=se(),_this63.type="Shape",_this63.holes=[];return _this63;}_createClass(mc,[{key:"getPointsHoles",value:function getPointsHoles(t){var e=[];for(var _n195=0,_i152=this.holes.length;_n195<_i152;_n195++)e[_n195]=this.holes[_n195].getPoints(t);return e;}},{key:"extractPoints",value:function extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)};}},{key:"copy",value:function copy(t){_get(_getPrototypeOf(mc.prototype),"copy",this).call(this,t),this.holes=[];for(var _e202=0,_n196=t.holes.length;_e202<_n196;_e202++){var _n197=t.holes[_e202];this.holes.push(_n197.clone());}return this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(mc.prototype),"toJSON",this).call(this);t.uuid=this.uuid,t.holes=[];for(var _e203=0,_n198=this.holes.length;_e203<_n198;_e203++){var _n199=this.holes[_e203];t.holes.push(_n199.toJSON());}return t;}},{key:"fromJSON",value:function fromJSON(t){_get(_getPrototypeOf(mc.prototype),"fromJSON",this).call(this,t),this.uuid=t.uuid,this.holes=[];for(var _e204=0,_n200=t.holes.length;_e204<_n200;_e204++){var _n201=t.holes[_e204];this.holes.push(new ec().fromJSON(_n201));}return this;}}]);return mc;}(ec);var fc=function fc(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;var i=e&&e.length,r=i?e[0]*n:t.length;var s=gc(t,0,r,n,!0);var a=[];if(!s||s.next===s.prev)return a;var o,l,c,h,u,d,p;if(i&&(s=function(t,e,n,i){var r=[];var s,a,o,l,c;for(s=0,a=e.length;s<a;s++)o=e[s]*i,l=s<a-1?e[s+1]*i:t.length,c=gc(t,o,l,i,!1),c===c.next&&(c.steiner=!0),r.push(Ac(c));for(r.sort(bc),s=0;s<r.length;s++)n=Tc(r[s],n);return n;}(t,e,s,n)),t.length>80*n){o=c=t[0],l=h=t[1];for(var _e205=n;_e205<r;_e205+=n)u=t[_e205],d=t[_e205+1],u<o&&(o=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-o,h-l),p=0!==p?32767/p:0;}return vc(s,a,n,o,l,p,0),a;};function gc(t,e,n,i,r){var s,a;if(r===function(t,e,n,i){var r=0;for(var _s68=e,_a56=n-i;_s68<n;_s68+=i)r+=(t[_a56]-t[_s68])*(t[_s68+1]+t[_a56+1]),_a56=_s68;return r;}(t,e,n,i)>0)for(s=e;s<n;s+=i)a=Fc(s,t[s],t[s+1],a);else for(s=n-i;s>=e;s-=i)a=Fc(s,t[s],t[s+1],a);return a&&Pc(a,a.next)&&(Bc(a),a=a.next),a;}function _c(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!Pc(i,i.next)&&0!==Lc(i.prev,i,i.next))i=i.next;else{if(Bc(i),i=e=i.prev,i===i.next)break;n=!0;}}while(n||i!==e);return e;}function vc(t,e,n,i,r,s,a){if(!t)return;!a&&s&&function(t,e,n,i){var r=t;do{0===r.z&&(r.z=wc(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,s,a,o,l,c=1;do{for(n=t,t=null,s=null,a=0;n;){for(a++,i=n,o=0,e=0;e<c&&(o++,i=i.nextZ,i);e++);for(l=c;o>0||l>0&&i;)0!==o&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,o--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i;}s.nextZ=null,c*=2;}while(a>1);}(r);}(t,i,r,s);var o,l,c=t;for(;t.prev!==t.next;)if(o=t.prev,l=t.next,s?yc(t,i,r,s):xc(t))e.push(o.i/n|0),e.push(t.i/n|0),e.push(l.i/n|0),Bc(t),t=l.next,c=l.next;else if((t=l)===c){a?1===a?vc(t=Mc(_c(t),e,n),e,n,i,r,s,2):2===a&&Sc(t,e,n,i,r,s):vc(_c(t),e,n,i,r,s,1);break;}}function xc(t){var e=t.prev,n=t,i=t.next;if(Lc(e,n,i)>=0)return!1;var r=e.x,s=n.x,a=i.x,o=e.y,l=n.y,c=i.y,h=r<s?r<a?r:a:s<a?s:a,u=o<l?o<c?o:c:l<c?l:c,d=r>s?r>a?r:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c;var m=i.next;for(;m!==e;){if(m.x>=h&&m.x<=d&&m.y>=u&&m.y<=p&&Rc(r,o,s,l,a,c,m.x,m.y)&&Lc(m.prev,m,m.next)>=0)return!1;m=m.next;}return!0;}function yc(t,e,n,i){var r=t.prev,s=t,a=t.next;if(Lc(r,s,a)>=0)return!1;var o=r.x,l=s.x,c=a.x,h=r.y,u=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,m=h<u?h<d?h:d:u<d?u:d,f=o>l?o>c?o:c:l>c?l:c,g=h>u?h>d?h:d:u>d?u:d,_=wc(p,m,e,n,i),v=wc(f,g,e,n,i);var x=t.prevZ,y=t.nextZ;for(;x&&x.z>=_&&y&&y.z<=v;){if(x.x>=p&&x.x<=f&&x.y>=m&&x.y<=g&&x!==r&&x!==a&&Rc(o,h,l,u,c,d,x.x,x.y)&&Lc(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,y.x>=p&&y.x<=f&&y.y>=m&&y.y<=g&&y!==r&&y!==a&&Rc(o,h,l,u,c,d,y.x,y.y)&&Lc(y.prev,y,y.next)>=0)return!1;y=y.nextZ;}for(;x&&x.z>=_;){if(x.x>=p&&x.x<=f&&x.y>=m&&x.y<=g&&x!==r&&x!==a&&Rc(o,h,l,u,c,d,x.x,x.y)&&Lc(x.prev,x,x.next)>=0)return!1;x=x.prevZ;}for(;y&&y.z<=v;){if(y.x>=p&&y.x<=f&&y.y>=m&&y.y<=g&&y!==r&&y!==a&&Rc(o,h,l,u,c,d,y.x,y.y)&&Lc(y.prev,y,y.next)>=0)return!1;y=y.nextZ;}return!0;}function Mc(t,e,n){var i=t;do{var _r116=i.prev,_s69=i.next.next;!Pc(_r116,_s69)&&Ic(_r116,i,i.next,_s69)&&Nc(_r116,_s69)&&Nc(_s69,_r116)&&(e.push(_r116.i/n|0),e.push(i.i/n|0),e.push(_s69.i/n|0),Bc(i),Bc(i.next),i=t=_s69),i=i.next;}while(i!==t);return _c(i);}function Sc(t,e,n,i,r,s){var a=t;do{var _t202=a.next.next;for(;_t202!==a.prev;){if(a.i!==_t202.i&&Cc(a,_t202)){var _o41=Oc(a,_t202);return a=_c(a,a.next),_o41=_c(_o41,_o41.next),vc(a,e,n,i,r,s,0),void vc(_o41,e,n,i,r,s,0);}_t202=_t202.next;}a=a.next;}while(a!==t);}function bc(t,e){return t.x-e.x;}function Tc(t,e){var n=function(t,e){var n,i=e,r=-1/0;var s=t.x,a=t.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var _t203=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(_t203<=s&&_t203>r&&(r=_t203,n=i.x<i.next.x?i:i.next,_t203===s))return n;}i=i.next;}while(i!==e);if(!n)return null;var o=n,l=n.x,c=n.y;var h,u=1/0;i=n;do{s>=i.x&&i.x>=l&&s!==i.x&&Rc(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),Nc(i,t)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&Ec(n,i)))&&(n=i,u=h)),i=i.next;}while(i!==o);return n;}(t,e);if(!n)return e;var i=Oc(n,t);return _c(i,i.next),_c(n,n.next);}function Ec(t,e){return Lc(t.prev,t,e.prev)<0&&Lc(e.next,t,t.next)<0;}function wc(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1;}function Ac(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;}while(e!==t);return n;}function Rc(t,e,n,i,r,s,a,o){return(r-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(i-o)>=(n-a)*(e-o)&&(n-a)*(s-o)>=(r-a)*(i-o);}function Cc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Ic(n,n.next,t,e))return!0;n=n.next;}while(n!==t);return!1;}(t,e)&&(Nc(t,e)&&Nc(e,t)&&function(t,e){var n=t,i=!1;var r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;}while(n!==t);return i;}(t,e)&&(Lc(t.prev,t,e.prev)||Lc(t,e.prev,e))||Pc(t,e)&&Lc(t.prev,t,t.next)>0&&Lc(e.prev,e,e.next)>0);}function Lc(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y);}function Pc(t,e){return t.x===e.x&&t.y===e.y;}function Ic(t,e,n,i){var r=Dc(Lc(t,e,n)),s=Dc(Lc(t,e,i)),a=Dc(Lc(n,i,t)),o=Dc(Lc(n,i,e));return r!==s&&a!==o||!(0!==r||!Uc(t,n,e))||!(0!==s||!Uc(t,i,e))||!(0!==a||!Uc(n,t,i))||!(0!==o||!Uc(n,e,i));}function Uc(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y);}function Dc(t){return t>0?1:t<0?-1:0;}function Nc(t,e){return Lc(t.prev,t,t.next)<0?Lc(t,e,t.next)>=0&&Lc(t,t.prev,e)>=0:Lc(t,e,t.prev)<0||Lc(t,t.next,e)<0;}function Oc(t,e){var n=new zc(t.i,t.x,t.y),i=new zc(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i;}function Fc(t,e,n,i){var r=new zc(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r;}function Bc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ);}function zc(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1;}var Gc=/*#__PURE__*/function(){function Gc(){_classCallCheck(this,Gc);}_createClass(Gc,null,[{key:"area",value:function area(t){var e=t.length;var n=0;for(var _i153=e-1,_r117=0;_r117<e;_i153=_r117++)n+=t[_i153].x*t[_r117].y-t[_r117].x*t[_i153].y;return .5*n;}},{key:"isClockWise",value:function isClockWise(t){return Gc.area(t)<0;}},{key:"triangulateShape",value:function triangulateShape(t,e){var n=[],i=[],r=[];Hc(t),Vc(n,t);var s=t.length;e.forEach(Hc);for(var _t204=0;_t204<e.length;_t204++)i.push(s),s+=e[_t204].length,Vc(n,e[_t204]);var a=fc(n,i);for(var _t205=0;_t205<a.length;_t205+=3)r.push(a.slice(_t205,_t205+3));return r;}}]);return Gc;}();function Hc(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop();}function Vc(t,e){for(var _n202=0;_n202<e.length;_n202++)t.push(e[_n202].x),t.push(e[_n202].y);}var kc=/*#__PURE__*/function(_Ii8){_inherits(kc,_Ii8);var _super68=_createSuper(kc);function kc(){var _this64;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new mc([new me(.5,.5),new me(-.5,.5),new me(-.5,-.5),new me(.5,-.5)]);var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,kc);_this64=_super68.call(this),_this64.type="ExtrudeGeometry",_this64.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];var n=_assertThisInitialized(_this64),i=[],r=[];for(var _e206=0,_n203=t.length;_e206<_n203;_e206++){s(t[_e206]);}function s(t){var s=[],a=void 0!==e.curveSegments?e.curveSegments:12,o=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:1;var c=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:h-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;var m=e.extrudePath,f=void 0!==e.UVGenerator?e.UVGenerator:Wc;var g,_,v,x,y,M=!1;m&&(g=m.getSpacedPoints(o),M=!0,c=!1,_=m.computeFrenetFrames(o,!1),v=new We(),x=new We(),y=new We()),c||(p=0,h=0,u=0,d=0);var S=t.extractPoints(a);var b=S.shape;var T=S.holes;if(!Gc.isClockWise(b)){b=b.reverse();for(var _t206=0,_e207=T.length;_t206<_e207;_t206++){var _e208=T[_t206];Gc.isClockWise(_e208)&&(T[_t206]=_e208.reverse());}}var E=Gc.triangulateShape(b,T),w=b;for(var _t207=0,_e209=T.length;_t207<_e209;_t207++){var _e210=T[_t207];b=b.concat(_e210);}function A(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().addScaledVector(e,n);}var R=b.length,C=E.length;function L(t,e,n){var i,r,s;var a=t.x-e.x,o=t.y-e.y,l=n.x-t.x,c=n.y-t.y,h=a*a+o*o,u=a*c-o*l;if(Math.abs(u)>Number.EPSILON){var _u13=Math.sqrt(h),_d14=Math.sqrt(l*l+c*c),_p13=e.x-o/_u13,_m8=e.y+a/_u13,_f4=((n.x-c/_d14-_p13)*c-(n.y+l/_d14-_m8)*l)/(a*c-o*l);i=_p13+a*_f4-t.x,r=_m8+o*_f4-t.y;var _g5=i*i+r*r;if(_g5<=2)return new me(i,r);s=Math.sqrt(_g5/2);}else{var _t208=!1;a>Number.EPSILON?l>Number.EPSILON&&(_t208=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(_t208=!0):Math.sign(o)===Math.sign(c)&&(_t208=!0),_t208?(i=-o,r=a,s=Math.sqrt(h)):(i=a,r=o,s=Math.sqrt(h/2));}return new me(i/s,r/s);}var P=[];for(var _t209=0,_e211=w.length,_n204=_e211-1,_i154=_t209+1;_t209<_e211;_t209++,_n204++,_i154++)_n204===_e211&&(_n204=0),_i154===_e211&&(_i154=0),P[_t209]=L(w[_t209],w[_n204],w[_i154]);var I=[];var U,D=P.concat();for(var _t210=0,_e212=T.length;_t210<_e212;_t210++){var _e213=T[_t210];U=[];for(var _t211=0,_n205=_e213.length,_i155=_n205-1,_r118=_t211+1;_t211<_n205;_t211++,_i155++,_r118++)_i155===_n205&&(_i155=0),_r118===_n205&&(_r118=0),U[_t211]=L(_e213[_t211],_e213[_i155],_e213[_r118]);I.push(U),D=D.concat(U);}for(var _t212=0;_t212<p;_t212++){var _e214=_t212/p,_n206=h*Math.cos(_e214*Math.PI/2),_i156=u*Math.sin(_e214*Math.PI/2)+d;for(var _t213=0,_e215=w.length;_t213<_e215;_t213++){var _e216=A(w[_t213],P[_t213],_i156);F(_e216.x,_e216.y,-_n206);}for(var _t214=0,_e217=T.length;_t214<_e217;_t214++){var _e218=T[_t214];U=I[_t214];for(var _t215=0,_r119=_e218.length;_t215<_r119;_t215++){var _r120=A(_e218[_t215],U[_t215],_i156);F(_r120.x,_r120.y,-_n206);}}}var N=u+d;for(var _t216=0;_t216<R;_t216++){var _e219=c?A(b[_t216],D[_t216],N):b[_t216];M?(x.copy(_.normals[0]).multiplyScalar(_e219.x),v.copy(_.binormals[0]).multiplyScalar(_e219.y),y.copy(g[0]).add(x).add(v),F(y.x,y.y,y.z)):F(_e219.x,_e219.y,0);}for(var _t217=1;_t217<=o;_t217++)for(var _e220=0;_e220<R;_e220++){var _n207=c?A(b[_e220],D[_e220],N):b[_e220];M?(x.copy(_.normals[_t217]).multiplyScalar(_n207.x),v.copy(_.binormals[_t217]).multiplyScalar(_n207.y),y.copy(g[_t217]).add(x).add(v),F(y.x,y.y,y.z)):F(_n207.x,_n207.y,l/o*_t217);}for(var _t218=p-1;_t218>=0;_t218--){var _e221=_t218/p,_n208=h*Math.cos(_e221*Math.PI/2),_i157=u*Math.sin(_e221*Math.PI/2)+d;for(var _t219=0,_e222=w.length;_t219<_e222;_t219++){var _e223=A(w[_t219],P[_t219],_i157);F(_e223.x,_e223.y,l+_n208);}for(var _t220=0,_e224=T.length;_t220<_e224;_t220++){var _e225=T[_t220];U=I[_t220];for(var _t221=0,_r121=_e225.length;_t221<_r121;_t221++){var _r122=A(_e225[_t221],U[_t221],_i157);M?F(_r122.x,_r122.y+g[o-1].y,g[o-1].x+_n208):F(_r122.x,_r122.y,l+_n208);}}}function O(t,e){var n=t.length;for(;--n>=0;){var _i158=n;var _r123=n-1;_r123<0&&(_r123=t.length-1);for(var _t222=0,_n209=o+2*p;_t222<_n209;_t222++){var _n210=R*_t222,_s70=R*(_t222+1);z(e+_i158+_n210,e+_r123+_n210,e+_r123+_s70,e+_i158+_s70);}}}function F(t,e,n){s.push(t),s.push(e),s.push(n);}function B(t,e,r){G(t),G(e),G(r);var s=i.length/3,a=f.generateTopUV(n,i,s-3,s-2,s-1);H(a[0]),H(a[1]),H(a[2]);}function z(t,e,r,s){G(t),G(e),G(s),G(e),G(r),G(s);var a=i.length/3,o=f.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);H(o[0]),H(o[1]),H(o[3]),H(o[1]),H(o[2]),H(o[3]);}function G(t){i.push(s[3*t+0]),i.push(s[3*t+1]),i.push(s[3*t+2]);}function H(t){r.push(t.x),r.push(t.y);}!function(){var t=i.length/3;if(c){var _t223=0,_e226=R*_t223;for(var _t224=0;_t224<C;_t224++){var _n211=E[_t224];B(_n211[2]+_e226,_n211[1]+_e226,_n211[0]+_e226);}_t223=o+2*p,_e226=R*_t223;for(var _t225=0;_t225<C;_t225++){var _n212=E[_t225];B(_n212[0]+_e226,_n212[1]+_e226,_n212[2]+_e226);}}else{for(var _t226=0;_t226<C;_t226++){var _e227=E[_t226];B(_e227[2],_e227[1],_e227[0]);}for(var _t227=0;_t227<C;_t227++){var _e228=E[_t227];B(_e228[0]+R*o,_e228[1]+R*o,_e228[2]+R*o);}}n.addGroup(t,i.length/3-t,0);}(),function(){var t=i.length/3;var e=0;O(w,e),e+=w.length;for(var _t228=0,_n213=T.length;_t228<_n213;_t228++){var _n214=T[_t228];O(_n214,e),e+=_n214.length;}n.addGroup(t,i.length/3-t,1);}();}_this64.setAttribute("position",new Ti(i,3)),_this64.setAttribute("uv",new Ti(r,2)),_this64.computeVertexNormals();return _this64;}_createClass(kc,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(kc.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(kc.prototype),"toJSON",this).call(this);return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(var _e229=0,_i159=t.length;_e229<_i159;_e229++){var _i160=t[_e229];n.shapes.push(_i160.uuid);}else n.shapes.push(t.uuid);n.options=Object.assign({},e),void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n;}(this.parameters.shapes,this.parameters.options,t);}}],[{key:"fromJSON",value:function fromJSON(t,e){var n=[];for(var _i161=0,_r124=t.shapes.length;_i161<_r124;_i161++){var _r125=e[t.shapes[_i161]];n.push(_r125);}var i=t.options.extrudePath;return void 0!==i&&(t.options.extrudePath=new Ql[i.type]().fromJSON(i)),new kc(n,t.options);}}]);return kc;}(Ii);var Wc={generateTopUV:function generateTopUV(t,e,n,i,r){var s=e[3*n],a=e[3*n+1],o=e[3*i],l=e[3*i+1],c=e[3*r],h=e[3*r+1];return[new me(s,a),new me(o,l),new me(c,h)];},generateSideWallUV:function generateSideWallUV(t,e,n,i,r,s){var a=e[3*n],o=e[3*n+1],l=e[3*n+2],c=e[3*i],h=e[3*i+1],u=e[3*i+2],d=e[3*r],p=e[3*r+1],m=e[3*r+2],f=e[3*s],g=e[3*s+1],_=e[3*s+2];return Math.abs(o-h)<Math.abs(a-c)?[new me(a,1-l),new me(c,1-u),new me(d,1-m),new me(f,1-_)]:[new me(o,1-l),new me(h,1-u),new me(p,1-m),new me(g,1-_)];}};var Xc=/*#__PURE__*/function(_oc2){_inherits(Xc,_oc2);var _super69=_createSuper(Xc);function Xc(){var _this65;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,Xc);var n=(1+Math.sqrt(5))/2;_this65=_super69.call(this,[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),_this65.type="IcosahedronGeometry",_this65.parameters={radius:t,detail:e};return _this65;}_createClass(Xc,null,[{key:"fromJSON",value:function fromJSON(t){return new Xc(t.radius,t.detail);}}]);return Xc;}(oc);var jc=/*#__PURE__*/function(_oc3){_inherits(jc,_oc3);var _super70=_createSuper(jc);function jc(){var _this66;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,jc);_this66=_super70.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),_this66.type="OctahedronGeometry",_this66.parameters={radius:t,detail:e};return _this66;}_createClass(jc,null,[{key:"fromJSON",value:function fromJSON(t){return new jc(t.radius,t.detail);}}]);return jc;}(oc);var qc=/*#__PURE__*/function(_Ii9){_inherits(qc,_Ii9);var _super71=_createSuper(qc);function qc(){var _this67;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:.5;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:32;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:2*Math.PI;_classCallCheck(this,qc);_this67=_super71.call(this),_this67.type="RingGeometry",_this67.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:s},n=Math.max(3,n);var a=[],o=[],l=[],c=[];var h=t;var u=(e-t)/(i=Math.max(1,i)),d=new We(),p=new me();for(var _t229=0;_t229<=i;_t229++){for(var _t230=0;_t230<=n;_t230++){var _i162=r+_t230/n*s;d.x=h*Math.cos(_i162),d.y=h*Math.sin(_i162),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,c.push(p.x,p.y);}h+=u;}for(var _t231=0;_t231<i;_t231++){var _e230=_t231*(n+1);for(var _t232=0;_t232<n;_t232++){var _i163=_t232+_e230,_r126=_i163,_s71=_i163+n+1,_o42=_i163+n+2,_l22=_i163+1;a.push(_r126,_s71,_l22),a.push(_s71,_o42,_l22);}}_this67.setIndex(a),_this67.setAttribute("position",new Ti(o,3)),_this67.setAttribute("normal",new Ti(l,3)),_this67.setAttribute("uv",new Ti(c,2));return _this67;}_createClass(qc,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(qc.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this;}}],[{key:"fromJSON",value:function fromJSON(t){return new qc(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength);}}]);return qc;}(Ii);var Yc=/*#__PURE__*/function(_Ii10){_inherits(Yc,_Ii10);var _super72=_createSuper(Yc);function Yc(){var _this68;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new mc([new me(0,.5),new me(-.5,-.5),new me(.5,-.5)]);var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:12;_classCallCheck(this,Yc);_this68=_super72.call(this),_this68.type="ShapeGeometry",_this68.parameters={shapes:t,curveSegments:e};var n=[],i=[],r=[],s=[];var a=0,o=0;if(!1===Array.isArray(t))l(t);else for(var _e231=0;_e231<t.length;_e231++)l(t[_e231]),_this68.addGroup(a,o,_e231),a+=o,o=0;function l(t){var a=i.length/3,l=t.extractPoints(e);var c=l.shape;var h=l.holes;!1===Gc.isClockWise(c)&&(c=c.reverse());for(var _t233=0,_e232=h.length;_t233<_e232;_t233++){var _e233=h[_t233];!0===Gc.isClockWise(_e233)&&(h[_t233]=_e233.reverse());}var u=Gc.triangulateShape(c,h);for(var _t234=0,_e234=h.length;_t234<_e234;_t234++){var _e235=h[_t234];c=c.concat(_e235);}for(var _t235=0,_e236=c.length;_t235<_e236;_t235++){var _e237=c[_t235];i.push(_e237.x,_e237.y,0),r.push(0,0,1),s.push(_e237.x,_e237.y);}for(var _t236=0,_e238=u.length;_t236<_e238;_t236++){var _e239=u[_t236],_i164=_e239[0]+a,_r127=_e239[1]+a,_s72=_e239[2]+a;n.push(_i164,_r127,_s72),o+=3;}}_this68.setIndex(n),_this68.setAttribute("position",new Ti(i,3)),_this68.setAttribute("normal",new Ti(r,3)),_this68.setAttribute("uv",new Ti(s,2));return _this68;}_createClass(Yc,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(Yc.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(Yc.prototype),"toJSON",this).call(this);return function(t,e){if(e.shapes=[],Array.isArray(t))for(var _n215=0,_i165=t.length;_n215<_i165;_n215++){var _i166=t[_n215];e.shapes.push(_i166.uuid);}else e.shapes.push(t.uuid);return e;}(this.parameters.shapes,t);}}],[{key:"fromJSON",value:function fromJSON(t,e){var n=[];for(var _i167=0,_r128=t.shapes.length;_i167<_r128;_i167++){var _r129=e[t.shapes[_i167]];n.push(_r129);}return new Yc(n,t.curveSegments);}}]);return Yc;}(Ii);var Zc=/*#__PURE__*/function(_Ii11){_inherits(Zc,_Ii11);var _super73=_createSuper(Zc);function Zc(){var _this69;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:32;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:16;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:2*Math.PI;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var a=arguments.length>6&&arguments[6]!==undefined?arguments[6]:Math.PI;_classCallCheck(this,Zc);_this69=_super73.call(this),_this69.type="SphereGeometry",_this69.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));var o=Math.min(s+a,Math.PI);var l=0;var c=[],h=new We(),u=new We(),d=[],p=[],m=[],f=[];for(var _d15=0;_d15<=n;_d15++){var _g6=[],_6=_d15/n;var _v5=0;0===_d15&&0===s?_v5=.5/e:_d15===n&&o===Math.PI&&(_v5=-.5/e);for(var _n216=0;_n216<=e;_n216++){var _o43=_n216/e;h.x=-t*Math.cos(i+_o43*r)*Math.sin(s+_6*a),h.y=t*Math.cos(s+_6*a),h.z=t*Math.sin(i+_o43*r)*Math.sin(s+_6*a),p.push(h.x,h.y,h.z),u.copy(h).normalize(),m.push(u.x,u.y,u.z),f.push(_o43+_v5,1-_6),_g6.push(l++);}c.push(_g6);}for(var _t237=0;_t237<n;_t237++)for(var _i168=0;_i168<e;_i168++){var _e240=c[_t237][_i168+1],_r130=c[_t237][_i168],_a57=c[_t237+1][_i168],_l23=c[_t237+1][_i168+1];(0!==_t237||s>0)&&d.push(_e240,_r130,_l23),(_t237!==n-1||o<Math.PI)&&d.push(_r130,_a57,_l23);}_this69.setIndex(d),_this69.setAttribute("position",new Ti(p,3)),_this69.setAttribute("normal",new Ti(m,3)),_this69.setAttribute("uv",new Ti(f,2));return _this69;}_createClass(Zc,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(Zc.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this;}}],[{key:"fromJSON",value:function fromJSON(t){return new Zc(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength);}}]);return Zc;}(Ii);var Jc=/*#__PURE__*/function(_oc4){_inherits(Jc,_oc4);var _super74=_createSuper(Jc);function Jc(){var _this70;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,Jc);_this70=_super74.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),_this70.type="TetrahedronGeometry",_this70.parameters={radius:t,detail:e};return _this70;}_createClass(Jc,null,[{key:"fromJSON",value:function fromJSON(t){return new Jc(t.radius,t.detail);}}]);return Jc;}(oc);var Kc=/*#__PURE__*/function(_Ii12){_inherits(Kc,_Ii12);var _super75=_createSuper(Kc);function Kc(){var _this71;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:.4;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:12;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:48;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:2*Math.PI;_classCallCheck(this,Kc);_this71=_super75.call(this),_this71.type="TorusGeometry",_this71.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);var s=[],a=[],o=[],l=[],c=new We(),h=new We(),u=new We();for(var _s73=0;_s73<=n;_s73++)for(var _d16=0;_d16<=i;_d16++){var _p14=_d16/i*r,_m9=_s73/n*Math.PI*2;h.x=(t+e*Math.cos(_m9))*Math.cos(_p14),h.y=(t+e*Math.cos(_m9))*Math.sin(_p14),h.z=e*Math.sin(_m9),a.push(h.x,h.y,h.z),c.x=t*Math.cos(_p14),c.y=t*Math.sin(_p14),u.subVectors(h,c).normalize(),o.push(u.x,u.y,u.z),l.push(_d16/i),l.push(_s73/n);}for(var _t238=1;_t238<=n;_t238++)for(var _e241=1;_e241<=i;_e241++){var _n217=(i+1)*_t238+_e241-1,_r131=(i+1)*(_t238-1)+_e241-1,_a58=(i+1)*(_t238-1)+_e241,_o44=(i+1)*_t238+_e241;s.push(_n217,_r131,_o44),s.push(_r131,_a58,_o44);}_this71.setIndex(s),_this71.setAttribute("position",new Ti(a,3)),_this71.setAttribute("normal",new Ti(o,3)),_this71.setAttribute("uv",new Ti(l,2));return _this71;}_createClass(Kc,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(Kc.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this;}}],[{key:"fromJSON",value:function fromJSON(t){return new Kc(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc);}}]);return Kc;}(Ii);var $c=/*#__PURE__*/function(_Ii13){_inherits($c,_Ii13);var _super76=_createSuper($c);function $c(){var _this72;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:.4;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:64;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:8;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:2;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:3;_classCallCheck(this,$c);_this72=_super76.call(this),_this72.type="TorusKnotGeometry",_this72.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);var a=[],o=[],l=[],c=[],h=new We(),u=new We(),d=new We(),p=new We(),m=new We(),f=new We(),g=new We();for(var _a59=0;_a59<=n;++_a59){var _v6=_a59/n*r*Math.PI*2;_(_v6,r,s,t,d),_(_v6+.01,r,s,t,p),f.subVectors(p,d),g.addVectors(p,d),m.crossVectors(f,g),g.crossVectors(m,f),m.normalize(),g.normalize();for(var _t239=0;_t239<=i;++_t239){var _r132=_t239/i*Math.PI*2,_s74=-e*Math.cos(_r132),_p15=e*Math.sin(_r132);h.x=d.x+(_s74*g.x+_p15*m.x),h.y=d.y+(_s74*g.y+_p15*m.y),h.z=d.z+(_s74*g.z+_p15*m.z),o.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(_a59/n),c.push(_t239/i);}}for(var _t240=1;_t240<=n;_t240++)for(var _e242=1;_e242<=i;_e242++){var _n218=(i+1)*(_t240-1)+(_e242-1),_r133=(i+1)*_t240+(_e242-1),_s75=(i+1)*_t240+_e242,_o45=(i+1)*(_t240-1)+_e242;a.push(_n218,_r133,_o45),a.push(_r133,_s75,_o45);}function _(t,e,n,i,r){var s=Math.cos(t),a=Math.sin(t),o=n/e*t,l=Math.cos(o);r.x=i*(2+l)*.5*s,r.y=i*(2+l)*a*.5,r.z=i*Math.sin(o)*.5;}_this72.setIndex(a),_this72.setAttribute("position",new Ti(o,3)),_this72.setAttribute("normal",new Ti(l,3)),_this72.setAttribute("uv",new Ti(c,2));return _this72;}_createClass($c,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf($c.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this;}}],[{key:"fromJSON",value:function fromJSON(t){return new $c(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q);}}]);return $c;}(Ii);var Qc=/*#__PURE__*/function(_Ii14){_inherits(Qc,_Ii14);var _super77=_createSuper(Qc);function Qc(){var _this73;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Kl(new We(-1,-1,0),new We(-1,1,0),new We(1,1,0));var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:64;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:8;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:!1;_classCallCheck(this,Qc);_this73=_super77.call(this),_this73.type="TubeGeometry",_this73.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r};var s=t.computeFrenetFrames(e,r);_this73.tangents=s.tangents,_this73.normals=s.normals,_this73.binormals=s.binormals;var a=new We(),o=new We(),l=new me();var c=new We();var h=[],u=[],d=[],p=[];function m(r){c=t.getPointAt(r/e,c);var l=s.normals[r],d=s.binormals[r];for(var _t241=0;_t241<=i;_t241++){var _e243=_t241/i*Math.PI*2,_r134=Math.sin(_e243),_s76=-Math.cos(_e243);o.x=_s76*l.x+_r134*d.x,o.y=_s76*l.y+_r134*d.y,o.z=_s76*l.z+_r134*d.z,o.normalize(),u.push(o.x,o.y,o.z),a.x=c.x+n*o.x,a.y=c.y+n*o.y,a.z=c.z+n*o.z,h.push(a.x,a.y,a.z);}}!function(){for(var _t242=0;_t242<e;_t242++)m(_t242);m(!1===r?e:0),function(){for(var _t243=0;_t243<=e;_t243++)for(var _n219=0;_n219<=i;_n219++)l.x=_t243/e,l.y=_n219/i,d.push(l.x,l.y);}(),function(){for(var _t244=1;_t244<=e;_t244++)for(var _e244=1;_e244<=i;_e244++){var _n220=(i+1)*(_t244-1)+(_e244-1),_r135=(i+1)*_t244+(_e244-1),_s77=(i+1)*_t244+_e244,_a60=(i+1)*(_t244-1)+_e244;p.push(_n220,_r135,_a60),p.push(_r135,_s77,_a60);}}();}(),_this73.setIndex(p),_this73.setAttribute("position",new Ti(h,3)),_this73.setAttribute("normal",new Ti(u,3)),_this73.setAttribute("uv",new Ti(d,2));return _this73;}_createClass(Qc,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(Qc.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(Qc.prototype),"toJSON",this).call(this);return t.path=this.parameters.path.toJSON(),t;}}],[{key:"fromJSON",value:function fromJSON(t){return new Qc(new Ql[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed);}}]);return Qc;}(Ii);var th=/*#__PURE__*/function(_Ii15){_inherits(th,_Ii15);var _super78=_createSuper(th);function th(){var _this74;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,th);if(_this74=_super78.call(this),_this74.type="WireframeGeometry",_this74.parameters={geometry:t},null!==t){var _e245=[],_n221=new Set(),_i169=new We(),_r136=new We();if(null!==t.index){var _s78=t.attributes.position,_a61=t.index;var _o46=t.groups;0===_o46.length&&(_o46=[{start:0,count:_a61.count,materialIndex:0}]);for(var _t245=0,_l24=_o46.length;_t245<_l24;++_t245){var _l25=_o46[_t245],_c19=_l25.start;for(var _t246=_c19,_o47=_c19+_l25.count;_t246<_o47;_t246+=3)for(var _o48=0;_o48<3;_o48++){var _l26=_a61.getX(_t246+_o48),_c20=_a61.getX(_t246+(_o48+1)%3);_i169.fromBufferAttribute(_s78,_l26),_r136.fromBufferAttribute(_s78,_c20),!0===eh(_i169,_r136,_n221)&&(_e245.push(_i169.x,_i169.y,_i169.z),_e245.push(_r136.x,_r136.y,_r136.z));}}}else{var _s79=t.attributes.position;for(var _t247=0,_a62=_s79.count/3;_t247<_a62;_t247++)for(var _a63=0;_a63<3;_a63++){var _o49=3*_t247+_a63,_l27=3*_t247+(_a63+1)%3;_i169.fromBufferAttribute(_s79,_o49),_r136.fromBufferAttribute(_s79,_l27),!0===eh(_i169,_r136,_n221)&&(_e245.push(_i169.x,_i169.y,_i169.z),_e245.push(_r136.x,_r136.y,_r136.z));}}_this74.setAttribute("position",new Ti(_e245,3));}return _possibleConstructorReturn(_this74);}_createClass(th,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(th.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this;}}]);return th;}(Ii);function eh(t,e,n){var i="".concat(t.x,",").concat(t.y,",").concat(t.z,"-").concat(e.x,",").concat(e.y,",").concat(e.z),r="".concat(e.x,",").concat(e.y,",").concat(e.z,"-").concat(t.x,",").concat(t.y,",").concat(t.z);return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0);}var nh=Object.freeze({__proto__:null,BoxGeometry:$i,CapsuleGeometry:ic,CircleGeometry:rc,ConeGeometry:ac,CylinderGeometry:sc,DodecahedronGeometry:lc,EdgesGeometry:pc,ExtrudeGeometry:kc,IcosahedronGeometry:Xc,LatheGeometry:nc,OctahedronGeometry:jc,PlaneGeometry:xr,PolyhedronGeometry:oc,RingGeometry:qc,ShapeGeometry:Yc,SphereGeometry:Zc,TetrahedronGeometry:Jc,TorusGeometry:Kc,TorusKnotGeometry:$c,TubeGeometry:Qc,WireframeGeometry:th});var ih=/*#__PURE__*/function(_di8){_inherits(ih,_di8);var _super79=_createSuper(ih);function ih(t){var _this75;_classCallCheck(this,ih);_this75=_super79.call(this),_this75.isShadowMaterial=!0,_this75.type="ShadowMaterial",_this75.color=new ci(0),_this75.transparent=!0,_this75.fog=!0,_this75.setValues(t);return _this75;}_createClass(ih,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(ih.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.fog=t.fog,this;}}]);return ih;}(di);var rh=/*#__PURE__*/function(_ir){_inherits(rh,_ir);var _super80=_createSuper(rh);function rh(t){var _this76;_classCallCheck(this,rh);_this76=_super80.call(this,t),_this76.isRawShaderMaterial=!0,_this76.type="RawShaderMaterial";return _this76;}return _createClass(rh);}(ir);var sh=/*#__PURE__*/function(_di9){_inherits(sh,_di9);var _super81=_createSuper(sh);function sh(t){var _this77;_classCallCheck(this,sh);_this77=_super81.call(this),_this77.isMeshStandardMaterial=!0,_this77.defines={STANDARD:""},_this77.type="MeshStandardMaterial",_this77.color=new ci(16777215),_this77.roughness=1,_this77.metalness=0,_this77.map=null,_this77.lightMap=null,_this77.lightMapIntensity=1,_this77.aoMap=null,_this77.aoMapIntensity=1,_this77.emissive=new ci(0),_this77.emissiveIntensity=1,_this77.emissiveMap=null,_this77.bumpMap=null,_this77.bumpScale=1,_this77.normalMap=null,_this77.normalMapType=0,_this77.normalScale=new me(1,1),_this77.displacementMap=null,_this77.displacementScale=1,_this77.displacementBias=0,_this77.roughnessMap=null,_this77.metalnessMap=null,_this77.alphaMap=null,_this77.envMap=null,_this77.envMapIntensity=1,_this77.wireframe=!1,_this77.wireframeLinewidth=1,_this77.wireframeLinecap="round",_this77.wireframeLinejoin="round",_this77.flatShading=!1,_this77.fog=!0,_this77.setValues(t);return _this77;}_createClass(sh,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(sh.prototype),"copy",this).call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this;}}]);return sh;}(di);var ah=/*#__PURE__*/function(_sh){_inherits(ah,_sh);var _super82=_createSuper(ah);function ah(t){var _this78;_classCallCheck(this,ah);_this78=_super82.call(this),_this78.isMeshPhysicalMaterial=!0,_this78.defines={STANDARD:"",PHYSICAL:""},_this78.type="MeshPhysicalMaterial",_this78.anisotropyRotation=0,_this78.anisotropyMap=null,_this78.clearcoatMap=null,_this78.clearcoatRoughness=0,_this78.clearcoatRoughnessMap=null,_this78.clearcoatNormalScale=new me(1,1),_this78.clearcoatNormalMap=null,_this78.ior=1.5,Object.defineProperty(_assertThisInitialized(_this78),"reflectivity",{get:function get(){return ae(2.5*(this.ior-1)/(this.ior+1),0,1);},set:function set(t){this.ior=(1+.4*t)/(1-.4*t);}}),_this78.iridescenceMap=null,_this78.iridescenceIOR=1.3,_this78.iridescenceThicknessRange=[100,400],_this78.iridescenceThicknessMap=null,_this78.sheenColor=new ci(0),_this78.sheenColorMap=null,_this78.sheenRoughness=1,_this78.sheenRoughnessMap=null,_this78.transmissionMap=null,_this78.thickness=0,_this78.thicknessMap=null,_this78.attenuationDistance=1/0,_this78.attenuationColor=new ci(1,1,1),_this78.specularIntensity=1,_this78.specularIntensityMap=null,_this78.specularColor=new ci(1,1,1),_this78.specularColorMap=null,_this78._anisotropy=0,_this78._clearcoat=0,_this78._iridescence=0,_this78._sheen=0,_this78._transmission=0,_this78.setValues(t);return _this78;}_createClass(ah,[{key:"anisotropy",get:function get(){return this._anisotropy;},set:function set(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t;}},{key:"clearcoat",get:function get(){return this._clearcoat;},set:function set(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t;}},{key:"iridescence",get:function get(){return this._iridescence;},set:function set(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t;}},{key:"sheen",get:function get(){return this._sheen;},set:function set(t){this._sheen>0!=t>0&&this.version++,this._sheen=t;}},{key:"transmission",get:function get(){return this._transmission;},set:function set(t){this._transmission>0!=t>0&&this.version++,this._transmission=t;}},{key:"copy",value:function copy(t){return _get(_getPrototypeOf(ah.prototype),"copy",this).call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=_toConsumableArray(t.iridescenceThicknessRange),this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this;}}]);return ah;}(sh);var oh=/*#__PURE__*/function(_di10){_inherits(oh,_di10);var _super83=_createSuper(oh);function oh(t){var _this79;_classCallCheck(this,oh);_this79=_super83.call(this),_this79.isMeshPhongMaterial=!0,_this79.type="MeshPhongMaterial",_this79.color=new ci(16777215),_this79.specular=new ci(1118481),_this79.shininess=30,_this79.map=null,_this79.lightMap=null,_this79.lightMapIntensity=1,_this79.aoMap=null,_this79.aoMapIntensity=1,_this79.emissive=new ci(0),_this79.emissiveIntensity=1,_this79.emissiveMap=null,_this79.bumpMap=null,_this79.bumpScale=1,_this79.normalMap=null,_this79.normalMapType=0,_this79.normalScale=new me(1,1),_this79.displacementMap=null,_this79.displacementScale=1,_this79.displacementBias=0,_this79.specularMap=null,_this79.alphaMap=null,_this79.envMap=null,_this79.combine=h,_this79.reflectivity=1,_this79.refractionRatio=.98,_this79.wireframe=!1,_this79.wireframeLinewidth=1,_this79.wireframeLinecap="round",_this79.wireframeLinejoin="round",_this79.flatShading=!1,_this79.fog=!0,_this79.setValues(t);return _this79;}_createClass(oh,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(oh.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this;}}]);return oh;}(di);var lh=/*#__PURE__*/function(_di11){_inherits(lh,_di11);var _super84=_createSuper(lh);function lh(t){var _this80;_classCallCheck(this,lh);_this80=_super84.call(this),_this80.isMeshToonMaterial=!0,_this80.defines={TOON:""},_this80.type="MeshToonMaterial",_this80.color=new ci(16777215),_this80.map=null,_this80.gradientMap=null,_this80.lightMap=null,_this80.lightMapIntensity=1,_this80.aoMap=null,_this80.aoMapIntensity=1,_this80.emissive=new ci(0),_this80.emissiveIntensity=1,_this80.emissiveMap=null,_this80.bumpMap=null,_this80.bumpScale=1,_this80.normalMap=null,_this80.normalMapType=0,_this80.normalScale=new me(1,1),_this80.displacementMap=null,_this80.displacementScale=1,_this80.displacementBias=0,_this80.alphaMap=null,_this80.wireframe=!1,_this80.wireframeLinewidth=1,_this80.wireframeLinecap="round",_this80.wireframeLinejoin="round",_this80.fog=!0,_this80.setValues(t);return _this80;}_createClass(lh,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(lh.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this;}}]);return lh;}(di);var ch=/*#__PURE__*/function(_di12){_inherits(ch,_di12);var _super85=_createSuper(ch);function ch(t){var _this81;_classCallCheck(this,ch);_this81=_super85.call(this),_this81.isMeshNormalMaterial=!0,_this81.type="MeshNormalMaterial",_this81.bumpMap=null,_this81.bumpScale=1,_this81.normalMap=null,_this81.normalMapType=0,_this81.normalScale=new me(1,1),_this81.displacementMap=null,_this81.displacementScale=1,_this81.displacementBias=0,_this81.wireframe=!1,_this81.wireframeLinewidth=1,_this81.flatShading=!1,_this81.setValues(t);return _this81;}_createClass(ch,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(ch.prototype),"copy",this).call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this;}}]);return ch;}(di);var hh=/*#__PURE__*/function(_di13){_inherits(hh,_di13);var _super86=_createSuper(hh);function hh(t){var _this82;_classCallCheck(this,hh);_this82=_super86.call(this),_this82.isMeshLambertMaterial=!0,_this82.type="MeshLambertMaterial",_this82.color=new ci(16777215),_this82.map=null,_this82.lightMap=null,_this82.lightMapIntensity=1,_this82.aoMap=null,_this82.aoMapIntensity=1,_this82.emissive=new ci(0),_this82.emissiveIntensity=1,_this82.emissiveMap=null,_this82.bumpMap=null,_this82.bumpScale=1,_this82.normalMap=null,_this82.normalMapType=0,_this82.normalScale=new me(1,1),_this82.displacementMap=null,_this82.displacementScale=1,_this82.displacementBias=0,_this82.specularMap=null,_this82.alphaMap=null,_this82.envMap=null,_this82.combine=h,_this82.reflectivity=1,_this82.refractionRatio=.98,_this82.wireframe=!1,_this82.wireframeLinewidth=1,_this82.wireframeLinecap="round",_this82.wireframeLinejoin="round",_this82.flatShading=!1,_this82.fog=!0,_this82.setValues(t);return _this82;}_createClass(hh,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(hh.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this;}}]);return hh;}(di);var uh=/*#__PURE__*/function(_di14){_inherits(uh,_di14);var _super87=_createSuper(uh);function uh(t){var _this83;_classCallCheck(this,uh);_this83=_super87.call(this),_this83.isMeshMatcapMaterial=!0,_this83.defines={MATCAP:""},_this83.type="MeshMatcapMaterial",_this83.color=new ci(16777215),_this83.matcap=null,_this83.map=null,_this83.bumpMap=null,_this83.bumpScale=1,_this83.normalMap=null,_this83.normalMapType=0,_this83.normalScale=new me(1,1),_this83.displacementMap=null,_this83.displacementScale=1,_this83.displacementBias=0,_this83.alphaMap=null,_this83.flatShading=!1,_this83.fog=!0,_this83.setValues(t);return _this83;}_createClass(uh,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(uh.prototype),"copy",this).call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this;}}]);return uh;}(di);var dh=/*#__PURE__*/function(_fl){_inherits(dh,_fl);var _super88=_createSuper(dh);function dh(t){var _this84;_classCallCheck(this,dh);_this84=_super88.call(this),_this84.isLineDashedMaterial=!0,_this84.type="LineDashedMaterial",_this84.scale=1,_this84.dashSize=3,_this84.gapSize=1,_this84.setValues(t);return _this84;}_createClass(dh,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(dh.prototype),"copy",this).call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this;}}]);return dh;}(fl);function ph(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t);}function mh(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView);}function fh(t){var e=t.length,n=new Array(e);for(var _t248=0;_t248!==e;++_t248)n[_t248]=_t248;return n.sort(function(e,n){return t[e]-t[n];}),n;}function gh(t,e,n){var i=t.length,r=new t.constructor(i);for(var _s80=0,_a64=0;_a64!==i;++_s80){var _i170=n[_s80]*e;for(var _n222=0;_n222!==e;++_n222)r[_a64++]=t[_i170+_n222];}return r;}function _h(t,e,n,i){var r=1,s=t[0];for(;void 0!==s&&void 0===s[i];)s=t[r++];if(void 0===s)return;var a=s[i];if(void 0!==a)if(Array.isArray(a))do{a=s[i],void 0!==a&&(e.push(s.time),n.push.apply(n,a)),s=t[r++];}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[i],void 0!==a&&(e.push(s.time),a.toArray(n,n.length)),s=t[r++];}while(void 0!==s);else do{a=s[i],void 0!==a&&(e.push(s.time),n.push(a)),s=t[r++];}while(void 0!==s);}var vh={convertArray:ph,isTypedArray:mh,getKeyframeOrder:fh,sortedArray:gh,flattenJSON:_h,subclip:function subclip(t,e,n,i){var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:30;var s=t.clone();s.name=e;var a=[];for(var _t249=0;_t249<s.tracks.length;++_t249){var _e246=s.tracks[_t249],_o50=_e246.getValueSize(),_l28=[],_c21=[];for(var _t250=0;_t250<_e246.times.length;++_t250){var _s81=_e246.times[_t250]*r;if(!(_s81<n||_s81>=i)){_l28.push(_e246.times[_t250]);for(var _n223=0;_n223<_o50;++_n223)_c21.push(_e246.values[_t250*_o50+_n223]);}}0!==_l28.length&&(_e246.times=ph(_l28,_e246.times.constructor),_e246.values=ph(_c21,_e246.values.constructor),a.push(_e246));}s.tracks=a;var o=1/0;for(var _t251=0;_t251<s.tracks.length;++_t251)o>s.tracks[_t251].times[0]&&(o=s.tracks[_t251].times[0]);for(var _t252=0;_t252<s.tracks.length;++_t252)s.tracks[_t252].shift(-1*o);return s.resetDuration(),s;},makeClipAdditive:function makeClipAdditive(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:t;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:30;i<=0&&(i=30);var r=n.tracks.length,s=e/i;var _loop=function _loop(){var i=n.tracks[_e247],r=i.ValueTypeName;if("bool"===r||"string"===r)return"continue";var a=t.tracks.find(function(t){return t.name===i.name&&t.ValueTypeName===r;});if(void 0===a)return"continue";var o=0;var l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);var c=0;var h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);var u=i.times.length-1;var d;if(s<=i.times[0]){var _t253=o,_e248=l-o;d=i.values.slice(_t253,_e248);}else if(s>=i.times[u]){var _t254=u*l+o,_e249=_t254+l-o;d=i.values.slice(_t254,_e249);}else{var _t255=i.createInterpolant(),_e250=o,_n224=l-o;_t255.evaluate(s),d=_t255.resultBuffer.slice(_e250,_n224);}if("quaternion"===r){new ke().fromArray(d).normalize().conjugate().toArray(d);}var p=a.times.length;for(var _t256=0;_t256<p;++_t256){var _e251=_t256*h+c;if("quaternion"===r)ke.multiplyQuaternionsFlat(a.values,_e251,d,0,a.values,_e251);else{var _t257=h-2*c;for(var _n225=0;_n225<_t257;++_n225)a.values[_e251+_n225]-=d[_n225];}}};for(var _e247=0;_e247<r;++_e247){var _ret=_loop();if(_ret==="continue")continue;}return t.blendMode=Ot,t;}};var xh=/*#__PURE__*/function(){function xh(t,e,n,i){_classCallCheck(this,xh);this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={};}_createClass(xh,[{key:"evaluate",value:function evaluate(t){var e=this.parameterPositions;var n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{var _s82;n:{i:if(!(t<i)){for(var _s83=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1);}if(n===_s83)break;if(r=i,i=e[++n],t<i)break e;}_s82=e.length;break n;}if(t>=r)break t;{var _a65=e[1];t<_a65&&(n=2,r=_a65);for(var _s84=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===_s84)break;if(i=r,r=e[--n-1],t>=r)break e;}_s82=n,n=0;}}for(;n<_s82;){var _i171=n+_s82>>>1;t<e[_i171]?_s82=_i171:n=_i171+1;}if(i=e[n],r=e[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1);}this._cachedIndex=n,this.intervalChanged_(n,r,i);}return this.interpolate_(n,r,t,i);}},{key:"getSettings_",value:function getSettings_(){return this.settings||this.DefaultSettings_;}},{key:"copySampleValue_",value:function copySampleValue_(t){var e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(var _t258=0;_t258!==i;++_t258)e[_t258]=n[r+_t258];return e;}},{key:"interpolate_",value:function interpolate_(){throw new Error("call to abstract method");}},{key:"intervalChanged_",value:function intervalChanged_(){}}]);return xh;}();var yh=/*#__PURE__*/function(_xh){_inherits(yh,_xh);var _super89=_createSuper(yh);function yh(t,e,n,i){var _this85;_classCallCheck(this,yh);_this85=_super89.call(this,t,e,n,i),_this85._weightPrev=-0,_this85._offsetPrev=-0,_this85._weightNext=-0,_this85._offsetNext=-0,_this85.DefaultSettings_={endingStart:It,endingEnd:It};return _this85;}_createClass(yh,[{key:"intervalChanged_",value:function intervalChanged_(t,e,n){var i=this.parameterPositions;var r=t-2,s=t+1,a=i[r],o=i[s];if(void 0===a)switch(this.getSettings_().endingStart){case Ut:r=t,a=2*e-n;break;case Dt:r=i.length-2,a=e+i[r]-i[r+1];break;default:r=t,a=n;}if(void 0===o)switch(this.getSettings_().endingEnd){case Ut:s=t,o=2*n-e;break;case Dt:s=1,o=n+i[1]-i[0];break;default:s=t-1,o=e;}var l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-n),this._offsetPrev=r*c,this._offsetNext=s*c;}},{key:"interpolate_",value:function interpolate_(t,e,n,i){var r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),m=p*p,f=m*p,g=-u*f+2*u*m-u*p,_=(1+u)*f+(-1.5-2*u)*m+(-.5+u)*p+1,v=(-1-d)*f+(1.5+d)*m+.5*p,x=d*f-d*m;for(var _t259=0;_t259!==a;++_t259)r[_t259]=g*s[c+_t259]+_*s[l+_t259]+v*s[o+_t259]+x*s[h+_t259];return r;}}]);return yh;}(xh);var Mh=/*#__PURE__*/function(_xh2){_inherits(Mh,_xh2);var _super90=_createSuper(Mh);function Mh(t,e,n,i){_classCallCheck(this,Mh);return _super90.call(this,t,e,n,i);}_createClass(Mh,[{key:"interpolate_",value:function interpolate_(t,e,n,i){var r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=(n-e)/(i-e),h=1-c;for(var _t260=0;_t260!==a;++_t260)r[_t260]=s[l+_t260]*h+s[o+_t260]*c;return r;}}]);return Mh;}(xh);var Sh=/*#__PURE__*/function(_xh3){_inherits(Sh,_xh3);var _super91=_createSuper(Sh);function Sh(t,e,n,i){_classCallCheck(this,Sh);return _super91.call(this,t,e,n,i);}_createClass(Sh,[{key:"interpolate_",value:function interpolate_(t){return this.copySampleValue_(t-1);}}]);return Sh;}(xh);var bh=/*#__PURE__*/function(){function bh(t,e,n,i){_classCallCheck(this,bh);if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=ph(e,this.TimeBufferType),this.values=ph(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation);}_createClass(bh,[{key:"InterpolantFactoryMethodDiscrete",value:function InterpolantFactoryMethodDiscrete(t){return new Sh(this.times,this.values,this.getValueSize(),t);}},{key:"InterpolantFactoryMethodLinear",value:function InterpolantFactoryMethodLinear(t){return new Mh(this.times,this.values,this.getValueSize(),t);}},{key:"InterpolantFactoryMethodSmooth",value:function InterpolantFactoryMethodSmooth(t){return new yh(this.times,this.values,this.getValueSize(),t);}},{key:"setInterpolation",value:function setInterpolation(t){var e;switch(t){case Ct:e=this.InterpolantFactoryMethodDiscrete;break;case Lt:e=this.InterpolantFactoryMethodLinear;break;case Pt:e=this.InterpolantFactoryMethodSmooth;}if(void 0===e){var _e252="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(_e252);this.setInterpolation(this.DefaultInterpolation);}return console.warn("THREE.KeyframeTrack:",_e252),this;}return this.createInterpolant=e,this;}},{key:"getInterpolation",value:function getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ct;case this.InterpolantFactoryMethodLinear:return Lt;case this.InterpolantFactoryMethodSmooth:return Pt;}}},{key:"getValueSize",value:function getValueSize(){return this.values.length/this.times.length;}},{key:"shift",value:function shift(t){if(0!==t){var _e253=this.times;for(var _n226=0,_i172=_e253.length;_n226!==_i172;++_n226)_e253[_n226]+=t;}return this;}},{key:"scale",value:function scale(t){if(1!==t){var _e254=this.times;for(var _n227=0,_i173=_e254.length;_n227!==_i173;++_n227)_e254[_n227]*=t;}return this;}},{key:"trim",value:function trim(t,e){var n=this.times,i=n.length;var r=0,s=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);var _t261=this.getValueSize();this.times=n.slice(r,s),this.values=this.values.slice(r*_t261,s*_t261);}return this;}},{key:"validate",value:function validate(){var t=!0;var e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);var s=null;for(var _e255=0;_e255!==r;_e255++){var _i174=n[_e255];if("number"==typeof _i174&&isNaN(_i174)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,_e255,_i174),t=!1;break;}if(null!==s&&s>_i174){console.error("THREE.KeyframeTrack: Out of order keys.",this,_e255,_i174,s),t=!1;break;}s=_i174;}if(void 0!==i&&mh(i))for(var _e256=0,_n228=i.length;_e256!==_n228;++_e256){var _n229=i[_e256];if(isNaN(_n229)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,_e256,_n229),t=!1;break;}}return t;}},{key:"optimize",value:function optimize(){var t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===Pt,r=t.length-1;var s=1;for(var _a66=1;_a66<r;++_a66){var _r137=!1;var _o51=t[_a66];if(_o51!==t[_a66+1]&&(1!==_a66||_o51!==t[0]))if(i)_r137=!0;else{var _t262=_a66*n,_i175=_t262-n,_s85=_t262+n;for(var _a67=0;_a67!==n;++_a67){var _n230=e[_t262+_a67];if(_n230!==e[_i175+_a67]||_n230!==e[_s85+_a67]){_r137=!0;break;}}}if(_r137){if(_a66!==s){t[s]=t[_a66];var _i176=_a66*n,_r138=s*n;for(var _t263=0;_t263!==n;++_t263)e[_r138+_t263]=e[_i176+_t263];}++s;}}if(r>0){t[s]=t[r];for(var _t264=r*n,_i177=s*n,_a68=0;_a68!==n;++_a68)e[_i177+_a68]=e[_t264+_a68];++s;}return s!==t.length?(this.times=t.slice(0,s),this.values=e.slice(0,s*n)):(this.times=t,this.values=e),this;}},{key:"clone",value:function clone(){var t=this.times.slice(),e=this.values.slice(),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n;}}],[{key:"toJSON",value:function toJSON(t){var e=t.constructor;var n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:ph(t.times,Array),values:ph(t.values,Array)};var _e257=t.getInterpolation();_e257!==t.DefaultInterpolation&&(n.interpolation=_e257);}return n.type=t.ValueTypeName,n;}}]);return bh;}();bh.prototype.TimeBufferType=Float32Array,bh.prototype.ValueBufferType=Float32Array,bh.prototype.DefaultInterpolation=Lt;var Th=/*#__PURE__*/function(_bh){_inherits(Th,_bh);var _super92=_createSuper(Th);function Th(){_classCallCheck(this,Th);return _super92.apply(this,arguments);}return _createClass(Th);}(bh);Th.prototype.ValueTypeName="bool",Th.prototype.ValueBufferType=Array,Th.prototype.DefaultInterpolation=Ct,Th.prototype.InterpolantFactoryMethodLinear=void 0,Th.prototype.InterpolantFactoryMethodSmooth=void 0;var Eh=/*#__PURE__*/function(_bh2){_inherits(Eh,_bh2);var _super93=_createSuper(Eh);function Eh(){_classCallCheck(this,Eh);return _super93.apply(this,arguments);}return _createClass(Eh);}(bh);Eh.prototype.ValueTypeName="color";var wh=/*#__PURE__*/function(_bh3){_inherits(wh,_bh3);var _super94=_createSuper(wh);function wh(){_classCallCheck(this,wh);return _super94.apply(this,arguments);}return _createClass(wh);}(bh);wh.prototype.ValueTypeName="number";var Ah=/*#__PURE__*/function(_xh4){_inherits(Ah,_xh4);var _super95=_createSuper(Ah);function Ah(t,e,n,i){_classCallCheck(this,Ah);return _super95.call(this,t,e,n,i);}_createClass(Ah,[{key:"interpolate_",value:function interpolate_(t,e,n,i){var r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-e)/(i-e);var l=t*a;for(var _t265=l+a;l!==_t265;l+=4)ke.slerpFlat(r,0,s,l-a,s,l,o);return r;}}]);return Ah;}(xh);var Rh=/*#__PURE__*/function(_bh4){_inherits(Rh,_bh4);var _super96=_createSuper(Rh);function Rh(){_classCallCheck(this,Rh);return _super96.apply(this,arguments);}_createClass(Rh,[{key:"InterpolantFactoryMethodLinear",value:function InterpolantFactoryMethodLinear(t){return new Ah(this.times,this.values,this.getValueSize(),t);}}]);return Rh;}(bh);Rh.prototype.ValueTypeName="quaternion",Rh.prototype.DefaultInterpolation=Lt,Rh.prototype.InterpolantFactoryMethodSmooth=void 0;var Ch=/*#__PURE__*/function(_bh5){_inherits(Ch,_bh5);var _super97=_createSuper(Ch);function Ch(){_classCallCheck(this,Ch);return _super97.apply(this,arguments);}return _createClass(Ch);}(bh);Ch.prototype.ValueTypeName="string",Ch.prototype.ValueBufferType=Array,Ch.prototype.DefaultInterpolation=Ct,Ch.prototype.InterpolantFactoryMethodLinear=void 0,Ch.prototype.InterpolantFactoryMethodSmooth=void 0;var Lh=/*#__PURE__*/function(_bh6){_inherits(Lh,_bh6);var _super98=_createSuper(Lh);function Lh(){_classCallCheck(this,Lh);return _super98.apply(this,arguments);}return _createClass(Lh);}(bh);Lh.prototype.ValueTypeName="vector";var Ph=/*#__PURE__*/function(){function Ph(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;var n=arguments.length>2?arguments[2]:undefined;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:2500;_classCallCheck(this,Ph);this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=se(),this.duration<0&&this.resetDuration();}_createClass(Ph,[{key:"resetDuration",value:function resetDuration(){var t=0;for(var _e258=0,_n231=this.tracks.length;_e258!==_n231;++_e258){var _n232=this.tracks[_e258];t=Math.max(t,_n232.times[_n232.times.length-1]);}return this.duration=t,this;}},{key:"trim",value:function trim(){for(var _t266=0;_t266<this.tracks.length;_t266++)this.tracks[_t266].trim(0,this.duration);return this;}},{key:"validate",value:function validate(){var t=!0;for(var _e259=0;_e259<this.tracks.length;_e259++)t=t&&this.tracks[_e259].validate();return t;}},{key:"optimize",value:function optimize(){for(var _t267=0;_t267<this.tracks.length;_t267++)this.tracks[_t267].optimize();return this;}},{key:"clone",value:function clone(){var t=[];for(var _e260=0;_e260<this.tracks.length;_e260++)t.push(this.tracks[_e260].clone());return new this.constructor(this.name,this.duration,t,this.blendMode);}},{key:"toJSON",value:function toJSON(){return this.constructor.toJSON(this);}}],[{key:"parse",value:function parse(t){var e=[],n=t.tracks,i=1/(t.fps||1);for(var _t268=0,_r139=n.length;_t268!==_r139;++_t268)e.push(Ih(n[_t268]).scale(i));var r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r;}},{key:"toJSON",value:function toJSON(t){var e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(var _t269=0,_i178=n.length;_t269!==_i178;++_t269)e.push(bh.toJSON(n[_t269]));return i;}},{key:"CreateFromMorphTargetSequence",value:function CreateFromMorphTargetSequence(t,e,n,i){var r=e.length,s=[];for(var _t270=0;_t270<r;_t270++){var _a69=[],_o52=[];_a69.push((_t270+r-1)%r,_t270,(_t270+1)%r),_o52.push(0,1,0);var _l29=fh(_a69);_a69=gh(_a69,1,_l29),_o52=gh(_o52,1,_l29),i||0!==_a69[0]||(_a69.push(r),_o52.push(_o52[0])),s.push(new wh(".morphTargetInfluences["+e[_t270].name+"]",_a69,_o52).scale(1/n));}return new this(t,-1,s);}},{key:"findByName",value:function findByName(t,e){var n=t;if(!Array.isArray(t)){var _e261=t;n=_e261.geometry&&_e261.geometry.animations||_e261.animations;}for(var _t271=0;_t271<n.length;_t271++)if(n[_t271].name===e)return n[_t271];return null;}},{key:"CreateClipsFromMorphTargetSequences",value:function CreateClipsFromMorphTargetSequences(t,e,n){var i={},r=/^([\w-]*?)([\d]+)$/;for(var _e262=0,_n233=t.length;_e262<_n233;_e262++){var _n234=t[_e262],_s86=_n234.name.match(r);if(_s86&&_s86.length>1){var _t272=_s86[1];var _e263=i[_t272];_e263||(i[_t272]=_e263=[]),_e263.push(_n234);}}var s=[];for(var _t273 in i)s.push(this.CreateFromMorphTargetSequence(_t273,i[_t273],e,n));return s;}},{key:"parseAnimation",value:function parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;var n=function n(t,e,_n235,i,r){if(0!==_n235.length){var _s87=[],_a70=[];_h(_n235,_s87,_a70,i),0!==_s87.length&&r.push(new t(e,_s87,_a70));}},i=[],r=t.name||"default",s=t.fps||30,a=t.blendMode;var o=t.length||-1;var l=t.hierarchy||[];for(var _t274=0;_t274<l.length;_t274++){var _r140=l[_t274].keys;if(_r140&&0!==_r140.length)if(_r140[0].morphTargets){var _t275={};var _e264=void 0;for(_e264=0;_e264<_r140.length;_e264++)if(_r140[_e264].morphTargets)for(var _n236=0;_n236<_r140[_e264].morphTargets.length;_n236++)_t275[_r140[_e264].morphTargets[_n236]]=-1;for(var _n237 in _t275){var _t276=[],_s88=[];for(var _i179=0;_i179!==_r140[_e264].morphTargets.length;++_i179){var _i180=_r140[_e264];_t276.push(_i180.time),_s88.push(_i180.morphTarget===_n237?1:0);}i.push(new wh(".morphTargetInfluence["+_n237+"]",_t276,_s88));}o=_t275.length*s;}else{var _s89=".bones["+e[_t274].name+"]";n(Lh,_s89+".position",_r140,"pos",i),n(Rh,_s89+".quaternion",_r140,"rot",i),n(Lh,_s89+".scale",_r140,"scl",i);}}if(0===i.length)return null;return new this(r,o,i,a);}}]);return Ph;}();function Ih(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return wh;case"vector":case"vector2":case"vector3":case"vector4":return Lh;case"color":return Eh;case"quaternion":return Rh;case"bool":case"boolean":return Th;case"string":return Ch;}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t);}(t.type);if(void 0===t.times){var _e265=[],_n238=[];_h(t.keys,_e265,_n238,"value"),t.times=_e265,t.values=_n238;}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation);}var Uh={enabled:!1,files:{},add:function add(t,e){!1!==this.enabled&&(this.files[t]=e);},get:function get(t){if(!1!==this.enabled)return this.files[t];},remove:function remove(t){delete this.files[t];},clear:function clear(){this.files={};}};var Dh=/*#__PURE__*/_createClass(function Dh(t,e,n){_classCallCheck(this,Dh);var i=this;var r,s=!1,a=0,o=0;var l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){o++,!1===s&&void 0!==i.onStart&&i.onStart(t,a,o),s=!0;},this.itemEnd=function(t){a++,void 0!==i.onProgress&&i.onProgress(t,a,o),a===o&&(s=!1,void 0!==i.onLoad&&i.onLoad());},this.itemError=function(t){void 0!==i.onError&&i.onError(t);},this.resolveURL=function(t){return r?r(t):t;},this.setURLModifier=function(t){return r=t,this;},this.addHandler=function(t,e){return l.push(t,e),this;},this.removeHandler=function(t){var e=l.indexOf(t);return-1!==e&&l.splice(e,2),this;},this.getHandler=function(t){for(var _e266=0,_n239=l.length;_e266<_n239;_e266+=2){var _n240=l[_e266],_i181=l[_e266+1];if(_n240.global&&(_n240.lastIndex=0),_n240.test(t))return _i181;}return null;};});var Nh=new Dh();var Oh=/*#__PURE__*/function(){function Oh(t){_classCallCheck(this,Oh);this.manager=void 0!==t?t:Nh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={};}_createClass(Oh,[{key:"load",value:function load(){}},{key:"loadAsync",value:function loadAsync(t,e){var n=this;return new Promise(function(i,r){n.load(t,i,e,r);});}},{key:"parse",value:function parse(){}},{key:"setCrossOrigin",value:function setCrossOrigin(t){return this.crossOrigin=t,this;}},{key:"setWithCredentials",value:function setWithCredentials(t){return this.withCredentials=t,this;}},{key:"setPath",value:function setPath(t){return this.path=t,this;}},{key:"setResourcePath",value:function setResourcePath(t){return this.resourcePath=t,this;}},{key:"setRequestHeader",value:function setRequestHeader(t){return this.requestHeader=t,this;}}]);return Oh;}();Oh.DEFAULT_MATERIAL_NAME="__DEFAULT";var Fh={};var Bh=/*#__PURE__*/function(_Error){_inherits(Bh,_Error);var _super99=_createSuper(Bh);function Bh(t,e){var _this86;_classCallCheck(this,Bh);_this86=_super99.call(this,t),_this86.response=e;return _this86;}return _createClass(Bh);}(/*#__PURE__*/_wrapNativeSuper(Error));var zh=/*#__PURE__*/function(_Oh){_inherits(zh,_Oh);var _super100=_createSuper(zh);function zh(t){_classCallCheck(this,zh);return _super100.call(this,t);}_createClass(zh,[{key:"load",value:function load(t,e,n,i){var _this87=this;void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var r=Uh.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout(function(){e&&e(r),_this87.manager.itemEnd(t);},0),r;if(void 0!==Fh[t])return void Fh[t].push({onLoad:e,onProgress:n,onError:i});Fh[t]=[],Fh[t].push({onLoad:e,onProgress:n,onError:i});var s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(function(e){if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;var _n241=Fh[t],_i182=e.body.getReader(),_r141=e.headers.get("Content-Length")||e.headers.get("X-File-Size"),_s90=_r141?parseInt(_r141):0,_a71=0!==_s90;var _o53=0;var _l30=new ReadableStream({start:function start(t){!function e(){_i182.read().then(function(_ref3){var i=_ref3.done,r=_ref3.value;if(i)t.close();else{_o53+=r.byteLength;var _i183=new ProgressEvent("progress",{lengthComputable:_a71,loaded:_o53,total:_s90});for(var _t277=0,_e267=_n241.length;_t277<_e267;_t277++){var _e268=_n241[_t277];_e268.onProgress&&_e268.onProgress(_i183);}t.enqueue(r),e();}});}();}});return new Response(_l30);}throw new Bh("fetch for \"".concat(e.url,"\" responded with ").concat(e.status,": ").concat(e.statusText),e);}).then(function(t){switch(o){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then(function(t){return new DOMParser().parseFromString(t,a);});case"json":return t.json();default:if(void 0===a)return t.text();{var _e269=/charset="?([^;"\s]*)"?/i.exec(a),_n242=_e269&&_e269[1]?_e269[1].toLowerCase():void 0,_i184=new TextDecoder(_n242);return t.arrayBuffer().then(function(t){return _i184.decode(t);});}}}).then(function(e){Uh.add(t,e);var n=Fh[t];delete Fh[t];for(var _t278=0,_i185=n.length;_t278<_i185;_t278++){var _i186=n[_t278];_i186.onLoad&&_i186.onLoad(e);}})["catch"](function(e){var n=Fh[t];if(void 0===n)throw _this87.manager.itemError(t),e;delete Fh[t];for(var _t279=0,_i187=n.length;_t279<_i187;_t279++){var _i188=n[_t279];_i188.onError&&_i188.onError(e);}_this87.manager.itemError(t);})["finally"](function(){_this87.manager.itemEnd(t);}),this.manager.itemStart(t);}},{key:"setResponseType",value:function setResponseType(t){return this.responseType=t,this;}},{key:"setMimeType",value:function setMimeType(t){return this.mimeType=t,this;}}]);return zh;}(Oh);var Gh=/*#__PURE__*/function(_Oh2){_inherits(Gh,_Oh2);var _super101=_createSuper(Gh);function Gh(t){_classCallCheck(this,Gh);return _super101.call(this,t);}_createClass(Gh,[{key:"load",value:function load(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var r=this,s=Uh.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout(function(){e&&e(s),r.manager.itemEnd(t);},0),s;var a=ye("img");function o(){c(),Uh.add(t,this),e&&e(this),r.manager.itemEnd(t);}function l(e){c(),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t);}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1);}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a;}}]);return Gh;}(Oh);var Hh=/*#__PURE__*/function(_jn11){_inherits(Hh,_jn11);var _super102=_createSuper(Hh);function Hh(t){var _this88;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;_classCallCheck(this,Hh);_this88=_super102.call(this),_this88.isLight=!0,_this88.type="Light",_this88.color=new ci(t),_this88.intensity=e;return _this88;}_createClass(Hh,[{key:"dispose",value:function dispose(){}},{key:"copy",value:function copy(t,e){return _get(_getPrototypeOf(Hh.prototype),"copy",this).call(this,t,e),this.color.copy(t.color),this.intensity=t.intensity,this;}},{key:"toJSON",value:function toJSON(t){var e=_get(_getPrototypeOf(Hh.prototype),"toJSON",this).call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e;}}]);return Hh;}(jn);var Vh=/*#__PURE__*/function(_Hh){_inherits(Vh,_Hh);var _super103=_createSuper(Vh);function Vh(t,e,n){var _this89;_classCallCheck(this,Vh);_this89=_super103.call(this,t,n),_this89.isHemisphereLight=!0,_this89.type="HemisphereLight",_this89.position.copy(jn.DEFAULT_UP),_this89.updateMatrix(),_this89.groundColor=new ci(e);return _this89;}_createClass(Vh,[{key:"copy",value:function copy(t,e){return _get(_getPrototypeOf(Vh.prototype),"copy",this).call(this,t,e),this.groundColor.copy(t.groundColor),this;}}]);return Vh;}(Hh);var kh=new Mn(),Wh=new We(),Xh=new We();var jh=/*#__PURE__*/function(){function jh(t){_classCallCheck(this,jh);this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new me(512,512),this.map=null,this.mapPass=null,this.matrix=new Mn(),this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new gr(),this._frameExtents=new me(1,1),this._viewportCount=1,this._viewports=[new Be(0,0,1,1)];}_createClass(jh,[{key:"getViewportCount",value:function getViewportCount(){return this._viewportCount;}},{key:"getFrustum",value:function getFrustum(){return this._frustum;}},{key:"updateMatrices",value:function updateMatrices(t){var e=this.camera,n=this.matrix;Wh.setFromMatrixPosition(t.matrixWorld),e.position.copy(Wh),Xh.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Xh),e.updateMatrixWorld(),kh.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(kh),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(kh);}},{key:"getViewport",value:function getViewport(t){return this._viewports[t];}},{key:"getFrameExtents",value:function getFrameExtents(){return this._frameExtents;}},{key:"dispose",value:function dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose();}},{key:"copy",value:function copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this;}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}},{key:"toJSON",value:function toJSON(){var t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t;}}]);return jh;}();var qh=/*#__PURE__*/function(_jh){_inherits(qh,_jh);var _super104=_createSuper(qh);function qh(){var _this90;_classCallCheck(this,qh);_this90=_super104.call(this,new sr(50,1,.5,500)),_this90.isSpotLightShadow=!0,_this90.focus=1;return _this90;}_createClass(qh,[{key:"updateMatrices",value:function updateMatrices(t){var e=this.camera,n=2*re*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),_get(_getPrototypeOf(qh.prototype),"updateMatrices",this).call(this,t);}},{key:"copy",value:function copy(t){return _get(_getPrototypeOf(qh.prototype),"copy",this).call(this,t),this.focus=t.focus,this;}}]);return qh;}(jh);var Yh=/*#__PURE__*/function(_Hh2){_inherits(Yh,_Hh2);var _super105=_createSuper(Yh);function Yh(t,e){var _this91;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Math.PI/3;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:2;_classCallCheck(this,Yh);_this91=_super105.call(this,t,e),_this91.isSpotLight=!0,_this91.type="SpotLight",_this91.position.copy(jn.DEFAULT_UP),_this91.updateMatrix(),_this91.target=new jn(),_this91.distance=n,_this91.angle=i,_this91.penumbra=r,_this91.decay=s,_this91.map=null,_this91.shadow=new qh();return _this91;}_createClass(Yh,[{key:"power",get:function get(){return this.intensity*Math.PI;},set:function set(t){this.intensity=t/Math.PI;}},{key:"dispose",value:function dispose(){this.shadow.dispose();}},{key:"copy",value:function copy(t,e){return _get(_getPrototypeOf(Yh.prototype),"copy",this).call(this,t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this;}}]);return Yh;}(Hh);var Zh=new Mn(),Jh=new We(),Kh=new We();var $h=/*#__PURE__*/function(_jh2){_inherits($h,_jh2);var _super106=_createSuper($h);function $h(){var _this92;_classCallCheck(this,$h);_this92=_super106.call(this,new sr(90,1,.5,500)),_this92.isPointLightShadow=!0,_this92._frameExtents=new me(4,2),_this92._viewportCount=6,_this92._viewports=[new Be(2,1,1,1),new Be(0,1,1,1),new Be(3,1,1,1),new Be(1,1,1,1),new Be(3,0,1,1),new Be(1,0,1,1)],_this92._cubeDirections=[new We(1,0,0),new We(-1,0,0),new We(0,0,1),new We(0,0,-1),new We(0,1,0),new We(0,-1,0)],_this92._cubeUps=[new We(0,1,0),new We(0,1,0),new We(0,1,0),new We(0,1,0),new We(0,0,1),new We(0,0,-1)];return _this92;}_createClass($h,[{key:"updateMatrices",value:function updateMatrices(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=this.camera,i=this.matrix,r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Jh.setFromMatrixPosition(t.matrixWorld),n.position.copy(Jh),Kh.copy(n.position),Kh.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Kh),n.updateMatrixWorld(),i.makeTranslation(-Jh.x,-Jh.y,-Jh.z),Zh.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Zh);}}]);return $h;}(jh);var Qh=/*#__PURE__*/function(_Hh3){_inherits(Qh,_Hh3);var _super107=_createSuper(Qh);function Qh(t,e){var _this93;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:2;_classCallCheck(this,Qh);_this93=_super107.call(this,t,e),_this93.isPointLight=!0,_this93.type="PointLight",_this93.distance=n,_this93.decay=i,_this93.shadow=new $h();return _this93;}_createClass(Qh,[{key:"power",get:function get(){return 4*this.intensity*Math.PI;},set:function set(t){this.intensity=t/(4*Math.PI);}},{key:"dispose",value:function dispose(){this.shadow.dispose();}},{key:"copy",value:function copy(t,e){return _get(_getPrototypeOf(Qh.prototype),"copy",this).call(this,t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this;}}]);return Qh;}(Hh);var tu=/*#__PURE__*/function(_jh3){_inherits(tu,_jh3);var _super108=_createSuper(tu);function tu(){var _this94;_classCallCheck(this,tu);_this94=_super108.call(this,new Lr(-5,5,5,-5,.5,500)),_this94.isDirectionalLightShadow=!0;return _this94;}return _createClass(tu);}(jh);var eu=/*#__PURE__*/function(_Hh4){_inherits(eu,_Hh4);var _super109=_createSuper(eu);function eu(t,e){var _this95;_classCallCheck(this,eu);_this95=_super109.call(this,t,e),_this95.isDirectionalLight=!0,_this95.type="DirectionalLight",_this95.position.copy(jn.DEFAULT_UP),_this95.updateMatrix(),_this95.target=new jn(),_this95.shadow=new tu();return _this95;}_createClass(eu,[{key:"dispose",value:function dispose(){this.shadow.dispose();}},{key:"copy",value:function copy(t){return _get(_getPrototypeOf(eu.prototype),"copy",this).call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this;}}]);return eu;}(Hh);var nu=/*#__PURE__*/function(_Hh5){_inherits(nu,_Hh5);var _super110=_createSuper(nu);function nu(t,e){var _this96;_classCallCheck(this,nu);_this96=_super110.call(this,t,e),_this96.isAmbientLight=!0,_this96.type="AmbientLight";return _this96;}return _createClass(nu);}(Hh);var iu=/*#__PURE__*/function(_Hh6){_inherits(iu,_Hh6);var _super111=_createSuper(iu);function iu(t,e){var _this97;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:10;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:10;_classCallCheck(this,iu);_this97=_super111.call(this,t,e),_this97.isRectAreaLight=!0,_this97.type="RectAreaLight",_this97.width=n,_this97.height=i;return _this97;}_createClass(iu,[{key:"power",get:function get(){return this.intensity*this.width*this.height*Math.PI;},set:function set(t){this.intensity=t/(this.width*this.height*Math.PI);}},{key:"copy",value:function copy(t){return _get(_getPrototypeOf(iu.prototype),"copy",this).call(this,t),this.width=t.width,this.height=t.height,this;}},{key:"toJSON",value:function toJSON(t){var e=_get(_getPrototypeOf(iu.prototype),"toJSON",this).call(this,t);return e.object.width=this.width,e.object.height=this.height,e;}}]);return iu;}(Hh);var ru=/*#__PURE__*/function(){function ru(){_classCallCheck(this,ru);this.isSphericalHarmonics3=!0,this.coefficients=[];for(var _t280=0;_t280<9;_t280++)this.coefficients.push(new We());}_createClass(ru,[{key:"set",value:function set(t){for(var _e270=0;_e270<9;_e270++)this.coefficients[_e270].copy(t[_e270]);return this;}},{key:"zero",value:function zero(){for(var _t281=0;_t281<9;_t281++)this.coefficients[_t281].set(0,0,0);return this;}},{key:"getAt",value:function getAt(t,e){var n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*i),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*i*1.092548),e.addScaledVector(s[5],i*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],n*r*1.092548),e.addScaledVector(s[8],.546274*(n*n-i*i)),e;}},{key:"getIrradianceAt",value:function getIrradianceAt(t,e){var n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*i),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*i),e.addScaledVector(s[5],.858086*i*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*n*r),e.addScaledVector(s[8],.429043*(n*n-i*i)),e;}},{key:"add",value:function add(t){for(var _e271=0;_e271<9;_e271++)this.coefficients[_e271].add(t.coefficients[_e271]);return this;}},{key:"addScaledSH",value:function addScaledSH(t,e){for(var _n243=0;_n243<9;_n243++)this.coefficients[_n243].addScaledVector(t.coefficients[_n243],e);return this;}},{key:"scale",value:function scale(t){for(var _e272=0;_e272<9;_e272++)this.coefficients[_e272].multiplyScalar(t);return this;}},{key:"lerp",value:function lerp(t,e){for(var _n244=0;_n244<9;_n244++)this.coefficients[_n244].lerp(t.coefficients[_n244],e);return this;}},{key:"equals",value:function equals(t){for(var _e273=0;_e273<9;_e273++)if(!this.coefficients[_e273].equals(t.coefficients[_e273]))return!1;return!0;}},{key:"copy",value:function copy(t){return this.set(t.coefficients);}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}},{key:"fromArray",value:function fromArray(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=this.coefficients;for(var _i189=0;_i189<9;_i189++)n[_i189].fromArray(t,e+3*_i189);return this;}},{key:"toArray",value:function toArray(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=this.coefficients;for(var _i190=0;_i190<9;_i190++)n[_i190].toArray(t,e+3*_i190);return t;}}],[{key:"getBasisAt",value:function getBasisAt(t,e){var n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i);}}]);return ru;}();var su=/*#__PURE__*/function(_Hh7){_inherits(su,_Hh7);var _super112=_createSuper(su);function su(){var _this98;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new ru();var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;_classCallCheck(this,su);_this98=_super112.call(this,void 0,e),_this98.isLightProbe=!0,_this98.sh=t;return _this98;}_createClass(su,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(su.prototype),"copy",this).call(this,t),this.sh.copy(t.sh),this;}},{key:"fromJSON",value:function fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this;}},{key:"toJSON",value:function toJSON(t){var e=_get(_getPrototypeOf(su.prototype),"toJSON",this).call(this,t);return e.object.sh=this.sh.toArray(),e;}}]);return su;}(Hh);var au=/*#__PURE__*/function(_Oh3){_inherits(au,_Oh3);var _super113=_createSuper(au);function au(t){var _this99;_classCallCheck(this,au);_this99=_super113.call(this,t),_this99.textures={};return _this99;}_createClass(au,[{key:"load",value:function load(t,e,n,i){var r=this,s=new zh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,function(n){try{e(r.parse(JSON.parse(n)));}catch(e){i?i(e):console.error(e),r.manager.itemError(t);}},n,i);}},{key:"parse",value:function parse(t){var e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t];}var i=au.createMaterialFromType(t.type);if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=t.sheen),void 0!==t.sheenColor&&(i.sheenColor=new ci().setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(i.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.specularIntensity&&(i.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.iridescence&&(i.iridescence=t.iridescence),void 0!==t.iridescenceIOR&&(i.iridescenceIOR=t.iridescenceIOR),void 0!==t.iridescenceThicknessRange&&(i.iridescenceThicknessRange=t.iridescenceThicknessRange),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.thickness&&(i.thickness=t.thickness),void 0!==t.attenuationDistance&&(i.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(t.attenuationColor),void 0!==t.anisotropy&&(i.anisotropy=t.anisotropy),void 0!==t.anisotropyRotation&&(i.anisotropyRotation=t.anisotropyRotation),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.shadowSide&&(i.shadowSide=t.shadowSide),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.alphaHash&&(i.alphaHash=t.alphaHash),void 0!==t.depthFunc&&(i.depthFunc=t.depthFunc),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.blendSrc&&(i.blendSrc=t.blendSrc),void 0!==t.blendDst&&(i.blendDst=t.blendDst),void 0!==t.blendEquation&&(i.blendEquation=t.blendEquation),void 0!==t.blendSrcAlpha&&(i.blendSrcAlpha=t.blendSrcAlpha),void 0!==t.blendDstAlpha&&(i.blendDstAlpha=t.blendDstAlpha),void 0!==t.blendEquationAlpha&&(i.blendEquationAlpha=t.blendEquationAlpha),void 0!==t.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(t.blendColor),void 0!==t.blendAlpha&&(i.blendAlpha=t.blendAlpha),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),void 0!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.alphaToCoverage&&(i.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(i.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.forceSinglePass&&(i.forceSinglePass=t.forceSinglePass),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(var _e274 in t.uniforms){var _r142=t.uniforms[_e274];switch(i.uniforms[_e274]={},_r142.type){case"t":i.uniforms[_e274].value=n(_r142.value);break;case"c":i.uniforms[_e274].value=new ci().setHex(_r142.value);break;case"v2":i.uniforms[_e274].value=new me().fromArray(_r142.value);break;case"v3":i.uniforms[_e274].value=new We().fromArray(_r142.value);break;case"v4":i.uniforms[_e274].value=new Be().fromArray(_r142.value);break;case"m3":i.uniforms[_e274].value=new fe().fromArray(_r142.value);break;case"m4":i.uniforms[_e274].value=new Mn().fromArray(_r142.value);break;default:i.uniforms[_e274].value=_r142.value;}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.glslVersion&&(i.glslVersion=t.glslVersion),void 0!==t.extensions)for(var _e275 in t.extensions)i.extensions[_e275]=t.extensions[_e275];if(void 0!==t.lights&&(i.lights=t.lights),void 0!==t.clipping&&(i.clipping=t.clipping),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=n(t.map)),void 0!==t.matcap&&(i.matcap=n(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){var _e276=t.normalScale;!1===Array.isArray(_e276)&&(_e276=[_e276,_e276]),i.normalScale=new me().fromArray(_e276);}return void 0!==t.displacementMap&&(i.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=n(t.specularMap)),void 0!==t.specularIntensityMap&&(i.specularIntensityMap=n(t.specularIntensityMap)),void 0!==t.specularColorMap&&(i.specularColorMap=n(t.specularColorMap)),void 0!==t.envMap&&(i.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=new me().fromArray(t.clearcoatNormalScale)),void 0!==t.iridescenceMap&&(i.iridescenceMap=n(t.iridescenceMap)),void 0!==t.iridescenceThicknessMap&&(i.iridescenceThicknessMap=n(t.iridescenceThicknessMap)),void 0!==t.transmissionMap&&(i.transmissionMap=n(t.transmissionMap)),void 0!==t.thicknessMap&&(i.thicknessMap=n(t.thicknessMap)),void 0!==t.anisotropyMap&&(i.anisotropyMap=n(t.anisotropyMap)),void 0!==t.sheenColorMap&&(i.sheenColorMap=n(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(i.sheenRoughnessMap=n(t.sheenRoughnessMap)),i;}},{key:"setTextures",value:function setTextures(t){return this.textures=t,this;}}],[{key:"createMaterialFromType",value:function createMaterialFromType(t){return new{ShadowMaterial:ih,SpriteMaterial:lo,RawShaderMaterial:rh,ShaderMaterial:ir,PointsMaterial:wl,MeshPhysicalMaterial:ah,MeshStandardMaterial:sh,MeshPhongMaterial:oh,MeshToonMaterial:lh,MeshNormalMaterial:ch,MeshLambertMaterial:hh,MeshDepthMaterial:Ha,MeshDistanceMaterial:Va,MeshBasicMaterial:pi,MeshMatcapMaterial:uh,LineDashedMaterial:dh,LineBasicMaterial:fl,Material:di}[t]();}}]);return au;}(Oh);var ou=/*#__PURE__*/function(){function ou(){_classCallCheck(this,ou);}_createClass(ou,null,[{key:"decodeText",value:function decodeText(t){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(t);var e="";for(var _n245=0,_i191=t.length;_n245<_i191;_n245++)e+=String.fromCharCode(t[_n245]);try{return decodeURIComponent(escape(e));}catch(t){return e;}}},{key:"extractUrlBase",value:function extractUrlBase(t){var e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1);}},{key:"resolveURL",value:function resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t);}}]);return ou;}();var lu=/*#__PURE__*/function(_Ii16){_inherits(lu,_Ii16);var _super114=_createSuper(lu);function lu(){var _this100;_classCallCheck(this,lu);_this100=_super114.call(this),_this100.isInstancedBufferGeometry=!0,_this100.type="InstancedBufferGeometry",_this100.instanceCount=1/0;return _this100;}_createClass(lu,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(lu.prototype),"copy",this).call(this,t),this.instanceCount=t.instanceCount,this;}},{key:"toJSON",value:function toJSON(){var t=_get(_getPrototypeOf(lu.prototype),"toJSON",this).call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t;}}]);return lu;}(Ii);var cu=/*#__PURE__*/function(_Oh4){_inherits(cu,_Oh4);var _super115=_createSuper(cu);function cu(t){_classCallCheck(this,cu);return _super115.call(this,t);}_createClass(cu,[{key:"load",value:function load(t,e,n,i){var r=this,s=new zh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,function(n){try{e(r.parse(JSON.parse(n)));}catch(e){i?i(e):console.error(e),r.manager.itemError(t);}},n,i);}},{key:"parse",value:function parse(t){var e={},n={};function i(t,i){if(void 0!==e[i])return e[i];var r=t.interleavedBuffers[i],s=function(t,e){if(void 0!==n[e])return n[e];var i=t.arrayBuffers,r=i[e],s=new Uint32Array(r).buffer;return n[e]=s,s;}(t,r.buffer),a=xe(r.type,s),o=new so(a,r.stride);return o.uuid=r.uuid,e[i]=o,o;}var r=t.isInstancedBufferGeometry?new lu():new Ii(),s=t.data.index;if(void 0!==s){var _t282=xe(s.type,s.array);r.setIndex(new Mi(_t282,1));}var a=t.data.attributes;for(var _e277 in a){var _n246=a[_e277];var _s91=void 0;if(_n246.isInterleavedBufferAttribute){var _e278=i(t.data,_n246.data);_s91=new oo(_e278,_n246.itemSize,_n246.offset,_n246.normalized);}else{var _t283=xe(_n246.type,_n246.array);_s91=new(_n246.isInstancedBufferAttribute?ko:Mi)(_t283,_n246.itemSize,_n246.normalized);}void 0!==_n246.name&&(_s91.name=_n246.name),void 0!==_n246.usage&&_s91.setUsage(_n246.usage),r.setAttribute(_e277,_s91);}var o=t.data.morphAttributes;if(o)for(var _e279 in o){var _n247=o[_e279],_s92=[];for(var _e280=0,_r143=_n247.length;_e280<_r143;_e280++){var _r144=_n247[_e280];var _a72=void 0;if(_r144.isInterleavedBufferAttribute){var _e281=i(t.data,_r144.data);_a72=new oo(_e281,_r144.itemSize,_r144.offset,_r144.normalized);}else{var _t284=xe(_r144.type,_r144.array);_a72=new Mi(_t284,_r144.itemSize,_r144.normalized);}void 0!==_r144.name&&(_a72.name=_r144.name),_s92.push(_a72);}r.morphAttributes[_e279]=_s92;}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);var l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(var _t285=0,_e282=l.length;_t285!==_e282;++_t285){var _e283=l[_t285];r.addGroup(_e283.start,_e283.count,_e283.materialIndex);}var c=t.data.boundingSphere;if(void 0!==c){var _t286=new We();void 0!==c.center&&_t286.fromArray(c.center),r.boundingSphere=new dn(_t286,c.radius);}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r;}}]);return cu;}(Oh);var hu={UVMapping:S,CubeReflectionMapping:b,CubeRefractionMapping:T,EquirectangularReflectionMapping:E,EquirectangularRefractionMapping:w,CubeUVReflectionMapping:A},uu={RepeatWrapping:R,ClampToEdgeWrapping:C,MirroredRepeatWrapping:L},du={NearestFilter:P,NearestMipmapNearestFilter:I,NearestMipmapLinearFilter:U,LinearFilter:D,LinearMipmapNearestFilter:N,LinearMipmapLinearFilter:O};var pu;var mu=/*#__PURE__*/function(){function mu(){_classCallCheck(this,mu);}_createClass(mu,null,[{key:"getContext",value:function getContext(){return void 0===pu&&(pu=new(window.AudioContext||window.webkitAudioContext)()),pu;}},{key:"setContext",value:function setContext(t){pu=t;}}]);return mu;}();var fu=new Mn(),gu=new Mn(),_u=new Mn();var vu=/*#__PURE__*/function(){function vu(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!0;_classCallCheck(this,vu);this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1;}_createClass(vu,[{key:"start",value:function start(){this.startTime=xu(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0;}},{key:"stop",value:function stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1;}},{key:"getElapsedTime",value:function getElapsedTime(){return this.getDelta(),this.elapsedTime;}},{key:"getDelta",value:function getDelta(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var _e284=xu();t=(_e284-this.oldTime)/1e3,this.oldTime=_e284,this.elapsedTime+=t;}return t;}}]);return vu;}();function xu(){return("undefined"==typeof performance?Date:performance).now();}var yu=new We(),Mu=new ke(),Su=new We(),bu=new We();var Tu=/*#__PURE__*/function(_jn12){_inherits(Tu,_jn12);var _super116=_createSuper(Tu);function Tu(t){var _this101;_classCallCheck(this,Tu);_this101=_super116.call(this),_this101.type="Audio",_this101.listener=t,_this101.context=t.context,_this101.gain=_this101.context.createGain(),_this101.gain.connect(t.getInput()),_this101.autoplay=!1,_this101.buffer=null,_this101.detune=0,_this101.loop=!1,_this101.loopStart=0,_this101.loopEnd=0,_this101.offset=0,_this101.duration=void 0,_this101.playbackRate=1,_this101.isPlaying=!1,_this101.hasPlaybackControl=!0,_this101.source=null,_this101.sourceType="empty",_this101._startedAt=0,_this101._progress=0,_this101._connected=!1,_this101.filters=[];return _this101;}_createClass(Tu,[{key:"getOutput",value:function getOutput(){return this.gain;}},{key:"setNodeSource",value:function setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this;}},{key:"setMediaElementSource",value:function setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this;}},{key:"setMediaStreamSource",value:function setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this;}},{key:"setBuffer",value:function setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this;}},{key:"play",value:function play(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect();}},{key:"pause",value:function pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.");}},{key:"stop",value:function stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.");}},{key:"connect",value:function connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var _t287=1,_e285=this.filters.length;_t287<_e285;_t287++)this.filters[_t287-1].connect(this.filters[_t287]);this.filters[this.filters.length-1].connect(this.getOutput());}else this.source.connect(this.getOutput());return this._connected=!0,this;}},{key:"disconnect",value:function disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var _t288=1,_e286=this.filters.length;_t288<_e286;_t288++)this.filters[_t288-1].disconnect(this.filters[_t288]);this.filters[this.filters.length-1].disconnect(this.getOutput());}else this.source.disconnect(this.getOutput());return this._connected=!1,this;}}},{key:"getFilters",value:function getFilters(){return this.filters;}},{key:"setFilters",value:function setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this;}},{key:"setDetune",value:function setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this;}},{key:"getDetune",value:function getDetune(){return this.detune;}},{key:"getFilter",value:function getFilter(){return this.getFilters()[0];}},{key:"setFilter",value:function setFilter(t){return this.setFilters(t?[t]:[]);}},{key:"setPlaybackRate",value:function setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.");}},{key:"getPlaybackRate",value:function getPlaybackRate(){return this.playbackRate;}},{key:"onEnded",value:function onEnded(){this.isPlaying=!1;}},{key:"getLoop",value:function getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop;}},{key:"setLoop",value:function setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.");}},{key:"setLoopStart",value:function setLoopStart(t){return this.loopStart=t,this;}},{key:"setLoopEnd",value:function setLoopEnd(t){return this.loopEnd=t,this;}},{key:"getVolume",value:function getVolume(){return this.gain.gain.value;}},{key:"setVolume",value:function setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this;}}]);return Tu;}(jn);var Eu=new We(),wu=new ke(),Au=new We(),Ru=new We();var Cu=/*#__PURE__*/function(){function Cu(t,e,n){_classCallCheck(this,Cu);var i,r,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n);}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0;}_createClass(Cu,[{key:"accumulate",value:function accumulate(t,e){var n=this.buffer,i=this.valueSize,r=t*i+i;var s=this.cumulativeWeight;if(0===s){for(var _t289=0;_t289!==i;++_t289)n[r+_t289]=n[_t289];s=e;}else{s+=e;var _t290=e/s;this._mixBufferRegion(n,r,0,_t290,i);}this.cumulativeWeight=s;}},{key:"accumulateAdditive",value:function accumulateAdditive(t){var e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t;}},{key:"apply",value:function apply(t){var e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){var _t291=e*this._origIndex;this._mixBufferRegion(n,i,_t291,1-r,e);}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(var _t292=e,_r145=e+e;_t292!==_r145;++_t292)if(n[_t292]!==n[_t292+e]){a.setValue(n,i);break;}}},{key:"saveOriginalState",value:function saveOriginalState(){var t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(var _t293=n,_r146=i;_t293!==_r146;++_t293)e[_t293]=e[i+_t293%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0;}},{key:"restoreOriginalState",value:function restoreOriginalState(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t);}},{key:"_setAdditiveIdentityNumeric",value:function _setAdditiveIdentityNumeric(){var t=this._addIndex*this.valueSize,e=t+this.valueSize;for(var _n248=t;_n248<e;_n248++)this.buffer[_n248]=0;}},{key:"_setAdditiveIdentityQuaternion",value:function _setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1;}},{key:"_setAdditiveIdentityOther",value:function _setAdditiveIdentityOther(){var t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(var _n249=0;_n249<this.valueSize;_n249++)this.buffer[e+_n249]=this.buffer[t+_n249];}},{key:"_select",value:function _select(t,e,n,i,r){if(i>=.5)for(var _i192=0;_i192!==r;++_i192)t[e+_i192]=t[n+_i192];}},{key:"_slerp",value:function _slerp(t,e,n,i){ke.slerpFlat(t,e,t,e,t,n,i);}},{key:"_slerpAdditive",value:function _slerpAdditive(t,e,n,i,r){var s=this._workIndex*r;ke.multiplyQuaternionsFlat(t,s,t,e,t,n),ke.slerpFlat(t,e,t,e,t,s,i);}},{key:"_lerp",value:function _lerp(t,e,n,i,r){var s=1-i;for(var _a73=0;_a73!==r;++_a73){var _r147=e+_a73;t[_r147]=t[_r147]*s+t[n+_a73]*i;}}},{key:"_lerpAdditive",value:function _lerpAdditive(t,e,n,i,r){for(var _s93=0;_s93!==r;++_s93){var _r148=e+_s93;t[_r148]=t[_r148]+t[n+_s93]*i;}}}]);return Cu;}();var Lu="\\[\\]\\.:\\/",Pu=new RegExp("["+Lu+"]","g"),Iu="[^"+Lu+"]",Uu="[^"+Lu.replace("\\.","")+"]",Du=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Iu)+/(WCOD+)?/.source.replace("WCOD",Uu)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Iu)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Iu)+"$"),Nu=["material","materials","bones","map"];var Ou=/*#__PURE__*/function(){function Ou(t,e,n){_classCallCheck(this,Ou);this.path=e,this.parsedPath=n||Ou.parseTrackName(e),this.node=Ou.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound;}_createClass(Ou,[{key:"_getValue_unavailable",value:function _getValue_unavailable(){}},{key:"_setValue_unavailable",value:function _setValue_unavailable(){}},{key:"_getValue_direct",value:function _getValue_direct(t,e){t[e]=this.targetObject[this.propertyName];}},{key:"_getValue_array",value:function _getValue_array(t,e){var n=this.resolvedProperty;for(var _i193=0,_r149=n.length;_i193!==_r149;++_i193)t[e++]=n[_i193];}},{key:"_getValue_arrayElement",value:function _getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex];}},{key:"_getValue_toArray",value:function _getValue_toArray(t,e){this.resolvedProperty.toArray(t,e);}},{key:"_setValue_direct",value:function _setValue_direct(t,e){this.targetObject[this.propertyName]=t[e];}},{key:"_setValue_direct_setNeedsUpdate",value:function _setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0;}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function _setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0;}},{key:"_setValue_array",value:function _setValue_array(t,e){var n=this.resolvedProperty;for(var _i194=0,_r150=n.length;_i194!==_r150;++_i194)n[_i194]=t[e++];}},{key:"_setValue_array_setNeedsUpdate",value:function _setValue_array_setNeedsUpdate(t,e){var n=this.resolvedProperty;for(var _i195=0,_r151=n.length;_i195!==_r151;++_i195)n[_i195]=t[e++];this.targetObject.needsUpdate=!0;}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function _setValue_array_setMatrixWorldNeedsUpdate(t,e){var n=this.resolvedProperty;for(var _i196=0,_r152=n.length;_i196!==_r152;++_i196)n[_i196]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0;}},{key:"_setValue_arrayElement",value:function _setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e];}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function _setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0;}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function _setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0;}},{key:"_setValue_fromArray",value:function _setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e);}},{key:"_setValue_fromArray_setNeedsUpdate",value:function _setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0;}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function _setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0;}},{key:"_getValue_unbound",value:function _getValue_unbound(t,e){this.bind(),this.getValue(t,e);}},{key:"_setValue_unbound",value:function _setValue_unbound(t,e){this.bind(),this.setValue(t,e);}},{key:"bind",value:function bind(){var t=this.node;var e=this.parsedPath,n=e.objectName,i=e.propertyName;var r=e.propertyIndex;if(t||(t=Ou.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){var _i197=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var _e287=0;_e287<t.length;_e287++)if(t[_e287].name===_i197){_i197=_e287;break;}break;case"map":if("map"in t){t=t.map;break;}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n];}if(void 0!==_i197){if(void 0===t[_i197])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[_i197];}}var s=t[i];if(void 0===s){var _n250=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+_n250+"."+i+" but it wasn't found.",t);}var a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);var o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r]);}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r;}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a];}},{key:"unbind",value:function unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound;}}],[{key:"create",value:function create(t,e,n){return t&&t.isAnimationObjectGroup?new Ou.Composite(t,e,n):new Ou(t,e,n);}},{key:"sanitizeNodeName",value:function sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Pu,"");}},{key:"parseTrackName",value:function parseTrackName(t){var e=Du.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var _t294=n.nodeName.substring(i+1);-1!==Nu.indexOf(_t294)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=_t294);}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n;}},{key:"findNode",value:function findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var _n251=t.skeleton.getBoneByName(e);if(void 0!==_n251)return _n251;}if(t.children){var _n252=function _n252(t){for(var _i199=0;_i199<t.length;_i199++){var _r153=t[_i199];if(_r153.name===e||_r153.uuid===e)return _r153;var _s94=_n252(_r153.children);if(_s94)return _s94;}return null;},_i198=_n252(t.children);if(_i198)return _i198;}return null;}}]);return Ou;}();Ou.Composite=/*#__PURE__*/function(){function _class(t,e,n){_classCallCheck(this,_class);var i=n||Ou.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i);}_createClass(_class,[{key:"getValue",value:function getValue(t,e){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e);}},{key:"setValue",value:function setValue(t,e){var n=this._bindings;for(var _i200=this._targetGroup.nCachedObjects_,_r154=n.length;_i200!==_r154;++_i200)n[_i200].setValue(t,e);}},{key:"bind",value:function bind(){var t=this._bindings;for(var _e288=this._targetGroup.nCachedObjects_,_n253=t.length;_e288!==_n253;++_e288)t[_e288].bind();}},{key:"unbind",value:function unbind(){var t=this._bindings;for(var _e289=this._targetGroup.nCachedObjects_,_n254=t.length;_e289!==_n254;++_e289)t[_e289].unbind();}}]);return _class;}(),Ou.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ou.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ou.prototype.GetterByBindingType=[Ou.prototype._getValue_direct,Ou.prototype._getValue_array,Ou.prototype._getValue_arrayElement,Ou.prototype._getValue_toArray],Ou.prototype.SetterByBindingTypeAndVersioning=[[Ou.prototype._setValue_direct,Ou.prototype._setValue_direct_setNeedsUpdate,Ou.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ou.prototype._setValue_array,Ou.prototype._setValue_array_setNeedsUpdate,Ou.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ou.prototype._setValue_arrayElement,Ou.prototype._setValue_arrayElement_setNeedsUpdate,Ou.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ou.prototype._setValue_fromArray,Ou.prototype._setValue_fromArray_setNeedsUpdate,Ou.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Fu=/*#__PURE__*/function(){function Fu(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:e.blendMode;_classCallCheck(this,Fu);this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;var r=e.tracks,s=r.length,a=new Array(s),o={endingStart:It,endingEnd:It};for(var _t295=0;_t295!==s;++_t295){var _e290=r[_t295].createInterpolant(null);a[_t295]=_e290,_e290.settings=o;}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0;}_createClass(Fu,[{key:"play",value:function play(){return this._mixer._activateAction(this),this;}},{key:"stop",value:function stop(){return this._mixer._deactivateAction(this),this.reset();}},{key:"reset",value:function reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping();}},{key:"isRunning",value:function isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this);}},{key:"isScheduled",value:function isScheduled(){return this._mixer._isActiveAction(this);}},{key:"startAt",value:function startAt(t){return this._startTime=t,this;}},{key:"setLoop",value:function setLoop(t,e){return this.loop=t,this.repetitions=e,this;}},{key:"setEffectiveWeight",value:function setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading();}},{key:"getEffectiveWeight",value:function getEffectiveWeight(){return this._effectiveWeight;}},{key:"fadeIn",value:function fadeIn(t){return this._scheduleFading(t,0,1);}},{key:"fadeOut",value:function fadeOut(t){return this._scheduleFading(t,1,0);}},{key:"crossFadeFrom",value:function crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){var _n255=this._clip.duration,_i201=t._clip.duration,_r155=_i201/_n255,_s95=_n255/_i201;t.warp(1,_r155,e),this.warp(_s95,1,e);}return this;}},{key:"crossFadeTo",value:function crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n);}},{key:"stopFading",value:function stopFading(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this;}},{key:"setEffectiveTimeScale",value:function setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping();}},{key:"getEffectiveTimeScale",value:function getEffectiveTimeScale(){return this._effectiveTimeScale;}},{key:"setDuration",value:function setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping();}},{key:"syncWith",value:function syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping();}},{key:"halt",value:function halt(t){return this.warp(this._effectiveTimeScale,0,t);}},{key:"warp",value:function warp(t,e,n){var i=this._mixer,r=i.time,s=this.timeScale;var a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);var o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+n,l[0]=t/s,l[1]=e/s,this;}},{key:"stopWarping",value:function stopWarping(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this;}},{key:"getMixer",value:function getMixer(){return this._mixer;}},{key:"getClip",value:function getClip(){return this._clip;}},{key:"getRoot",value:function getRoot(){return this._localRoot||this._mixer._root;}},{key:"_update",value:function _update(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);var r=this._startTime;if(null!==r){var _i202=(t-r)*n;_i202<0||0===n?e=0:(this._startTime=null,e=n*_i202);}e*=this._updateTimeScale(t);var s=this._updateTime(e),a=this._updateWeight(t);if(a>0){var _t296=this._interpolants,_e291=this._propertyBindings;if(this.blendMode===Ot)for(var _n256=0,_i203=_t296.length;_n256!==_i203;++_n256)_t296[_n256].evaluate(s),_e291[_n256].accumulateAdditive(a);else for(var _n257=0,_r156=_t296.length;_n257!==_r156;++_n257)_t296[_n257].evaluate(s),_e291[_n257].accumulate(i,a);}}},{key:"_updateWeight",value:function _updateWeight(t){var e=0;if(this.enabled){e=this.weight;var _n258=this._weightInterpolant;if(null!==_n258){var _i204=_n258.evaluate(t)[0];e*=_i204,t>_n258.parameterPositions[1]&&(this.stopFading(),0===_i204&&(this.enabled=!1));}}return this._effectiveWeight=e,e;}},{key:"_updateTimeScale",value:function _updateTimeScale(t){var e=0;if(!this.paused){e=this.timeScale;var _n259=this._timeScaleInterpolant;if(null!==_n259){e*=_n259.evaluate(t)[0],t>_n259.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e);}}return this._effectiveTimeScale=e,e;}},{key:"_updateTime",value:function _updateTime(t){var e=this._clip.duration,n=this.loop;var i=this.time+t,r=this._loopCount;var s=2202===n;if(0===t)return-1===r?i:s&&1==(1&r)?e-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t;}i=0;}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1});}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=e||i<0){var _n260=Math.floor(i/e);i-=e*_n260,r+=Math.abs(_n260);var _a74=this.repetitions-r;if(_a74<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===_a74){var _e292=t<0;this._setEndings(_e292,!_e292,s);}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:_n260});}}else this.time=i;if(s&&1==(1&r))return e-i;}return i;}},{key:"_setEndings",value:function _setEndings(t,e,n){var i=this._interpolantSettings;n?(i.endingStart=Ut,i.endingEnd=Ut):(i.endingStart=t?this.zeroSlopeAtStart?Ut:It:Dt,i.endingEnd=e?this.zeroSlopeAtEnd?Ut:It:Dt);}},{key:"_scheduleFading",value:function _scheduleFading(t,e,n){var i=this._mixer,r=i.time;var s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);var a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=e,a[1]=r+t,o[1]=n,this;}}]);return Fu;}();var Bu=new Float32Array(1);var zu=/*#__PURE__*/function(){function zu(t){_classCallCheck(this,zu);this.value=t;}_createClass(zu,[{key:"clone",value:function clone(){return new zu(void 0===this.value.clone?this.value:this.value.clone());}}]);return zu;}();var Gu=0;function Hu(t,e){return t.distance-e.distance;}function Vu(t,e,n,i){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===i){var _i205=t.children;for(var _t297=0,_r157=_i205.length;_t297<_r157;_t297++)Vu(_i205[_t297],e,n,!0);}}var ku=new me();var Wu=new We(),Xu=new We();var ju=new We();var qu=new We(),Yu=new Mn(),Zu=new Mn();function Ju(t){var e=[];!0===t.isBone&&e.push(t);for(var _n261=0;_n261<t.children.length;_n261++)e.push.apply(e,Ju(t.children[_n261]));return e;}var Ku=new We(),$u=new ci(),Qu=new ci();var td=new We(),ed=new We(),nd=new We();var id=new We(),rd=new rr();function sd(t,e,n,i,r,s,a){id.set(r,s,a).unproject(i);var o=e[t];if(void 0!==o){var _t298=n.getAttribute("position");for(var _e293=0,_n262=o.length;_e293<_n262;_e293++)_t298.setXYZ(o[_e293],id.x,id.y,id.z);}}var ad=new qe();var od=new We();var ld,cd;"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:e}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=e),t.ACESFilmicToneMapping=_,t.AddEquation=o,t.AddOperation=d,t.AdditiveAnimationBlendMode=Ot,t.AdditiveBlending=2,t.AgXToneMapping=x,t.AlphaFormat=1021,t.AlwaysCompare=519,t.AlwaysDepth=1,t.AlwaysStencilFunc=519,t.AmbientLight=nu,t.AnimationAction=Fu,t.AnimationClip=Ph,t.AnimationLoader=/*#__PURE__*/function(_Oh5){_inherits(_class2,_Oh5);var _super117=_createSuper(_class2);function _class2(t){_classCallCheck(this,_class2);return _super117.call(this,t);}_createClass(_class2,[{key:"load",value:function load(t,e,n,i){var r=this,s=new zh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,function(n){try{e(r.parse(JSON.parse(n)));}catch(e){i?i(e):console.error(e),r.manager.itemError(t);}},n,i);}},{key:"parse",value:function parse(t){var e=[];for(var _n263=0;_n263<t.length;_n263++){var _i206=Ph.parse(t[_n263]);e.push(_i206);}return e;}}]);return _class2;}(Oh),t.AnimationMixer=/*#__PURE__*/function(_te7){_inherits(_class3,_te7);var _super118=_createSuper(_class3);function _class3(t){var _this102;_classCallCheck(this,_class3);_this102=_super118.call(this),_this102._root=t,_this102._initMemoryManager(),_this102._accuIndex=0,_this102.time=0,_this102.timeScale=1;return _this102;}_createClass(_class3,[{key:"_bindAction",value:function _bindAction(t,e){var n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,s=t._propertyBindings,a=t._interpolants,o=n.uuid,l=this._bindingsByRootAndName;var c=l[o];void 0===c&&(c={},l[o]=c);for(var _t299=0;_t299!==r;++_t299){var _r158=i[_t299],_l31=_r158.name;var _h14=c[_l31];if(void 0!==_h14)++_h14.referenceCount,s[_t299]=_h14;else{if(_h14=s[_t299],void 0!==_h14){null===_h14._cacheIndex&&(++_h14.referenceCount,this._addInactiveBinding(_h14,o,_l31));continue;}var _i207=e&&e._propertyBindings[_t299].binding.parsedPath;_h14=new Cu(Ou.create(n,_l31,_i207),_r158.ValueTypeName,_r158.getValueSize()),++_h14.referenceCount,this._addInactiveBinding(_h14,o,_l31),s[_t299]=_h14;}a[_t299].resultBuffer=_h14.buffer;}}},{key:"_activateAction",value:function _activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var _e294=(t._localRoot||this._root).uuid,_n264=t._clip.uuid,_i208=this._actionsByClip[_n264];this._bindAction(t,_i208&&_i208.knownActions[0]),this._addInactiveAction(t,_n264,_e294);}var _e295=t._propertyBindings;for(var _t300=0,_n265=_e295.length;_t300!==_n265;++_t300){var _n266=_e295[_t300];0==_n266.useCount++&&(this._lendBinding(_n266),_n266.saveOriginalState());}this._lendAction(t);}}},{key:"_deactivateAction",value:function _deactivateAction(t){if(this._isActiveAction(t)){var _e296=t._propertyBindings;for(var _t301=0,_n267=_e296.length;_t301!==_n267;++_t301){var _n268=_e296[_t301];0==--_n268.useCount&&(_n268.restoreOriginalState(),this._takeBackBinding(_n268));}this._takeBackAction(t);}}},{key:"_initMemoryManager",value:function _initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length;},get inUse(){return t._nActiveActions;}},bindings:{get total(){return t._bindings.length;},get inUse(){return t._nActiveBindings;}},controlInterpolants:{get total(){return t._controlInterpolants.length;},get inUse(){return t._nActiveControlInterpolants;}}};}},{key:"_isActiveAction",value:function _isActiveAction(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions;}},{key:"_addInactiveAction",value:function _addInactiveAction(t,e,n){var i=this._actions,r=this._actionsByClip;var s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{var _e297=s.knownActions;t._byClipCacheIndex=_e297.length,_e297.push(t);}t._cacheIndex=i.length,i.push(t),s.actionByRoot[n]=t;}},{key:"_removeInactiveAction",value:function _removeInactiveAction(t){var e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;var r=t._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),t._byClipCacheIndex=null;delete a.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(t);}},{key:"_removeInactiveBindingsForAction",value:function _removeInactiveBindingsForAction(t){var e=t._propertyBindings;for(var _t302=0,_n269=e.length;_t302!==_n269;++_t302){var _n270=e[_t302];0==--_n270.referenceCount&&this._removeInactiveBinding(_n270);}}},{key:"_lendAction",value:function _lendAction(t){var e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r;}},{key:"_takeBackAction",value:function _takeBackAction(t){var e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r;}},{key:"_addInactiveBinding",value:function _addInactiveBinding(t,e,n){var i=this._bindingsByRootAndName,r=this._bindings;var s=i[e];void 0===s&&(s={},i[e]=s),s[n]=t,t._cacheIndex=r.length,r.push(t);}},{key:"_removeInactiveBinding",value:function _removeInactiveBinding(t){var e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,a=s[i],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete a[r],0===Object.keys(a).length&&delete s[i];}},{key:"_lendBinding",value:function _lendBinding(t){var e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r;}},{key:"_takeBackBinding",value:function _takeBackBinding(t){var e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r;}},{key:"_lendControlInterpolant",value:function _lendControlInterpolant(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++;var n=t[e];return void 0===n&&(n=new Mh(new Float32Array(2),new Float32Array(2),1,Bu),n.__cacheIndex=e,t[e]=n),n;}},{key:"_takeBackControlInterpolant",value:function _takeBackControlInterpolant(t){var e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r;}},{key:"clipAction",value:function clipAction(t,e,n){var i=e||this._root,r=i.uuid;var s="string"==typeof t?Ph.findByName(i,t):t;var a=null!==s?s.uuid:t,o=this._actionsByClip[a];var l=null;if(void 0===n&&(n=null!==s?s.blendMode:Nt),void 0!==o){var _t303=o.actionByRoot[r];if(void 0!==_t303&&_t303.blendMode===n)return _t303;l=o.knownActions[0],null===s&&(s=l._clip);}if(null===s)return null;var c=new Fu(this,s,e,n);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c;}},{key:"existingAction",value:function existingAction(t,e){var n=e||this._root,i=n.uuid,r="string"==typeof t?Ph.findByName(n,t):t,s=r?r.uuid:t,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[i]||null;}},{key:"stopAllAction",value:function stopAllAction(){var t=this._actions;for(var _e298=this._nActiveActions-1;_e298>=0;--_e298)t[_e298].stop();return this;}},{key:"update",value:function update(t){t*=this.timeScale;var e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(var _a75=0;_a75!==n;++_a75){e[_a75]._update(i,t,r,s);}var a=this._bindings,o=this._nActiveBindings;for(var _t304=0;_t304!==o;++_t304)a[_t304].apply(s);return this;}},{key:"setTime",value:function setTime(t){this.time=0;for(var _t305=0;_t305<this._actions.length;_t305++)this._actions[_t305].time=0;return this.update(t);}},{key:"getRoot",value:function getRoot(){return this._root;}},{key:"uncacheClip",value:function uncacheClip(t){var e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){var _t306=r.knownActions;for(var _n271=0,_i209=_t306.length;_n271!==_i209;++_n271){var _i210=_t306[_n271];this._deactivateAction(_i210);var _r159=_i210._cacheIndex,_s96=e[e.length-1];_i210._cacheIndex=null,_i210._byClipCacheIndex=null,_s96._cacheIndex=_r159,e[_r159]=_s96,e.pop(),this._removeInactiveBindingsForAction(_i210);}delete i[n];}}},{key:"uncacheRoot",value:function uncacheRoot(t){var e=t.uuid,n=this._actionsByClip;for(var _t307 in n){var _i211=n[_t307].actionByRoot[e];void 0!==_i211&&(this._deactivateAction(_i211),this._removeInactiveAction(_i211));}var i=this._bindingsByRootAndName[e];if(void 0!==i)for(var _t308 in i){var _e299=i[_t308];_e299.restoreOriginalState(),this._removeInactiveBinding(_e299);}}},{key:"uncacheAction",value:function uncacheAction(t,e){var n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n));}}]);return _class3;}(te),t.AnimationObjectGroup=/*#__PURE__*/function(){function _class4(){_classCallCheck(this,_class4);this.isAnimationObjectGroup=!0,this.uuid=se(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var _e300=0,_n272=arguments.length;_e300!==_n272;++_e300)t[arguments[_e300].uuid]=_e300;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var e=this;this.stats={objects:{get total(){return e._objects.length;},get inUse(){return this.total-e.nCachedObjects_;}},get bindingsPerObject(){return e._bindings.length;}};}_createClass(_class4,[{key:"add",value:function add(){var t=this._objects,e=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length;var a,o=t.length,l=this.nCachedObjects_;for(var _c22=0,_h15=arguments.length;_c22!==_h15;++_c22){var _h16=arguments[_c22],_u14=_h16.uuid;var _d17=e[_u14];if(void 0===_d17){_d17=o++,e[_u14]=_d17,t.push(_h16);for(var _t309=0,_e301=s;_t309!==_e301;++_t309)r[_t309].push(new Ou(_h16,n[_t309],i[_t309]));}else if(_d17<l){a=t[_d17];var _o54=--l,_c23=t[_o54];e[_c23.uuid]=_d17,t[_d17]=_c23,e[_u14]=_o54,t[_o54]=_h16;for(var _t310=0,_e302=s;_t310!==_e302;++_t310){var _e303=r[_t310],_s97=_e303[_o54];var _a76=_e303[_d17];_e303[_d17]=_s97,void 0===_a76&&(_a76=new Ou(_h16,n[_t310],i[_t310])),_e303[_o54]=_a76;}}else t[_d17]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.");}this.nCachedObjects_=l;}},{key:"remove",value:function remove(){var t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;var r=this.nCachedObjects_;for(var _s98=0,_a77=arguments.length;_s98!==_a77;++_s98){var _a78=arguments[_s98],_o55=_a78.uuid,_l32=e[_o55];if(void 0!==_l32&&_l32>=r){var _s99=r++,_c24=t[_s99];e[_c24.uuid]=_l32,t[_l32]=_c24,e[_o55]=_s99,t[_s99]=_a78;for(var _t311=0,_e304=i;_t311!==_e304;++_t311){var _e305=n[_t311],_i212=_e305[_s99],_r160=_e305[_l32];_e305[_l32]=_i212,_e305[_s99]=_r160;}}}this.nCachedObjects_=r;}},{key:"uncache",value:function uncache(){var t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;var r=this.nCachedObjects_,s=t.length;for(var _a79=0,_o56=arguments.length;_a79!==_o56;++_a79){var _o57=arguments[_a79].uuid,_l33=e[_o57];if(void 0!==_l33)if(delete e[_o57],_l33<r){var _a80=--r,_o58=t[_a80],_c25=--s,_h17=t[_c25];e[_o58.uuid]=_l33,t[_l33]=_o58,e[_h17.uuid]=_a80,t[_a80]=_h17,t.pop();for(var _t312=0,_e306=i;_t312!==_e306;++_t312){var _e307=n[_t312],_i213=_e307[_a80],_r161=_e307[_c25];_e307[_l33]=_i213,_e307[_a80]=_r161,_e307.pop();}}else{var _r162=--s,_a81=t[_r162];_r162>0&&(e[_a81.uuid]=_l33),t[_l33]=_a81,t.pop();for(var _t313=0,_e308=i;_t313!==_e308;++_t313){var _e309=n[_t313];_e309[_l33]=_e309[_r162],_e309.pop();}}}this.nCachedObjects_=r;}},{key:"subscribe_",value:function subscribe_(t,e){var n=this._bindingsIndicesByPath;var i=n[t];var r=this._bindings;if(void 0!==i)return r[i];var s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,h=new Array(l);i=r.length,n[t]=i,s.push(t),a.push(e),r.push(h);for(var _n273=c,_i214=o.length;_n273!==_i214;++_n273){var _i215=o[_n273];h[_n273]=new Ou(_i215,t,e);}return h;}},{key:"unsubscribe_",value:function unsubscribe_(t){var e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){var _i216=this._paths,_r163=this._parsedPaths,_s100=this._bindings,_a82=_s100.length-1,_o59=_s100[_a82];e[t[_a82]]=n,_s100[n]=_o59,_s100.pop(),_r163[n]=_r163[_a82],_r163.pop(),_i216[n]=_i216[_a82],_i216.pop();}}}]);return _class4;}(),t.AnimationUtils=vh,t.ArcCurve=Ol,t.ArrayCamera=qa,t.ArrowHelper=/*#__PURE__*/function(_jn13){_inherits(_class5,_jn13);var _super119=_createSuper(_class5);function _class5(){var _this103;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new We(0,0,1);var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new We(0,0,0);var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:16776960;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:.2*n;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:.2*r;_classCallCheck(this,_class5);_this103=_super119.call(this),_this103.type="ArrowHelper",void 0===ld&&(ld=new Ii(),ld.setAttribute("position",new Ti([0,0,0,0,1,0],3)),cd=new sc(0,.5,1,5,1),cd.translate(0,-.5,0)),_this103.position.copy(e),_this103.line=new Ml(ld,new fl({color:i,toneMapped:!1})),_this103.line.matrixAutoUpdate=!1,_this103.add(_this103.line),_this103.cone=new Ji(cd,new pi({color:i,toneMapped:!1})),_this103.cone.matrixAutoUpdate=!1,_this103.add(_this103.cone),_this103.setDirection(t),_this103.setLength(n,r,s);return _this103;}_createClass(_class5,[{key:"setDirection",value:function setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{od.set(t.z,0,-t.x).normalize();var _e310=Math.acos(t.y);this.quaternion.setFromAxisAngle(od,_e310);}}},{key:"setLength",value:function setLength(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:.2*t;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:.2*e;this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix();}},{key:"setColor",value:function setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t);}},{key:"copy",value:function copy(t){return _get(_getPrototypeOf(_class5.prototype),"copy",this).call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this;}},{key:"dispose",value:function dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose();}}]);return _class5;}(jn),t.AttachedBindMode=y,t.Audio=Tu,t.AudioAnalyser=/*#__PURE__*/function(){function _class6(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2048;_classCallCheck(this,_class6);this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser);}_createClass(_class6,[{key:"getFrequencyData",value:function getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data;}},{key:"getAverageFrequency",value:function getAverageFrequency(){var t=0;var e=this.getFrequencyData();for(var _n274=0;_n274<e.length;_n274++)t+=e[_n274];return t/e.length;}}]);return _class6;}(),t.AudioContext=mu,t.AudioListener=/*#__PURE__*/function(_jn14){_inherits(_class7,_jn14);var _super120=_createSuper(_class7);function _class7(){var _this104;_classCallCheck(this,_class7);_this104=_super120.call(this),_this104.type="AudioListener",_this104.context=mu.getContext(),_this104.gain=_this104.context.createGain(),_this104.gain.connect(_this104.context.destination),_this104.filter=null,_this104.timeDelta=0,_this104._clock=new vu();return _this104;}_createClass(_class7,[{key:"getInput",value:function getInput(){return this.gain;}},{key:"removeFilter",value:function removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this;}},{key:"getFilter",value:function getFilter(){return this.filter;}},{key:"setFilter",value:function setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this;}},{key:"getMasterVolume",value:function getMasterVolume(){return this.gain.gain.value;}},{key:"setMasterVolume",value:function setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this;}},{key:"updateMatrixWorld",value:function updateMatrixWorld(t){_get(_getPrototypeOf(_class7.prototype),"updateMatrixWorld",this).call(this,t);var e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(yu,Mu,Su),bu.set(0,0,-1).applyQuaternion(Mu),e.positionX){var _t314=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(yu.x,_t314),e.positionY.linearRampToValueAtTime(yu.y,_t314),e.positionZ.linearRampToValueAtTime(yu.z,_t314),e.forwardX.linearRampToValueAtTime(bu.x,_t314),e.forwardY.linearRampToValueAtTime(bu.y,_t314),e.forwardZ.linearRampToValueAtTime(bu.z,_t314),e.upX.linearRampToValueAtTime(n.x,_t314),e.upY.linearRampToValueAtTime(n.y,_t314),e.upZ.linearRampToValueAtTime(n.z,_t314);}else e.setPosition(yu.x,yu.y,yu.z),e.setOrientation(bu.x,bu.y,bu.z,n.x,n.y,n.z);}}]);return _class7;}(jn),t.AudioLoader=/*#__PURE__*/function(_Oh6){_inherits(_class8,_Oh6);var _super121=_createSuper(_class8);function _class8(t){_classCallCheck(this,_class8);return _super121.call(this,t);}_createClass(_class8,[{key:"load",value:function load(t,e,n,i){var r=this,s=new zh(this.manager);function a(e){i?i(e):console.error(e),r.manager.itemError(t);}s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,function(t){try{var _n275=t.slice(0);mu.getContext().decodeAudioData(_n275,function(t){e(t);})["catch"](a);}catch(t){a(t);}},n,i);}}]);return _class8;}(Oh),t.AxesHelper=/*#__PURE__*/function(_Tl){_inherits(_class9,_Tl);var _super122=_createSuper(_class9);function _class9(){var _this105;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;_classCallCheck(this,_class9);var e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Ii();n.setAttribute("position",new Ti(e,3)),n.setAttribute("color",new Ti([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));_this105=_super122.call(this,n,new fl({vertexColors:!0,toneMapped:!1})),_this105.type="AxesHelper";return _this105;}_createClass(_class9,[{key:"setColors",value:function setColors(t,e,n){var i=new ci(),r=this.geometry.attributes.color.array;return i.set(t),i.toArray(r,0),i.toArray(r,3),i.set(e),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this;}},{key:"dispose",value:function dispose(){this.geometry.dispose(),this.material.dispose();}}]);return _class9;}(Tl),t.BackSide=a,t.BasicDepthPacking=3200,t.BasicShadowMap=0,t.BatchedMesh=ml,t.Bone=Bo,t.BooleanKeyframeTrack=Th,t.Box2=/*#__PURE__*/function(){function _class10(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new me(1/0,1/0);var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new me(-1/0,-1/0);_classCallCheck(this,_class10);this.isBox2=!0,this.min=t,this.max=e;}_createClass(_class10,[{key:"set",value:function set(t,e){return this.min.copy(t),this.max.copy(e),this;}},{key:"setFromPoints",value:function setFromPoints(t){this.makeEmpty();for(var _e311=0,_n276=t.length;_e311<_n276;_e311++)this.expandByPoint(t[_e311]);return this;}},{key:"setFromCenterAndSize",value:function setFromCenterAndSize(t,e){var n=ku.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this;}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}},{key:"copy",value:function copy(t){return this.min.copy(t.min),this.max.copy(t.max),this;}},{key:"makeEmpty",value:function makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this;}},{key:"isEmpty",value:function isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y;}},{key:"getCenter",value:function getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5);}},{key:"getSize",value:function getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min);}},{key:"expandByPoint",value:function expandByPoint(t){return this.min.min(t),this.max.max(t),this;}},{key:"expandByVector",value:function expandByVector(t){return this.min.sub(t),this.max.add(t),this;}},{key:"expandByScalar",value:function expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this;}},{key:"containsPoint",value:function containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y);}},{key:"containsBox",value:function containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y;}},{key:"getParameter",value:function getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y));}},{key:"intersectsBox",value:function intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y);}},{key:"clampPoint",value:function clampPoint(t,e){return e.copy(t).clamp(this.min,this.max);}},{key:"distanceToPoint",value:function distanceToPoint(t){return this.clampPoint(t,ku).distanceTo(t);}},{key:"intersect",value:function intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this;}},{key:"union",value:function union(t){return this.min.min(t.min),this.max.max(t.max),this;}},{key:"translate",value:function translate(t){return this.min.add(t),this.max.add(t),this;}},{key:"equals",value:function equals(t){return t.min.equals(this.min)&&t.max.equals(this.max);}}]);return _class10;}(),t.Box3=qe,t.Box3Helper=/*#__PURE__*/function(_Tl2){_inherits(_class11,_Tl2);var _super123=_createSuper(_class11);function _class11(t){var _this106;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:16776960;_classCallCheck(this,_class11);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Ii();i.setIndex(new Mi(n,1)),i.setAttribute("position",new Ti([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),_this106=_super123.call(this,i,new fl({color:e,toneMapped:!1})),_this106.box=t,_this106.type="Box3Helper",_this106.geometry.computeBoundingSphere();return _this106;}_createClass(_class11,[{key:"updateMatrixWorld",value:function updateMatrixWorld(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),_get(_getPrototypeOf(_class11.prototype),"updateMatrixWorld",this).call(this,t));}},{key:"dispose",value:function dispose(){this.geometry.dispose(),this.material.dispose();}}]);return _class11;}(Tl),t.BoxGeometry=$i,t.BoxHelper=/*#__PURE__*/function(_Tl3){_inherits(_class12,_Tl3);var _super124=_createSuper(_class12);function _class12(t){var _this107;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:16776960;_classCallCheck(this,_class12);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new Ii();r.setIndex(new Mi(n,1)),r.setAttribute("position",new Mi(i,3)),_this107=_super124.call(this,r,new fl({color:e,toneMapped:!1})),_this107.object=t,_this107.type="BoxHelper",_this107.matrixAutoUpdate=!1,_this107.update();return _this107;}_createClass(_class12,[{key:"update",value:function update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&ad.setFromObject(this.object),ad.isEmpty())return;var e=ad.min,n=ad.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=e.x,r[4]=n.y,r[5]=n.z,r[6]=e.x,r[7]=e.y,r[8]=n.z,r[9]=n.x,r[10]=e.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=e.z,r[15]=e.x,r[16]=n.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=n.x,r[22]=e.y,r[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere();}},{key:"setFromObject",value:function setFromObject(t){return this.object=t,this.update(),this;}},{key:"copy",value:function copy(t,e){return _get(_getPrototypeOf(_class12.prototype),"copy",this).call(this,t,e),this.object=t.object,this;}},{key:"dispose",value:function dispose(){this.geometry.dispose(),this.material.dispose();}}]);return _class12;}(Tl),t.BufferAttribute=Mi,t.BufferGeometry=Ii,t.BufferGeometryLoader=cu,t.ByteType=1010,t.Cache=Uh,t.Camera=rr,t.CameraHelper=/*#__PURE__*/function(_Tl4){_inherits(_class13,_Tl4);var _super125=_createSuper(_class13);function _class13(t){var _this108;_classCallCheck(this,_class13);var e=new Ii(),n=new fl({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={};function a(t,e){o(t),o(e);}function o(t){i.push(0,0,0),r.push(0,0,0),void 0===s[t]&&(s[t]=[]),s[t].push(i.length/3-1);}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),e.setAttribute("position",new Ti(i,3)),e.setAttribute("color",new Ti(r,3)),_this108=_super125.call(this,e,n),_this108.type="CameraHelper",_this108.camera=t,_this108.camera.updateProjectionMatrix&&_this108.camera.updateProjectionMatrix(),_this108.matrix=t.matrixWorld,_this108.matrixAutoUpdate=!1,_this108.pointMap=s,_this108.update();var l=new ci(16755200),c=new ci(16711680),h=new ci(43775),u=new ci(16777215),d=new ci(3355443);_this108.setColors(l,c,h,u,d);return _this108;}_createClass(_class13,[{key:"setColors",value:function setColors(t,e,n,i,r){var s=this.geometry.getAttribute("color");s.setXYZ(0,t.r,t.g,t.b),s.setXYZ(1,t.r,t.g,t.b),s.setXYZ(2,t.r,t.g,t.b),s.setXYZ(3,t.r,t.g,t.b),s.setXYZ(4,t.r,t.g,t.b),s.setXYZ(5,t.r,t.g,t.b),s.setXYZ(6,t.r,t.g,t.b),s.setXYZ(7,t.r,t.g,t.b),s.setXYZ(8,t.r,t.g,t.b),s.setXYZ(9,t.r,t.g,t.b),s.setXYZ(10,t.r,t.g,t.b),s.setXYZ(11,t.r,t.g,t.b),s.setXYZ(12,t.r,t.g,t.b),s.setXYZ(13,t.r,t.g,t.b),s.setXYZ(14,t.r,t.g,t.b),s.setXYZ(15,t.r,t.g,t.b),s.setXYZ(16,t.r,t.g,t.b),s.setXYZ(17,t.r,t.g,t.b),s.setXYZ(18,t.r,t.g,t.b),s.setXYZ(19,t.r,t.g,t.b),s.setXYZ(20,t.r,t.g,t.b),s.setXYZ(21,t.r,t.g,t.b),s.setXYZ(22,t.r,t.g,t.b),s.setXYZ(23,t.r,t.g,t.b),s.setXYZ(24,e.r,e.g,e.b),s.setXYZ(25,e.r,e.g,e.b),s.setXYZ(26,e.r,e.g,e.b),s.setXYZ(27,e.r,e.g,e.b),s.setXYZ(28,e.r,e.g,e.b),s.setXYZ(29,e.r,e.g,e.b),s.setXYZ(30,e.r,e.g,e.b),s.setXYZ(31,e.r,e.g,e.b),s.setXYZ(32,n.r,n.g,n.b),s.setXYZ(33,n.r,n.g,n.b),s.setXYZ(34,n.r,n.g,n.b),s.setXYZ(35,n.r,n.g,n.b),s.setXYZ(36,n.r,n.g,n.b),s.setXYZ(37,n.r,n.g,n.b),s.setXYZ(38,i.r,i.g,i.b),s.setXYZ(39,i.r,i.g,i.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0;}},{key:"update",value:function update(){var t=this.geometry,e=this.pointMap;rd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),sd("c",e,t,rd,0,0,-1),sd("t",e,t,rd,0,0,1),sd("n1",e,t,rd,-1,-1,-1),sd("n2",e,t,rd,1,-1,-1),sd("n3",e,t,rd,-1,1,-1),sd("n4",e,t,rd,1,1,-1),sd("f1",e,t,rd,-1,-1,1),sd("f2",e,t,rd,1,-1,1),sd("f3",e,t,rd,-1,1,1),sd("f4",e,t,rd,1,1,1),sd("u1",e,t,rd,.7,1.1,-1),sd("u2",e,t,rd,-.7,1.1,-1),sd("u3",e,t,rd,0,2,-1),sd("cf1",e,t,rd,-1,0,1),sd("cf2",e,t,rd,1,0,1),sd("cf3",e,t,rd,0,-1,1),sd("cf4",e,t,rd,0,1,1),sd("cn1",e,t,rd,-1,0,-1),sd("cn2",e,t,rd,1,0,-1),sd("cn3",e,t,rd,0,-1,-1),sd("cn4",e,t,rd,0,1,-1),t.getAttribute("position").needsUpdate=!0;}},{key:"dispose",value:function dispose(){this.geometry.dispose(),this.material.dispose();}}]);return _class13;}(Tl),t.CanvasTexture=/*#__PURE__*/function(_Fe7){_inherits(_class14,_Fe7);var _super126=_createSuper(_class14);function _class14(t,e,n,i,r,s,a,o,l){var _this109;_classCallCheck(this,_class14);_this109=_super126.call(this,t,e,n,i,r,s,a,o,l),_this109.isCanvasTexture=!0,_this109.needsUpdate=!0;return _this109;}return _createClass(_class14);}(Fe),t.CapsuleGeometry=ic,t.CatmullRomCurve3=Vl,t.CineonToneMapping=g,t.CircleGeometry=rc,t.ClampToEdgeWrapping=C,t.Clock=vu,t.Color=ci,t.ColorKeyframeTrack=Eh,t.ColorManagement=Re,t.CompressedArrayTexture=/*#__PURE__*/function(_Ul){_inherits(_class15,_Ul);var _super127=_createSuper(_class15);function _class15(t,e,n,i,r,s){var _this110;_classCallCheck(this,_class15);_this110=_super127.call(this,t,e,n,r,s),_this110.isCompressedArrayTexture=!0,_this110.image.depth=i,_this110.wrapR=C;return _this110;}return _createClass(_class15);}(Ul),t.CompressedCubeTexture=/*#__PURE__*/function(_Ul2){_inherits(_class16,_Ul2);var _super128=_createSuper(_class16);function _class16(t,e,n){var _this111;_classCallCheck(this,_class16);_this111=_super128.call(this,void 0,t[0].width,t[0].height,e,n,b),_this111.isCompressedCubeTexture=!0,_this111.isCubeTexture=!0,_this111.image=t;return _this111;}return _createClass(_class16);}(Ul),t.CompressedTexture=Ul,t.CompressedTextureLoader=/*#__PURE__*/function(_Oh7){_inherits(_class17,_Oh7);var _super129=_createSuper(_class17);function _class17(t){_classCallCheck(this,_class17);return _super129.call(this,t);}_createClass(_class17,[{key:"load",value:function load(t,e,n,i){var r=this,s=[],a=new Ul(),o=new zh(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);var l=0;function c(c){o.load(t[c],function(t){var n=r.parse(t,!0);s[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(a.minFilter=D),a.image=s,a.format=n.format,a.needsUpdate=!0,e&&e(a));},n,i);}if(Array.isArray(t))for(var _e312=0,_n277=t.length;_e312<_n277;++_e312)c(_e312);else o.load(t,function(t){var n=r.parse(t,!0);if(n.isCubemap){var _t315=n.mipmaps.length/n.mipmapCount;for(var _e313=0;_e313<_t315;_e313++){s[_e313]={mipmaps:[]};for(var _t316=0;_t316<n.mipmapCount;_t316++)s[_e313].mipmaps.push(n.mipmaps[_e313*n.mipmapCount+_t316]),s[_e313].format=n.format,s[_e313].width=n.width,s[_e313].height=n.height;}a.image=s;}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=D),a.format=n.format,a.needsUpdate=!0,e&&e(a);},n,i);return a;}}]);return _class17;}(Oh),t.ConeGeometry=ac,t.ConstantAlphaFactor=213,t.ConstantColorFactor=211,t.CubeCamera=or,t.CubeReflectionMapping=b,t.CubeRefractionMapping=T,t.CubeTexture=lr,t.CubeTextureLoader=/*#__PURE__*/function(_Oh8){_inherits(_class18,_Oh8);var _super130=_createSuper(_class18);function _class18(t){_classCallCheck(this,_class18);return _super130.call(this,t);}_createClass(_class18,[{key:"load",value:function load(t,e,n,i){var r=new lr();r.colorSpace=Gt;var s=new Gh(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);var a=0;function o(n){s.load(t[n],function(t){r.images[n]=t,a++,6===a&&(r.needsUpdate=!0,e&&e(r));},void 0,i);}for(var _e314=0;_e314<t.length;++_e314)o(_e314);return r;}}]);return _class18;}(Oh),t.CubeUVReflectionMapping=A,t.CubicBezierCurve=jl,t.CubicBezierCurve3=ql,t.CubicInterpolant=yh,t.CullFaceBack=1,t.CullFaceFront=2,t.CullFaceFrontBack=3,t.CullFaceNone=0,t.Curve=Dl,t.CurvePath=tc,t.CustomBlending=5,t.CustomToneMapping=v,t.CylinderGeometry=sc,t.Cylindrical=/*#__PURE__*/function(){function _class19(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,_class19);return this.radius=t,this.theta=e,this.y=n,this;}_createClass(_class19,[{key:"set",value:function set(t,e,n){return this.radius=t,this.theta=e,this.y=n,this;}},{key:"copy",value:function copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this;}},{key:"setFromVector3",value:function setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z);}},{key:"setFromCartesianCoords",value:function setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this;}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}}]);return _class19;}(),t.Data3DTexture=Ve,t.DataArrayTexture=He,t.DataTexture=zo,t.DataTextureLoader=/*#__PURE__*/function(_Oh9){_inherits(_class20,_Oh9);var _super131=_createSuper(_class20);function _class20(t){_classCallCheck(this,_class20);return _super131.call(this,t);}_createClass(_class20,[{key:"load",value:function load(t,e,n,i){var r=this,s=new zo(),a=new zh(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(t,function(t){var n;try{n=r.parse(t);}catch(t){if(void 0===i)return void console.error(t);i(t);}void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:C,s.wrapT=void 0!==n.wrapT?n.wrapT:C,s.magFilter=void 0!==n.magFilter?n.magFilter:D,s.minFilter=void 0!==n.minFilter?n.minFilter:D,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace?s.colorSpace=n.colorSpace:void 0!==n.encoding&&(s.encoding=n.encoding),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=O),1===n.mipmapCount&&(s.minFilter=D),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,e&&e(s,n);},n,i),s;}}]);return _class20;}(Oh),t.DataUtils=vi,t.DecrementStencilOp=7683,t.DecrementWrapStencilOp=34056,t.DefaultLoadingManager=Nh,t.DepthFormat=q,t.DepthStencilFormat=Y,t.DepthTexture=ns,t.DetachedBindMode=M,t.DirectionalLight=eu,t.DirectionalLightHelper=/*#__PURE__*/function(_jn15){_inherits(_class21,_jn15);var _super132=_createSuper(_class21);function _class21(t,e,n){var _this112;_classCallCheck(this,_class21);_this112=_super132.call(this),_this112.light=t,_this112.matrix=t.matrixWorld,_this112.matrixAutoUpdate=!1,_this112.color=n,_this112.type="DirectionalLightHelper",void 0===e&&(e=1);var i=new Ii();i.setAttribute("position",new Ti([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var r=new fl({fog:!1,toneMapped:!1});_this112.lightPlane=new Ml(i,r),_this112.add(_this112.lightPlane),i=new Ii(),i.setAttribute("position",new Ti([0,0,0,0,0,1],3)),_this112.targetLine=new Ml(i,r),_this112.add(_this112.targetLine),_this112.update();return _this112;}_createClass(_class21,[{key:"dispose",value:function dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose();}},{key:"update",value:function update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),td.setFromMatrixPosition(this.light.matrixWorld),ed.setFromMatrixPosition(this.light.target.matrixWorld),nd.subVectors(ed,td),this.lightPlane.lookAt(ed),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(ed),this.targetLine.scale.z=nd.length();}}]);return _class21;}(jn),t.DiscreteInterpolant=Sh,t.DisplayP3ColorSpace=Vt,t.DodecahedronGeometry=lc,t.DoubleSide=2,t.DstAlphaFactor=206,t.DstColorFactor=208,t.DynamicCopyUsage=35050,t.DynamicDrawUsage=35048,t.DynamicReadUsage=35049,t.EdgesGeometry=pc,t.EllipseCurve=Nl,t.EqualCompare=514,t.EqualDepth=4,t.EqualStencilFunc=514,t.EquirectangularReflectionMapping=E,t.EquirectangularRefractionMapping=w,t.Euler=Pn,t.EventDispatcher=te,t.ExtrudeGeometry=kc,t.FileLoader=zh,t.Float16BufferAttribute=/*#__PURE__*/function(_Mi5){_inherits(_class22,_Mi5);var _super133=_createSuper(_class22);function _class22(t,e,n){var _this113;_classCallCheck(this,_class22);_this113=_super133.call(this,new Uint16Array(t),e,n),_this113.isFloat16BufferAttribute=!0;return _this113;}_createClass(_class22,[{key:"getX",value:function getX(t){var e=_i(this.array[t*this.itemSize]);return this.normalized&&(e=ue(e,this.array)),e;}},{key:"setX",value:function setX(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize]=gi(e),this;}},{key:"getY",value:function getY(t){var e=_i(this.array[t*this.itemSize+1]);return this.normalized&&(e=ue(e,this.array)),e;}},{key:"setY",value:function setY(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize+1]=gi(e),this;}},{key:"getZ",value:function getZ(t){var e=_i(this.array[t*this.itemSize+2]);return this.normalized&&(e=ue(e,this.array)),e;}},{key:"setZ",value:function setZ(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize+2]=gi(e),this;}},{key:"getW",value:function getW(t){var e=_i(this.array[t*this.itemSize+3]);return this.normalized&&(e=ue(e,this.array)),e;}},{key:"setW",value:function setW(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize+3]=gi(e),this;}},{key:"setXY",value:function setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=de(e,this.array),n=de(n,this.array)),this.array[t+0]=gi(e),this.array[t+1]=gi(n),this;}},{key:"setXYZ",value:function setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=de(e,this.array),n=de(n,this.array),i=de(i,this.array)),this.array[t+0]=gi(e),this.array[t+1]=gi(n),this.array[t+2]=gi(i),this;}},{key:"setXYZW",value:function setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=de(e,this.array),n=de(n,this.array),i=de(i,this.array),r=de(r,this.array)),this.array[t+0]=gi(e),this.array[t+1]=gi(n),this.array[t+2]=gi(i),this.array[t+3]=gi(r),this;}}]);return _class22;}(Mi),t.Float32BufferAttribute=Ti,t.Float64BufferAttribute=/*#__PURE__*/function(_Mi6){_inherits(_class23,_Mi6);var _super134=_createSuper(_class23);function _class23(t,e,n){_classCallCheck(this,_class23);return _super134.call(this,new Float64Array(t),e,n);}return _createClass(_class23);}(Mi),t.FloatType=H,t.Fog=io,t.FogExp2=no,t.FramebufferTexture=/*#__PURE__*/function(_Fe8){_inherits(_class24,_Fe8);var _super135=_createSuper(_class24);function _class24(t,e){var _this114;_classCallCheck(this,_class24);_this114=_super135.call(this,{width:t,height:e}),_this114.isFramebufferTexture=!0,_this114.magFilter=P,_this114.minFilter=P,_this114.generateMipmaps=!1,_this114.needsUpdate=!0;return _this114;}return _createClass(_class24);}(Fe),t.FrontSide=s,t.Frustum=gr,t.GLBufferAttribute=/*#__PURE__*/function(){function _class25(t,e,n,i,r){_classCallCheck(this,_class25);this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0;}_createClass(_class25,[{key:"needsUpdate",set:function set(t){!0===t&&this.version++;}},{key:"setBuffer",value:function setBuffer(t){return this.buffer=t,this;}},{key:"setType",value:function setType(t,e){return this.type=t,this.elementSize=e,this;}},{key:"setItemSize",value:function setItemSize(t){return this.itemSize=t,this;}},{key:"setCount",value:function setCount(t){return this.count=t,this;}}]);return _class25;}(),t.GLSL1="100",t.GLSL3=Jt,t.GreaterCompare=516,t.GreaterDepth=6,t.GreaterEqualCompare=518,t.GreaterEqualDepth=5,t.GreaterEqualStencilFunc=518,t.GreaterStencilFunc=516,t.GridHelper=/*#__PURE__*/function(_Tl5){_inherits(_class26,_Tl5);var _super136=_createSuper(_class26);function _class26(){var _this115;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:10;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:4473924;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:8947848;_classCallCheck(this,_class26);n=new ci(n),i=new ci(i);var r=e/2,s=t/e,a=t/2,o=[],l=[];for(var _t317=0,_c26=0,_h18=-a;_t317<=e;_t317++,_h18+=s){o.push(-a,0,_h18,a,0,_h18),o.push(_h18,0,-a,_h18,0,a);var _e315=_t317===r?n:i;_e315.toArray(l,_c26),_c26+=3,_e315.toArray(l,_c26),_c26+=3,_e315.toArray(l,_c26),_c26+=3,_e315.toArray(l,_c26),_c26+=3;}var c=new Ii();c.setAttribute("position",new Ti(o,3)),c.setAttribute("color",new Ti(l,3));_this115=_super136.call(this,c,new fl({vertexColors:!0,toneMapped:!1})),_this115.type="GridHelper";return _this115;}_createClass(_class26,[{key:"dispose",value:function dispose(){this.geometry.dispose(),this.material.dispose();}}]);return _class26;}(Tl),t.Group=Ya,t.HalfFloatType=V,t.HemisphereLight=Vh,t.HemisphereLightHelper=/*#__PURE__*/function(_jn16){_inherits(_class27,_jn16);var _super137=_createSuper(_class27);function _class27(t,e,n){var _this116;_classCallCheck(this,_class27);_this116=_super137.call(this),_this116.light=t,_this116.matrix=t.matrixWorld,_this116.matrixAutoUpdate=!1,_this116.color=n,_this116.type="HemisphereLightHelper";var i=new jc(e);i.rotateY(.5*Math.PI),_this116.material=new pi({wireframe:!0,fog:!1,toneMapped:!1}),void 0===_this116.color&&(_this116.material.vertexColors=!0);var r=i.getAttribute("position"),s=new Float32Array(3*r.count);i.setAttribute("color",new Mi(s,3)),_this116.add(new Ji(i,_this116.material)),_this116.update();return _this116;}_createClass(_class27,[{key:"dispose",value:function dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose();}},{key:"update",value:function update(){var t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var _e316=t.geometry.getAttribute("color");$u.copy(this.light.color),Qu.copy(this.light.groundColor);for(var _t318=0,_n278=_e316.count;_t318<_n278;_t318++){var _i217=_t318<_n278/2?$u:Qu;_e316.setXYZ(_t318,_i217.r,_i217.g,_i217.b);}_e316.needsUpdate=!0;}this.light.updateWorldMatrix(!0,!1),t.lookAt(Ku.setFromMatrixPosition(this.light.matrixWorld).negate());}}]);return _class27;}(jn),t.IcosahedronGeometry=Xc,t.ImageBitmapLoader=/*#__PURE__*/function(_Oh10){_inherits(_class28,_Oh10);var _super138=_createSuper(_class28);function _class28(t){var _this117;_classCallCheck(this,_class28);_this117=_super138.call(this,t),_this117.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),_this117.options={premultiplyAlpha:"none"};return _this117;}_createClass(_class28,[{key:"setOptions",value:function setOptions(t){return this.options=t,this;}},{key:"load",value:function load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var r=this,s=Uh.get(t);if(void 0!==s)return r.manager.itemStart(t),s.then?void s.then(function(n){e&&e(n),r.manager.itemEnd(t);})["catch"](function(t){i&&i(t);}):(setTimeout(function(){e&&e(s),r.manager.itemEnd(t);},0),s);var a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader;var o=fetch(t,a).then(function(t){return t.blob();}).then(function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}));}).then(function(n){return Uh.add(t,n),e&&e(n),r.manager.itemEnd(t),n;})["catch"](function(e){i&&i(e),Uh.remove(t),r.manager.itemError(t),r.manager.itemEnd(t);});Uh.add(t,o),r.manager.itemStart(t);}}]);return _class28;}(Oh),t.ImageLoader=Gh,t.ImageUtils=Ie,t.IncrementStencilOp=7682,t.IncrementWrapStencilOp=34055,t.InstancedBufferAttribute=ko,t.InstancedBufferGeometry=lu,t.InstancedInterleavedBuffer=/*#__PURE__*/function(_so){_inherits(_class29,_so);var _super139=_createSuper(_class29);function _class29(t,e){var _this118;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;_classCallCheck(this,_class29);_this118=_super139.call(this,t,e),_this118.isInstancedInterleavedBuffer=!0,_this118.meshPerAttribute=n;return _this118;}_createClass(_class29,[{key:"copy",value:function copy(t){return _get(_getPrototypeOf(_class29.prototype),"copy",this).call(this,t),this.meshPerAttribute=t.meshPerAttribute,this;}},{key:"clone",value:function clone(t){var e=_get(_getPrototypeOf(_class29.prototype),"clone",this).call(this,t);return e.meshPerAttribute=this.meshPerAttribute,e;}},{key:"toJSON",value:function toJSON(t){var e=_get(_getPrototypeOf(_class29.prototype),"toJSON",this).call(this,t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e;}}]);return _class29;}(so),t.InstancedMesh=Ko,t.Int16BufferAttribute=/*#__PURE__*/function(_Mi7){_inherits(_class30,_Mi7);var _super140=_createSuper(_class30);function _class30(t,e,n){_classCallCheck(this,_class30);return _super140.call(this,new Int16Array(t),e,n);}return _createClass(_class30);}(Mi),t.Int32BufferAttribute=/*#__PURE__*/function(_Mi8){_inherits(_class31,_Mi8);var _super141=_createSuper(_class31);function _class31(t,e,n){_classCallCheck(this,_class31);return _super141.call(this,new Int32Array(t),e,n);}return _createClass(_class31);}(Mi),t.Int8BufferAttribute=/*#__PURE__*/function(_Mi9){_inherits(_class32,_Mi9);var _super142=_createSuper(_class32);function _class32(t,e,n){_classCallCheck(this,_class32);return _super142.call(this,new Int8Array(t),e,n);}return _createClass(_class32);}(Mi),t.IntType=z,t.InterleavedBuffer=so,t.InterleavedBufferAttribute=oo,t.Interpolant=xh,t.InterpolateDiscrete=Ct,t.InterpolateLinear=Lt,t.InterpolateSmooth=Pt,t.InvertStencilOp=5386,t.KeepStencilOp=Yt,t.KeyframeTrack=bh,t.LOD=Ao,t.LatheGeometry=nc,t.Layers=In,t.LessCompare=513,t.LessDepth=2,t.LessEqualCompare=515,t.LessEqualDepth=3,t.LessEqualStencilFunc=515,t.LessStencilFunc=513,t.Light=Hh,t.LightProbe=su,t.Line=Ml,t.Line3=/*#__PURE__*/function(){function _class33(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new We();var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new We();_classCallCheck(this,_class33);this.start=t,this.end=e;}_createClass(_class33,[{key:"set",value:function set(t,e){return this.start.copy(t),this.end.copy(e),this;}},{key:"copy",value:function copy(t){return this.start.copy(t.start),this.end.copy(t.end),this;}},{key:"getCenter",value:function getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5);}},{key:"delta",value:function delta(t){return t.subVectors(this.end,this.start);}},{key:"distanceSq",value:function distanceSq(){return this.start.distanceToSquared(this.end);}},{key:"distance",value:function distance(){return this.start.distanceTo(this.end);}},{key:"at",value:function at(t,e){return this.delta(e).multiplyScalar(t).add(this.start);}},{key:"closestPointToPointParameter",value:function closestPointToPointParameter(t,e){Wu.subVectors(t,this.start),Xu.subVectors(this.end,this.start);var n=Xu.dot(Xu);var i=Xu.dot(Wu)/n;return e&&(i=ae(i,0,1)),i;}},{key:"closestPointToPoint",value:function closestPointToPoint(t,e,n){var i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start);}},{key:"applyMatrix4",value:function applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this;}},{key:"equals",value:function equals(t){return t.start.equals(this.start)&&t.end.equals(this.end);}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}}]);return _class33;}(),t.LineBasicMaterial=fl,t.LineCurve=Yl,t.LineCurve3=Zl,t.LineDashedMaterial=dh,t.LineLoop=El,t.LineSegments=Tl,t.LinearDisplayP3ColorSpace=kt,t.LinearEncoding=Ft,t.LinearFilter=D,t.LinearInterpolant=Mh,t.LinearMipMapLinearFilter=1008,t.LinearMipMapNearestFilter=1007,t.LinearMipmapLinearFilter=O,t.LinearMipmapNearestFilter=N,t.LinearSRGBColorSpace=Ht,t.LinearToneMapping=m,t.LinearTransfer=Wt,t.Loader=Oh,t.LoaderUtils=ou,t.LoadingManager=Dh,t.LoopOnce=2200,t.LoopPingPong=2202,t.LoopRepeat=2201,t.LuminanceAlphaFormat=1025,t.LuminanceFormat=1024,t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},t.Material=di,t.MaterialLoader=au,t.MathUtils=pe,t.Matrix3=fe,t.Matrix4=Mn,t.MaxEquation=104,t.Mesh=Ji,t.MeshBasicMaterial=pi,t.MeshDepthMaterial=Ha,t.MeshDistanceMaterial=Va,t.MeshLambertMaterial=hh,t.MeshMatcapMaterial=uh,t.MeshNormalMaterial=ch,t.MeshPhongMaterial=oh,t.MeshPhysicalMaterial=ah,t.MeshStandardMaterial=sh,t.MeshToonMaterial=lh,t.MinEquation=103,t.MirroredRepeatWrapping=L,t.MixOperation=u,t.MultiplyBlending=4,t.MultiplyOperation=h,t.NearestFilter=P,t.NearestMipMapLinearFilter=1005,t.NearestMipMapNearestFilter=1004,t.NearestMipmapLinearFilter=U,t.NearestMipmapNearestFilter=I,t.NeverCompare=512,t.NeverDepth=0,t.NeverStencilFunc=512,t.NoBlending=0,t.NoColorSpace=zt,t.NoToneMapping=p,t.NormalAnimationBlendMode=Nt,t.NormalBlending=1,t.NotEqualCompare=517,t.NotEqualDepth=7,t.NotEqualStencilFunc=517,t.NumberKeyframeTrack=wh,t.Object3D=jn,t.ObjectLoader=/*#__PURE__*/function(_Oh11){_inherits(_class34,_Oh11);var _super143=_createSuper(_class34);function _class34(t){_classCallCheck(this,_class34);return _super143.call(this,t);}_createClass(_class34,[{key:"load",value:function load(t,e,n,i){var r=this,s=""===this.path?ou.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;var a=new zh(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(n){var s=null;try{s=JSON.parse(n);}catch(e){return void 0!==i&&i(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message);}var a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())return void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+t)),void console.error("THREE.ObjectLoader: Can't load "+t);r.parse(s,e);},n,i);}},{key:"loadAsync",value:function(){var _loadAsync=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(t,e){var n,i,r,s,a;return _regeneratorRuntime().wrap(function _callee2$(_context8){while(1)switch(_context8.prev=_context8.next){case 0:n=""===this.path?ou.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;i=new zh(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);_context8.next=6;return i.loadAsync(t,e);case 6:r=_context8.sent;s=JSON.parse(r);a=s.metadata;if(!(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())){_context8.next=11;break;}throw new Error("THREE.ObjectLoader: Can't load "+t);case 11:_context8.next=13;return this.parseAsync(s);case 13:return _context8.abrupt("return",_context8.sent);case 14:case"end":return _context8.stop();}},_callee2,this);}));function loadAsync(_x5,_x6){return _loadAsync.apply(this,arguments);}return loadAsync;}()},{key:"parse",value:function parse(t,e){var n=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,i),s=this.parseImages(t.images,function(){void 0!==e&&e(l);}),a=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,r,o,a,n),c=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,c),void 0!==e){var _t319=!1;for(var _e317 in s)if(s[_e317].data instanceof HTMLImageElement){_t319=!0;break;}!1===_t319&&e(l);}return l;}},{key:"parseAsync",value:function(){var _parseAsync=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(t){var e,n,i,r,s,a,o,l;return _regeneratorRuntime().wrap(function _callee3$(_context9){while(1)switch(_context9.prev=_context9.next){case 0:e=this.parseAnimations(t.animations);n=this.parseShapes(t.shapes);i=this.parseGeometries(t.geometries,n);_context9.next=5;return this.parseImagesAsync(t.images);case 5:r=_context9.sent;s=this.parseTextures(t.textures,r);a=this.parseMaterials(t.materials,s);o=this.parseObject(t.object,i,a,s,e);l=this.parseSkeletons(t.skeletons,o);return _context9.abrupt("return",(this.bindSkeletons(o,l),o));case 11:case"end":return _context9.stop();}},_callee3,this);}));function parseAsync(_x7){return _parseAsync.apply(this,arguments);}return parseAsync;}()},{key:"parseShapes",value:function parseShapes(t){var e={};if(void 0!==t)for(var _n279=0,_i218=t.length;_n279<_i218;_n279++){var _i219=new mc().fromJSON(t[_n279]);e[_i219.uuid]=_i219;}return e;}},{key:"parseSkeletons",value:function parseSkeletons(t,e){var n={},i={};if(e.traverse(function(t){t.isBone&&(i[t.uuid]=t);}),void 0!==t)for(var _e318=0,_r164=t.length;_e318<_r164;_e318++){var _r165=new Vo().fromJSON(t[_e318],i);n[_r165.uuid]=_r165;}return n;}},{key:"parseGeometries",value:function parseGeometries(t,e){var n={};if(void 0!==t){var _i220=new cu();for(var _r166=0,_s101=t.length;_r166<_s101;_r166++){var _s102=void 0;var _a83=t[_r166];switch(_a83.type){case"BufferGeometry":case"InstancedBufferGeometry":_s102=_i220.parse(_a83);break;default:_a83.type in nh?_s102=nh[_a83.type].fromJSON(_a83,e):console.warn("THREE.ObjectLoader: Unsupported geometry type \"".concat(_a83.type,"\""));}_s102.uuid=_a83.uuid,void 0!==_a83.name&&(_s102.name=_a83.name),void 0!==_a83.userData&&(_s102.userData=_a83.userData),n[_a83.uuid]=_s102;}}return n;}},{key:"parseMaterials",value:function parseMaterials(t,e){var n={},i={};if(void 0!==t){var _r167=new au();_r167.setTextures(e);for(var _e319=0,_s103=t.length;_e319<_s103;_e319++){var _s104=t[_e319];void 0===n[_s104.uuid]&&(n[_s104.uuid]=_r167.parse(_s104)),i[_s104.uuid]=n[_s104.uuid];}}return i;}},{key:"parseAnimations",value:function parseAnimations(t){var e={};if(void 0!==t)for(var _n280=0;_n280<t.length;_n280++){var _i221=t[_n280],_r168=Ph.parse(_i221);e[_r168.uuid]=_r168;}return e;}},{key:"parseImages",value:function parseImages(t,e){var n=this,i={};var r;function s(t){if("string"==typeof t){var _e320=t;return function(t){return n.manager.itemStart(t),r.load(t,function(){n.manager.itemEnd(t);},void 0,function(){n.manager.itemError(t),n.manager.itemEnd(t);});}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(_e320)?_e320:n.resourcePath+_e320);}return t.data?{data:xe(t.type,t.data),width:t.width,height:t.height}:null;}if(void 0!==t&&t.length>0){var _n281=new Dh(e);r=new Gh(_n281),r.setCrossOrigin(this.crossOrigin);for(var _e321=0,_n282=t.length;_e321<_n282;_e321++){var _n283=t[_e321],_r169=_n283.url;if(Array.isArray(_r169)){var _t320=[];for(var _e322=0,_n284=_r169.length;_e322<_n284;_e322++){var _n285=s(_r169[_e322]);null!==_n285&&(_n285 instanceof HTMLImageElement?_t320.push(_n285):_t320.push(new zo(_n285.data,_n285.width,_n285.height)));}i[_n283.uuid]=new De(_t320);}else{var _t321=s(_n283.url);i[_n283.uuid]=new De(_t321);}}}return i;}},{key:"parseImagesAsync",value:function(){var _parseImagesAsync=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(t){var e,n,i,r,_r170,_e323,_i222,_i223,_s105,_t322,_e324,_n286,_n287,_i224,_t323;return _regeneratorRuntime().wrap(function _callee5$(_context11){while(1)switch(_context11.prev=_context11.next){case 0:_r170=function _r173(){_r170=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(t){var _n288,_r171;return _regeneratorRuntime().wrap(function _callee4$(_context10){while(1)switch(_context10.prev=_context10.next){case 0:if(!("string"==typeof t)){_context10.next=5;break;}_n288=t,_r171=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(_n288)?_n288:e.resourcePath+_n288;_context10.next=4;return i.loadAsync(_r171);case 4:return _context10.abrupt("return",_context10.sent);case 5:return _context10.abrupt("return",t.data?{data:xe(t.type,t.data),width:t.width,height:t.height}:null);case 6:case"end":return _context10.stop();}},_callee4);}));return _r170.apply(this,arguments);};r=function _r172(_x9){return _r170.apply(this,arguments);};e=this,n={};if(!(void 0!==t&&t.length>0)){_context11.next=30;break;}i=new Gh(this.manager),i.setCrossOrigin(this.crossOrigin);_e323=0,_i222=t.length;case 6:if(!(_e323<_i222)){_context11.next=30;break;}_i223=t[_e323],_s105=_i223.url;if(!Array.isArray(_s105)){_context11.next=23;break;}_t322=[];_e324=0,_n286=_s105.length;case 11:if(!(_e324<_n286)){_context11.next=20;break;}_n287=_s105[_e324];_context11.next=15;return r(_n287);case 15:_i224=_context11.sent;null!==_i224&&(_i224 instanceof HTMLImageElement?_t322.push(_i224):_t322.push(new zo(_i224.data,_i224.width,_i224.height)));case 17:_e324++;_context11.next=11;break;case 20:n[_i223.uuid]=new De(_t322);_context11.next=27;break;case 23:_context11.next=25;return r(_i223.url);case 25:_t323=_context11.sent;n[_i223.uuid]=new De(_t323);case 27:_e323++;_context11.next=6;break;case 30:return _context11.abrupt("return",n);case 31:case"end":return _context11.stop();}},_callee5,this);}));function parseImagesAsync(_x8){return _parseImagesAsync.apply(this,arguments);}return parseImagesAsync;}()},{key:"parseTextures",value:function parseTextures(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t]);}var i={};if(void 0!==t)for(var r=0,_s106=t.length;r<_s106;r++){var _s107=t[r];void 0===_s107.image&&console.warn('THREE.ObjectLoader: No "image" specified for',_s107.uuid),void 0===e[_s107.image]&&console.warn("THREE.ObjectLoader: Undefined image",_s107.image);var _a84=e[_s107.image],_o60=_a84.data;var _l34=void 0;Array.isArray(_o60)?(_l34=new lr(),6===_o60.length&&(_l34.needsUpdate=!0)):(_l34=_o60&&_o60.data?new zo():new Fe(),_o60&&(_l34.needsUpdate=!0)),_l34.source=_a84,_l34.uuid=_s107.uuid,void 0!==_s107.name&&(_l34.name=_s107.name),void 0!==_s107.mapping&&(_l34.mapping=n(_s107.mapping,hu)),void 0!==_s107.channel&&(_l34.channel=_s107.channel),void 0!==_s107.offset&&_l34.offset.fromArray(_s107.offset),void 0!==_s107.repeat&&_l34.repeat.fromArray(_s107.repeat),void 0!==_s107.center&&_l34.center.fromArray(_s107.center),void 0!==_s107.rotation&&(_l34.rotation=_s107.rotation),void 0!==_s107.wrap&&(_l34.wrapS=n(_s107.wrap[0],uu),_l34.wrapT=n(_s107.wrap[1],uu)),void 0!==_s107.format&&(_l34.format=_s107.format),void 0!==_s107.internalFormat&&(_l34.internalFormat=_s107.internalFormat),void 0!==_s107.type&&(_l34.type=_s107.type),void 0!==_s107.colorSpace&&(_l34.colorSpace=_s107.colorSpace),void 0!==_s107.encoding&&(_l34.encoding=_s107.encoding),void 0!==_s107.minFilter&&(_l34.minFilter=n(_s107.minFilter,du)),void 0!==_s107.magFilter&&(_l34.magFilter=n(_s107.magFilter,du)),void 0!==_s107.anisotropy&&(_l34.anisotropy=_s107.anisotropy),void 0!==_s107.flipY&&(_l34.flipY=_s107.flipY),void 0!==_s107.generateMipmaps&&(_l34.generateMipmaps=_s107.generateMipmaps),void 0!==_s107.premultiplyAlpha&&(_l34.premultiplyAlpha=_s107.premultiplyAlpha),void 0!==_s107.unpackAlignment&&(_l34.unpackAlignment=_s107.unpackAlignment),void 0!==_s107.compareFunction&&(_l34.compareFunction=_s107.compareFunction),void 0!==_s107.userData&&(_l34.userData=_s107.userData),i[_s107.uuid]=_l34;}return i;}},{key:"parseObject",value:function parseObject(t,e,n,i,r){var s,a,o;function l(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t];}function c(t){if(void 0!==t){if(Array.isArray(t)){var _e325=[];for(var _i225=0,_r174=t.length;_i225<_r174;_i225++){var _r175=t[_i225];void 0===n[_r175]&&console.warn("THREE.ObjectLoader: Undefined material",_r175),_e325.push(n[_r175]);}return _e325;}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t];}}function h(t){return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),i[t];}switch(t.type){case"Scene":s=new ro(),void 0!==t.background&&(Number.isInteger(t.background)?s.background=new ci(t.background):s.background=h(t.background)),void 0!==t.environment&&(s.environment=h(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new io(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new no(t.fog.color,t.fog.density)),""!==t.fog.name&&(s.fog.name=t.fog.name)),void 0!==t.backgroundBlurriness&&(s.backgroundBlurriness=t.backgroundBlurriness),void 0!==t.backgroundIntensity&&(s.backgroundIntensity=t.backgroundIntensity);break;case"PerspectiveCamera":s=new sr(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new Lr(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new nu(t.color,t.intensity);break;case"DirectionalLight":s=new eu(t.color,t.intensity);break;case"PointLight":s=new Qh(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new iu(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new Yh(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new Vh(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=new su().fromJSON(t);break;case"SkinnedMesh":a=l(t.geometry),o=c(t.material),s=new Fo(a,o),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":a=l(t.geometry),o=c(t.material),s=new Ji(a,o);break;case"InstancedMesh":a=l(t.geometry),o=c(t.material);var _e326=t.count,_n289=t.instanceMatrix,_i226=t.instanceColor;s=new Ko(a,o,_e326),s.instanceMatrix=new ko(new Float32Array(_n289.array),16),void 0!==_i226&&(s.instanceColor=new ko(new Float32Array(_i226.array),_i226.itemSize));break;case"BatchedMesh":a=l(t.geometry),o=c(t.material),s=new ml(t.maxGeometryCount,t.maxVertexCount,t.maxIndexCount,o),s.geometry=a,s.perObjectFrustumCulled=t.perObjectFrustumCulled,s.sortObjects=t.sortObjects,s._drawRanges=t.drawRanges,s._reservedRanges=t.reservedRanges,s._visibility=t.visibility,s._active=t.active,s._bounds=t.bounds.map(function(t){var e=new qe();e.min.fromArray(t.boxMin),e.max.fromArray(t.boxMax);var n=new dn();return n.radius=t.sphereRadius,n.center.fromArray(t.sphereCenter),{boxInitialized:t.boxInitialized,box:e,sphereInitialized:t.sphereInitialized,sphere:n};}),s._maxGeometryCount=t.maxGeometryCount,s._maxVertexCount=t.maxVertexCount,s._maxIndexCount=t.maxIndexCount,s._geometryInitialized=t.geometryInitialized,s._geometryCount=t.geometryCount,s._matricesTexture=h(t.matricesTexture.uuid);break;case"LOD":s=new Ao();break;case"Line":s=new Ml(l(t.geometry),c(t.material));break;case"LineLoop":s=new El(l(t.geometry),c(t.material));break;case"LineSegments":s=new Tl(l(t.geometry),c(t.material));break;case"PointCloud":case"Points":s=new Pl(l(t.geometry),c(t.material));break;case"Sprite":s=new bo(c(t.material));break;case"Group":s=new Ya();break;case"Bone":s=new Bo();break;default:s=new jn();}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.up&&s.up.fromArray(t.up),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){var _a85=t.children;for(var _t324=0;_t324<_a85.length;_t324++)s.add(this.parseObject(_a85[_t324],e,n,i,r));}if(void 0!==t.animations){var _e327=t.animations;for(var _t325=0;_t325<_e327.length;_t325++){var _n290=_e327[_t325];s.animations.push(r[_n290]);}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);var _e328=t.levels;for(var _t326=0;_t326<_e328.length;_t326++){var _n291=_e328[_t326],_i227=s.getObjectByProperty("uuid",_n291.object);void 0!==_i227&&s.addLevel(_i227,_n291.distance,_n291.hysteresis);}}return s;}},{key:"bindSkeletons",value:function bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse(function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){var _n292=e[t.skeleton];void 0===_n292?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(_n292,t.bindMatrix);}});}}]);return _class34;}(Oh),t.ObjectSpaceNormalMap=1,t.OctahedronGeometry=jc,t.OneFactor=201,t.OneMinusConstantAlphaFactor=214,t.OneMinusConstantColorFactor=212,t.OneMinusDstAlphaFactor=207,t.OneMinusDstColorFactor=209,t.OneMinusSrcAlphaFactor=c,t.OneMinusSrcColorFactor=203,t.OrthographicCamera=Lr,t.P3Primaries=qt,t.PCFShadowMap=n,t.PCFSoftShadowMap=i,t.PMREMGenerator=Hr,t.Path=ec,t.PerspectiveCamera=sr,t.Plane=pr,t.PlaneGeometry=xr,t.PlaneHelper=/*#__PURE__*/function(_Ml3){_inherits(_class35,_Ml3);var _super144=_createSuper(_class35);function _class35(t){var _this119;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:16776960;_classCallCheck(this,_class35);var i=n,r=new Ii();r.setAttribute("position",new Ti([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere(),_this119=_super144.call(this,r,new fl({color:i,toneMapped:!1})),_this119.type="PlaneHelper",_this119.plane=t,_this119.size=e;var s=new Ii();s.setAttribute("position",new Ti([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),_this119.add(new Ji(s,new pi({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})));return _this119;}_createClass(_class35,[{key:"updateMatrixWorld",value:function updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),_get(_getPrototypeOf(_class35.prototype),"updateMatrixWorld",this).call(this,t);}},{key:"dispose",value:function dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose();}}]);return _class35;}(Ml),t.PointLight=Qh,t.PointLightHelper=/*#__PURE__*/function(_Ji4){_inherits(_class36,_Ji4);var _super145=_createSuper(_class36);function _class36(t,e,n){var _this120;_classCallCheck(this,_class36);_this120=_super145.call(this,new Zc(e,4,2),new pi({wireframe:!0,fog:!1,toneMapped:!1})),_this120.light=t,_this120.color=n,_this120.type="PointLightHelper",_this120.matrix=_this120.light.matrixWorld,_this120.matrixAutoUpdate=!1,_this120.update();return _this120;}_createClass(_class36,[{key:"dispose",value:function dispose(){this.geometry.dispose(),this.material.dispose();}},{key:"update",value:function update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color);}}]);return _class36;}(Ji),t.Points=Pl,t.PointsMaterial=wl,t.PolarGridHelper=/*#__PURE__*/function(_Tl6){_inherits(_class37,_Tl6);var _super146=_createSuper(_class37);function _class37(){var _this121;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:10;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:16;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:8;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:64;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:4473924;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:8947848;_classCallCheck(this,_class37);r=new ci(r),s=new ci(s);var a=[],o=[];if(e>1)for(var _n293=0;_n293<e;_n293++){var _i228=_n293/e*(2*Math.PI),_l35=Math.sin(_i228)*t,_c27=Math.cos(_i228)*t;a.push(0,0,0),a.push(_l35,0,_c27);var _h19=1&_n293?r:s;o.push(_h19.r,_h19.g,_h19.b),o.push(_h19.r,_h19.g,_h19.b);}for(var _e329=0;_e329<n;_e329++){var _l36=1&_e329?r:s,_c28=t-t/n*_e329;for(var _t327=0;_t327<i;_t327++){var _e330=_t327/i*(2*Math.PI),_n294=Math.sin(_e330)*_c28,_r176=Math.cos(_e330)*_c28;a.push(_n294,0,_r176),o.push(_l36.r,_l36.g,_l36.b),_e330=(_t327+1)/i*(2*Math.PI),_n294=Math.sin(_e330)*_c28,_r176=Math.cos(_e330)*_c28,a.push(_n294,0,_r176),o.push(_l36.r,_l36.g,_l36.b);}}var l=new Ii();l.setAttribute("position",new Ti(a,3)),l.setAttribute("color",new Ti(o,3));_this121=_super146.call(this,l,new fl({vertexColors:!0,toneMapped:!1})),_this121.type="PolarGridHelper";return _this121;}_createClass(_class37,[{key:"dispose",value:function dispose(){this.geometry.dispose(),this.material.dispose();}}]);return _class37;}(Tl),t.PolyhedronGeometry=oc,t.PositionalAudio=/*#__PURE__*/function(_Tu){_inherits(_class38,_Tu);var _super147=_createSuper(_class38);function _class38(t){var _this122;_classCallCheck(this,_class38);_this122=_super147.call(this,t),_this122.panner=_this122.context.createPanner(),_this122.panner.panningModel="HRTF",_this122.panner.connect(_this122.gain);return _this122;}_createClass(_class38,[{key:"connect",value:function connect(){_get(_getPrototypeOf(_class38.prototype),"connect",this).call(this),this.panner.connect(this.gain);}},{key:"disconnect",value:function disconnect(){_get(_getPrototypeOf(_class38.prototype),"disconnect",this).call(this),this.panner.disconnect(this.gain);}},{key:"getOutput",value:function getOutput(){return this.panner;}},{key:"getRefDistance",value:function getRefDistance(){return this.panner.refDistance;}},{key:"setRefDistance",value:function setRefDistance(t){return this.panner.refDistance=t,this;}},{key:"getRolloffFactor",value:function getRolloffFactor(){return this.panner.rolloffFactor;}},{key:"setRolloffFactor",value:function setRolloffFactor(t){return this.panner.rolloffFactor=t,this;}},{key:"getDistanceModel",value:function getDistanceModel(){return this.panner.distanceModel;}},{key:"setDistanceModel",value:function setDistanceModel(t){return this.panner.distanceModel=t,this;}},{key:"getMaxDistance",value:function getMaxDistance(){return this.panner.maxDistance;}},{key:"setMaxDistance",value:function setMaxDistance(t){return this.panner.maxDistance=t,this;}},{key:"setDirectionalCone",value:function setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this;}},{key:"updateMatrixWorld",value:function updateMatrixWorld(t){if(_get(_getPrototypeOf(_class38.prototype),"updateMatrixWorld",this).call(this,t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Eu,wu,Au),Ru.set(0,0,1).applyQuaternion(wu);var e=this.panner;if(e.positionX){var _t328=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Eu.x,_t328),e.positionY.linearRampToValueAtTime(Eu.y,_t328),e.positionZ.linearRampToValueAtTime(Eu.z,_t328),e.orientationX.linearRampToValueAtTime(Ru.x,_t328),e.orientationY.linearRampToValueAtTime(Ru.y,_t328),e.orientationZ.linearRampToValueAtTime(Ru.z,_t328);}else e.setPosition(Eu.x,Eu.y,Eu.z),e.setOrientation(Ru.x,Ru.y,Ru.z);}}]);return _class38;}(Tu),t.PropertyBinding=Ou,t.PropertyMixer=Cu,t.QuadraticBezierCurve=Jl,t.QuadraticBezierCurve3=Kl,t.Quaternion=ke,t.QuaternionKeyframeTrack=Rh,t.QuaternionLinearInterpolant=Ah,t.RED_GREEN_RGTC2_Format=At,t.RED_RGTC1_Format=36283,t.REVISION=e,t.RGBADepthPacking=3201,t.RGBAFormat=j,t.RGBAIntegerFormat=K,t.RGBA_ASTC_10x10_Format=yt,t.RGBA_ASTC_10x5_Format=_t,t.RGBA_ASTC_10x6_Format=vt,t.RGBA_ASTC_10x8_Format=xt,t.RGBA_ASTC_12x10_Format=Mt,t.RGBA_ASTC_12x12_Format=St,t.RGBA_ASTC_4x4_Format=ct,t.RGBA_ASTC_5x4_Format=ht,t.RGBA_ASTC_5x5_Format=ut,t.RGBA_ASTC_6x5_Format=dt,t.RGBA_ASTC_6x6_Format=pt,t.RGBA_ASTC_8x5_Format=mt,t.RGBA_ASTC_8x6_Format=ft,t.RGBA_ASTC_8x8_Format=gt,t.RGBA_BPTC_Format=bt,t.RGBA_ETC2_EAC_Format=lt,t.RGBA_PVRTC_2BPPV1_Format=st,t.RGBA_PVRTC_4BPPV1_Format=rt,t.RGBA_S3TC_DXT1_Format=Q,t.RGBA_S3TC_DXT3_Format=tt,t.RGBA_S3TC_DXT5_Format=et,t.RGB_BPTC_SIGNED_Format=Tt,t.RGB_BPTC_UNSIGNED_Format=Et,t.RGB_ETC1_Format=at,t.RGB_ETC2_Format=ot,t.RGB_PVRTC_2BPPV1_Format=it,t.RGB_PVRTC_4BPPV1_Format=nt,t.RGB_S3TC_DXT1_Format=$,t.RGFormat=1030,t.RGIntegerFormat=J,t.RawShaderMaterial=rh,t.Ray=yn,t.Raycaster=/*#__PURE__*/function(){function _class39(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1/0;_classCallCheck(this,_class39);this.ray=new yn(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new In(),this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}};}_createClass(_class39,[{key:"set",value:function set(t,e){this.ray.set(t,e);}},{key:"setFromCamera",value:function setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type);}},{key:"intersectObject",value:function intersectObject(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];return Vu(t,this,n,e),n.sort(Hu),n;}},{key:"intersectObjects",value:function intersectObjects(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];for(var _i229=0,r=t.length;_i229<r;_i229++)Vu(t[_i229],this,n,e);return n.sort(Hu),n;}}]);return _class39;}(),t.Rec709Primaries=jt,t.RectAreaLight=iu,t.RedFormat=1028,t.RedIntegerFormat=Z,t.ReinhardToneMapping=f,t.RenderTarget=ze,t.RepeatWrapping=R,t.ReplaceStencilOp=7681,t.ReverseSubtractEquation=102,t.RingGeometry=qc,t.SIGNED_RED_GREEN_RGTC2_Format=Rt,t.SIGNED_RED_RGTC1_Format=wt,t.SRGBColorSpace=Gt,t.SRGBTransfer=Xt,t.Scene=ro,t.ShaderChunk=yr,t.ShaderLib=Sr,t.ShaderMaterial=ir,t.ShadowMaterial=ih,t.Shape=mc,t.ShapeGeometry=Yc,t.ShapePath=/*#__PURE__*/function(){function _class40(){_classCallCheck(this,_class40);this.type="ShapePath",this.color=new ci(),this.subPaths=[],this.currentPath=null;}_createClass(_class40,[{key:"moveTo",value:function moveTo(t,e){return this.currentPath=new ec(),this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this;}},{key:"lineTo",value:function lineTo(t,e){return this.currentPath.lineTo(t,e),this;}},{key:"quadraticCurveTo",value:function quadraticCurveTo(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this;}},{key:"bezierCurveTo",value:function bezierCurveTo(t,e,n,i,r,s){return this.currentPath.bezierCurveTo(t,e,n,i,r,s),this;}},{key:"splineThru",value:function splineThru(t){return this.currentPath.splineThru(t),this;}},{key:"toShapes",value:function toShapes(t){function e(t,e){var n=e.length;var i=!1;for(var _r177=n-1,_s108=0;_s108<n;_r177=_s108++){var _n295=e[_r177],_a86=e[_s108],_o61=_a86.x-_n295.x,_l37=_a86.y-_n295.y;if(Math.abs(_l37)>Number.EPSILON){if(_l37<0&&(_n295=e[_s108],_o61=-_o61,_a86=e[_r177],_l37=-_l37),t.y<_n295.y||t.y>_a86.y)continue;if(t.y===_n295.y){if(t.x===_n295.x)return!0;}else{var _e331=_l37*(t.x-_n295.x)-_o61*(t.y-_n295.y);if(0===_e331)return!0;if(_e331<0)continue;i=!i;}}else{if(t.y!==_n295.y)continue;if(_a86.x<=t.x&&t.x<=_n295.x||_n295.x<=t.x&&t.x<=_a86.x)return!0;}}return i;}var n=Gc.isClockWise,i=this.subPaths;if(0===i.length)return[];var r,s,a;var o=[];if(1===i.length)return s=i[0],a=new mc(),a.curves=s.curves,o.push(a),o;var l=!n(i[0].getPoints());l=t?!l:l;var c=[],h=[];var u,d,p=[],m=0;h[m]=void 0,p[m]=[];for(var _e332=0,_a87=i.length;_e332<_a87;_e332++)s=i[_e332],u=s.getPoints(),r=n(u),r=t?!r:r,r?(!l&&h[m]&&m++,h[m]={s:new mc(),p:u},h[m].s.curves=s.curves,l&&m++,p[m]=[]):p[m].push({h:s,p:u[0]});if(!h[0])return function(t){var e=[];for(var _n296=0,_i230=t.length;_n296<_i230;_n296++){var _i231=t[_n296],_r178=new mc();_r178.curves=_i231.curves,e.push(_r178);}return e;}(i);if(h.length>1){var _t329=!1,_n297=0;for(var _t330=0,_e333=h.length;_t330<_e333;_t330++)c[_t330]=[];for(var _i232=0,_r179=h.length;_i232<_r179;_i232++){var _r180=p[_i232];for(var _s109=0;_s109<_r180.length;_s109++){var _a88=_r180[_s109];var _o62=!0;for(var _r181=0;_r181<h.length;_r181++)e(_a88.p,h[_r181].p)&&(_i232!==_r181&&_n297++,_o62?(_o62=!1,c[_r181].push(_a88)):_t329=!0);_o62&&c[_i232].push(_a88);}}_n297>0&&!1===_t329&&(p=c);}for(var _t331=0,_e334=h.length;_t331<_e334;_t331++){a=h[_t331].s,o.push(a),d=p[_t331];for(var _t332=0,_e335=d.length;_t332<_e335;_t332++)a.holes.push(d[_t332].h);}return o;}}]);return _class40;}(),t.ShapeUtils=Gc,t.ShortType=1011,t.Skeleton=Vo,t.SkeletonHelper=/*#__PURE__*/function(_Tl7){_inherits(_class41,_Tl7);var _super148=_createSuper(_class41);function _class41(t){var _this123;_classCallCheck(this,_class41);var e=Ju(t),n=new Ii(),i=[],r=[],s=new ci(0,0,1),a=new ci(0,1,0);for(var _t333=0;_t333<e.length;_t333++){var _n298=e[_t333];_n298.parent&&_n298.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b));}n.setAttribute("position",new Ti(i,3)),n.setAttribute("color",new Ti(r,3));_this123=_super148.call(this,n,new fl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),_this123.isSkeletonHelper=!0,_this123.type="SkeletonHelper",_this123.root=t,_this123.bones=e,_this123.matrix=t.matrixWorld,_this123.matrixAutoUpdate=!1;return _this123;}_createClass(_class41,[{key:"updateMatrixWorld",value:function updateMatrixWorld(t){var e=this.bones,n=this.geometry,i=n.getAttribute("position");Zu.copy(this.root.matrixWorld).invert();for(var _t334=0,_n299=0;_t334<e.length;_t334++){var r=e[_t334];r.parent&&r.parent.isBone&&(Yu.multiplyMatrices(Zu,r.matrixWorld),qu.setFromMatrixPosition(Yu),i.setXYZ(_n299,qu.x,qu.y,qu.z),Yu.multiplyMatrices(Zu,r.parent.matrixWorld),qu.setFromMatrixPosition(Yu),i.setXYZ(_n299+1,qu.x,qu.y,qu.z),_n299+=2);}n.getAttribute("position").needsUpdate=!0,_get(_getPrototypeOf(_class41.prototype),"updateMatrixWorld",this).call(this,t);}},{key:"dispose",value:function dispose(){this.geometry.dispose(),this.material.dispose();}}]);return _class41;}(Tl),t.SkinnedMesh=Fo,t.Source=De,t.Sphere=dn,t.SphereGeometry=Zc,t.Spherical=/*#__PURE__*/function(){function _class42(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,_class42);return this.radius=t,this.phi=e,this.theta=n,this;}_createClass(_class42,[{key:"set",value:function set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this;}},{key:"copy",value:function copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this;}},{key:"makeSafe",value:function makeSafe(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this;}},{key:"setFromVector3",value:function setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z);}},{key:"setFromCartesianCoords",value:function setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(ae(e/this.radius,-1,1))),this;}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}}]);return _class42;}(),t.SphericalHarmonics3=ru,t.SplineCurve=$l,t.SpotLight=Yh,t.SpotLightHelper=/*#__PURE__*/function(_jn17){_inherits(_class43,_jn17);var _super149=_createSuper(_class43);function _class43(t,e){var _this124;_classCallCheck(this,_class43);_this124=_super149.call(this),_this124.light=t,_this124.matrix=t.matrixWorld,_this124.matrixAutoUpdate=!1,_this124.color=e,_this124.type="SpotLightHelper";var n=new Ii(),i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var _t335=0,_e336=1,_n300=32;_t335<_n300;_t335++,_e336++){var _r182=_t335/_n300*Math.PI*2,_s110=_e336/_n300*Math.PI*2;i.push(Math.cos(_r182),Math.sin(_r182),1,Math.cos(_s110),Math.sin(_s110),1);}n.setAttribute("position",new Ti(i,3));var r=new fl({fog:!1,toneMapped:!1});_this124.cone=new Tl(n,r),_this124.add(_this124.cone),_this124.update();return _this124;}_createClass(_class43,[{key:"dispose",value:function dispose(){this.cone.geometry.dispose(),this.cone.material.dispose();}},{key:"update",value:function update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),ju.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ju),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color);}}]);return _class43;}(jn),t.Sprite=bo,t.SpriteMaterial=lo,t.SrcAlphaFactor=l,t.SrcAlphaSaturateFactor=210,t.SrcColorFactor=202,t.StaticCopyUsage=35046,t.StaticDrawUsage=Zt,t.StaticReadUsage=35045,t.StereoCamera=/*#__PURE__*/function(){function _class44(){_classCallCheck(this,_class44);this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new sr(),this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new sr(),this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null};}_createClass(_class44,[{key:"update",value:function update(t){var e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,_u.copy(t.projectionMatrix);var _n301=e.eyeSep/2,_i233=_n301*e.near/e.focus,r=e.near*Math.tan(ie*e.fov*.5)/e.zoom;var _s111,_a89;gu.elements[12]=-_n301,fu.elements[12]=_n301,_s111=-r*e.aspect+_i233,_a89=r*e.aspect+_i233,_u.elements[0]=2*e.near/(_a89-_s111),_u.elements[8]=(_a89+_s111)/(_a89-_s111),this.cameraL.projectionMatrix.copy(_u),_s111=-r*e.aspect-_i233,_a89=r*e.aspect-_i233,_u.elements[0]=2*e.near/(_a89-_s111),_u.elements[8]=(_a89+_s111)/(_a89-_s111),this.cameraR.projectionMatrix.copy(_u);}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(gu),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(fu);}}]);return _class44;}(),t.StreamCopyUsage=35042,t.StreamDrawUsage=35040,t.StreamReadUsage=35041,t.StringKeyframeTrack=Ch,t.SubtractEquation=101,t.SubtractiveBlending=3,t.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},t.TangentSpaceNormalMap=0,t.TetrahedronGeometry=Jc,t.Texture=Fe,t.TextureLoader=/*#__PURE__*/function(_Oh12){_inherits(_class45,_Oh12);var _super150=_createSuper(_class45);function _class45(t){_classCallCheck(this,_class45);return _super150.call(this,t);}_createClass(_class45,[{key:"load",value:function load(t,e,n,i){var r=new Fe(),s=new Gh(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r);},n,i),r;}}]);return _class45;}(Oh),t.TorusGeometry=Kc,t.TorusKnotGeometry=$c,t.Triangle=ri,t.TriangleFanDrawMode=2,t.TriangleStripDrawMode=1,t.TrianglesDrawMode=0,t.TubeGeometry=Qc,t.TwoPassDoubleSide=2,t.UVMapping=S,t.Uint16BufferAttribute=Si,t.Uint32BufferAttribute=bi,t.Uint8BufferAttribute=/*#__PURE__*/function(_Mi10){_inherits(_class46,_Mi10);var _super151=_createSuper(_class46);function _class46(t,e,n){_classCallCheck(this,_class46);return _super151.call(this,new Uint8Array(t),e,n);}return _createClass(_class46);}(Mi),t.Uint8ClampedBufferAttribute=/*#__PURE__*/function(_Mi11){_inherits(_class47,_Mi11);var _super152=_createSuper(_class47);function _class47(t,e,n){_classCallCheck(this,_class47);return _super152.call(this,new Uint8ClampedArray(t),e,n);}return _createClass(_class47);}(Mi),t.Uniform=zu,t.UniformsGroup=/*#__PURE__*/function(_te8){_inherits(_class48,_te8);var _super153=_createSuper(_class48);function _class48(){var _this125;_classCallCheck(this,_class48);_this125=_super153.call(this),_this125.isUniformsGroup=!0,Object.defineProperty(_assertThisInitialized(_this125),"id",{value:Gu++}),_this125.name="",_this125.usage=Zt,_this125.uniforms=[];return _this125;}_createClass(_class48,[{key:"add",value:function add(t){return this.uniforms.push(t),this;}},{key:"remove",value:function remove(t){var e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this;}},{key:"setName",value:function setName(t){return this.name=t,this;}},{key:"setUsage",value:function setUsage(t){return this.usage=t,this;}},{key:"dispose",value:function dispose(){return this.dispatchEvent({type:"dispose"}),this;}},{key:"copy",value:function copy(t){this.name=t.name,this.usage=t.usage;var e=t.uniforms;this.uniforms.length=0;for(var _t336=0,_n302=e.length;_t336<_n302;_t336++){var _n303=Array.isArray(e[_t336])?e[_t336]:[e[_t336]];for(var _t337=0;_t337<_n303.length;_t337++)this.uniforms.push(_n303[_t337].clone());}return this;}},{key:"clone",value:function clone(){return new this.constructor().copy(this);}}]);return _class48;}(te),t.UniformsLib=Mr,t.UniformsUtils=nr,t.UnsignedByteType=F,t.UnsignedInt248Type=X,t.UnsignedIntType=G,t.UnsignedShort4444Type=k,t.UnsignedShort5551Type=W,t.UnsignedShortType=B,t.VSMShadowMap=r,t.Vector2=me,t.Vector3=We,t.Vector4=Be,t.VectorKeyframeTrack=Lh,t.VideoTexture=/*#__PURE__*/function(_Fe9){_inherits(_class49,_Fe9);var _super154=_createSuper(_class49);function _class49(t,e,n,i,r,s,a,o,l){var _this126;_classCallCheck(this,_class49);_this126=_super154.call(this,t,e,n,i,r,s,a,o,l),_this126.isVideoTexture=!0,_this126.minFilter=void 0!==s?s:D,_this126.magFilter=void 0!==r?r:D,_this126.generateMipmaps=!1;var c=_assertThisInitialized(_this126);"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e);});return _this126;}_createClass(_class49,[{key:"clone",value:function clone(){return new this.constructor(this.image).copy(this);}},{key:"update",value:function update(){var t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0);}}]);return _class49;}(Fe),t.WebGL1Renderer=eo,t.WebGL3DRenderTarget=/*#__PURE__*/function(_Ge2){_inherits(_class50,_Ge2);var _super155=_createSuper(_class50);function _class50(){var _this127;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};_classCallCheck(this,_class50);_this127=_super155.call(this,t,e,i),_this127.isWebGL3DRenderTarget=!0,_this127.depth=n,_this127.texture=new Ve(null,t,e,n),_this127.texture.isRenderTargetTexture=!0;return _this127;}return _createClass(_class50);}(Ge),t.WebGLArrayRenderTarget=/*#__PURE__*/function(_Ge3){_inherits(_class51,_Ge3);var _super156=_createSuper(_class51);function _class51(){var _this128;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};_classCallCheck(this,_class51);_this128=_super156.call(this,t,e,i),_this128.isWebGLArrayRenderTarget=!0,_this128.depth=n,_this128.texture=new He(null,t,e,n),_this128.texture.isRenderTargetTexture=!0;return _this128;}return _createClass(_class51);}(Ge),t.WebGLCoordinateSystem=$t,t.WebGLCubeRenderTarget=cr,t.WebGLMultipleRenderTargets=/*#__PURE__*/function(_Ge4){_inherits(_class52,_Ge4);var _super157=_createSuper(_class52);function _class52(){var _this129;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};_classCallCheck(this,_class52);_this129=_super157.call(this,t,e,i),_this129.isWebGLMultipleRenderTargets=!0;var r=_this129.texture;_this129.texture=[];for(var _t338=0;_t338<n;_t338++)_this129.texture[_t338]=r.clone(),_this129.texture[_t338].isRenderTargetTexture=!0;return _this129;}_createClass(_class52,[{key:"setSize",value:function setSize(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(var _i234=0,r=this.texture.length;_i234<r;_i234++)this.texture[_i234].image.width=t,this.texture[_i234].image.height=e,this.texture[_i234].image.depth=n;this.dispose();}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e);}},{key:"copy",value:function copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(var _e337=0,_n304=t.texture.length;_e337<_n304;_e337++)this.texture[_e337]=t.texture[_e337].clone(),this.texture[_e337].isRenderTargetTexture=!0;return this;}}]);return _class52;}(Ge),t.WebGLRenderTarget=Ge,t.WebGLRenderer=to,t.WebGLUtils=ja,t.WebGPUCoordinateSystem=Qt,t.WireframeGeometry=th,t.WrapAroundEnding=Dt,t.ZeroCurvatureEnding=It,t.ZeroFactor=200,t.ZeroSlopeEnding=Ut,t.ZeroStencilOp=0,t._SRGBAFormat=Kt,t.createCanvasElement=Me,t.sRGBEncoding=Bt;});